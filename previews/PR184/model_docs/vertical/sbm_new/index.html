<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>wflow_sbm (new description) · Wflow.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link rel="canonical" href="https://deltares.github.io/Wflow.jl/model_docs/vertical/sbm_new/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Wflow.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Wflow.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../../">About wflow</a></li><li><a class="tocitem" href="../../../intro/use_cases/">Case studies using wflow</a></li><li><a class="tocitem" href="../../../intro/publications/">Publications about wflow</a></li></ul></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../../../user_guide/intro/">About the user guide</a></li><li><a class="tocitem" href="../../../user_guide/install/">How to install</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">How to use wflow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../user_guide/step1_requirements/">Step 1: Understanding the requirements</a></li><li><a class="tocitem" href="../../../user_guide/step2_settings_file/">Step 2: Preparing the settings file</a></li><li><a class="tocitem" href="../../../user_guide/step3_input_data/">Step 3: Preparing the input data</a></li><li><a class="tocitem" href="../../../user_guide/step4_running/">Step 4: Running a simulation</a></li><li><a class="tocitem" href="../../../user_guide/step5_output/">Step 5: Analyzing the model output</a></li><li><a class="tocitem" href="../../../user_guide/additional_options/">Additional wflow options</a></li><li><a class="tocitem" href="../../../user_guide/sample_data/">Tutorial models</a></li></ul></li><li><a class="tocitem" href="../../../user_guide/model-setup/">Building a model from scratch</a></li></ul></li><li><span class="tocitem">Model documentation</span><ul><li><a class="tocitem" href="../../intro/">About the model documentation</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Vertical concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../sbm/">wflow_sbm</a></li><li class="is-active"><a class="tocitem" href>wflow_sbm (new description)</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Precipitation"><span>Precipitation</span></a></li><li><a class="tocitem" href="#interception"><span>Rainfall interception</span></a></li><li><a class="tocitem" href="#evap"><span>Evaporation</span></a></li><li><a class="tocitem" href="#snow"><span>Snow and glaciers</span></a></li><li><a class="tocitem" href="#soil"><span>Soil processes</span></a></li><li><a class="tocitem" href="#Open-water"><span>Open water</span></a></li></ul></li><li><a class="tocitem" href="../hbv/">wflow_hbv</a></li><li><a class="tocitem" href="../sediment/">wflow_sediment</a></li><li><a class="tocitem" href="../../shared_concepts/">Shared model concepts</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Lateral concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lateral/gwf/">Groundwater flow</a></li><li><a class="tocitem" href="../../lateral/kinwave/">Kinematic wave</a></li><li><a class="tocitem" href="../../lateral/sediment_flux/">Sediment flux</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Model parameters</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../params_vertical/">Parameters vertical concepts</a></li><li><a class="tocitem" href="../../params_lateral/">Parameters lateral concepts</a></li><li><a class="tocitem" href="../../structures/">Julia structures</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model documentation</a></li><li><a class="is-disabled">Vertical concepts</a></li><li class="is-active"><a href>wflow_sbm (new description)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>wflow_sbm (new description)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Deltares/Wflow.jl/blob/master/docs/src/model_docs/vertical/sbm_new.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="wflow_sbm-(new-description)"><a class="docs-heading-anchor" href="#wflow_sbm-(new-description)">wflow_sbm (new description)</a><a id="wflow_sbm-(new-description)-1"></a><a class="docs-heading-anchor-permalink" href="#wflow_sbm-(new-description)" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>The soil part of wflow_sbm model concept is largely based on the Topog_sbm mode, but  has had considerable changes over time. The main changes in wflow_sbm are:</p><ul><li>The unsaturated zone can be split up in different layers</li><li>The addition of evapotranspiration losses</li><li>The addition of capillary rise</li><li>Wflow_sbm routes water over a D8 network instead of an element network based on contour lines and trajectories</li></ul><p>For the lateral components of this wflow_sbm model water is routed over a D8 network, and the kinematic wave approach is used for river, overland and lateral subsurface flow. This is described in more detail in the section [Kinematic wave].</p><p>An overview of the different processes and fluxes in the wflow_sbm model:</p><p><img src="../../../images/wflow_sbm_soil.png" alt="wflow_sbm model"/></p><h2 id="Precipitation"><a class="docs-heading-anchor" href="#Precipitation">Precipitation</a><a id="Precipitation-1"></a><a class="docs-heading-anchor-permalink" href="#Precipitation" title="Permalink"></a></h2><p>The division between solid and liquid precipitation (snowfall and rainfall, respectively) is  performed based on the air temperature. If the temperature is below a threshold temperature  (<code>tt</code>), precipitation will fall as snow. A interval parameter (<code>tti</code>) defines the range  over which precipitation is partly falling as snow, and partly as rain. Snowfall is added to the snowpack, where it is subject to melting and refreezing (see the section on  <a href="#snow">snow and glaciers</a>). The amount of rainfall is subject to  <a href="#interception">interception</a>, and ultimately becomes available for <a href="#evap">evaporation</a>  and/or <a href="#soil">soil processes</a>.</p><p><img src="../../../images/snowfall.png" alt="snowfall"/> </p><h2 id="interception"><a class="docs-heading-anchor" href="#interception">Rainfall interception</a><a id="interception-1"></a><a class="docs-heading-anchor-permalink" href="#interception" title="Permalink"></a></h2><p>Two different interception models are available: the analytical Gash model, and the modified Rutter model. The simulation timestep defines which interception model is used, where daily (or larger) timesteps use the Gash model, and timesteps smaller than daily use the modified  Rutter model.</p><h3 id="The-analytical-Gash-model-(Gash,-1979)"><a class="docs-heading-anchor" href="#The-analytical-Gash-model-(Gash,-1979)">The analytical Gash model (Gash, 1979)</a><a id="The-analytical-Gash-model-(Gash,-1979)-1"></a><a class="docs-heading-anchor-permalink" href="#The-analytical-Gash-model-(Gash,-1979)" title="Permalink"></a></h3><p>The Gash model generally assumes that there is one rainfall event per day. It calculates the amount of water required to fully saturate the canopy. The amount of stemflow is taken as  a fraction (<code>0.1 * canopygapfraction</code>) of the precipitation. Throughfall is the precipitation  that is not intercepted by the leaves and stems. If the interception is larger than the  potential evaporation, the amount above potential evaporation is added to the throughfall,  as the concept is based on a daily timestep (assuming that the canopy storage is emptied at  the end of the timestep). </p><h3 id="The-modified-Rutter-model-(Rutter-et-al.,-1971)"><a class="docs-heading-anchor" href="#The-modified-Rutter-model-(Rutter-et-al.,-1971)">The modified Rutter model (Rutter et al., 1971)</a><a id="The-modified-Rutter-model-(Rutter-et-al.,-1971)-1"></a><a class="docs-heading-anchor-permalink" href="#The-modified-Rutter-model-(Rutter-et-al.,-1971)" title="Permalink"></a></h3><p>The amount of stemflow is taken as a fraction (<code>0.1 * canopygapfraction</code>) of the  precipitation. Throughfall equals to the amount of water that cannot be stored by the  canopy, plus the rainfall that is not captured by the canopy. There is no flow from water on the leaves to the ground, when the canopy storage is below the maximum canopy storage  (<code>cmax</code>). Water can evaporate from the canopy storage, taken as the minimum between potential  evaporation and the current storage. The &quot;left-over&quot; potential evaporation (if any) is  returned as output.</p><h2 id="evap"><a class="docs-heading-anchor" href="#evap">Evaporation</a><a id="evap-1"></a><a class="docs-heading-anchor-permalink" href="#evap" title="Permalink"></a></h2><p>The wflow_sbm model assumes the input to be potential evaporation. A multiplication factor (<code>et_reftopot</code>, set to 1 by default) is present to correct the input evaporation if required. </p><p>The potential evaporation left over after interception and open water evaporation (rivers and water bodies) is split in potential soil evaporation and potential transpiration based on the canopy gap fraction (assumed to be identical to the amount of bare soil). </p><h2 id="snow"><a class="docs-heading-anchor" href="#snow">Snow and glaciers</a><a id="snow-1"></a><a class="docs-heading-anchor-permalink" href="#snow" title="Permalink"></a></h2><p>The snow and glacier model is described in <a href="../../shared_concepts/#snow_and_glac">Snow and glaciers</a>. Both options can be enabled by specifying the following in the TOML file:</p><pre><code class="language-toml hljs">[model]
snow = true
glacier = true</code></pre><h2 id="soil"><a class="docs-heading-anchor" href="#soil">Soil processes</a><a id="soil-1"></a><a class="docs-heading-anchor-permalink" href="#soil" title="Permalink"></a></h2><h3 id="Bare-soil-evaporation"><a class="docs-heading-anchor" href="#Bare-soil-evaporation">Bare soil evaporation</a><a id="Bare-soil-evaporation-1"></a><a class="docs-heading-anchor-permalink" href="#Bare-soil-evaporation" title="Permalink"></a></h3><p>If there is only one soil layer present in the wflow_sbm model, the bare soil evaporation is scaled according to the wetness of the soil layer. The fraction of bare soil is assumed to be equal to the fraction not covered by the canopy (<code>conapygapfraction</code>). When the soil is fully saturated, evaporation is set to equal the potential evaporation. When the soil is not fully saturated, actual evaporation decrease linearly with decreasing soil moisture values, as indicated by the figure below.</p><p><img src="../../../images/soil_evap.png" alt="soil_evap"/> </p><p>When more soil layers are present, soil evaporation is only provided from the upper soil layer, and soil evaporation is split in evaporation from the unsaturated store and evaporation from the saturated store. Water is first evaporated water from the unsaturated store. The remaining potential soil evaporation can be used for evaporation from the saturated store, but only when the water table is present in the upper soil layer. </p><h3 id="Transpiration"><a class="docs-heading-anchor" href="#Transpiration">Transpiration</a><a id="Transpiration-1"></a><a class="docs-heading-anchor-permalink" href="#Transpiration" title="Permalink"></a></h3><p>The fraction of wet roots is determined using a sigmoid fuction (see figure below). The parameter <code>rootdistpar</code> defines the sharpness of the transition between fully wet and fully dry roots. The returned wetroots fraction is multiplied by the potential evaporation (and limited by the available water in saturated zone) to get the transpiration from the saturated part of the soil.</p><p><img src="../../../images/soil_wetroots.png" alt="soil_wetroots"/> </p><p>The remaining potential evaporation is used to extract water from the unsaturated store. The maximum allowed extration of the unsaturated zone is determined based on the fraction of the unsaturated zone that is above the rooting depth, see conceptual figure below. </p><p><img src="../../../images/soil_unsatevap.png" alt="soil_unsatevap"/> </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When <code>whole_ust_available</code> is set to true in the TOML file, almost the complete unsaturated storage (99%) is available for transpiration, independent of the <code>rootingdepth</code>.</p><pre><code class="language-toml hljs">[model]
whole_ust_available = true</code></pre></div></div><p>Next, a root water uptake reduction model is used to calculate a reduction coefficient as a function of soil water pressure. This concept is based on the concept presented by Feddes et al. (1978). This concept defines a reduction coefficient <code>a</code> as a function of soil water pressure (<code>h</code>). Four different levels of <code>h</code> are defined: <code>h2</code>, <code>h3</code>, and <code>h4</code> are defined as fixed values, and <code>h1</code> can be defined as input to the model (defaults to -10 cm). <code>h1</code> represents the air entry pressure, <code>h2</code> represents field capacity, <code>h3</code> represents the point of critical soil moisture content, and <code>h4</code> represents the wilting point. The current soil water pressure is determined following the concept defined by Brooks and Corey (1964). </p><p>Whenever the current soil water pressure drops below <code>h4</code>, the root water uptake is set to zero. The root water uptake is at ideal conditions whenever the soil water pressure is above <code>h3</code>, with a linear transition between <code>h3</code> and <code>h4</code>. In the original concept, root water uptake is set be reduced when soil water pressures are above field capacity (<code>h2</code>). This is not inplemented in wlow_sbm, as the assumption from the original concept does not apply to crops. </p><p><img src="../../../images/soil_rootwateruptake.png" alt="soil_rootwateruptake"/> </p><h3 id="Infiltration"><a class="docs-heading-anchor" href="#Infiltration">Infiltration</a><a id="Infiltration-1"></a><a class="docs-heading-anchor-permalink" href="#Infiltration" title="Permalink"></a></h3><p>The water available for infiltration is taken as the rainfall including meltwater. Infiltration is determined seperately for the compacted and non compacted areas, as these have different infitration capacities. Naturally, only the water that can be stored in the soil can infiltrate. If not all water can infiltrate, this is added as excess water to the runoff routing scheme. </p><p>If snow processes are modelled, the infiltration capacity is reduced when the soil is frozen (or near freezing point). A infiltration correction factor is defined as a S-curve with the shape as defined below. A parameter (<code>cf_soil</code>) defines the base factor of infiltration when the soil is frozen. The soil temperature is calculated based on the soil temperature on the previous timestep, and the temperature difference between air and soil temperature weighted with a factor (<code>w\_soil</code>, which defaults to 0.1125).</p><p><img src="../../../images/soil_frozeninfilt.png" alt="soil_frozeninfilt"/> </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The following options need to be enabled in the TOML file to allow for this correction factor. If <code>soilinfreduction</code> is set to <code>false</code>, water is allowed to infiltrate the soil, even if the soil is frozen.</p><pre><code class="language-toml hljs">[model]
snow = true
soilinfreduction = true</code></pre></div></div><h3 id="Capillary-rise"><a class="docs-heading-anchor" href="#Capillary-rise">Capillary rise</a><a id="Capillary-rise-1"></a><a class="docs-heading-anchor-permalink" href="#Capillary-rise" title="Permalink"></a></h3><p>The actual capillary rise <code>actcapflux</code> [mm t<span>$^{-1}$</span>] is determined using the following approach: first the saturated hydraulic conductivty <code>ksat</code> [mm t<span>$^{-1}$</span>] is determined at the water table <span>$z_{i}$</span>; next a potential capillary rise <code>maxcapflux</code> [mm t<span>$^{-1}$</span>] is determined from the minimum of <code>ksat</code>, actual transpiration <code>actevapustore</code> [mm t<span>$^{-1}$</span>] taken from the <span>$U$</span> store, available water in the <span>$S$</span> store (<code>satwaterdepth</code> [mm]) and the deficit of the <span>$U$</span> store (<code>ustorecapacity</code> [mm]), as shown by the following code block:</p><pre><code class="language-julia hljs">    maxcapflux = max(0.0, min(ksat, actevapustore, ustorecapacity, satwaterdepth))</code></pre><p>Then the potential rise <code>maxcapflux</code> is scaled using the water table depth <code>zi</code> and a maximum water depth <code>cap_hmax</code> [mm] beyond which capillary rise ceases as follows in the code block below (<code>i</code> refers to the index of the vector that contains all active cells within the spatial model domain):</p><pre><code class="language-julia hljs">    if sbm.zi[i] &gt; rootingdepth
        capflux =
            maxcapflux *
            pow(1.0 - min(sbm.zi[i], sbm.cap_hmax[i]) / (sbm.cap_hmax[i]), 2.0)
    else
        capflux = 0.0
    end</code></pre><p>If the roots reach the water table (<code>rootingdepth</code> <span>$\ge$</span> <code>sbm.zi</code>), <code>capflux</code> is set to zero and thus setting the capillary rise <code>capflux</code> to zero.</p><p>Finally, the capillary rise <code>capflux</code> is limited by the unsaturated store deficit (one or multiple layers), calculated as follows in the code block below (<code>i</code> refers to the index of the vector that contains all active cells within the spatial model domain, and <code>k</code> refers to the layer position):</p><pre><code class="language-julia hljs">    usl[k] * (sbm.θₛ[i] - sbm.θᵣ[i]) - usld[k]</code></pre><p>where <code>usl</code> [mm] is the unsaturated layer thickness, <code>usld</code> is the <code>ustorelayerdepth</code> [mm] (amount of water in the unsaturated layer), and <span>$\theta_{s}$</span> and <span>$\theta_{r}$</span> as previously defined.</p><p>The calculation of the actual capillary rise <code>actcapflux</code> is as follows in the code block below (<code>i</code> refers to the index of the vector that contains all active cells within the spatial model domain, and <code>k</code> refers to the layer position):</p><pre><code class="language-julia hljs">    actcapflux = 0.0
    netcapflux = capflux
    for k = n_usl:-1:1
        toadd =
            min(netcapflux, max(usl[k] * (sbm.θₛ[i] - sbm.θᵣ[i]) - usld[k], 0.0))
        usld = setindex(usld, usld[k] + toadd, k)
        netcapflux = netcapflux - toadd
        actcapflux = actcapflux + toadd
    end</code></pre><p>In case of multiple unsaturated layers (<code>n_usl</code> <span>$&gt;$</span> 1), the calculation of the actual capillary rise starts at the lowest unsaturated layer while keeping track of the remaining capillary rise <code>netcapflux</code> [mm t<span>$^{-1}$</span>].</p><h3 id="Leakage"><a class="docs-heading-anchor" href="#Leakage">Leakage</a><a id="Leakage-1"></a><a class="docs-heading-anchor-permalink" href="#Leakage" title="Permalink"></a></h3><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>ToDo </p><pre><code class="language-julia hljs">deepksat = sbm.kv₀[i] * exp(-sbm.f[i] * sbm.soilthickness[i])
deeptransfer = min(satwaterdepth, deepksat)</code></pre></div></div><p>If the <code>maxleakage</code> (mm/day) input model parameter is set &gt; 0, water is lost from the saturated zone and runs out of the model.</p><h2 id="Open-water"><a class="docs-heading-anchor" href="#Open-water">Open water</a><a id="Open-water-1"></a><a class="docs-heading-anchor-permalink" href="#Open-water" title="Permalink"></a></h2><p>Part of the water available for infiltration is diverted to the open water, based on the fractions of river and lakes of each grid cell. The amount of evaporation from open water is taken assumed to be equal to potential evaporation (if sufficient water is available).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sbm/">« wflow_sbm</a><a class="docs-footer-nextpage" href="../hbv/">wflow_hbv »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Thursday 23 December 2021 13:17">Thursday 23 December 2021</span>. Using Julia version 1.7.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
