<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Shared processes · Wflow.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://deltares.github.io/Wflow.jl/model_docs/shared_concepts/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Wflow.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Wflow.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../">About wflow</a></li><li><a class="tocitem" href="../../intro/use_cases/">Case studies</a></li><li><a class="tocitem" href="../../intro/publications/">Publications</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li></ul></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../../user_guide/intro/">About the user guide</a></li><li><a class="tocitem" href="../../user_guide/install/">How to install</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">How to use wflow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../user_guide/step1_requirements/">Step 1: Understanding the requirements</a></li><li><a class="tocitem" href="../../user_guide/step2_settings_file/">Step 2: Preparing the settings file</a></li><li><a class="tocitem" href="../../user_guide/step3_input_data/">Step 3: Preparing the input data</a></li><li><a class="tocitem" href="../../user_guide/step4_running/">Step 4: Running a simulation</a></li><li><a class="tocitem" href="../../user_guide/step5_output/">Step 5: Analyzing the model output</a></li><li><a class="tocitem" href="../../user_guide/additional_options/">Additional wflow options</a></li><li><a class="tocitem" href="../../user_guide/sample_data/">Example models</a></li></ul></li><li><a class="tocitem" href="../../user_guide/model-setup/">Building a model from scratch</a></li></ul></li><li><span class="tocitem">Model documentation</span><ul><li><a class="tocitem" href="../intro/">About the model documentation</a></li><li><a class="tocitem" href="../model_configurations/">Model configurations</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Vertical concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../vertical/sbm/">SBM</a></li><li><a class="tocitem" href="../vertical/hbv/">HBV</a></li><li><a class="tocitem" href="../vertical/flextopo/">FLEXTopo</a></li><li><a class="tocitem" href="../vertical/sediment/">Sediment</a></li><li class="is-active"><a class="tocitem" href>Shared processes</a><ul class="internal"><li><a class="tocitem" href="#snow_and_glac"><span>Snow and glaciers</span></a></li><li><a class="tocitem" href="#Rainfall-interception"><span>Rainfall interception</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Lateral concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lateral/gwf/">Groundwater flow</a></li><li><a class="tocitem" href="../lateral/kinwave/">Kinematic wave</a></li><li><a class="tocitem" href="../lateral/local-inertial/">Local inertial</a></li><li><a class="tocitem" href="../lateral/waterbodies/">Reservoirs and Lakes</a></li><li><a class="tocitem" href="../lateral/sediment_flux/">Sediment flux</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Model parameters</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../params_vertical/">Parameters vertical concepts</a></li><li><a class="tocitem" href="../params_lateral/">Parameters lateral concepts</a></li><li><a class="tocitem" href="../structures/">Julia structures</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model documentation</a></li><li><a class="is-disabled">Vertical concepts</a></li><li class="is-active"><a href>Shared processes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Shared processes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Deltares/Wflow.jl/blob/master/docs/src/model_docs/shared_concepts.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Shared-processes"><a class="docs-heading-anchor" href="#Shared-processes">Shared processes</a><a id="Shared-processes-1"></a><a class="docs-heading-anchor-permalink" href="#Shared-processes" title="Permalink"></a></h1><h2 id="snow_and_glac"><a class="docs-heading-anchor" href="#snow_and_glac">Snow and glaciers</a><a id="snow_and_glac-1"></a><a class="docs-heading-anchor-permalink" href="#snow_and_glac" title="Permalink"></a></h2><h3 id="Snow-modelling"><a class="docs-heading-anchor" href="#Snow-modelling">Snow modelling</a><a id="Snow-modelling-1"></a><a class="docs-heading-anchor-permalink" href="#Snow-modelling" title="Permalink"></a></h3><p>If the air temperature, <span>$T_a$</span>, is below a user-defined threshold <code>tt</code> (<span>$\degree$</span>C) precipitation occurs as snowfall, whereas it occurs as rainfall if <span>$Ta ≥ tt$</span>. A another parameter <code>tti</code> defines how precipitation can occur partly as rain of snowfall (see the figure below). If precipitation occurs as snowfall, it is added to the dry snow component within the snow pack. Otherwise it ends up in the free water reservoir, which represents the liquid water content of the snow pack. Between the two components of the snow pack, interactions take place, either through snow melt (if temperatures are above a threshold <code>tt</code>) or through snow refreezing (if temperatures are below threshold <code>tt</code>.</p><p>The respective rates of snow melt and refreezing are:</p><p class="math-container">\[Q_m = cfmax(T_a−tt)\, ;\,T_a &gt; tt \\~\\
Q_r=cfmax \, cfr(tt−T_a)\,;\, Ta &lt; tt\]</p><p>where <span>$Q_m$</span> is the rate of snow melt, <span>$Q_r$</span> is the rate of snow refreezing, and <span>$cfmax$</span> and <span>$cfr$</span> are user defined model parameters (the melting factor [mm/(<span>$\degree$</span>C day)] and the refreezing factor respectively).</p><p>The fraction of liquid water in the snow pack is at most equal to a user defined fraction, <code>whc</code>, of the water equivalent of the dry snow content. If the liquid water concentration exceeds <code>whc</code>, either through snow melt or incoming rainfall, the surplus water (<code>rainfall</code>) becomes available for infiltration into the soil:</p><pre><code class="language-julia hljs">    snowwater = snowwater - refreezing  # free water content in snow
    maxsnowwater = snow * whc  # max water in the snow
    snowwater = snowwater + snowmelt + rainfall  # add all water and potentially supersaturate the snowpack
    rainfall = max(snowwater - maxsnowwater, 0.0)  # rain + surplus snowwater</code></pre><p><br/> <img src="../../images/snowmelt.png" alt="snowmelt"/></p><p><em>Snowmelt and refreezing rates as a function of temperature (for set melting and refreezing factors)</em></p><h3 id="Glacier-modelling"><a class="docs-heading-anchor" href="#Glacier-modelling">Glacier modelling</a><a id="Glacier-modelling-1"></a><a class="docs-heading-anchor-permalink" href="#Glacier-modelling" title="Permalink"></a></h3><p>Glacier processes can be modelled if the snow model is enabled. For the vertical HBV concept snow modelling is not optional. Glacier modelling is very close to snow modelling and considers two main processes: glacier build-up from snow turning into firn/ice (using the HBV-light model) and glacier melt (using a temperature degree-day model).</p><p>The definition of glacier boundaries and initial volume is defined in three parameters. <code>glacierfrac</code> is a parameter that gives the fraction of each grid cell covered by a glacier as a number between zero and one. <code>glacierstore</code> is a state parameter that gives the amount of water (in mm w.e.) within the glaciers at each gridcell. Because the glacier store (<code>glacierstore</code>) cannot be initialized by running the model for a couple of years, a default initial state should be supplied by adding this parameter to the input static file. The required glacier data can be prepared from available glacier datasets.</p><p>First, a fixed fraction of the snowpack on top of the glacier is converted into ice for each timestep and added to the <code>glacierstore</code> using the HBV-light model (Seibert et al., 2018). This fraction <code>g_sifrac</code> typically ranges from 0.001 to 0.006.</p><p>Then, when the snowpack on top of the glacier is almost all melted (snow cover &lt; 10 mm), glacier melt is enabled and estimated with a degree-day model. If the air temperature, <span>$T_a$</span>, is below a certain threshold <code>g_tt</code> (<span>$\degree$</span>C) precipitation occurs as snowfall, whereas it occurs as rainfall if <span>$T_a ≥$</span> <code>g_tt</code>.</p><p>With this the rate of glacier melt in mm is estimated as:</p><p class="math-container">\[Q_m = g\_cfmax(T_a − g\_tt)\, ; \, T_a &gt; g\_tt\]</p><p>where <span>$Q_m$</span> is the rate of glacier melt and <span>$g\_cfmax$</span> is the melting factor in mm/(<span>$\degree$</span>C day). Parameter <code>g_tt</code> can be taken as equal to the snow <code>tt</code> parameter. Values of the melting factor <code>g_cfmax</code> normally varies from one glacier to another and some values are reported in the literature. <code>g_cfmax</code> can also be estimated by multiplying snow <code>cfmax</code> by a factor between 1 and 2, to take into account the higher albedo of ice compared to snow.</p><h2 id="Rainfall-interception"><a class="docs-heading-anchor" href="#Rainfall-interception">Rainfall interception</a><a id="Rainfall-interception-1"></a><a class="docs-heading-anchor-permalink" href="#Rainfall-interception" title="Permalink"></a></h2><p>Both the Gash and Rutter models are available to estimate rainfall interception by the vegetation. The selection of an interception model depends on the simulation timestep.</p><h3 id="The-analytical-(Gash)-model"><a class="docs-heading-anchor" href="#The-analytical-(Gash)-model">The analytical (Gash) model</a><a id="The-analytical-(Gash)-model-1"></a><a class="docs-heading-anchor-permalink" href="#The-analytical-(Gash)-model" title="Permalink"></a></h3><p>The analytical model of rainfall interception is based on Rutter’s numerical model. The simplifications that introduced allow the model to be applied on a daily basis, although a storm-based approach will yield better results in situations with more than one storm per day. The amount of water needed to completely saturate the canopy is defined as:</p><p class="math-container">\[P&#39;=\frac{-\overline{R}S}{\overline{E}_{w}}ln\left[1-\frac{\overline{E}_{w}}{\overline{R}}(1-p-p_{t})^{-1}\right]\]</p><p>where <span>$\overline{R}$</span> is the average precipitation intensity on a saturated canopy and <span>$\overline{E}_{w}$</span> the average evaporation from the wet canopy and with the vegetation parameters <span>$S$</span>, <span>$p$</span> and <span>$p_t$</span> as defined previously. The model uses a series of expressions to calculate the interception loss during different phases of a storm. An analytical integration of the total evaporation and rainfall under saturated canopy conditions is then done for each storm to determine average values of <span>$\overline{E}_{w}$</span> and <span>$\overline{R}$</span>. The total evaporation from the canopy (the total interception loss) is calculated as the sum of the components listed in the table below. Interception losses from the stems are calculated for days with <span>$P\geq S_{t}/p_{t}$</span>. <span>$p_t$</span> and <span>$S_t$</span> are small and neglected.</p><p>Table: Formulation of the components of interception loss according to Gash:</p><table><tr><th style="text-align: left">Components</th><th style="text-align: right">Interception loss</th></tr><tr><td style="text-align: left">For <span>$m$</span> small storms (<span>$P_{g}&lt;{P&#39;}_{g}$</span>)</td><td style="text-align: right"><span>$(1-p-p_{t})\sum_{j=1}^{m}P_{g,j}$</span></td></tr><tr><td style="text-align: left">Wetting up the canopy in <span>$n$</span> large storms (<span>$P_{g}\geq{P&#39;}_{g}$</span>)</td><td style="text-align: right"><span>$n(1-p-p_{t}){P&#39;}_{g}-nS$</span></td></tr><tr><td style="text-align: left">Evaporation from saturated canopy during rainfall</td><td style="text-align: right"><span>$\overline{E}/\overline{R}\sum_{j=1}^{n}(P_{g,j}-{P&#39;}_{g})$</span></td></tr><tr><td style="text-align: left">Evaporation after rainfall ceases for <span>$n$</span> large storms</td><td style="text-align: right"><span>$nS$</span></td></tr><tr><td style="text-align: left">Evaporation from trunks in <span>$q$</span> storms that fill the trunk storage</td><td style="text-align: right"><span>$qS_{t}$</span></td></tr><tr><td style="text-align: left">Evaporation from  trunks in <span>$m+n-q$</span> storms that do not fill the trunk storage</td><td style="text-align: right"><span>$p_{t}\sum_{j=1}^{m+n-q}P_{g,j}$</span></td></tr></table><p>In applying the analytical model, saturated conditions are assumed to occur when the hourly rainfall exceeds a certain threshold. Often a threshold of 0.5 mm/hr is used. <span>$\overline{R}$</span> is calculated for all hours when the rainfall exceeds the threshold to give an estimate of the mean rainfall rate onto a saturated canopy.</p><p>Gash (1979) has shown that in a regression of interception loss on rainfall (on a storm basis) the regression coefficient should equal to <span>$\overline{E}_w/\overline{R}$</span>. Assuming that neither <span>$\overline{E}_w$</span> nor <span>$\overline{R}$</span> vary considerably in time, <span>$\overline{E}_w$</span> can be estimated in this way from <span>$\overline{R}$</span> in the absence of above-canopy climatic observations. Values derived in this way generally tend to be (much) higher than those calculated with the penman-monteith equation.</p><h3 id="The-modified-rutter-model"><a class="docs-heading-anchor" href="#The-modified-rutter-model">The modified rutter model</a><a id="The-modified-rutter-model-1"></a><a class="docs-heading-anchor-permalink" href="#The-modified-rutter-model" title="Permalink"></a></h3><p>For sub daily timesteps the interception is calculated using a simplification of the Rutter model. The simplified model is solved explicitly and does not take drainage from the canopy into account.</p><article class="docstring"><header><a class="docstring-binding" id="Wflow.rainfall_interception_modrut" href="#Wflow.rainfall_interception_modrut"><code>Wflow.rainfall_interception_modrut</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rainfall_interception_modrut(precipitation, potential_evaporation, canopystorage, canopygapfraction, cmax)</code></pre><p>Interception according to a modified Rutter model. The model is solved explicitly and there is no drainage below <code>cmax</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Deltares/Wflow.jl/blob/832a866086486b143393c17799d2419e7d847c6e/src/vertical_process.jl#LL71-L76">source</a></section></article><h3 id="Interception-parameters-from-LAI"><a class="docs-heading-anchor" href="#Interception-parameters-from-LAI">Interception parameters from LAI</a><a id="Interception-parameters-from-LAI-1"></a><a class="docs-heading-anchor-permalink" href="#Interception-parameters-from-LAI" title="Permalink"></a></h3><p>The SBM concept can determine the interception parameters from leaf area index (LAI) climatology. In order to switch this on you must define this cyclic parameter in the TOML file, the parameter is read from <code>path_static</code>, as follows:</p><pre><code class="language-toml hljs">[input]
path_forcing = &quot;data/forcing-moselle.nc&quot;
path_static = &quot;data/staticmaps-moselle.nc&quot;

cyclic = [&quot;vertical.leaf_area_index&quot;]</code></pre><p>Furthermore these additional parameters are required:</p><ul><li>Specific leaf storage  (<code>sl</code> [mm])</li><li>Storage woody part of vegetation (<code>swood</code> [mm])</li><li>Extinction coefficient (<code>kext</code> [-])</li></ul><p>Here it is assumed that <code>cmax</code> [mm] (leaves) (canopy storage capacity for the leaves only) relates linearly with LAI (c.f. Van Dijk and Bruijnzeel 2001). This done via the <code>sl</code>. <code>sl</code> can be determined through a lookup table with land cover based on literature (Pitman 1989, Lui 1998). Next the <code>cmax</code> (leaves) is determined using:</p><p class="math-container">\[
    cmax(leaves)  = sl \, LAI\]</p><p>To get to total storage (<code>cmax</code>) the woody part of the vegetation also needs to be added. As for <code>sl</code>, the storage of the woody part <code>swood</code> can also be related to land cover (lookup table).</p><p>The canopy gap fraction is determined using the extinction coefficient <code>kext</code> (van Dijk and Bruijnzeel 2001):</p><p class="math-container">\[    canopygapfraction = exp(-kext \, LAI)\]</p><p>The extinction coefficient <code>kext</code> can be related to land cover.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Seibert, J., Vis, M. J. P., Kohn, I., Weiler, M., and Stahl, K., 2018, Technical note: Representing glacier geometry changes in a semi-distributed hydrological model, Hydrol. Earth Syst. Sci., 22, 2211–2224, https://doi.org/10.5194/hess-22-2211-2018.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vertical/sediment/">« Sediment</a><a class="docs-footer-nextpage" href="../lateral/gwf/">Groundwater flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 2 December 2022 14:20">Friday 2 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
