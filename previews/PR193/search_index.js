var documenterSearchIndex = {"docs":
[{"location":"vertical/sediment/#Inland-sediment-model","page":"Soil Loss","title":"Inland sediment model","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Over the land, soil erosion, also called soil loss, is closely linked to the water cycle. The main processes governing sediment generation are splash erosion from rain droplets, and sheet and rill erosion from the shear stress caused by overland flow. The intensity of soil erosion by rain or ﬂow depends on the land and soil characteristics such as slope, land use or soil type. Once soil is eroded, the detached particles can be transported downslope by overland ﬂow. Along the transport pathways, soil particles can also be deposited due to a low flow velocity, a change of topography in depressions, footslopes or valley bottoms, and/or can be filtered and stopped by a change in vegetation such as ﬁeld boundaries.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"The inland part of the sediment gathers these different processes, separated in a vertical structure for the soil loss and lateral structure for the transport in overland flow.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Overview of the different processes for a land cell in wflow_sediment.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"(Image: sediment_inland)","category":"page"},{"location":"vertical/sediment/#Soil-Erosion","page":"Soil Loss","title":"Soil Erosion","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"The first process to consider in sediment dynamics is the generation of sediments by land erosion. The main processes behind soil loss are rainfall erosion and overland flow erosion. In order to model such processes at a fine time and space scale, physics-based models such as ANSWERS and EUROSEM were chosen here.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"The choice of rainfall erosion method is set up in the model section of the TOML:","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"[model]\nrainerosmethod = \"answers\" # Rainfall erosion equation: [\"answers\", \"eurosem\"]","category":"page"},{"location":"vertical/sediment/#Rainfall-erosion","page":"Soil Loss","title":"Rainfall erosion","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"In wflow_sediment, rainfall erosion can both be modelled using EUROSEM or ANSWERS equation. The main difference between the models is that EUROSEM uses a more physics-based approach using the kinetic energy of the rain drops impacting the soil (Morgan et al, 1998), while ANSWERS is more empirical and uses parameters from the USLE model (Beasley et al, 1991).","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"In EUROSEM, rainfall erosion is modelled according to rainfall intensity and its kinetic energy while it reaches the soil according to equations developed by Brandt (1990). As the intensity of the rain kinetic energy depends on the length of the fall, rainfall intercepted by vegetation will then be reduced compared to direct throughfall. The kinetic energy of direct throughfall is estimated by (Morgan et al, 1998):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   KE_direct = 895 + 844log_10R_i","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where KE_direct is kinetic energy of direct throughfall (J m^-2 mm^-1) and R_i is rainfall intensity (mm h^-1). If the rainfall is intercepted by vegetation and falls as leaf drainage, its kinetic energy is then reduced according to (Brandt, 1990):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   KE_leaf = 158H_p^05 - 587","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where KE_leaf is kinetic energy of leaf drainage (J m^-2 mm^-1) and H_p is the effective canopy height (half of plant height in m). Canopy height can be derived from the global map from Simard & al. (2011) or by user input depending on the land use.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Kinetic energies from both direct throughfall and leaf drainage are then multiplied by the respective depths of direct throughfall and leaf drainage (mm) and added to get the total rainfall kinetic energy KE. The soil detached by rainfall D_R (g m^-2) is then:","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   D_R = kKEe^-varphi h","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where k is an index of the detachability of the soil (g J^-1), KE is the total rainfall kinetic energy (J m^-2), h is the surface runoff depth on the soil (m) and varphi is an exponent varying between 0.9 and 3.1 used to reduce rainfall impact if the soil is already covered by water. As a simplification, Torri (1987) has shown that a value of 2.0 for varphi is representative enough for a wide range of soil conditions. The detachability of the soil k depends on the soil texture (proportion of clay, silt and sand content) and corresponding values are defined in EUROSEM user guide (Morgan et al, 1998). As a simplification, in wflow_sediment, the mean value of the detachability shown in the table below are used. Soil texture can for example be derived from the topsoil clay and silt content from SoilGrids (Hengl et al, 2017).","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Table: Mean detachability of soil depending on its texture (Morgan et al, 1998).","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Texture (USDA system) Mean detachability k (g/J)\nClay 2.0\nClay Loam 1.7\nSilt 1.2\nSilt Loam 1.5\nLoam 2.0\nSandy Loam 2.6\nLoamy Sand 3.0\nFine Sand 3.5\nSand 1.9","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Rainfall erosion is handled differently in ANSWERS. There, the impacts of vegetation and soil properties are handled through the USLE coefficients in the equation (Beasley et al, 1991):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   D_R = 0108  C_USLE  K_USLE  A_i  R_i^2","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where D_R is the soil detachment by rainfall (here in kg min^-1), C_USLE is the soil cover-management factor from the USLE equation, K_USLE is the soil erodibility factor from the USLE equation, A_i is the area of the cell (m^2) and R_i is the rainfall intensity (here in mm min^-1). There are several methods available to estimate the C and K factors from the USLE. They can come from user input maps, for example maps resulting from Panagos & al.’s recent studies for Europe (Panagos et al, 2015) (Ballabio et al, 2016). To get an estimate of the C factor globally, the other method is to estimate C values for the different land use type in from global land cover maps (e.g. GlobCover). An example is given for the global land cover map GlobCover, summed up in the table below, the values come from a literature study including Panagos et al.’s review (2015), Gericke & al. (2015), Mansoor & al. (2013), Chadli et al. (2016), de Vente et al. (2009), Borrelli et al. (2014), Yang et al. (2003) and Bosco et al. (2015).","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"The other methods to estimate the USLE K factor are to use either topsoil composition or topsoil geometric mean diameter. K estimation from topsoil composition is estimated with the equation developed in the EPIC model (Williams et al, 1983):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   K_USLE = left 02 + 03expleft-00256SANfrac(1-SIL)100right right\n   left(fracSILCLA+SILright)^03 \n   left(1-frac025OCOC+e^(372-295OC)right)left(1-frac075SNSN+e^(-551+229SN)right)","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where CLA, SIL, SAN are respectively the clay, silt and sand fractions of the topsoil (%), OC is the topsoil organic carbon content (%) and SN is 1-SAN100. These soil parameters can be derived for example from the SoilGrids dataset. The K factor can also be estimated from the soil mean geometric diameter using the formulation from the RUSLE guide by Renard & al. (1997):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   K_USLE = 00034 + 00405e^left(-dfrac12left(dfraclog_10(D_g)+165907101right)^2right)","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where D_g is the soil geometric mean diameter (mm) estimated from topsoil clay, silt, sand fraction.","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Table: Estimation of USLE C factor per Globcover land use type","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"GlobCover Value Globcover label C_USLE\n11 Post-flooding or irrigated croplands (or aquatic) 0.2\n14 Rainfed croplands 0.35\n20 Mosaic cropland (50-70%) vegetation (grassland/shrubland/forest) (20-50%) 0.27\n30 Mosaic vegetation (grassland/shrubland/forest) (50-70%) / cropland (20-50%) 0.25\n40 Closed to open (>15%) broadleaved evergreen or semi-deciduous forest (>5m) 0.0065\n50 Closed (>40%) broadleaved deciduous forest (>5m) 0.001\n60 Open (15-40%) broadleaved deciduous forest/woodland (>5m) 0.01\n70 Closed (>40%) needleleaved evergreen forest (>5m) 0.001\n90 Open (15-40%) needleleaved deciduous or evergreen forest (>5m) 0.01\n100 Closed to open (>15%) mixed broadleaved and needleleaved forest (>5m) 0.02\n110 Mosaic forest or shrubland (50-70%) / grassland (20-50%) 0.015\n120 Mosaic grassland (50-70%) / forest or shrubland (20-50%) 0.03\n130 Closed to open (>15%) (broadleaved or needleleaved, evergreen or deciduous) shrubland (<5m) 0.035\n140 Closed to open (>15%) herbaceous vegetation (grassland, savannas or lichens/mosses) 0.05\n150 Sparse (<15%) vegetation 0.35\n160 Closed to open (>15%) broadleaved forest regularly flooded (semi-permanently or temporarily) - Fresh or brackish water 0.001\n170 Closed (>40%) broadleaved forest or shrubland permanently flooded - Saline or brackish water 0.0005\n180 Closed to open (>15%) grassland or woody vegetation on regularly flooded or waterlogged soil - Fresh, brackish or saline water 0.04\n190 Artificial surfaces and associated areas (Urban areas >50%) 0.0\n200 Bare areas 0.0\n210 Water bodies 0.0\n220 Permanent snow and ice 0.0\n230 No data (burnt areas, clouds,…) 0.0","category":"page"},{"location":"vertical/sediment/#Overland-flow-erosion","page":"Soil Loss","title":"Overland flow erosion","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Overland flow (or surface runoff) erosion is induced by the strength of the shear stress of the surface water on the soil. As in rainfall erosion, the effect of the flow shear stress can be reduced by the soil vegetation or by the soil properties. In wflow_sediment, soil detachment by overland flow is modelled as in ANSWERS with (Beasley et al, 1991):","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"   D_F = 090  C_USLE  K_USLE  A_i  S  q","category":"page"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"where D_F is soil detachment by flow (kg min^-1), C_USLE and K_USLE are the USLE cover and soil erodibility factors, A_i is the cell area (m^2), S is the slope gradient and q is the overland flow rate per unit width (m^2 min^-1). The USLE C and K factors can be estimated with the same methods as for rainfall erosion and here the slope gradient is obtained from the sinus rather than the tangent of the slope angle.","category":"page"},{"location":"vertical/sediment/#Delivery-to-the-river-system","page":"Soil Loss","title":"Delivery to the river system","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"Once soil is detached, it can be transported by overland flow and reach the river system. This process is described in Sediment Flux in overland flow.","category":"page"},{"location":"vertical/sediment/#References","page":"Soil Loss","title":"References","text":"","category":"section"},{"location":"vertical/sediment/","page":"Soil Loss","title":"Soil Loss","text":"D.B Beasley and L.F Huggins. ANSWERS - Users Manual. Technical report, EPA, 1991.\nP. Borrelli, M. M\u007farker, P. Panagos, and B. Sch\u007futt. Modeling soil erosion and river sediment yield for an intermountain drainage basin of the Central Apennines, Italy. Catena, 114:45-58, 2014. 10.1016/j.catena.2013.10.007\nC. Bosco, D. De Rigo, O. Dewitte, J. Poesen, and P. Panagos. Modelling soil erosion at European scale: Towards harmonization and reproducibility. Natural Hazards and Earth System Sciences, 15(2):225-245, 2015. 10.5194/nhess-15-225-2015\nC.J Brandt. Simulation of the size distribution and erosivity of raindrops and throughfall drops. Earth Surface Processes and Landforms, 15(8):687-698, dec 1990.\nK. Chadli. Estimation of soil loss using RUSLE model for Sebou watershed (Morocco). Modeling Earth Systems and Environment, 2(2):51, 2016. 10.1007/s40808-016-0105-y\nG R Foster. Modeling the erosion process. Hydrologic modeling of small watersheds, pages 295-380, 1982.\nA. Gericke. Soil loss estimation and empirical relationships for sediment delivery ratios of European river catchments. International Journal of River Basin Management, 2015. 10.1080/15715124.2014.1003302\nL.D.K. Mansoor, M.D. Matlock, E.C. Cummings, and L.L. Nalley. Quantifying and mapping multiple ecosystem services change in West Africa. Agriculture, Ecosystems and Environment, 165:6-18, 2013. 10.1016/j.agee.2012.12.001\nQ Morgan, J.N Smith, R.E Govers, G Poesen, J.W.A Auerswald, K Chisci, G Torri, D Styczen, and M E Folly. The European soil erosion model (EUROSEM): documentation and user guide. Technical report, 1998.\nS.L Neitsch, J.G Arnold, J.R Kiniry, and J.R Williams. SWAT Theoretical Documentation Version 2009. Texas Water Resources Institute, pages 1-647, 2011. 10.1016/j.scitotenv.2015.11.063\nP. Panagos, P. Borrelli, K. Meusburger, C. Alewell, E. Lugato, and L. Montanarella. Estimating the soil erosion cover-management factor at the European scale. Land Use Policy, 48:38-50, 2015. 10.1016/j.landusepol.2015.05.021\nK Renard, Gr Foster, Ga Weesies, Dk McCool, and Dc Yoder. Predicting soil erosion by water: a guide to conservation planning with the Revised Universal Soil Loss Equation (RUSLE). Washington, 1997.\nD. Torri, M. Sfalanga, and M. Del Sette. Splash detachment: Runoff depth and soil cohesion. Catena, 14(1-3):149-155, 1987. 10.1016/S0341-8162(87)80013-9\nJ. de Vente, J. Poesen, G. Govers, and C. Boix-Fayos. The implications of data selection for regional erosion and sediment yield modelling. Earth Surface Processes and Landforms, 34(15):1994-2007, 2009. 10.1002/esp.1884\nG. Verstraeten and J. Poesen. Estimating trap efficiency of small reservoirs and ponds: methods and implications for the assessment of sediment yield. Progress in Physical Geography, 24(2):219-251, 2000. 10.1177/030913330002400204\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, and J. Poesen. Adapting SWAT hillslope erosion model to predict sediment concentrations and yields in large Basins. Science of the Total Environment, 538:855-875, 2015. 10.1016/j.scitotenv.2015.08.095\nJ.R. Williams, K.G. Renard, and P.T. Dyke. EPIC A new method for assessing erosion's effect on soil productivity. Journal of Soil and Water Conservation, 38(5):381-383, 1983.\nD. Yang, S. Kanae, T. Oki, T. Koike, and K. Musiake. Global potential soil erosion with reference to land use and climate changes. Hydrological Processes, 17(14):2913-2928, 2003. 10.1002/hyp.1441","category":"page"},{"location":"lateral/gwf_params/#Groundwater-flow","page":"Groundwater flow","title":"Groundwater flow","text":"","category":"section"},{"location":"lateral/gwf_params/#Confined-aquifer","page":"Groundwater flow","title":"Confined aquifer","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct ConfinedAquifer, including a description of these parameters, the unit, and default value if applicable. Struct ConfinedAquifer is not (yet) part of a Wflow Model.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nk horizontal conductivity m d^-1s -\nstorativity storativity m m^-1 -\nspecific_storage specific storage m^-1 - }\ntop top groundwater layers m -\nbottom bottom groundwater layers m -\narea cell area m^2 -\nhead groundwater head m -\nconductance conductance m^2 d^-1 -","category":"page"},{"location":"lateral/gwf_params/#Unconfined-aquifer","page":"Groundwater flow","title":"Unconfined aquifer","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct UnconfinedAquifer, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. The top parameter is provided by the exteral parameter altitude as part of the static input data and set as follows through the TOML file:","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"[input]\n# these are not directly part of the model\naltitude = \"wflow_dem\"","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nk (conductivity) horizontal conductivity m d^-1s -\nspecific_yield specific yield m m^-1 -\ntop (altitude) top groundwater layer m -\nbottom bottom groundwater layer m -\narea cell area m^2 -\nhead groundwater head m -\nconductance conductance m^2 d^-1 -","category":"page"},{"location":"lateral/gwf_params/#Constant-Head","page":"Groundwater flow","title":"Constant Head","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct ConstantHead, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nhead (constant_head) groundwater head m -\nindex constand head cell index - -","category":"page"},{"location":"lateral/gwf_params/#Boundary-conditions","page":"Groundwater flow","title":"Boundary conditions","text":"","category":"section"},{"location":"lateral/gwf_params/#gwf_river_params","page":"Groundwater flow","title":"River","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct River, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nstage river stage m -\ninfiltration_conductance river bed infiltration conductance m^2 day^-1 m^2 day^-1 -\nexfiltration_conductance river bed exfiltration conductance m^2 day^-1 -\nbottom (river_bottom) river bottom elevation m -\nindex river cell index - -\nflux exchange flux (river to aquifer) m^3 d^-1 -","category":"page"},{"location":"lateral/gwf_params/#gwf_drainage_params","page":"Groundwater flow","title":"Drainage","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct Drainage, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nelevation (drain_elevation) drain elevation m -\nconductance (drain_conductance) drain conductance m^2 day^-1 -\nindex (drain) drain cell index - -\nflux exchange flux (drains to aquifer) m^3 day^-1 -","category":"page"},{"location":"lateral/gwf_params/#gwf_recharge_params","page":"Groundwater flow","title":"Recharge","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct Recharge, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nrate recharge rate m^3 day^-1 -\nindex recharge cell index - -\nflux recharge flux m^3 day^-1 -","category":"page"},{"location":"lateral/gwf_params/#gwf_headboundary_params","page":"Groundwater flow","title":"Head boundary","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct HeadBoundary, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"parameter description unit default\nhead head m -\nconductance conductance of the head boundary m^2 day^-1 -\nindex head boundary cell index - -\nflux conductance of the head boundary m^3 day^-1 -","category":"page"},{"location":"lateral/gwf_params/#well_boundary_params","page":"Groundwater flow","title":"Well boundary","text":"","category":"section"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table below shows the parameters (fields) of struct Well, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"lateral/gwf_params/","page":"Groundwater flow","title":"Groundwater flow","text":"input parameter description unit default\nvolumetric_rate volumetric well rate m^3 d^-1 -\nindex well index - -\nflux actual well flux m^3 day^-1 -","category":"page"},{"location":"bmi/#Basic-Model-Interface","page":"Basic Model Interface","title":"Basic Model Interface","text":"","category":"section"},{"location":"bmi/#Introduction","page":"Basic Model Interface","title":"Introduction","text":"","category":"section"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"The Community Surface Dynamics Modeling System (CSMDS) has developed the Basic Model Interface (BMI). BMI consists of a set of standard control and query functions that can be added by a developer to the model code and makes a model both easier to learn and easier to couple with other software elements. ","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"For more information see also: http://csdms.colorado.edu/wiki/BMI_Description","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"CSDMS provides specifications for the languages C, C++, Fortran and Python. Wflow, written in the Julia programming language, makes use of the following Julia specification, based on BMI 2.0 version.","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"For the BMI implementation of Wflow all grids are defined as unstructured grids. While the input (forcing and model parameters) is structured (uniform rectilinear), internally wflow works with one dimensional arrays based on the active grid cells of the 2D model domain.","category":"page"},{"location":"bmi/#Configuration","page":"Basic Model Interface","title":"Configuration","text":"","category":"section"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"The variables that Wflow can exchange through BMI are based on the different model components and these components should be listed under the API section of the TOML configuration file of the model type. Below an example of this API section, that lists the vertical component and different lateral components:","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"[API]\ncomponents = [\n  \"vertical\",\n  \"lateral.subsurface\",\n  \"lateral.land\",\n  \"lateral.river\",\n  \"lateral.river.reservoir\"\n]","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"See also:","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"Wflow.BMI.initialize\nWflow.BMI.get_input_var_names","category":"page"},{"location":"bmi/#BasicModelInterface.initialize","page":"Basic Model Interface","title":"BasicModelInterface.initialize","text":"BMI.initialize(::Type{<:Wflow.Model}, config_file)\n\nInitialize the model. Reads the input settings and data as defined in the Config object generated from the configuration file config_file. Will return a Model that is ready to run.\n\n\n\n\n\n","category":"function"},{"location":"bmi/#BasicModelInterface.get_input_var_names","page":"Basic Model Interface","title":"BasicModelInterface.get_input_var_names","text":"BMI.get_input_var_names(model::Model)\n\nReturns model input variables, based on the API section in the model configuration file. This API sections contains a list of Model components for which variables can be exchanged.\n\n\n\n\n\n","category":"function"},{"location":"bmi/#Couple-to-a-groundwater-model","page":"Basic Model Interface","title":"Couple to a groundwater model","text":"","category":"section"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"For the coupling of wflow_sbm (SBM + kinematic wave) with a groundwater model (e.g. MODFLOW) it is possible to run:","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"wflow_sbm in parts from the BMI, and \nto switch off the lateral subsurface flow component of wflow_sbm. ","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"The lateral subsurface component of wflow_sbm is not initialized by Wflow when the [input.lateral.subsurface] part of the TOML file is not included. Then from the BMI it is possible to run first the recharge part of SBM:","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"model = BMI.update(model, run=\"sbm_until_recharge\")","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"and to exchange recharge and for example river waterlevels to the groundwater model. After the groundwater model update, and the exchange of groundwater head and for example drain and river flux to wflow_sbm, the SBM part that mainly determines exfiltration of water from the unsaturated store, and the kinematic wave for river - and overland flow can be run as follows: ","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"model = BMI.update(model, run=\"sbm_after_subsurfaceflow\")","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"See also:","category":"page"},{"location":"bmi/","page":"Basic Model Interface","title":"Basic Model Interface","text":"Wflow.BMI.update","category":"page"},{"location":"bmi/#BasicModelInterface.update","page":"Basic Model Interface","title":"BasicModelInterface.update","text":"BMI.update(model::Model; run = nothing)\n\nUpdate the model for a single timestep. \n\nArguments\n\nrun = nothing: to update a model partially.\n\n\n\n\n\n","category":"function"},{"location":"vertical/parameters/#SBM","page":"Vertical concepts","title":"SBM","text":"","category":"section"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"The Table below shows the parameters (fields) of struct SBM, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.vertical] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable Sl:","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"[input.vertical]\nspecific_leaf = \"Sl\"","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"parameter description unit default\ncfmax degree-day factor mm ᵒC^-1 Δt^-1 3.75653 mm ᵒC^-1 day^-1\ntt threshold temperature for snowfall ᵒC 0.0\ntti threshold temperature interval length ᵒC 1.0\nttm threshold temperature for snowmelt ᵒC 0.0\nwhc water holding capacity as fraction of current snow pack - 0.1\nw_soil soil temperature smooth factor - 0.1125\ncf_soil controls soil infiltration reduction factor when soil is frozen - 0.038\ng_tt threshold temperature for snowfall above glacier ᵒC 0.0\ng_cfmax Degree-day factor for glacier mm ᵒC^-1 Δt^-1 3.0 mm ᵒC^-1 day^-1\ng_sifrac fraction of the snowpack on top of the glacier converted into ice - 0.001\nglacierfrac fraction covered by a glacier - 0.0\nglacierstore water within the glacier mm 5500.0\nθₛ (theta_s) saturated water content (porosity) - 0.6\nθᵣ (theta_r) residual water content - 0.01\nkv₀ (kv_0) Vertical hydraulic conductivity at soil surface mm Δt^-1 3000.0 mm day^-1\nf scaling parameter (controls exponential decline of kv₀) mm^-1 0.001\nhb air entry pressure of soil (Brooks-Corey) cm 10.0\nsoilthickness soil thickness mm 2000.0\ninfiltcappath infiltration capacity of the compacted areas mm Δt^-1 10.0 mm day^-1\ninfiltcapsoil soil infiltration capacity mm Δt^-1 100.0 mm day^-1\nmaxleakage maximum leakage from saturated zone mm Δt^-1 0.0  mm day^-1\nc Brooks-Corey power coefficient for each soil layer - 10.0\nkvfrac muliplication factor applied to kv_z (vertical flow) - 1.0\nwaterfrac fraction of open water (excluding rivers) - 0.0\npathfrac fraction of compacted area - 0.01\nrootingdepth rooting depth mm 750.0\nrootdistpar controls how roots are linked to water table - -500.0\ncap_hmax water depth beyond which capillary flux ceases mm 2000.0\ncap_n coefficient controlling capillary rise - 2.0\net_reftopot multiplication factor to correct reference evaporation - 1.0\nsl (specific_leaf) specific leaf storage mm -\nswood (storage_wood) storage woody part of vegetation mm -\nkext extinction coefficient (to calculate canopy gap fraction) - -\ncmax maximum canopy storage mm 1.0\ne_r (eoverr) Gash interception model parameter - 0.1\ncanopygapfraction canopy gap fraction - 0.1\nΔt model time step s -\nmaxlayers maximum number of soil layers - -\nn number of grid cells - -\nnlayers number of soil layers - -\nn_unsatlayers number of unsaturated soil layers - -\nriverfrac fraction of river - -\nact_thickl thickness of soil layers mm -\nsumlayers cumulative sum of soil layers thickness, starting at soil surface mm -\nstemflow stemflow mm Δt^-1 -\nthroughfall throughfall mm Δt^-1 -\nustorelayerdepth amount of water in the unsaturated store, per layer mm -\nsatwaterdepth saturated store mm -\nzi pseudo-water table depth (top of the saturated zone) mm -\nsoilwatercapacity soilwater capacity mm -\ncanopystorage canopy storage mm -\ncanopygapfraction canopygapfraction - -\nprecipitation precipitation mm Δt^-1 -\ntemperature temperature ᵒC -\npotential_evaporation potential evaporation mm Δt^-1 -\npottrans_soil interception subtracted from potential evaporation) mm Δt^-1 -\ntranspiration transpiration mm Δt^-1 -\nae_ustore actual evaporation from unsaturated store mm Δt^-1 -\ninterception interception mm Δt^-1 -\nsoilevap soil evaporation from unsaturated store mm Δt^-1 -\nsoilevapsat soil evaporation from saturated store mm Δt^-1 -\nactcapflux actual capillary rise mm Δt^-1 -\nactevapsat actual transpiration from saturated store mm Δt^-1 -\nactevap total actual evapotranspiration mm Δt^-1 -\nrunoff_river runoff from river based on riverfrac mm Δt^-1 -\nrunoff_land runoff from land based on waterfrac mm Δt^-1 -\nae_openw_l actual evaporation from open water (land) mm Δt^-1 -\nae_openw_r actual evaporation from river mm Δt^-1 -\nnet_runoff_river net runoff from river (runoff_river - ae_openw_r) mm Δt^-1 -\navail_forinfilt water available for infiltration mm Δt^-1 -\nactinfilt actual infiltration into the unsaturated zone mm Δt^-1 -\nactinfiltsoil actual infiltration into non-compacted fraction mm Δt^-1 -\nactinfiltpath actual infiltration into compacted fraction mm Δt^-1 -\ninfiltsoilpath infiltration into the unsaturated zone mm Δt^-1 -\ninfiltexcess infiltration excess water mm Δt^-1 -\nexcesswater water that cannot infiltrate due to saturated soil (saturation excess) mm Δt^-1 -\nexfiltsatwater water exfiltrating during saturation excess conditions mm Δt^-1 -\nexfiltustore water exfiltrating from unsaturated store because of change in water table mm Δt^-1 -\nexcesswatersoil excess water for non-compacted fraction mm Δt^-1 -\nexcesswaterpath excess water for ompacted fraction mm Δt^-1 -\nrunoff total surface runoff from infiltration and saturation excess mm Δt^-1 -\nvwc volumetric water content per soil layer (including θᵣ and saturated zone) - -\nvwc_perc volumetric water content per soil layer (including θᵣ and saturated zone) % -\nrootstore root water storage in unsaturated and saturated zone (excluding θᵣ) mm -\nvwc_root volumetric water content in root zone (including θᵣ and saturated zone) - -\nvwc_percroot volumetric water content in root zone (including θᵣ and saturated zone) % -\nustoredepth total amount of available water in the usaturated zone mm -\ntransfer downward flux from unsaturated to saturated zone mm Δt^-1 -\nrecharge net recharge to saturated zone mm Δt^-1 -\nactleakage actual leakage from saturated store mm Δt^-1 -\nsnow snow storage mm -\nsnowwater liquid water content in the snow pack mm -\nrainfallplusmelt snowmelt + precipitation as rainfall mm Δt^-1 -\nglacierstore water within the glacier mm -\ntsoil top soil temperature ᵒC -\nleaf_area_index leaf area index m^2 m-2 -\nwaterlevel_land water level land mm -\nwaterlevel_river water level river mm -","category":"page"},{"location":"vertical/parameters/#HBV","page":"Vertical concepts","title":"HBV","text":"","category":"section"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"The Table below shows the parameters (fields) of struct HBV, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. ","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"parameter description unit default\ncfmax degree-day factor mm ᵒC^-1 Δt^-1 3.75653 mm ᵒC^-1 day^-1\ntt threshold temperature for snowfall ᵒC -1.41934\ntti threshold temperature interval length ᵒC 1.0\nttm threshold temperature for snowmelt ᵒC -1.41934\nwhc water holding capacity as fraction of current snow pack - 0.1\ng_tt threshold temperature for snowfall above glacier ᵒC 0.0\ng_cfmax Degree-day factor for glacier mm ᵒC^-1 Δt^-1 3.0 mm ᵒC^-1 day^-1\ng_sifrac fraction of the snowpack on top of the glacier converted into ice - 0.001\nglacierfrac fraction covered by a glacier - 0.0\nglacierstore water within the glacier mm 5500.0\nfc field capacity mm 260.0\nbetaseepage exponent in soil runoff generation equation - 1.8\nlp fraction of field capacity below which actual evaporation=potential evaporation - 0.53\nk4 recession constant baseflow Δt^-1 0.02307 day^-1\nkquickflow recession constant upper reservoir Δt^-1 0.09880 day^-1\nsuz Level over which k0 is used mm 100.0\nk0 recession constant upper reservoir Δt^-1 0.30 day^-1\nkhq recession rate at flow hq Δt^-1 0.09880 day^-1\nhq high flow rate hq for which recession rate of upper reservoir is known mm Δt^-1 3.27 mm day^-1\nalphanl measure of non-linearity of upper reservoir - 1.1\nperc percolation from upper to lower zone mm Δt^-1 0.4 mm day^-1\ncfr refreezing efficiency constant in refreezing of freewater in snow - 0.05\npcorr correction factor for precipitation - 1.0\nrfcf correction factor for rainfall - 1.0\nsfcf correction factor for snowfall - 1.0\ncflux maximum capillary rise from runoff response routine to soil moisture routine mm Δt^-1 2.0 mm day^-1\nicf maximum interception storage (in forested and non-forested areas) mm 2.0\ncevpf correction factor for potential evaporation - 1.0\nepf exponent of correction factor for evaporation on days with precipitation mm^-1 1.0\necorr evaporation correction - 1.0\nprecipitation precipitation mm Δt^-1 -\ntemperature temperature ᵒC -\npotential_evaporation potential evapotranspiration mm Δt^-1 -\npotsoilevap potential soil evaporation mm Δt^-1 -\nsoilevap soil evaporation mm Δt^-1 -\nintevap evaporation from interception storage mm Δt^-1 -\nactevap actual evapotranspiration (intevap + soilevap) mm Δt^-1 -\ninterceptionstorage actual interception storage mm -\nsnowwater available free water in snow mm -\nsnow snow pack mm -\nrainfallplusmelt snow melt + precipitation as rainfall mm Δt^-1 -\nsoilmoisture actual soil moisture mm -\ndirectrunoff direct runoff to upper zone mm Δt^-1 -\nhbv_seepage recharge to upper zone mm Δt^-1 -\nin_upperzone water inflow into upper zone mm Δt^-1 -\nupperzonestorage water content of the upper zone mm -\nquickflow specific runoff (quickflow part) mm Δt^-1 -\nreal_quickflow specific runoff (quickflow), if K upper zone is precalculated mm Δt^-1 -\npercolation actual percolation to the lower zone mm Δt^-1 -\ncapflux capillary rise mm Δt^-1 -\nlowerzonestorage water content of the lower zone mm -\nbaseflow specific runoff (baseflow part) per cell mm Δt^-1 -\nrunoff total specific runoff per cell mm Δt^-1 -","category":"page"},{"location":"vertical/parameters/#Sediment","page":"Vertical concepts","title":"Sediment","text":"","category":"section"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"The Table below shows external parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.vertical]. These external parameters are not part of struct LandSediment, but used to calculate parameters of struct LandSediment.","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"external parameter description unit default\npclay percentage clay % 0.1\npsilt percentage silt % 0.1\nresareas reservoir coverage - -\nlakeareas lake coverage - -","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"The Table below shows the parameters (fields) of struct LandSediment, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.vertical] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable Sl:","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"[input.vertical]\nspecific_leaf = \"Sl\"","category":"page"},{"location":"vertical/parameters/","page":"Vertical concepts","title":"Vertical concepts","text":"parameter description unit default\ncanopyheight canopy height m 3.0\nerosk coefficient for EUROSEM rainfall erosion - 0.6\nerosspl exponent for EUROSEM rainfall erosion - 2.0\nerosov coefficient for ANSWERS overland flow erosion - 0.9\npathfrac fraction of impervious area per grid cell - 0.01\nslope land slope - 0.01\nusleC USLE crop management factor - 0.01\nusleK USLE soil erodibility factor - 0.1\nsl (specific_leaf) specific leaf storage mm -\nswood (storage_wood) storage woody part of vegetation mm -\nkext extinction coefficient (to calculate canopy gap fraction) - -\ncmax maximum canopy storage mm 1.0\ncanopygapfraction canopy gap fraction - 0.1\ndmclay median diameter particle size class clay µm 2.0\ndmsilt median diameter particle size class silt µm 10.0\ndmsand median diameter particle size class sand µm 200.0\ndmsagg median diameter particle size class small aggregates µm 30.0\ndmlagg median diameter particle size class large aggregates µm 500.0\nrhos (rhosed) density of sediment kg m^-31 2650.0\nn number of cells - -\nyl length of cells in y direction m -\nxl length of cells in x direction m -\nriverfrac fraction of river - -\nwbcover waterbody coverage - -\nh_land depth of overland flow m -\ninterception canopy interception mm Δt^-1 -\nprecipitation precipitation mm Δt^-1 -\nq_land overland flow m^3 s^-1 -\nsedspl sediment eroded by rainfall ton Δt^-1 -\nsedov sediment eroded by overland flow ton Δt^-1 -\nsoilloss total eroded soil ton Δt^-1 -\nerosclay eroded soil for particle class clay ton Δt^-1 -\nerossilt eroded soil for particle class silt ton Δt^-1 -\nerossand eroded soil for particle class sand ton Δt^-1 -\nerossagg eroded soil for particle class small aggregates ton Δt^-1 -\neroslagg eroded soil for particle class large aggregates ton Δt^-1 -\nleaf_area_index leaf area index m^2 m^-2 -\ndl drain length m -\ndw flow width m -\ncGovers Govers transport capacity coefficient - -\nnGovers Govers transport capacity coefficient - -\nD50 median particle diameter of the topsoil mm -\nfclay fraction of particle class clay - -\nfsilt fraction of particle class silt - -\nfsand fraction of particle class sand - -\nfsagg fraction of particle class small aggregates - -\nflagg fraction of particle class large aggregates - -\nrivcell river cells - -\nTCsed total transport capacity of overland flow ton Δt^-1 -\nTCclay transport capacity of overland flow for particle class clay ton Δt^-1 -\nTCsilt transport capacity of overland flow for particle class silt ton Δt^-1 -\nTCsand transport capacity of overland flow for particle class sand ton Δt^-1 -\nTCsagg transport capacity of overland flow for particle class small aggregates ton Δt^-1 -\nTClagg transport capacity of overland flow for particle class large aggregates ton Δt^-1 -","category":"page"},{"location":"vertical/hbv/#HBV-vertical-concept","page":"HBV","title":"HBV vertical concept","text":"","category":"section"},{"location":"vertical/hbv/#Snow","page":"HBV","title":"Snow","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The snow model is described in Snow modelling.","category":"page"},{"location":"vertical/hbv/#Glaciers","page":"HBV","title":"Glaciers","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Glacier processes are described in Glacier modelling. Glacier modelling is enabled by specifying the following in the TOML file:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"[model]\nglacier = true","category":"page"},{"location":"vertical/hbv/#Potential-Evaporation","page":"HBV","title":"Potential Evaporation","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The cevpf model parameter is used to adjust the potential evaporation based on land use. In the original HBV version cevpfo is used, a factor for forest land use only.","category":"page"},{"location":"vertical/hbv/#Interception","page":"HBV","title":"Interception","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"For interception storage a single icf parameter is used according to the land use. In this implementation interception evaporation is subtracted to ensure total evaporation does not exceed potential evaporation. From this storage evaporation equal to the potential evaporation rate will occur as long as water is available, even if it is stored as snow. All water enters this store first, there is no concept of free throughfall (e.g. through gaps in the canopy). In the model a running water budget is kept of the interception store:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The available storage (icf- actual storage) is filled with the water coming from the snow routine (Q_in)\nAny surplus water now becomes the new Q_in\nInterception evaporation is determined as the minimum of the current interception storage and the potential evaporation","category":"page"},{"location":"vertical/hbv/#The-soil-routine","page":"HBV","title":"The soil routine","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The incoming water from the snow and interception routines, Q_in, is available for infiltration in the soil routine. The soil layer has a limited capacity, fc, to hold soil water, which means if fc is exceeded the abundant water cannot infiltrate and, consequently, becomes directly available for runoff.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    Q_dr=max((SM+Q_infc)00)","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where Q_dr is the abundant soil water (also referred to as direct runoff) and SM is the soil moisture content. Consequently, the net amount of water that infiltrates into the soil, I_net, equals:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"I_net = Q_in  Q_dr","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Part of the infiltrating water, I_net, will runoff through the soil layer (seepage). This runoff volume, SP, is related to the soil moisture content, SM, through the following power relation:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"SP = left(fracSMfcright)^beta I_net","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where beta is an empirically based parameter. Application of this equation implies that the amount of seepage water increases with increasing soil moisture content. The fraction of the infiltrating water which does not runoff, I_netSP, is added to the available amount of soil moisture, SM. The beta parameter affects the amount of supply to the soil moisture reservoir that is transferred to the quick response reservoir. Values of beta vary generally between 1 and 3. Larger values of beta reduce runoff and indicate a higher absorption capacity of the soil.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"(Image: hbv-soilmoist.png) ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Schematic view of the soil moisture routine","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"A percentage of the soil moisture will evaporate. This percentage is related to the potential evaporation and the available amount of soil moisture:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    E_a = fracSMT_m E_p    SMT_m \n    E_a = E_p    SM geq T_m","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where E_a is the actual evaporation, E_p is the potential evaporation and T_m (leq fc) is a user defined threshold, above which the actual evaporation equals the potential evaporation. T_m is defined as LP * fc in which LP is a soil dependent evaporation factor (LPleq 1).","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"In the original model (Bergström, 1992), a correction to E_a is applied in case of interception. If E_a from the soil moisture storage plus E_i exceeds ET_pE_i (E_i = interception evaporation) then the exceeding part is multiplied by a factor (1-e_red), where the parameter e_red varies between 0 and 1. This correction is not present in the wflow_hbv model.","category":"page"},{"location":"vertical/hbv/#The-runoff-response-routine","page":"HBV","title":"The runoff response routine","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The volume of water which becomes available for runoff, S_dr+SP, is transferred to the runoff response routine. In this routine the runoff delay is simulated through the use of a number of linear reservoirs.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Two linear reservoirs are defined to simulate the different runoff processes: the upper zone (generating quick runoff and interflow) and the lower zone (generating slow runoff). The available runoff water from the soil routine (i.e. direct runoff, S_dr, and seepage, SP) in principle ends up in the lower zone, unless the percolation threshold, PERC, is exceeded, in which case the redundant water ends up in the upper zone:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Delta V_LZ=min(PERC(S_dr+SP)) \nDelta V_UZ=max(00(S_dr+SPPERC))","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where V_UZ is the content of the upper zone, V_LZ is the content of the lower zone.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Capillary flow from the upper zone to the soil moisture reservoir is modeled according to: ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Q_cf=cflux  (fcSM)fc","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where cflux is the maximum capillary flux [mm day^-1].","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The upper zone generates quick runoff (Q_q) using:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Q_q=K  UZ^(1+alpha)","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where K is the upper zone recession coefficient, and alpha determines the amount of non-linearity. Within HBV-96, the value of K is determined from three other parameters: alpha, KHQ, and HQ [mm day^-1]. The value of HQ represents an outflow rate of the upper zone for which the recession rate is equal to KHQ. If we define UZ_HQ to be the content of the upper zone at outflow rate HQ we can write the following equation:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    HQ=K cdot UZ^(1+alpha) = KHQ cdot UZ_HQ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"If we eliminate UZ_HQ we obtain:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    HQ = K left(fracHQKHQright)^(1+alpha)","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Rewriting for K results in:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    K = KQH^(1alpha) HQ^alpha","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The lower zone is a linear reservoir, which means the rate of slow runoff, Q_LZ, which leaves this zone during one time step equals: ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Q_LZ = K_LZ  V_LZ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"where K_LZ is the reservoir constant.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The upper zone is also a linear reservoir, but it is slightly more complicated than the lower zone because it is divided into two zones: a lower part in which interflow is generated and an upper part in which quick flow is generated.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"(Image: hbv-upper) ","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Schematic view of the upper zone","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"If the total water content of the upper zone, V_UZ is lower than a threshold UZ1, the upper zone only generates interflow. On the other hand, if V_UZ exceeds UZ1, part of the upper zone water will runoff as quick flow:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    Q_i = K_i min(UZ1V_uz)\n    Q_q = K_q max((V_UZUZ1)00)","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Where Q_i is the amount of generated interflow in one time step, Q_q is the amount of generated quick flow in one time step and K_i and K_q are reservoir constants for interflow and quick flow respectively.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The total runoff rate, Q, is equal to the sum of the three different runoff components:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    Q = Q_LZ+Q_i+Q_q","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"The runoff behavior in the runoff response routine is controlled by two threshold values P_m and UZ1 in combination with three reservoir parameters, K_LZ, K_i and K_q.","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"In order to represent the differences in delay times between the three runoff components, the reservoir constants have to meet the following requirement:","category":"page"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"    K_LZK_iK_q","category":"page"},{"location":"vertical/hbv/#References","page":"HBV","title":"References","text":"","category":"section"},{"location":"vertical/hbv/","page":"HBV","title":"HBV","text":"Bergström, S., 1992, The HBV model–its structure and applications, SMHI Reports RH 4, Norrköping.","category":"page"},{"location":"publications/#Publications-using-Wflow-[![DOI](https://zenodo.org/badge/246787232.svg)](https://zenodo.org/badge/latestdoi/246787232)","page":"Publications","title":"Publications using Wflow (Image: DOI)","text":"","category":"section"},{"location":"publications/#Papers","page":"Publications","title":"Papers","text":"","category":"section"},{"location":"publications/","page":"Publications","title":"Publications","text":"de Boer-Euser, T., Bouaziz, L., De Niel, J., Brauer, C., Dewals, B., Drogue, G., Fenicia, F., Grelier, B., Nossent, J., Pereira, F., Savenije, H., Thirel, G., Willems, P., 2017. Looking beyond general metrics for model comparison – lessons from an international model intercomparison study. Hydrol. Earth Syst. Sci. 21, 423–440. https://doi:10.5194/hess-21-423-2017.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Bouaziz, L.J.E., Fenicia, F., Thirel, G., de Boer-Euser, T., Buitink, J., Brauer, C.C., De Niel, J., Dewals, B.J., Drogue, G., Grelier, B., Melsen, L. A., Moustakas, S., Nossent, J., Pereira, F., Sprokkereef, E., Stam, J., Weerts, A.H., Willems, P., Savenije, H.H.G., Hrachowitz, M., 2021. Behind the scenes of streamflow model performance. Hydrol. Earth Syst. Sci., 25, 1069–1095. https://doi.org/10.5194/hess-25-1069-2021.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Bouaziz, L.J.E., Aalbers, E.E., Weerts, A.H., Hegnauer, M., Buiteveld, H., Lammersen, R., Stam, J., Sprokkereef, E., Savenije, H.H.G., Hrachowitz, M., 2021. The importance of ecosystem adaptation on hydrological model predictions in response to climate change, Hydrol. Earth Syst. Sci. Discuss. [preprint], https://doi.org/10.5194/hess-2021-204, in review.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Casson, D. R., Werner, M., Weerts, A., and Solomatine, D., 2018. Global re-analysis datasets to improve hydrological assessment and snow water equivalent estimation in a sub-Arctic watershed. Hydrol. Earth Syst. Sci., 22, 4685–4697. https://doi.org/10.5194/hess-22-4685-2018.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Emerton, R.E., Stephens, E.M., Pappenberger, F., Pagano, T.C., Weerts, A.H., Wood, A.W., Salamon, P., Brown, J.D., Hjerdt, N., Donnelly, C., Baugh, C.A., Cloke, H.L., 2016. Continental and global scale flood forecasting systems. WIREs Water 3, 391–418. https://doi.org/10.1002/wat2.1137.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Gebremicael, T.G., Mohamed, Y.A., Van der Zaag, P., 2019. Attributing the hydrological impact of different land use types and their long-term dynamics through combining parsimonious hydrological modelling, alteration analysis and PLSR analysis. Science of The Total Environment, 660, 1155-1167, https://doi.org/10.1016/jscitotenv.2019.01.085.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Giardino, A., Schrijvershof, R., Nederhoff, C.M., de Vroeg, H., Brière, C., Tonnon, P.-K., Caires, S., Walstra, D.J., Sosa, J., van Verseveld, W., Schellekens, J., Sloff, C.J., 2018. A quantitative assessment of human interventions and climate change on the West African sediment budget, Ocean & Coastal Management, 156, 249-265. https://doi.org/10.1016/j.ocecoaman.2017.11.008.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Hally, A., Caumont, O., Garrote, L., Richard, E., Weerts, A., Delogu, F., Fiori, E., Rebora, N., Parodi, A., Mihalović, A., Ivković, M., Dekić, L., van Verseveld, W., Nuissier, O., Ducrocq, V., D’Agostino, D., Galizia, A., Danovaro, E., Clematis, A., 2015. Hydrometeorological multi-model ensemble simulations of the 4 November 2011 flash flood event in Genoa, Italy, in the framework of the DRIHM project. Nat. Hazards Earth Syst. Sci. 15, 537–555. https://doi:10.5194/nhess-15-537-2015.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Hassaballah, K., Mohamed, Y., Uhlenbrook, S., Biro, K., 2017. Analysis of streamflow response to land use land cover changes using satellite data and hydrological modelling: case study of Dinder and Rahad tributaries of the Blue Nile. Hydrol. Earth Syst. Sci. Discuss. 2017, 1–22. https://doi:10.5194/hess-2017-128.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Imhoff, R.O, van Verseveld, W.J., van Osnabrugge, B., Weerts, A.H., 2020. Scaling Point-Scale (Pedo)transfer Functions to Seamless Large-Domain Parameter Estimates for High-Resolution Distributed Hydrologic Modeling: An Example for the Rhine River. Water Resources Research,56,e2019WR026807. https://doi.org/10.1029/2019WR026807.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Imhoff, R.O., van Verseveld, W., van Osnabrugge, B., Weerts, A.H., 2020. Ruimtelijk schaalbare hydrologische modelparameters uit open-source omgevingsdata: een voorbeeld voor de Rijn. Stromingen: vakblad voor hydrologen, 26(3), 19-36 https://edepot.wur.nl/540682.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Jeuken, A., Bouaziz, L., Corzo, G., Alfonso, L., 2016. Analyzing Needs for Climate Change Adaptation in the Magdalena River Basin in Colombia, in: Filho, W.L., Musa, H., Cavan, G., O’Hare, P., Seixas, J. (Eds.), Climate Change Adaptation, Resilience and Hazards, Climate Change Management. Springer International Publishing, pp. 329–344 https://doi.org/10.1007/978-3-319-39880-8.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"López López, P., Wanders, N., Schellekens, J., Renzullo, L.J., Sutanudjaja, E.H., Bierkens, M.F.P., 2016. Improved large-scale hydrological modelling through the assimilation of streamflow and downscaled satellite soil moisture observations. Hydrol. Earth Syst. Sci., 20, 3059–3076. https://doi.org/10.5194/hess-20-3059-2016. ","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., Weerts, A.H., Uijlenhoet, R., 2017. genRE: A method to extend gridded precipitation climatology data sets in near real-time for hydrological forecasting purposes. Water Resources Research, 53. https://doi.org/10.1002/2017WR021201.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., Uijlenhoet, R., Weerts, A., 2019. Contribution of potential evaporation forecasts to 10-day streamflow forecast skill for the Rhine River, Hydrol. Earth Syst. Sci., 23, 1453–1467, https://doi.org/10.5194/hess-23-1453-2019.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Rakovec, O., Weerts, A.H., Sumihar, J., Uijlenhoet, R., 2015. Operational aspects of asynchronous filtering for flood forecasting. Hydrol. Earth Syst. Sci., 19, 2911–2924, https://doi.org/10.5194/hess-19-2911-2015.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Schaller, N., Sillmann, J., Müller, M., Haarsma, R., Hazeleger, W., Hegdahl, T.J., Kelder, T., van den Oord, G., Weerts, A., Whan, K., 2020. The role of spatial and temporal model resolution in a flood event storyline approach in western Norway. Weather and Climate Extremes, doi: https://doi.org/10.1016/j.wace.2020.100259.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Tangdamrongsub, N., Steele-Dunne, S.C., Gunter, B.C., Ditmar, P.G., Weerts, A.H., 2015. Data assimilation of GRACE terrestrial water storage estimates into a regional hydrological model of the Rhine River basin. Hydrol. Earth Syst. Sci. 19, 2079–2100. https://doi:10.5194/hess-19-2079-2015.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"van der Vat, M., Boderie, P., Bons, K.A., Hegnauer, M., Hendriksen, G., van Oorschot, M., Ottow, B., Roelofsen, F., Sankhua, R.N., Sinha, S.K., Warren, A., Young, W., 2019. Participatory Modelling of Surface and Groundwater to Support Strategic Planning in the Ganga Basin in India. Water, 11, 2443. https://doi.org/10.3390/w11122443. ","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Wannasin, C., Brauer, C. C., Uijlenhoet, R., van Verseveld, W. J., Weerts, A. H., 2021. Daily flow simulation in Thailand Part I: Testing a distributed hydrological model with seamless parameter maps based on global data. Journal of Hydrology: Regional Studies, 34, 1-19. https://doi.org/10.1016/j.ejrh.2021.100794.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Wannasin, C., Brauer, C. C., Uijlenhoet, R., van Verseveld, W. J., Weerts, A. H., 2021. Daily flow simulation in Thailand Part II: Unraveling effects of reservoir operation. Journal of Hydrology: RegionalStudies, 34, 1-17. https://doi.org/10.1016/j.ejrh.2021.100792.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Wang, X., Zhang, J., Babovic, V., 2016. Improving real-time forecasting of water quality indicators with combination of process-based models and data assimilation technique. Ecological Indicators 66, 428–439. https://doi:10.1016/j.ecolind.2016.02.016.","category":"page"},{"location":"publications/#Theses","page":"Publications","title":"Theses","text":"","category":"section"},{"location":"publications/","page":"Publications","title":"Publications","text":"Arnal, L., 2014. An intercomparison of flood forecasting models for the Meuse River basin, MSc. Thesis, Vrije Universiteit, Amsterdam. https://hal.inrae.fr/hal-02600749.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Alkemade, G., 2019. Routing and calibration of distributed hydrological models, MSc. Thesis, Vrije Universiteit Amsterdam, Faculty of Science, Hydrology.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Azadeh Karami Fard, 2015. Modeling runoff of an Ethiopian catchment with WFLOW, MSc. Thesis, Vrije Universiteit, Amsterdam.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"López López, P., 2018. Application of Global Hydrological Datasets for River Basin Modelling Utrecht University, Utrecht, the Netherlands, pp. 1-214, Doctoral dissertation. http://dspace.library.uu.nl/handle/1874/364148.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Maat, W.H., 2015. Simulating discharges and forecasting floods using a conceptual rainfall-runoff model for the Bolivian Mamoré basin, MSc. Thesis, University of Twente, Enschede. https://essay.utwente.nl/67046/.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., 2020. Interpolate, simulate, assimilate: operational aspects of improving hydrological forecasts in the Rhine basin. Wageningen University. https://doi.org/10.18174/513157.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Rohrmueller, I., 2019. BENCHMARKING THE NEW WFLOW DISTRIBUTED HYDROLOGICAL MODEL, MSc. Thesis, School of Engineering - Newcastle University.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Tretjakova, D., 2015. Investigating the effect of using fully-distributed model and data assimilation on the performance of hydrological forecasting in the Karasu catchment, Turkey, MSc thesis, Wageningen University.","category":"page"},{"location":"publications/","page":"Publications","title":"Publications","text":"Verbrugge, M., 2019. Reservoir Operation Optimization, a case study in the Chao Phraya Basin, BSc thesis, Hydrology and Quantitative Water Management Group, Wageningen University.","category":"page"},{"location":"publications/#Reports","page":"Publications","title":"Reports","text":"","category":"section"},{"location":"publications/","page":"Publications","title":"Publications","text":"World Bank. 2021. Plastic Waste Discharges from Rivers and Coastlines in Indonesia. Marine Plastics Series;. World Bank, Washington, DC. © World Bank. https://openknowledge.worldbank.org/handle/10986/35607 License: CC BY 3.0 IGO","category":"page"},{"location":"fews/#Run-from-Delft-FEWS","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"","category":"section"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"Wflow integrates easily as part of an operational system by linking to the Delft-FEWS platform. Delft-FEWS integrates data and models, and is for example used in many active flood forecasting systems around the world.","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"This can be done without a model adapter that provides the interface between Delft-FEWS and an external model (or module). This is possible because time information in the TOML configuration file is optional and Delft-FEWS can import and export NetCDF files. When time information is left out from the TOML configuration file, the starttime, endtime and timestepsecs (timestep) of the run is extracted from the NetCDF forcing file by Wflow. ","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"To indicate that a Wflow model runs from Delft-FEWS, the following setting needs to be specified in the main section of the TOML configuration file:","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"fews_run = true  # optional, default value is false","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"This ensures that Wflow offsets the time handling, to meet the expectations of Delft-FEWS.","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"It also uses a different format for the log file such that each log message takes up only one line. That meets the General Adapter logFile expectations, which then can get parsed with these Delft-FEWS log parsing settings:","category":"page"},{"location":"fews/","page":"Run from Delft-FEWS","title":"Run from Delft-FEWS","text":"<logFile>\n    <file>log.txt</file>\n    <errorLinePattern >* [Error] *</errorLinePattern >\n    <warningLinePattern>* [Warn] *</warningLinePattern>\n    <infoLinePattern>* [Info] *</infoLinePattern>\n    <debugLinePattern >* [Debug] *</debugLinePattern >\n</logFile>","category":"page"},{"location":"config/#Config-and-TOML","page":"Config","title":"Config and TOML","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"TOML is used as the configuration format for models available in wflow. File paths included in the configuration TOML file are relative to the TOML file location, or to dir_input and dir_output if they are given.","category":"page"},{"location":"config/#General-time-info","page":"Config","title":"General time info","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"Time information is optional. When left out, each time step in the forcing NetCDF will be calculated. If you wish to calculate a subset of this time range, or a different timestep, you can specify a starttime, endtime and timestepsecs yourself. The time_units optional information is used by the writer of the model, for model output in netCDF format. The calendar option allows you to calculate in one of the different CF conventions calendars provided by the CFTime.jl package, such as \"360_day\". This is useful if you want to calculate climate scenarios which are sometimes provided in these alternative calendars.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"calendar = \"standard\"                           # optional, this is default value\nendtime = 2000-02-01T00:00:00                   # optional, default from forcing NetCDF\nstarttime = 2000-01-01T00:00:00                 # optional, default from forcing NetCDF\ntime_units = \"days since 1900-01-01 00:00:00\"   # optional, this is default value\ntimestepsecs = 86400                            # optional, default from forcing NetCDF\ndir_input = \"data/input\"                        # optional, default is the path of the TOML\ndir_output = \"data/output\"                      # optional, default is the path of the TOML","category":"page"},{"location":"config/#Logging","page":"Config","title":"Logging","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"Wflow emits logging messages at various levels such as debug, info, and error. These get sent to both the terminal as well as a log file. If you want to debug an issue it can be helpful to set loglevel = \"debug\" in the TOML. To avoid flooding the screen, debug messages are only sent to the log file. The following settings will affect the logging:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"silent = false          # optional, default is \"false\"\nloglevel = \"debug\"      # optional, default is \"info\"\npath_log = \"log.txt\"    # optional, default is \"log.txt\"\nfews_run = false        # optional, default value is false","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"silent avoids logging to the terminal, and only writes the log file. loglevel controls which levels are filtered out, so the default setting \"info\" does not show any debug level messages. Note that for finer control, you can also pass an integer log level, see Julia's Logging documentation. path_log sets the desired output path for the log file. For information regarding fews_run, see Run from Delft-FEWS.","category":"page"},{"location":"config/#Model-section","page":"Config","title":"Model section","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"Model specific settings can be included in the model section of the TOML file.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[model]\ntype = \"sbm\"                        # one of (\"sbm\", \"sbm_gwf, \"hbv\")\nmasswasting = true                  # include lateral snow transport in the model, default is false\nsnow = true                         # include snow modelling, default is false\nreinit = true                       # cold (reinit = true) or warm state (reinit = false), default is true\nreservoirs = true                   # include reservoir modelling, default is false\nkin_wave_iteration = true           # enable kinematic wave iterations in the model, default is false\nthicknesslayers = [100, 300, 800]   # specific SBM setting: for each soil layer a thickness [mm] is specified\nmin_streamorder = 3                 # minimum stream order to delineate subbasins, default is 4 (for multi-threading computing purposes)","category":"page"},{"location":"config/#State-section","page":"Config","title":"State section","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"The state section in the TOML file provides information about the location of the state file if the model is initialized with a warm state (path_input) and to what file the states are written at the end of the model run (path_output). A mapping between external state names and internal model states is required. This information is specified for each model component, the vertical model and lateral model components. In the example below the vertical component represents the SBM concept, and for the lateral components there is a river (including reservoir), land and subsurface domain. The internal model states are listed on the left side, and the external state names are listed on the right side. Note that path_input is only required when reinit is set to false. path_output is optional, an output state file is only written when it is defined. If neither is set, the entire state section can be left out.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[state]\npath_input = \"instates-moselle.nc\" \npath_output = \"outstates-moselle.nc\"\n\n[state.vertical]\nsatwaterdepth = \"satwaterdepth\"\nsnow = \"snow\"\ntsoil = \"tsoil\"\nustorelayerdepth = \"ustorelayerdepth\"\nsnowwater = \"snowwater\"\ncanopystorage = \"canopystorage\"\n\n[state.lateral.river]\nq = \"q_river\"\nh = \"h_river\"\nh_av = \"h_av_river\"\n\n[state.lateral.river.reservoir]\nvolume = \"volume_reservoir\"\n\n[state.lateral.subsurface]\nssf = \"ssf\"\n\n[state.lateral.land]\nq = \"q_land\"\nh = \"h_land\"\nh_av = \"h_av_land\"","category":"page"},{"location":"config/#Input-section","page":"Config","title":"Input section","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"The input section of the TOML file contains information about the input forcing and model parameters files (netCDF format). Forcing is applied to the vertical component of the model, and needs to be mapped to the external netCDF variable name. forcing lists the internal model forcing parameters, and these are mapped to the external netCDF variables listed under the section [input.vertical]. It is possible to provide cyclic parameters to the model. In the example below this is done for the internal vertical.leaf_area_index model parameter, that is linked to the external netCDF variable \"LAI\" variable. ","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"As for the states, mapping of external model parameters (provided in the example below by the file staticmaps-moselle.nc) is done per model component. If a model parameter is not mapped a default value will be used if available.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[input]\n# use \"forcing-year-*.nc\" if forcing files are split in time\npath_forcing = \"forcing-moselle.nc\"\npath_static = \"staticmaps-moselle.nc\"\n\n# these are not directly part of the model\ngauges = \"wflow_gauges\"\nldd = \"wflow_ldd\"\nriver_location = \"wflow_river\"\nsubcatchment = \"wflow_subcatch\"\n\n# specify the internal IDs of the parameters which vary over time\n# the external name mapping needs to be below together with the other mappings\nforcing = [\n\"vertical.precipitation\",\n\"vertical.temperature\",\n\"vertical.potential_evaporation\",\n]\n\ncyclic = [\"vertical.leaf_area_index\"]\n\n[input.vertical]\naltitude = \"wflow_dem\" \nc = \"c\" \ncf_soil = \"cf_soil\" \ncfmax = \"Cfmax\" \ne_r = \"EoverR\" \ninfiltcappath = \"InfiltCapPath\" \ninfiltcapsoil = \"InfiltCapSoil\" \nkext = \"Kext\" \n\"kv₀\" = \"KsatVer\" \nleaf_area_index = \"LAI\"\nm = \"M\" \nmaxleakage = \"MaxLeakage\" \npathfrac = \"PathFrac\" \npotential_evaporation = \"PET\" # forcing\nprecipitation = \"P\" # forcing\nrootdistpar = \"rootdistpar\" \nrootingdepth = \"RootingDepth\" \nsoilminthickness = \"SoilMinThickness\" \nsoilthickness = \"SoilThickness\" \nspecific_leaf = \"Sl\" \nstorage_wood = \"Swood\" \ntemperature = \"TEMP\" # forcing\ntt = \"TT\" \ntti = \"TTI\" \nttm = \"TTM\" \nw_soil = \"wflow_soil\" \nwater_holding_capacity = \"WHC\" \nwaterfrac = \"WaterFrac\" \n\"θᵣ\" = \"thetaR\" \n\"θₛ\" = \"thetaS\"\n\n[input.lateral.river]\nlength = \"wflow_riverlength\"\nn = \"N_River\"\nslope = \"RiverSlope\"\nwidth = \"wflow_riverwidth\"\n\n[input.lateral.river.reservoir]\narea = \"ResSimpleArea\"\nareas = \"wflow_reservoirareas\"\ndemand = \"ResDemand\"\nlocs = \"wflow_reservoirlocs\"\nmaxrelease = \"ResMaxRelease\"\nmaxvolume = \"ResMaxVolume\"\ntargetfullfrac = \"ResTargetFullFrac\"\ntargetminfrac = \"ResTargetMinFrac\"\n\n[input.lateral.subsurface]\nksathorfrac = \"KsatHorFrac\"\n\n[input.lateral.land]\nn = \"N\"\nslope = \"Slope\"","category":"page"},{"location":"config/#Output-NetCDF-section","page":"Config","title":"Output NetCDF section","text":"","category":"section"},{"location":"config/#Grid-data","page":"Config","title":"Grid data","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"This optional section of the TOML file contains the output netCDF file for writing gridded model output, including a mapping between internal model parameter components and external netCDF variables.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[output]\npath = \"output_moselle.nc\"\n\n[output.vertical]\nsatwaterdepth = \"satwaterdepth\"\nsnow = \"snow\"\ntsoil = \"tsoil\"\nustorelayerdepth = \"ustorelayerdepth\"\nsnowwater = \"snowwater\"\ncanopystorage = \"canopystorage\"\n\n[output.lateral.river]\nq = \"q_river\"\nh = \"h_river\"\n\n[output.lateral.river.reservoir]\nvolume = \"volume_reservoir\"\n\n[output.lateral.subsurface]\nssf = \"ssf\"\n\n[output.lateral.land]\nq = \"q_land\"\nh = \"h_land\"","category":"page"},{"location":"config/#Scalar-data","page":"Config","title":"Scalar data","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"Besides gridded data, it is also possible to write scalar data to a NetCDF file. Below is an example that writes scalar data to the file \"output_scalar_moselle.nc\". For each NetCDF variable a name (external variable name) and parameter (internal model parameter) is required. A reducer can be specified to apply to the model output, see for more information the following section Output CSV section. When a map is provided to extract data for certain locations (e.g. gauges) or areas (e.g. subcatchment), the NetCDF location names are extracted from these maps. For a specific location (grid cell) a location is required. In the section Output CSV section, similar functionality is available for CSV. For integration with Delft-FEWS, see also Run from Delft-FEWS, it is recommended to write scalar data to NetCDF format since the General Adapter of Delft-FEWS can ingest this data format directly.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[netcdf]\npath = \"output_scalar_moselle.nc\"\n\n[[netcdf.variable]]\nname = \"Q\"\nmap = \"gauges\"\nparameter = \"lateral.river.q\"\n\n[[netcdf.variable]]\ncoordinate.x = 6.255\ncoordinate.y = 50.012\nname = \"temp_coord\"\nlocation = \"temp_bycoord\"\nparameter = \"vertical.temperature\"\n\n[[netcdf.variable]]\nlocation = \"temp_byindex\"\nname = \"temp_index\"\nindex.x = 100\nindex.y = 264\nparameter = \"vertical.temperature\"","category":"page"},{"location":"config/#Output-CSV-section","page":"Config","title":"Output CSV section","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"Model output can also be written to CSV output. Below is an example that writes model output to the file \"output_moselle.csv\". For each CSV column a header and parameter (internal model parameter) is required. A reducer can be specified to apply to the model output, with the following available reducers:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"maximum\nminimum\nmean\nmedian\nfirst\nlast\nonly","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"with only as the default. To extract data for a specific location (grid cell), the index of the vector, the coordinates coordinate.x and coordinate.y, or the x and y indices of the 2D array (index.x and index.y) can be provided. Finally a map can be provided to extract data for certain locations (e.g. gauges) or areas (e.g. subcatchment). In this case a single entry can lead to multiple columns in the CSV file, which will be of the form header_id, e.g. Q_20, for a gauge with integer ID 20.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"The double brackets in [[csv.column]] is TOML syntax to indicate that it is part of a list. You may specify as many entries as you wish.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[csv]\npath = \"output_moselle.csv\"\n\n[[csv.column]]\nheader = \"Q\"\nparameter = \"lateral.river.q\"\nreducer = \"maximum\"\n\n[[csv.column]]\nheader = \"volume\"\nindex = 1\nparameter = \"lateral.river.reservoir.volume\"\n\n[[csv.column]]\ncoordinate.x = 6.255\ncoordinate.y = 50.012\nheader = \"temp_bycoord\"\nparameter = \"vertical.temperature\"\n\n[[csv.column]]\nheader = \"temp_byindex\"\nindex.x = 100\nindex.y = 264\nparameter = \"vertical.temperature\"\n\n[[csv.column]]\nheader = \"Q\"\nmap = \"gauges\"\nparameter = \"lateral.river.q\"\n\n[[csv.column]]\nheader = \"recharge\"\nmap = \"subcatchment\"\nparameter = \"vertical.recharge\"\nreducer = \"mean\"","category":"page"},{"location":"config/#Modify-parameters","page":"Config","title":"Modify parameters","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"It is possible to modify model parameters and forcing through the TOML file. Two options to modify input parameters are available:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"Set an input parameter (static) to an uniform value.\nModify an input parameter (cyclic and static) or forcing variable through the use of a scale factor and offset.","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"To set for example the input parameter cfmax to an uniform value of 2.5:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[input.vertical]\nwater_holding_capacity = \"WHC\"\nwaterfrac = \"WaterFrac\"\ncfmax.value = 2.5","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"To change for example the forcing variable precipitation with a scale factor of 1.5 and an offset of 0.5:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[input.vertical.precipitation]\nnetcdf.variable.name = \"P\"\nscale = 1.5\noffset = 0.5","category":"page"},{"location":"config/#Fixed-forcing-values","page":"Config","title":"Fixed forcing values","text":"","category":"section"},{"location":"config/","page":"Config","title":"Config","text":"It is possible to set fixed values for forcing parameters through the TOML file. To set for example temperature to a fixed value of 10 degreeC, the complete forcing list is required:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"forcing = [\n  \"vertical.precipitation\",\n  \"vertical.temperature\",\n  \"vertical.potential_evaporation\",\n]\n\n[input.vertical.temperature]\nvalue = 10","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"Note that the mapping to the external netCDF variable listed under the section [input.vertical] needs to be removed or commented out:","category":"page"},{"location":"config/","page":"Config","title":"Config","text":"[input.vertical]\npotential_evaporation = \"PET\" # forcing\n# temperature = \"TEMP\" # forcing\nprecipitation = \"P\" # forcing","category":"page"},{"location":"lateral/sediment_params/#Overland-flow","page":"Sediment flux","title":"Overland flow","text":"","category":"section"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"The Table below shows the parameters (fields) of struct OverlandFlowSediment, including a description of these parameters, the unit, and default value if applicable. ","category":"page"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"parameter description unit default\nn number of cells - -\nrivcell river cells - -\nsoilloss total eroded soil ton Δt^-1 -\nerosclay eroded soil for particle class clay ton Δt^-1 -\nerossilt eroded soil for particle class silt ton Δt^-1 -\nerossand eroded soil for particle class sand ton Δt^-1 -\nerossagg eroded soil for particle class small aggregates ton Δt^-1 -\neroslagg eroded soil for particle class large aggregates ton Δt^-1 -\nTCsed total transport capacity of overland flow ton Δt^-1 -\nTCclay transport capacity of overland flow for particle class clay ton Δt^-1 -\nTCsilt transport capacity of overland flow for particle class silt ton Δt^-1 -\nTCsand transport capacity of overland flow for particle class sand ton Δt^-1 -\nTCsagg transport capacity of overland flow for particle class small aggregates ton Δt^-1 -\nTClagg transport capacity of overland flow for particle class large aggregates ton Δt^-1 -\ninlandsed sediment reaching the river with overland flow ton Δt^-1 -\ninlandclay sediment with particle class clay reaching the river with overland flow ton Δt^-1 -\ninlandsilt sediment with particle class silt reaching the river with overland flow ton Δt^-1 -\ninlandsand sediment with particle class sand reaching the river with overland flow ton Δt^-1 -\ninlandsagg sediment with particle class small aggregates reaching the river with overland flow ton Δt^-1 -\ninlandlagg sediment with particle class large aggregates reaching the river with overland flow ton Δt^-1 -","category":"page"},{"location":"lateral/sediment_params/#River-flow","page":"Sediment flux","title":"River flow","text":"","category":"section"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"The Table below shows external parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river]. These external parameters are not part of struct RiverSediment, but used to calculate parameters of struct RiverSediment.","category":"page"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"external parameter description unit default\nreslocs reservoir location (outlet) - -\nresareas reservoir coverage - -\nresarea reservoir area - m^2\nrestrapeff reservoir trapping efficiency coefficient - -\nlakelocs lake location (outlet) - -\nlakeareas lake coverage - -\nlakearea lake area - m^2","category":"page"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"The Table below shows the parameters (fields) of struct RiverSediment, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.lateral.river] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable RiverSlope:","category":"page"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"[input.vertical]\nslope = \"RiverSlope\"","category":"page"},{"location":"lateral/sediment_params/","page":"Sediment flux","title":"Sediment flux","text":"parameter description unit default\ndl (length) river length m -\nwidth river width m -\nsl (slope) river slope - -\nrhos (rhosed) density of sediment kg m^-31 2650.0\ndmclay median diameter particle size class clay mm 2.0\ndmsilt median diameter particle size class silt mm 10.0\ndmsand median diameter particle size class sand mm 200.0\ndmsagg median diameter particle size class small aggregates mm 30.0\ndmlagg median diameter particle size class large aggregates mm 500.0\ndmgrav median diameter particle size class gravel mm 2000.0\nfclayriv fraction of particle class clay - -\nfsiltriv fraction of particle class silt - -\nfsandriv fraction of particle class sand - -\nfsaggriv fraction of particle class small aggregates - -\nflaggriv fraction of particle class large aggregates - -\nfgravriv fraction of particle class gravel - -\nd50 (d50riv) river sediment median diameter mm -\nd50engelund river mean diameter mm -\ncbagnold Bagnold c coefficient - -\nebagnold Bagnold exponent - -\nn number of cells - -\nΔt model time step s -\nak Kodatie coefficient a - -\nbk Kodatie coefficient b - -\nck Kodatie coefficient c - -\ndk Kodatie coefficient d - -\nkdbank bank erodibilty m^3 N^-1 s^-1 -\nkdbed bed erodibility m^3 N^-1 s^-1 -\nTCrbank critical bed bank shear stress m^3 N^-2 -\nTCrbed critical bed shear stress m^3 N^-2 -\nh_riv river water level m -\nq_riv river discharge m^3 s^-1 -\ninlandclay sediment input with particle class clay from land erosion t Δt^-1 -\ninlandsilt sediment input with particle class silt from land erosion t Δt^-1 -\ninlandsand sediment input with particle class sand from land erosion t Δt^-1 -\ninlandsagg sediment input with particle class small aggregates from land erosion t Δt^-1 -\ninlandlagg sediment input with particle class large aggregates from land erosion t Δt^-1 -\ninlandsed sediment input from land erosion t Δt^-1 -\nsedload sediment left in the cell t -\nclayload sediment with particle class clay left in the cell t -\nsiltload sediment with particle class silt left in the cell t -\nsandload sediment with particle class sand left in the cell t -\nsaggload sediment with particle class small aggregates left in the cell t -\nlaggload sediment with particle class large aggregates in the cell t -\ngravload sediment with particle class gravel left in the cell t -\nsedstore sediment stored on the river bed after deposition t Δt^-1 -\nclaystore sediment with particle class clay stored on the river bed after deposition t Δt^-1 -\nsiltstore sediment with particle class silt stored on the river bed after deposition t Δt^-1 -\nsandstore sediment with particle class sand stored on the river bed after deposition t Δt^-1 -\nsaggstore sediment with particle class small aggregates stored on the river bed after deposition t Δt^-1 -\nlaggstore sediment with particle class large aggregates stored on the river bed after deposition t Δt^-1 -\ngravstore sediment with particle class gravel stored on the river bed after deposition t Δt^-1 -\noutsed sediment flux t Δt^-1 -\noutclay sediment with particle class clay flux t Δt^-1 -\noutsilt sediment with particle class silt t Δt^-1 -\noutsand sediment with particle class sand t Δt^-1 -\noutsagg sediment with particle class small aggregates t Δt^-1 -\noutlagg sediment with particle class large aggregates t Δt^-1 -\noutgrav sediment with particle class gravel t Δt^-1 -\nSedconc sediment concentration kg m^-3 -\nSSconc sediment concentration kg m^-3 -\nBedconc sediment concentration kg m^-3 -\nmaxsed river transport capacity t Δt^-1 -\nerodsed total eroded sediment t Δt^-1 -\nerodsedbank eroded bank sediment t Δt^-1 -\nerodsedbed eroded bed sediment t Δt^-1 -\ndepsed deposited sediment t Δt^-1 -\ninsed sediment input flux t Δt^-1 -\nwbcover waterbody coverage - -\nwblocs waterbody locations - -\nwbarea waterbody area m^2 -\nwbtrap waterbody trapping efficiency coefficient - -","category":"page"},{"location":"model/sbm/#wflow_sbm","page":"wflow_sbm","title":"wflow_sbm","text":"","category":"section"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Wflow_sbm represents a family of hydrological models derived from the CQflow model (Köhler et al.,2006) that has been applied in various countries, most notably in Central America. The models have the vertical SBM concept in common. The soil part of wflow_sbm is largely based on the Topog_SBM model but has had considerable changes over time. Topog_SBM is specifically designed to simulate fast runoff processes in small catchments while wflow_sbm model can be applied more widely. The main differences are for the vertical concept SBM of wflow_sbm:","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"The unsaturated zone can be split-up in different layers\nThe addition of evapotranspiration losses\nThe addition of a capillary rise","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"The vertical SBM concept is explained in more detail in the following section SBM vertical concept.","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Topog_SBM uses an element network based on contour lines and trajectories for water routing. Wflow_sbm models differ in how the lateral components:","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"river\nland\nsubsurface  ","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"are solved.","category":"page"},{"location":"model/sbm/#SBM-Kinematic-wave","page":"wflow_sbm","title":"SBM + Kinematic wave","text":"","category":"section"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"For the lateral components of this wflow_sbm model water is routed over a D8 network, and the kinematic wave approach is used for river, overland and lateral subsurface flow. This is described in more detail in the section Kinematic wave.","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Overview of the different processes and fluxes in the wflow_sbm model:","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"(Image: wflow_sbm model)","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Below the mapping for this wflow_sbm model (type sbm) to the vertical SBM concept (instance of struct SBM) and the different lateral concepts is presented. For an explanation about the type parameters between curly braces after the struct name see Vertical and lateral models.","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"vertical => struct SBM{T,N,M}\nlateral.subsurface => struct LateralSSF{T}\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model/sbm/#SBM-Local-inertial-river","page":"wflow_sbm","title":"SBM + Local inertial river","text":"","category":"section"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"By default the SBM + Kinematic wave model (type sbm) uses the kinematic wave approach for river flow. There is also the option to use the local inertial model for river flow, by providing the following in the TOML file:  ","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"[model]\nriver_routing = \"local-inertial\"","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Only the mapping for the river component changes, as shown below. For an explanation about the type parameters between curly braces after the struct name see Vertical and lateral models. ","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"lateral.river => struct ShallowWaterRiver{T,R,L}","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"The local inertial approach is described in more detail in the section Local inertial model.","category":"page"},{"location":"model/sbm/#SBM-Groundwater-flow","page":"wflow_sbm","title":"SBM + Groundwater flow","text":"","category":"section"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"For river and overland flow the kinematic wave approach over a D8 network is used for this wflow_sbm model. For the subsurface domain, an unconfined aquifer with groundwater flow in four directions (adjacent cells) is used. This is described in more detail in the section Groundwater flow.","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Below the mapping for this wflow_sbm model (type sbm_gwf) to the vertical SBM concept (instance of struct SBM) and the different lateral concepts. For an explanation about the type parameters between curly braces after the struct name see Vertical and lateral models.","category":"page"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"vertical => struct SBM{T,N,M}\nlateral.subsurface.flow => struct GroundwaterFlow{A, B}\nlateral.subsurface.recharge => struct Recharge{T} <: AquiferBoundaryCondition\nlateral.subsurface.river => struct River{T} <: AquiferBoundaryCondition\nlateral.subsurface.drain => struct Drainage{T} <: AquiferBoundaryCondition # optional\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model/sbm/#References","page":"wflow_sbm","title":"References","text":"","category":"section"},{"location":"model/sbm/","page":"wflow_sbm","title":"wflow_sbm","text":"Köhler, L., Mulligan, M., Schellekens, J., Schmid, S., Tobón, C., 2006, Hydrological impacts of converting tropical montane cloud forest to pasture, with initial reference to northern Costa Rica. Final Technical Report DFID‐FRP Project No. R799.","category":"page"},{"location":"model-setup/#Building-a-model","page":"Building a model","title":"Building a model","text":"","category":"section"},{"location":"model-setup/#Data-requirements","page":"Building a model","title":"Data requirements","text":"","category":"section"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The actual data requirements depend on the application of the Model and the Model type. Both forcing and static data should be provided in netCDF format, with the same grid definition for forcing and static data. The only exception is storage and rating curves for lakes, that should be provided in CSV format, see also Additional settings.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"Forcing data:\nPrecipitation\nPotential evapotranspiration\nTemperature (optional, only needed for snow and glacier modelling)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The requirements for static data (including model parameters) depend on the Model type. The  following data is required for all Model types, but not directly part of a Model component:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"flow direction data (D8)\nriver map (location of the river)\nsub-catchment map (model domain)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"For the flow direction (D8) data, the PCRaster ldd convention is used, see also PCRaster ldd. An approach to generate ldd data is to make use of the Python package pyflwdir: ","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"to upscale existing flow direction data as the 3 arcsec MERIT Hydro data (Yamazaki et al., 2019)\nor to derive flow directions from elevation data,","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"see also Eilander et al. (2021) for more information.  Pyflwdir is also used by the hydroMT Python package described in the next paragraph. Another approach to generate ldd data is to make use of PCRaster functionality, see for example lddcreate.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"Optionally, but also not directly part of a model component are gauge locations, that are used to extract gridded data from certain locations.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The following Model types make use of the kinematic wave:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"SBM + Kinematic wave\nSBM + Groundwater flow\nHBV model","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"and require for the river and overland flow components input data that is described in Surface flow. Reservoirs or lakes can be part of the kinematic wave (optional) and input parameters are described in Reservoirs and Lakes.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"Besides the river and overland flow components the SBM + Kinematic wave model consists of the SBM vertical concept and input parameters for this component are described in the SBM section of Model parameters. Finally, the SBM + Kinematic wave model includes the lateral component Subsurface flow routing and parameters that are part of this component are described in the Lateral subsurface flow section of Model parameters. Input parameters for this component of the SBM + Kinematic wave model are derived from the SBM vertical concept and the land slope. One external parameter khfrac is used to calculate the horizontal hydraulic conductivity at the soil surface kh₀.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"There is also the option to use the local inertial model for river flow as part of the SBM + Kinematic wave model. Input parameters for this approach are described in River flow (local inertial) of the Model parameters section.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The HBV model consists besides the river and overland flow components of the HBV vertical concept. Input parameters for this component are described in the HBV section of Model parameters.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The SBM + Groundwater flow includes besides the river and overland flow components and the vertical SBM concept, the lateral Groundwater flow component. For the unconfined aquifer the input parameters are described in the section Unconfined aquifer of Model parameters. The bottom (bottom) of the groundwater layer is derived from from the soilthickness [mm] parameter of SBM and the provided surface elevation altitude [m] as part of the static input. The area parameter is derived from the model grid. Parameters that are part of the boundary conditions of the unconfined aquifer are listed under Constant Head and Boundary conditions of the Model parameters section.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The wflow_sediment model consists of the vertical Soil Erosion concept and the input parameters for this concept are described in the Sediment section of the Model parameters. The parameters of the lateral Sediment Flux in overland flow concept are described in the Overland flow section of the Model parameters. Parameters of this component are not directly set by data from static input. The input parameters of the lateral concept River Sediment Model are listed in River flow of the Model parameters section.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The Model parameters section lists all the parameters per Model component and these Tables can also be used to check which parameters can be part of the output, see also Output NetCDF section and Output CSV section.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"For each Wflow Model a test model is available that can help to understand the data requirements and the usage of each Model. The TOML configuration file per available model are listed in the Table below:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"model TOML configuration file\nSBM + Kinematic wave sbm_config.toml\nSBM + Groundwater flow sbm_gwf_config.toml\nHBV model hbv_config.toml\nwflow_sediment sediment_config.toml","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"The associated Model files (input static, forcing and state files) can easily be downloaded and for this we share the following Julia code (per Model) that downloads the required files to your current working directory:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"SBM + Kinematic wave:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"# urls to TOML and NetCDF of the Moselle example model\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.4/staticmaps-moselle.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/forcing-2000.nc\"\ninstates = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.2/instates-moselle.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sbm_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-moselle.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-moselle.nc\"))\ndownload(instates, joinpath(datadir, \"instates-moselle.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"SBM + Groundwater flow:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"# urls to TOML and NetCDF of the Moselle example model\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.2/staticmaps-sbm-groundwater.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.1/forcing-sbm-groundwater.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sbm_gwf_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-sbm-groundwater.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-sbm-groundwater.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"HBV model:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"# urls to TOML and NetCDF of the Moselle example model\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.1/staticmaps-lahn.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/forcing-lahn.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"hbv_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-lahn.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-lahn.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"wflow_sediment:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"# urls to TOML and NetCDF of the Moselle example model\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.3/staticmaps-moselle-sed.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.3/forcing-moselle-sed.nc\"\ninstates = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/instates-moselle-sed.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sediment_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-moselle-sed.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-moselle-sed.nc\"))\ndownload(instates, joinpath(datadir, \"instates-moselle-sed.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"For running these test model see also Usage and Command Line Interface.","category":"page"},{"location":"model-setup/#hydroMT","page":"Building a model","title":"hydroMT","text":"","category":"section"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"hydroMT is a Python package, developed by Deltares, to build and analysis hydro models. It provides a generic model api with attributes to access the model schematization, (dynamic) forcing data, results and states.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"For the following Wflow models:","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"SBM + Kinematic wave \nwflow_sediment","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"the Wflow plugin hydroMT-wflow of hydroMT can be used to build and analyse these Wflow model types in an automated way.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"To learn more about the Wflow plugin of this Python package, we refer to the hydroMT-wflow documentation.","category":"page"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"To inspect or modify (for example in QGIS) the netCDF static data of these Wflow models it is convenient to export the maps to a raster format. This can be done as part of the hydroMT-wflow plugin, see also the following example. It is also possible to create again the netCDF static data file based on the modified raster map stack.","category":"page"},{"location":"model-setup/#References","page":"Building a model","title":"References","text":"","category":"section"},{"location":"model-setup/","page":"Building a model","title":"Building a model","text":"Yamazaki, D., Ikeshima, D., Sosa, J., Bates, P. D., Allen, G. H. and Pavelsky, T. M.: MERIT Hydro: A high‐resolution global hydrography map based on latest topography datasets, Water Resour. Res., 2019WR024873, doi:10.1029/2019WR024873, 2019.\nEilander, D., van Verseveld, W., Yamazaki, D., Weerts, A., Winsemius, H. C., and Ward, P. J.: A hydrography upscaling method for scale-invariant parametrization of distributed hydrological models, Hydrol. Earth Syst. Sci., 25, 5287–5313, https://doi.org/10.5194/hess-25-5287-2021, 2021.","category":"page"},{"location":"vertical/process/#Vertical-processes","page":"Vertical processes","title":"Vertical processes","text":"","category":"section"},{"location":"vertical/process/#Snow-and-glaciers","page":"Vertical processes","title":"Snow and glaciers","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Snow and glacier processes are derived from the original HBV concept and HBV-light respectively. ","category":"page"},{"location":"vertical/process/#Snow-modelling","page":"Vertical processes","title":"Snow modelling","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"If the air temperature, T_a, is below a user-defined threshold tt (degreeC) precipitation occurs as snowfall, whereas it occurs as rainfall if Ta  tt. A another parameter tti defines how precipitation can occur partly as rain of snowfall (see the figure below). If precipitation occurs as snowfall, it is added to the dry snow component within the snow pack. Otherwise it ends up in the free water reservoir, which represents the liquid water content of the snow pack. Between the two components of the snow pack, interactions take place, either through snow melt (if temperatures are above a threshold tt) or through snow refreezing (if temperatures are below threshold tt.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The respective rates of snow melt and refreezing are:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Q_m = cfmax(T_att) T_a  tt \nQ_r=cfmax  cfr(ttT_a) Ta  tt","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"where Q_m is the rate of snow melt, Q_r is the rate of snow refreezing, and cfmax and cfr are user defined model parameters (the melting factor [mm/(degreeC day)] and the refreezing factor respectively).","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The fraction of liquid water in the snow pack is at most equal to a user defined fraction, whc, of the water equivalent of the dry snow content. If the liquid water concentration exceeds whc, either through snow melt or incoming rainfall, the surplus water (rainfall) becomes available for infiltration into the soil:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"    snowwater = snowwater - refreezing  # free water content in snow\n    maxsnowwater = snow * whc  # max water in the snow\n    snowwater = snowwater + snowmelt + rainfall  # add all water and potentially supersaturate the snowpack\n    rainfall = max(snowwater - maxsnowwater, 0.0)  # rain + surpluss snowwater","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"\n (Image: snow hbv) Schematic view of the snow routine","category":"page"},{"location":"vertical/process/#Glacier-modelling","page":"Vertical processes","title":"Glacier modelling","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Glacier processes can be modelled if the snow model is enabled. For the vertical HBV concept snow modelling is not optional. Glacier modelling is very close to snow modelling and considers two main processes: glacier build-up from snow turning into firn/ice (using the HBV-light model) and glacier melt (using a temperature degree-day model).","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The definition of glacier boundaries and initial volume is defined in three parameters. glacierfrac is a parameter that gives the fraction of each grid cell covered by a glacier as a number between zero and one. glacierstore is a state parameter that gives the amount of water (in mm w.e.) within the glaciers at each gridcell. Because the glacier store (glacierstore) cannot be initialized by running the model for a couple of years, a default initial state should be supplied by adding this parameter to the input static file. The required glacier data can be prepared from available glacier datasets.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"First, a fixed fraction of the snowpack on top of the glacier is converted into ice for each timestep and added to the glacierstore using the HBV-light model (Seibert et al., 2018). This fraction g_sifrac typically ranges from 0.001 to 0.006.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Then, when the snowpack on top of the glacier is almost all melted (snow cover < 10 mm), glacier melt is enabled and estimated with a degree-day model. If the air temperature, T_a, is below a certain threshold g_tt (degreeC) precipitation occurs as snowfall, whereas it occurs as rainfall if T_a  g_tt.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"With this the rate of glacier melt in mm is estimated as:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Q_m = g_cfmax(T_a  g_tt)   T_a  g_tt","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"where Q_m is the rate of glacier melt and g_cfmax is the melting factor in mm/(degreeC day). Parameter g_tt can be taken as equal to the snow tt parameter. Values of the melting factor g_cfmax normally varies from one glacier to another and some values are reported in the literature. g_cfmax can also be estimated by multiplying snow cfmax by a factor between 1 and 2, to take into account the higher albedo of ice compared to snow.","category":"page"},{"location":"vertical/process/#Rainfall-interception","page":"Vertical processes","title":"Rainfall interception","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Both the Gash and Rutter models are available to estimate rainfall interception by the vegetation. The selection of an interception model depends on the simulation timestep.","category":"page"},{"location":"vertical/process/#The-analytical-(Gash)-model","page":"Vertical processes","title":"The analytical (Gash) model","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The analytical model of rainfall interception is based on Rutter’s numerical model. The simplifications that introduced allow the model to be applied on a daily basis, although a storm-based approach will yield better results in situations with more than one storm per day. The amount of water needed to completely saturate the canopy is defined as:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"P=frac-overlineRSoverlineE_wlnleft1-fracoverlineE_woverlineR(1-p-p_t)^-1right","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"where overlineR is the average precipitation intensity on a saturated canopy and overlineE_w the average evaporation from the wet canopy and with the vegetation parameters S, p and p_t as defined previously. The model uses a series of expressions to calculate the interception loss during different phases of a storm. An analytical integration of the total evaporation and rainfall under saturated canopy conditions is then done for each storm to determine average values of overlineE_w and overlineR. The total evaporation from the canopy (the total interception loss) is calculated as the sum of the components listed in the table below. Interception losses from the stems are calculated for days with Pgeq S_tp_t. p_t and S_t are small and neglected.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Table: Formulation of the components of interception loss according to Gash:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Components Interception loss\nFor m small storms (P_gP_g) (1-p-p_t)sum_j=1^mP_gj\nWetting up the canopy in n large storms (P_ggeqP_g) n(1-p-p_t)P_g-nS\nEvaporation from saturated canopy during rainfall overlineEoverlineRsum_j=1^n(P_gj-P_g)\nEvaporation after rainfall ceases for n large storms nS\nEvaporation from trunks in q storms that fill the trunk storage qS_t\nEvaporation from  trunks in m+n-q storms that do not fill the trunk storage p_tsum_j=1^m+n-qP_gj","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"In applying the analytical model, saturated conditions are assumed to occur when the hourly rainfall exceeds a certain threshold. Often a threshold of 0.5 mm/hr is used. overlineR is calculated for all hours when the rainfall exceeds the threshold to give an estimate of the mean rainfall rate onto a saturated canopy.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Gash (1979) has shown that in a regression of interception loss on rainfall (on a storm basis) the regression coefficient should equal to overlineE_woverlineR. Assuming that neither overlineE_w nor overlineR vary considerably in time, overlineE_w can be estimated in this way from overlineR in the absence of above-canopy climatic observations. Values derived in this way generally tend to be (much) higher than those calculated with the penman-monteith equation.","category":"page"},{"location":"vertical/process/#The-modified-rutter-model","page":"Vertical processes","title":"The modified rutter model","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"For sub daily timesteps the interception is calculated using a simplification of the Rutter model. The simplified model is solved explicitly and does not take drainage from the canopy into account.","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Wflow.rainfall_interception_modrut","category":"page"},{"location":"vertical/process/#Wflow.rainfall_interception_modrut","page":"Vertical processes","title":"Wflow.rainfall_interception_modrut","text":"rainfall_interception_modrut(precipitation, potential_evaporation, canopystorage, canopygapfraction, cmax)\n\nInterception according to a modified Rutter model. The model is solved explicitly and there is no drainage below cmax.\n\n\n\n\n\n","category":"function"},{"location":"vertical/process/#Interception-parameters-from-LAI","page":"Vertical processes","title":"Interception parameters from LAI","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The SBM concept can determine the interception parameters from leaf area index (LAI) climatology. In order to switch this on you must define this cyclic parameter in the TOML file, the parameter is read from path_static, as follows:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"[input] \npath_forcing = \"data/forcing-moselle.nc\" \npath_static = \"data/staticmaps-moselle.nc\"\n\ncyclic = [\"vertical.leaf_area_index\"]","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Furthermore these additional parameters are required:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Specific leaf storage  (sl [mm])\nStorage woody part of vegetation (swood [mm])\nExtinction coefficient (kext [-])","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Here it is assumed that cmax [mm] (leaves) (canopy storage capacity for the leaves only) relates linearly with LAI (c.f. Van Dijk and Bruijnzeel 2001). This done via the sl. sl can be determined through a lookup table with land cover based on literature (Pitman 1989, Lui 1998). Next the cmax (leaves) is determined using:","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"\n    cmax(leaves)  = sl  LAI","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"To get to total storage (cmax) the woody part of the vegetation also needs to be added. As for sl, the storage of the woody part swood can also be related to land cover (lookup table).","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The canopy gap fraction is determined using the extinction coefficient kext (van Dijk and Bruijnzeel 2001):","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"    canopygapfraction = exp(-kext  LAI)","category":"page"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"The extinction coefficient kext can be related to land cover.","category":"page"},{"location":"vertical/process/#References","page":"Vertical processes","title":"References","text":"","category":"section"},{"location":"vertical/process/","page":"Vertical processes","title":"Vertical processes","text":"Gash, J. H. C., 1979, An analytical model of rainfall interception by forests, Q. J. Roy. Meteor. Soc., 105, 43–55, doi:1026 10.1002/qj.497105443041027.\nLiu, S., 1998, Estimation of rainfall storage capacity in the canopies of cypress wetlands and slash pine uplands in North-Central Florida, J. Hydr., 207, 32–41, doi: 10.1016/S0022-1694(98)00115-2.\nPitman, J., 1989, Rainfall interception by bracken in open habitats—relations between leaf area, canopy storage and drainage rate, J. Hydr. 105, 317–334, doi: 10.1016/0022-1694(89)90111-X.\nSeibert, J., Vis, M. J. P., Kohn, I., Weiler, M., and Stahl, K., 2018, Technical note: Representing glacier geometry changes in a semi-distributed hydrological model, Hydrol. Earth Syst. Sci., 22, 2211–2224, https://doi.org/10.5194/hess-22-2211-2018.\nVan Dijk, A. I. J. M., and Bruijnzeel, L. A., 2001, Modelling rainfall interception by vegetation of variable density using an adapted analytical model, Part 2, Model validation for a tropical upland mixed cropping system, J. Hydr., 247, 239–262.","category":"page"},{"location":"quick-start/#Quick-start","page":"Quick start","title":"Quick start","text":"","category":"section"},{"location":"quick-start/#Installation","page":"Quick start","title":"Installation","text":"","category":"section"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Wflow is a Julia package, that can be installed using Julia's built-in package manager, Pkg. The rest of this section provides more detailed instructions, such that new Julia users can also install Wflow. If you already know this, you can go ahead to the next section.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"First download and install the current stable release of Julia. Please see platform specific instructions for further installation instructions and if you have trouble installing Julia.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"If you are new to Julia, it may be a good idea to check out the Getting Started section of the Julia Manual. Links to other learning resources can be found at julialang.org/learning.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Start an interactive session (also known as a read-eval-print loop or \"REPL\") by double-clicking the Julia executable or running julia from the command line, in case you have chosen to add it to your path. The default prompt will appear, in which Julia code can be entered and run.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"julia> 1 + 2\n3","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Enter the Pkg REPL by pressing ] from the Julia REPL. To get back to the Julia REPL, press backspace or ^C. Just like in the Julia REPL, you can type ? to get a help message, this will list the available commands. To get more information on a specific command type ? followed by the command.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"pkg> ?\n\npkg> ?add","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"If you have not used Julia in a while, it can be a good idea to run up to update your packages.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"pkg> up","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"If you go back to the Julia REPL, note that the same works, and is a convenient way to consult documentation for specific functions or types, or other objects.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"help?> cos","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Now go back to the Pkg REPL and install Wflow using:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"pkg> add Wflow","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"This can take a while, especially the first time, since compatible dependencies are also automatically looked up and installed from the Pkg General registry. It is also possible to install Wflow from the master branch as follows:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"pkg> add https://github.com/Deltares/Wflow.jl","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"This command will track the master branch, and will update to the latest commit on that branch when you run update, or simply up, in the Pkg REPL. The use of add will install Wflow in you home directory under .julia/packages/Wflow. Note that packages installed under packages by add are supposed to never be altered in that location, for Pkg and it's automatic dependency handling to work well. If you want to make any changes to any of the files in the Wflow directory, you need to do a development install. This can be done using:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"pkg> dev https://github.com/Deltares/Wflow.jl","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"This will clone the git repository, put it under your home directory in .julia/dev/Wflow, and add the Wflow package to your project environment. Note that to receive updates, you have to pull in the latest changes yourself using git pull.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Finally, go back the Julia REPL and try to load Wflow:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"julia> using Wflow","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"The first time this will take longer as any package that is new or changed needs to be precompiled first, to allow faster loading on subsequent uses.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"You have now successfully installed Julia and Wflow. Before ending this section, we still want to recommend a few tools that can make using and developing Julia code easier.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"The first is Revise.jl. This package allows you to modify code and use the changes without restarting Julia. Install it with add Revise from the Pkg REPL. Then create a file called .julia/config/startup.jl, and put using Revise there. This will load Revise every time you start a Julia session.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"There is a section on editors and IDEs for Julia on https://julialang.org/, scroll down to see it. We use and recommend Microsoft's free and open source Visual Studio Code. When combined with the Julia extension it provides a powerful and interactive development experience.","category":"page"},{"location":"quick-start/#Usage","page":"Quick start","title":"Usage","text":"","category":"section"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"To run a simulation, first the required static and dynamic input data should be prepared in NetCDF files. Next, we use a TOML configuration file, to fully specify a model simulation. This includes the model type, the start- and endtime, the path to the forcing NetCDF files, as well as the mapping of parameters in the model to names in the NetCDF file. See the section Config and TOML for more details.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"As an example, we will run the Moselle example SBM model, of which the configuration file can be seen here: sbm_simple.toml. First we share some code that will download the required files to your current working directory:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"# urls to TOML and NetCDF of the Moselle example model\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.1/staticmaps.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/forcing-2000.nc\"\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/sbm_simple.toml\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sbm_simple.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-moselle.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-moselle.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Now that we have our files in place, running a simulation is as simple as calling this function:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Wflow.run","category":"page"},{"location":"quick-start/#Wflow.run","page":"Quick start","title":"Wflow.run","text":"run(tomlpath::AbstractString; silent=false)\nrun(config::Config)\nrun(model::Model)\nrun()\n\nRun an entire simulation starting either from a path to a TOML settings file, a prepared Config object, or an initialized Model object. This allows more flexibility if you want to for example modify a Config before initializing the Model. Logging to a  file is only part of the run(tomlpath::AbstractString) method. To avoid logging to the terminal, set the silent keyword argument to true, or put that in the TOML.\n\nThe 0 argument version expects ARGS to contain a single entry, pointing to the TOML path. This makes it easier to start a run from the command line without having to escape quotes:\n\njulia -e \"using Wflow; Wflow.run()\" \"path/to/config.toml\"\n\n\n\n\n\n","category":"function"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"As you can see, there are three different methods for this function. We will first make use of the first one, where a path to a TOML file is passed as a String.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"using Wflow\nWflow.run(toml_path)","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"This will parse the TOML file to create a Wflow.Config, use that to initialize a Wflow.Model, and finally run the Wflow.Model for the specified duration.","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Wflow.Config\nWflow.Model","category":"page"},{"location":"quick-start/#Wflow.Config","page":"Quick start","title":"Wflow.Config","text":"Config(path::AbstractString)\nConfig(dict::AbstractDict)\nConfig(dict::Dict{String,Any}, path::Union{String,Nothing})\n\nStruct that contains the parsed TOML configuration, as well as a reference to the TOML path, if it exists. It behaves largely like a distionary, but it overloads getproperty and setproperty to support syntax like config.model.reinit = false.\n\n\n\n\n\n","category":"type"},{"location":"quick-start/#Wflow.Model","page":"Quick start","title":"Wflow.Model","text":"Model{N,L,V,R,W}\n\nComposite type that represents all different aspects of a Wflow Model, such as the network, parameters, clock, configuration and input and output.\n\n\n\n\n\n","category":"type"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"If you want to try out several different settings, without having to modify the TOML file every time, you can create a Wflow.Config first, modify some settings, and then start the simulation:","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"using Dates\nconfig = Wflow.Config(toml_path)\nconfig.endtime = DateTime(\"2000-01-03T00:00:00\")\nWflow.run(config)","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"For even more control, you can initialize the model object yourself, and modify it directly, or run a custom simulation loop. See the Wflow.run source for some inspiration.","category":"page"},{"location":"quick-start/#quickstart_multi_threading","page":"Quick start","title":"Multi-Threading","text":"","category":"section"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"Wflow supports multi-threading execution of the wflow_sbm model SBM + Kinematic wave that uses the kinematic wave approach for river, overland and lateral subsurface flow. Both the SBM vertical concept and the kinematic wave components of this model can run on multiple threads. The optional local inertial model for river flow as part of the wflow_sbm model SBM + Local inertial river model can also run on multiple threads. The threading functionality for the kinematic wave may also be useful for models that make (partly) use of this routing approach as the HBV model and the wflow_sbm model  SBM + Groundwater flow. The multi-threading functionality in Wflow is considered experimental, see also the following issue, where an error was not thrown running code multi-threaded. Because of this we advise to start with running a Wflow model single-threaded (for example during the testing phase of setting up an new Wflow model).","category":"page"},{"location":"quick-start/","page":"Quick start","title":"Quick start","text":"For information on how to start Julia with multiple threads we refer to How to start Julia with multiple threads.","category":"page"},{"location":"cli/#Command-Line-Interface","page":"Command line interface","title":"Command Line Interface","text":"","category":"section"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"If you don't need the extra features of using Wflow as a library, but just want to run simulations, the command line interface makes it easier to do so. It consists of a single executable, wflow_cli that accepts a single argument, the path to a TOML configuration file.","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"Binaries of wflow_cli can be downloaded from our website download.deltares.nl, and are currently available for Windows and Linux.","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"After installing you can see three folders in the installation directory. It is only the bin/wflow_cli that is directly used. All three folders need to stay together however. The share folder contains TOML files with more information about the build.","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"bin\\wflow_cli\nlib\nshare","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"Simply running wflow_cli with no arguments will give the following message:","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"Usage: wflow_cli 'path/to/config.toml'","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"When starting a run, you will see basic run information on the screen, as well as a progress bar, that gives an estimate of how much time is needed to finish the simulaion:","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"┌ Info: Run information\n│   model_type = \"sbm\"\n│   starttime = CFTime.DateTimeStandard(2000-01-01T00:00:00)\n│   Δt = 86400 seconds\n│   endtime = CFTime.DateTimeStandard(2000-12-31T00:00:00)\n└   nthreads() = 4\n\nProgress: 100%|██████████████████████████████████████████████████| Time: 0:00:27","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"To try out a simple test model, you can download sbm_moselle_config_data.zip, which includes both a TOML configuration file as well as the NetCDF input data, for a one year simulation of the Moselle catchment.","category":"page"},{"location":"cli/#cli_multi_threading","page":"Command line interface","title":"Multi-Threading","text":"","category":"section"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"As explained in the quick start section on multi-threading, we need to start julia with multiple threads to make use of this speedup. For wflow_cli, the only way to do this is by setting the JULIA_NUM_THREADS environment variable, as explained in these julia docs.","category":"page"},{"location":"cli/","page":"Command line interface","title":"Command line interface","text":"When a model run starts, among the run information the number of threads that are used is printed, so nthreads() = 4 means 4 threads are used, because JULIA_NUM_THREADS has been set to 4.","category":"page"},{"location":"vertical/sbm/#SBM-vertical-concept","page":"SBM","title":"SBM vertical concept","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The SBM vertical concept has its roots in the Topog_SBM model but has had considerable changes over time. The main differences are:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The unsaturated zone can be split-up in different layers\nThe addition of evapotranspiration losses\nThe addition of a capillary rise","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The sections below describe the working of the SBM vertical concept in more detail.","category":"page"},{"location":"vertical/sbm/#Snow","page":"SBM","title":"Snow","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Snow modelling is enabled by specifying the following in the TOML file:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nsnow = true","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The snow model is described in Snow modelling","category":"page"},{"location":"vertical/sbm/#Glaciers","page":"SBM","title":"Glaciers","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Glacier processes are described in Glacier modelling. Glacier modelling is enabled by specifying the following in the TOML file:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nglacier = true","category":"page"},{"location":"vertical/sbm/#Soil","page":"SBM","title":"Soil","text":"","category":"section"},{"location":"vertical/sbm/#Infiltration","page":"SBM","title":"Infiltration","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"If the surface is (partly) saturated the throughfall and stemflow that falls onto the saturated area is added to the river runoff component (based on fraction rivers, riverfrac [-]) and to the overland runoff component (based on open water fraction (waterfrac [-] minus riverfrac [-]). Infiltration of the remaining water is determined as follows:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The soil infiltration capacity can be adjusted in case the soil is frozen, this is optional and can be set in the TOML file as follows:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nsoilinfreduction = true ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The remaining storage capacity of the unsaturated store is determined.  The infiltrating water is split in two parts, the part that falls on compacted areas and the part that falls on non-compacted areas. The maximum amount of water that can infiltrate in these areas is calculated by taking the minimum of the maximum infiltration rate (infiltcapsoil [mm t^-1] for non-compacted areas and infiltcappath [mm t^-1] for compacted areas) and the amount of water available for infiltration avail_forinfilt [mm t^-1]. The water that can actual infiltrate infiltsoilpath [mm t^-1] is calculated by taking the minimum of the total maximum infiltration rate (compacted and non-compacted areas) and the remaining storage capacity.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Infiltration excess occurs when the infiltration capacity is smaller then the throughfall and stemflow rate. This amount of water (infiltexcess [mm t^-1]) becomes overland flow (infiltration excess overland flow). Saturation excess occurs when the (upper) soil becomes saturated and water cannot infiltrate anymore. This amount of water excesswater [mm t^-1] becomes overland flow (saturation excess overland flow).","category":"page"},{"location":"vertical/sbm/#The-SBM-soil-water-accounting-scheme","page":"SBM","title":"The SBM soil water accounting scheme","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"A detailed description of the Topog_SBM model has been given by Vertessy (1999). Briefly: the soil is considered as a bucket with a certain depth (z_t [mm]), divided into a saturated store (S [mm]) and an unsaturated store (U [mm]). The top of the S store forms a pseudo-water table at depth z_i [mm] such that the value of S at any time is given by:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    S=(z_t-z_i)(theta_s-theta_r)","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where theta_s [-] and theta_r [-] are the saturated and residual soil water contents, respectively. ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The unsaturated store U is subdivided into storage (U_s [mm]) and deficit (U_d [mm]):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    U_d=(theta_s-theta_r)z_i-U\n    U_s=U-U_d","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The saturation deficit (S_d [mm]) for the soil profile as a whole is defined as: ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    S_d=(theta_s-theta_r)z_t-S","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"All infiltrating water that enters the U store first. The unsaturated layer can be split-up in different layers, by providing the thickness [mm] of the layers in the TOML file. The following example specifies three layers (from top to bottom) of 100, 300 and 800 mm:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nthicknesslayers = [100, 300, 800]","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The code checks for each grid cell the specified layers against the soilthickness [mm], and adds or removes (partly) layer(s) based on the soilthickness.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Assuming a unit head gradient, the transfer of water (st [mm t^-1]) from a U [mm] store layer is controlled by the saturated hydraulic conductivity K_sat [mm t^-1] at depth z [mm] (bottom layer) or z_i [mm], the effective saturation degree of the layer, and a Brooks-Corey power coefficient (parameter c) based on the pore size distribution index lambda (Brooks and Corey, 1964):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    st=K_mathitsatleft(fractheta-theta_rtheta_s-theta_rright)^c\n    c=frac2+3lambdalambda","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"When the unsaturated layer is not split-up into different layers, it is possible to use the original Topog_SBM vertical transfer formulation, by specifying in the TOML file:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\ntransfermethod = true","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The transfer of water from the U [mm] store to the S [mm] store (st [mm t^-1]) is in that case controlled by the saturated hydraulic conductivity K_sat [mm t^-1] at depth z_i [mm] and the ratio between U [mm] and S_d [mm]: ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    st=K_mathitsatfracU_sS_d","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Saturated conductivity (K_sat [mm t^-1]) declines with soil depth (z [mm]) in the model according to: ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    K_sat=K_0e^(-fz)","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where K_0 [mm t^-1] is the saturated conductivity at the soil surface and f is a scaling parameter [mm^-1].","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The plot below shows the relation between soil depth z and saturated hydraulic conductivity K_sat for different values of f.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    using Printf\n    using CairoMakie","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[1, 1], xlabel = \"Kₛₐₜ [mm/day]\", ylabel = \"-z [mm]\")                  # hide\n\n        z = 0:5.0:1000                                                                      # hide\n        ksat = 100.0                                                                        # hide\n        f = 0.6 ./ collect(50:150.0:800)                                                    # hide\n\n        for fi in f                                                                         # hide\n            lines!(ax, ksat .* exp.(-fi .* z), -z, label = @sprintf(\"f = %.2e\", fi))        # hide\n        end                                                                                 # hide\n\n        Legend(fig[1, 2], ax, \"f\")                                                          # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"vertical/sbm/#Transpiration-and-soil-evaporation","page":"SBM","title":"Transpiration and soil evaporation","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The potential evaporation left over after interception and open water evaporation (rivers and water bodies) is split in potential soil evaporation and potential transpiration based on the canopy gap fraction (assumed to be identical to the amount of bare soil).","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"For the case of one single soil layer (the SBM soil column is not split-up into different layers), soil evaporation [mm t^-1] is scaled according to (as shown by the following code block (i refers to the index of the vector that contains all active cells within the spatial model domain)):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    soilevapunsat = potsoilevap * min(1.0, saturationdeficit / sbm.soilwatercapacity[i])","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"As such, evaporation will be potential if the soil is fully wetted and it decreases linear with increasing soil moisture deficit.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"For more than one soil layer, soil evaporation is only provided from the upper soil layer (often 100 mm) and soil evaporation is split in evaporation from the unsaturated store and evaporation from the saturated store. First water is evaporated water from the unsaturated store. Then the remaining potential soil evaporation can be used for evaporation from the saturated store. This is only possible, when the water table is present in the upper soil layer (very wet conditions). Both the evaporation from the unsaturated store and the evaporation from the saturated store are limited by the minimum of the remaining potential soil evaporation and the available water in the unsaturated/saturated zone of the upper soil layer. Also for multiple soil layers, the evaporation (both unsaturated and saturated) decreases linearly with decreasing water availability.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The original Topog_SBM model does not include transpiration or a notion of capillary rise. In SBM transpiration is first taken from the S [mm] store if the roots reach the water table z_i [mm]. If the S [mm] store cannot satisfy the demand the U [mm] store is used next. First the fraction of wet roots (wetroots [-]) is determined (going from 1 to 0) using a sigmoid function as follows:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    wetroots = 10(10 + e^-rootdistpar (zi - rootingdepth))","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Below a plot showing the fraction of wet roots for different values of rootdistpar [-] for a rooting depth of 275 mm.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[2, 1], xlabel = \"zi [mm]\", ylabel = \"fraction of wet roots [-]\")      # hide\n\n        fig[1, 1:2] =                                                                       # hide\n            Label(fig, \"Wet roots fraction for a rooting depth of 275 mm\", textsize = 20)   # hide\n\n        c = [-500, -1, -0.5, -0.3]                                                          # hide\n        z = collect(250.0:300.0)                                                            # hide\n        a = 275.0                                                                           # hide\n\n        for i = 1:4                                                                         # hide\n            lines!(ax, z, 1.0 ./ (1.0 .+ exp.(-c[i] .* (z .- a))), label = string(c[i]))    # hide\n        end                                                                                 # hide\n\n        Legend(fig[2, 2], ax, \"rootdistpar\")                                                # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Here the sharpness parameter rootdistpar [-] (by default a large negative value, -500.0) determines if there is a stepwise output or a more gradual output (default is stepwise). zi [mm] is the level of the water table in the grid cell below the surface, rootingdepth [mm] is the maximum depth of the roots below the surface. For all values of zi smaller that rootingdepth a value of 1 is returned if they are equal a value of 0.5 is returned if zi is larger than the rootingdepth a value of 0 is returned. The returned wetroots [-] fraction is multiplied by the potential evaporation (and limited by the available water in saturated zone) to get the transpiration from the saturated part of the soil, as shown by the following code block (i refers to the index of the vector that contains all active cells within the spatial model domain):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    # transpiration from saturated store\n    wetroots = scurve(sbm.zi[i], rootingdepth, 1.0, sbm.rootdistpar[i])\n    actevapsat = min(pottrans * wetroots, satwaterdepth)\n    satwaterdepth = satwaterdepth - actevapsat\n    restpottrans = pottrans - actevapsat","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Next the remaining potential evaporation is used to extract water from the unsaturated store. The fraction of roots (availcap [-]) that cover the unsaturated zone for each soil layer is used to calculate the potential root water extraction rate (maxextr [mm t^-1]). When whole_ust_available is set to true in the TOML file as follows, almost the complete unsaturated storage (99%) is available for transpiration, independent of the rootingdepth:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nwhole_ust_available = true","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Below the code snippet from the Wflow.acttransp_unsat_sbm function that calculates the potential root water extraction rate maxextr [mm t^-1], as shown by the following code block:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    if ust # whole_ust_available = true\n        availcap = ustorelayerdepth * 0.99\n    else\n        if usl > 0.0\n            availcap = min(1.0, max(0.0, (rootingdepth - sumlayer) / usl))\n        else\n            availcap = 0.0\n        end\n    end\n    maxextr = availcap * ustorelayerdepth ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where ustorelayerdepth [mm] is the amount of water in the unsaturated layer, sumlayer [mm] is the upper boundary (depth) of the unsaturated zone layer, and usl [mm] is the thickness of the unsaturated zone layer and availcap and maxextr as previously defined.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Next, the Feddes root water uptake reduction model (Feddes et al., 1978) is used to calculate a reduction coefficient as a function of soil water pressure. Soil water pressure is calculated following Brooks and Corey (1964):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    frac(theta-theta_r)(theta_s-theta_r) =  Bigglbraceleft(frach_bhright)^lambda h  h_b atop 1  h leq h_b","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where h is the pressure head [cm], h_b is the air entry pressure head [cm], and theta, theta_s, theta_r and lambda as previously defined.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Feddes (1978) described a transpiration reduction-curve for the reduction coefficient alpha, as a function of h. The plot below shows the reduction curve as implemented for the SBM concept, with fixed values for h2, h3 and h4, while h1 has a default value of -10 cm and can be provided as part of the static input. Root water uptake is zero when the soil water pressure head is below the wilting point h4, and reduced in the dry range between h4 and the critical head value h3. Optimal conditions for root water uptake exist when the soil water pressure head is above the critical head value h3. Note that in the original transpiration reduction-curve of Feddes (1978) root water uptake above h1 is set to zero (oxygen deficit) and between h1 and h2 root water uptake is limited. The assumption that very wet conditions do not affect root water uptake too much is probably generally applicable to natural vegetation, however for crops this assumption is not valid. This could be improved in the Wflow code by applying the reduction to crops only.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[1, 1], xlabel = \"soil water pressure head [-pF]\", ylabel = \"α [-]\")   # hide\n        # dummy x axis values that show the desired spacing                                 # hide\n        # on the ticks we show the right labels                                             # hide\n        h = [0, 2, 3, 4]                                                                    # hide\n        hlabel = [\"h4\\n-15849 cm\", \"h3\\n-400 cm\", \"h2\\n-100 cm\", \"h1\\n-10 cm\"]              # hide\n        alpha = [0.0, 1.0, 1.0, 1.0]                                                        # hide\n        ax.xticks = (h, hlabel)                                                             # hide\n\n        lines!(ax, h, alpha)                                                                # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Below, the function used in SBM, that calculates actual transpiration from the unsaturated zone layer(s).","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Wflow.acttransp_unsat_sbm(rootingdepth, ustorelayerdepth, sumlayer, restpotevap, sum_actevapustore, c, usl, θₛ, θᵣ, hb, ust::Bool = false)","category":"page"},{"location":"vertical/sbm/#Wflow.acttransp_unsat_sbm","page":"SBM","title":"Wflow.acttransp_unsat_sbm","text":"acttransp_unsat_sbm(rootingdepth, ustorelayerdepth, sumlayer, restpotevap, sum_actevapustore, c, usl, θₛ, θᵣ, hb, ust::Bool = false)\n\nCompute actual transpiration for unsaturated zone. If ust is true, the whole unsaturated store is available for transpiration.\n\nArguments\n\nrootingdepth\nustorelayerdepth\nsumlayer (depth (z) of upper boundary unsaturated layer)\nrestpotevap (remaining evaporation)\nsum_actevapustore (cumulative actual transpiration (more than one unsaturated layers))\nc (Brooks-Corey coefficient)\nusl (thickness of unsaturated zone)\nθₛ\nθᵣ\nhb (air entry pressure)\nust\n\nOutput\n\nustorelayerdepth\nsum_actevapustore\nrestpotevap\n\n\n\n\n\n","category":"function"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The actual capillary rise actcapflux [mm t^-1] is determined using the following approach: first the saturated hydraulic conductivty ksat [mm t^-1] is determined at the water table z_i; next a potential capillary rise maxcapflux [mm t^-1] is determined from the minimum of ksat, actual transpiration actevapustore [mm t^-1] taken from the U store, available water in the S store (satwaterdepth [mm]) and the deficit of the U store (ustorecapacity [mm]), as shown by the following code block:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    maxcapflux = max(0.0, min(ksat, actevapustore, ustorecapacity, satwaterdepth))","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Then the potential rise maxcapflux is scaled using the water table depth zi, a maximum water depth cap_hmax [mm] beyond which capillary rise ceases and a coefficient cap_n [-], as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    if sbm.zi[i] > rootingdepth\n        capflux =\n            maxcapflux * pow(\n                1.0 - min(sbm.zi[i], sbm.cap_hmax[i]) / (sbm.cap_hmax[i]),\n                sbm.cap_n[i],\n            )\n    else\n        capflux = 0.0\n    end","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"If the roots reach the water table (rootingdepth ge sbm.zi), capflux is set to zero.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Finally, the capillary rise capflux is limited by the unsaturated store deficit (one or multiple layers), calculated as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain, and k refers to the layer position):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    usl[k] * (sbm.θₛ[i] - sbm.θᵣ[i]) - usld[k]","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where usl [mm] is the unsaturated layer thickness, usld is the ustorelayerdepth [mm] (amount of water in the unsaturated layer), and theta_s and theta_r as previously defined.","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The calculation of the actual capillary rise actcapflux is as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain, and k refers to the layer position):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    actcapflux = 0.0\n    netcapflux = capflux\n    for k = n_usl:-1:1\n        toadd =\n            min(netcapflux, max(usl[k] * (sbm.θₛ[i] - sbm.θᵣ[i]) - usld[k], 0.0))\n        usld = setindex(usld, usld[k] + toadd, k)\n        netcapflux = netcapflux - toadd\n        actcapflux = actcapflux + toadd\n    end","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"In case of multiple unsaturated layers (n_usl  1), the calculation of the actual capillary rise starts at the lowest unsaturated layer while keeping track of the remaining capillary rise netcapflux [mm t^-1].","category":"page"},{"location":"vertical/sbm/#Leakage","page":"SBM","title":"Leakage","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"If the maxleakage [mm/day] input model parameter is set > 0, water is lost from the saturated zone and runs out of the model.","category":"page"},{"location":"vertical/sbm/#Soil-temperature","page":"SBM","title":"Soil temperature","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"The near surface soil temperature is modelled using a simple equation (Wigmosta et al., 2009):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"T_s^t = T_s^t-1 + w  (T_a - T_s^t-1)  ","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"where T_s^t [degreeC] is the near-surface soil temperature at time t, T_a [degreeC] is air temperature and w [-] is a weighting coefficient determined through calibration (default is 0.1125 for daily timesteps).","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"A reduction factor (cf_soil [-], default is 0.038) is applied to the maximum infiltration rate (infiltcapsoil and infiltcappath), when the following model settings are specified in the TOML file:","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nsoilinfreduction = true\nsnow = true","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"A S-curve (see plot below) is used to make a smooth transition (a c-factor (c) of 8.0 is used):","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    b = frac10(10 - cf_soil)\n    soilinfredu = frac10b + exp(-c (T_s - a)) + cf_soil\n    a = 00\n    c = 80","category":"page"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[2, 1], xlabel = \"Temperature [°C]\", ylabel = \"Reduction factor (cf_soil)\")  # hide\n\n        fig[1, 1:2] = Label(fig, \"Infiltration reduction for frozen soil\", textsize = 20)   # hide\n\n        c = [8, 4, 2, 1]                                                                    # hide\n        temp = [-3.0:0.1:3.0;]                                                              # hide\n        b = 1.0 / (1.0 - 0.038)                                                             # hide\n        a = 0.0                                                                             # hide\n\n        for i = 1:4                                                                         # hide\n            lines!(ax, temp, 1.0 ./ (b .+ exp.(-c[i] .* (temp .- a))), label = string(c[i]))  # hide\n        end                                                                                 # hide\n\n        Legend(fig[2, 2], ax, \"c\")                                                          # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"vertical/sbm/#References","page":"SBM","title":"References","text":"","category":"section"},{"location":"vertical/sbm/","page":"SBM","title":"SBM","text":"Brooks, R. H., and Corey, A. T., 1964, Hydraulic properties of porous media, Hydrology Papers 3, Colorado State University, Fort Collins, 27 p.\nFeddes, R.A., Kowalik, P.J. and Zaradny, H., 1978, Simulation of field water use and crop yield, Pudoc, Wageningen, Simulation Monographs.\nVertessy, R., and Elsenbeer, H., 1999, Distributed modeling of storm ﬂow generation in an amazonian rain forest catchment: effects of model parameterization, Water Resour. Res., 35, 2173–2187. doi: 10.1029/1999WR9000511257.\nWigmosta, M. S., Lane, L. J., Tagestad, J. D., and Coleman A. M., 2009, Hydrologic and erosion models to assess land use and management practices affecting soil erosion, J. Hydrol. Eng., 14, 27-41.","category":"page"},{"location":"lateral/local-inertial/#Local-inertial-model","page":"Local inertial","title":"Local inertial model","text":"","category":"section"},{"location":"lateral/local-inertial/#River-routing","page":"Local inertial","title":"River routing","text":"","category":"section"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The local inertial approximation of shallow water flow neglects only the convective acceleration term in the Saint-Venant momentum conservation equation. The numerical solution of the local inertial approximation on a staggered grid is as follows (Bates et al., 2010):","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Q_t+Delta t = fracQ_t - g A_t Delta t S_t(1+gDelta t n^2 Q_t  (R_t^43 A_t))","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where Q_t+Delta t is the river flow [m^3/s] at time step t+Delta t, g is acceleration due to gravity [m/s^2], A_t is the cross sectional flow area at the previous time step, R_t is the hydraulic radius at the previous time step, Q_t is the river flow [m^3/s] at the previous time step, S_t is the water surface slope at the previous time step and n is the Manning's roughness coefficient [m^-13 s].","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The momentum equation is applied to each link between two river grid cells, while the continuity equation over Delta t is applied to each river cell:","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"h^t+Delta t = h^t + Delta t fracQ^t+Delta t_src - Q^t+Delta t_dstA","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where h^t+Delta t is the water depth [m] at time step t+Delta t, h^t is the water depth [m] at the previous time step, A is the river area [m^2] and Q_src and Q_dst represent river flow [m^3/s] at the upstream and downstream link of the river cell, respectively.","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The model time step Delta t for the local inertal model is estimated based on the Courant-Friedrichs-Lewy condition (Bates et al., 2010):","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Delta t = min(alpha fracDelta x_isqrt(gh_i))","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where sqrt(gh_i) is the wave celerity for river cell i , Delta x_i is the river length [m] for river cell i and alpha is a coefficient (typically between 0.2 and 0.7) to enhance the stability of the simulation.","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"In the TOML file the following properties related to the local inertial model can be provided for the sbm model type:","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"[model]\nriver_routing = \"local-inertial\" # default is kinematic-wave\ninertial_flow_alpha = 0.5      # alpha coefficient for model stability (default = 0.7)\nfroude_limit = true            # default is true, limit flow to subcritical-critical according to Froude number\nh_thresh = 0.1                 # water depth [m] threshold for calculating flow between cells (default = 1e-03)\nriverlength_bc = 1000.0        # river length [m] for boundary points (default = 1e04)","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The momentum equation is most stable for low slope enviroments, and to keep the simulation stable for (partly) steep environments the froude_limit option is set to true by default. This setting limits flow conditions to subcritical-critical conditions based on the Froude number (le 1), similar to Coulthard et al. (2013) in the CAESAR-LISFLOOD model and Adams et al. (2017) in the Landlab v1.0 OverlandFlow component. The froude number Fr on a link is calculated as follows:","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"  Fr = fracusqrt(gh_f)","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where sqrt(gh_f) is the wave celerity on a link and u is the water velocity on a link. If the water velocity from the local inertial model is causing the Froude number to be greater than 1.0, the water velocity (and flow) is reduced in order to maintain a Froude number of 1.0.","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The downstream boundary condition basically simulates a zero water depth boundary condition at a set distance, as follows. For the downstream boundary condition (ghost point) the river width, river bed elevation and Manning's roughness coefficient are copied from the upstream river cell. The river length [m] of the boundary cell can be set through the TOML file with riverlength_bc, and has a default value of 10 km. The water depth at the boundary cell is fixed at 0.0 m.","category":"page"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Simplified reservoirs and lakes models can be included as part of the local inertial model,  see also Reservoirs and Lakes.","category":"page"},{"location":"lateral/local-inertial/#Inflow","page":"Local inertial","title":"Inflow","text":"","category":"section"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"External water (supply/abstraction) inflow [m^3 s^-1]  can be added to the local inertial model for river flow, as a cyclic parameter or as part of forcing (see also Input section).","category":"page"},{"location":"lateral/local-inertial/#Multi-Threading","page":"Local inertial","title":"Multi-Threading","text":"","category":"section"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The local inertial model for river flow can be executed in parallel using multiple threads.","category":"page"},{"location":"lateral/local-inertial/#References","page":"Local inertial","title":"References","text":"","category":"section"},{"location":"lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Adams, J. M., Gasparini, N. M., Hobley, D. E. J., Tucker, G. E., Hutton, E. W. H., Nudurupati, S. S., and Istanbulluoglu, E., 2017, The Landlab v1.0 OverlandFlow component: a Python tool for computing shallow-water flow across watersheds, Geosci. Model Dev., 10, 1645–1663, https://doi.org/10.5194/gmd-10-1645-2017. \nBates, P. D., M. S. Horritt, and T. J. Fewtrell, 2010, A simple inertial formulation of the shallow water equations for efficient two-dimensional flood inundation modelling, J. Hydrol., 387, 33–45, https://doi.org/10.1016/j.jhydrol.2010.03.027.\nCoulthard, T. J., Neal, J. C., Bates, P. D., Ramirez, J., de Almeida, G. A. M., and Hancock, G. R., 2013, Integrating the LISFLOOD-FP 2- D hydrodynamic model with the CAESAR model: implications for modelling landscape evolution, Earth Surf. Proc. Land., 38, 1897–1906, https://doi.org/10.1002/esp.3478.","category":"page"},{"location":"model/hbv/#HBV-model","page":"wflow_hbv","title":"HBV model","text":"","category":"section"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"The Hydrologiska Byrans Vattenbalansavdelning (HBV) model was introduced back in 1972 by the Swedisch Meteological and Hydrological Institute (SMHI).  The HBV model is mainly used for runoff simulation and hydrological forecasting. The model is particularly useful for catchments where snow fall and snow melt are dominant factors, but application of the model is by no means restricted to these type of catchments.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"The model is based on the HBV-96 model. However, the hydrological routing represent in HBV by a triangular function controlled by the MAXBAS parameter has been removed. Instead, the kinematic wave function is used to route the water downstream. All runoff that is generated in a cell in one of the HBV reservoirs is added to the kinematic wave reservoir at the end of a timestep. There is no connection between the different HBV cells within the model.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"A catchment is divided into a number of grid cells. For each of the cells individually, daily runoff is computed through application of the HBV-96 of the HBV model. The use of the grid cells offers the possibility to turn the HBV modelling concept, which is originally lumped, into a distributed model.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"(Image: wflow_hbv model)","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"The figure above shows a schematic view of hydrological response simulation with the HBV-modelling concept. The land-phase of the hydrological cycle is represented by three different components: a snow routine, a soil routine and a runoff response routine. Each component is discussed separately in more detail in the section HBV vertical concept.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"The routing for river and overland flow is described in the section Kinematic wave.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"Below the mapping for wflow_hbv (type hbv) to the vertical HBV concept (instance of struct HBV) and the different lateral concepts. For an explanation about the type parameters between curly braces after the struct name see Vertical and lateral models.","category":"page"},{"location":"model/hbv/","page":"wflow_hbv","title":"wflow_hbv","text":"vertical => struct HBV{T}\nlateral.subsurface => struct LateralSSF{T}\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model/sediment/#wflow_sediment","page":"wflow_sediment","title":"wflow_sediment","text":"","category":"section"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"The processes and fate of many particles and pollutants impacting water quality at the catchment level are intricately linked to the processes governing sediment dynamics. Both nutrients such as phosphorus, carbon or other pollutants such as metals are influenced by sediment properties in processes such as mobilization, flocculation or deposition. To better assert and model water quality in inland systems, a better comprehension and modelling of sediment sources and fate in the river is needed at a spatial and time scale relevant to such issues. ","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"The wflow_sediment model was developed to answer such issues. It is a distributed physics-based model, based on the distributed hydrologic wflow_sbm model. It is able to simulate both land and in-stream processes, and relies on available global datasets, parameter estimation and small calibration effort.","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"In order to model the exports of terrestrial sediment to the coast through the Land Ocean Aquatic Continuum or LOAC (inland waters network such as streams, lakes...), two different modelling parts were considered. The first part, called the inland sediment model, is the modelling and estimation of soil loss and sediment yield to the river system by land erosion, separated into vertical Soil Erosion processes and lateral Sediment Flux in overland flow. The second part, called the River Sediment Model is the transport and processes of the sediment in the river system. The two parts together constitute the wflow_sediment model.","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"Overview of the concepts of the wflow_sediment model: (Image: wflow_sediment)","category":"page"},{"location":"model/sediment/#Configuration","page":"wflow_sediment","title":"Configuration","text":"","category":"section"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"As sediment generation and transport processes are linked to the hydrology and water flows, the inputs to the wflow_sediment model come directly from a hydrological model. The required dynamic inputs to run wflow_sediment are:","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"Precipitation (can also come from the hydrological forcing data),\nLand runoff (overland flow) from the kinematic wave,\nRiver runoff from the kinematic wave,\nLand water level in the kinematic wave,\nRiver water level in the kinematic wave,\nRainfall interception by the vegetation.","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"These inputs can be obtained from other wflow models such as wflow_sbm, wflow_hbv or from other sources.","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"Model outputs can be saved for both the inland and the instream part of the model. Some examples are listed below.","category":"page"},{"location":"model/sediment/","page":"wflow_sediment","title":"wflow_sediment","text":"[output.vertical]\n# Soil splash erosion [ton]\nsedspl = \"sedspl\"\n# Soil erosion by overland flow [ton]\nsedov = \"sedov\"\n# Total soil loss [ton]\nsoilloss = \"soilloss\"\n# Total transport capacity of overland flow [ton]\nTCsed = \"TCsed\"\n# Transport capacity per particle class (clay) [ton]\nTCclay = \"TCclay\"\n\n[output.lateral.land]\n# Total (or per particle class) sediment flux in overland flow [ton]\nolsed = \"olsed\"\nolclay = \"olclay\"\n# Total (or per particle class) sediment yield to the river [ton]\ninlandsed = \"inlandsed\"\ninlandclay = \"inlandclay\"\n\n[output.lateral.river]\n# Total sediment concentration in the river (suspended + bed load) [kg/m3]\nSedconc = \"Sedconc\"\n# Suspended load [kg/m3]\nSSconc = \"SSconc\"\n# Bed load [kg/m3]\nBedconc = \"Bedconc\"","category":"page"},{"location":"changelog/#Changelog","page":"Changelog","title":"Changelog","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"All notable changes to this project will be documented in this file.","category":"page"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.","category":"page"},{"location":"changelog/#Unreleased","page":"Changelog","title":"Unreleased","text":"","category":"section"},{"location":"changelog/#Changed","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model types sbm_gwf and hbv use the same approach for the calculation of the drain width dw as model type sbm.","category":"page"},{"location":"changelog/#Added","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Option to use the local inertial model for river flow as part of the SBM + Kinematic wave. See also SBM + Local inertial river.\nAdditional log messages and log file as output, see also Logging.","category":"page"},{"location":"changelog/#Fixed","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model type hbv: the surface width for overland flow was not corrected with the river width.\nFixed use of absolute path for path_forcing in TOML file, which gave an error in Wflow v0.5.1.\nWhen the surface flow width for overland flow is zero, the water level h of the kinematic wave should not be calculated, otherwise this results in NaN values. When the model is initialized from state files, q and h are set to zero for indices with a zero surface flow width.\nFixed CSV output of variables with dimension layer (SVector) when data is extracted for a specific location (coordinates or index).\nsnow and snowwater were not mutating in the function lateral_snow_transport!, and  as a result vertical.snow and vertical.snowwater were not updated.","category":"page"},{"location":"changelog/#v0.5.1-2021-11-24","page":"Changelog","title":"v0.5.1 - 2021-11-24","text":"","category":"section"},{"location":"changelog/#Fixed-2","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Fixed calculation of exfiltwater as part of the sbm_gwf model type. This was based directly on groundwater head above the surface level, without multiplying by the specific_yield, resulting in an overestimation of exfiltwater. This is required since the groundwater model estimates the head by dividing the volume by the specific yield or storativity of the aquifer. So, should the groundwater table rise above surface level, the head above surface level does not represent a water column one to one. (This also means the groundwater model (slightly) overestimates heads when the head rises above the surface level. However, this water is immediately removed, and the head will be set to surface level.)","category":"page"},{"location":"changelog/#Added-2","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Optional dir_input and dir_output keys in the TOML, which can be used to quickly change the path for all input or output files that are given as a relative path.","category":"page"},{"location":"changelog/#v0.5.0-2021-11-12","page":"Changelog","title":"v0.5.0 - 2021-11-12","text":"","category":"section"},{"location":"changelog/#Changed-2","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Scaling of potential capillary rise is replaced by a common approach found in literature, based on the water table depth zi, a maximum water depth cap_hmax beyond which capillary rise ceases, and a coefficient cap_n. See also Transpiration and soil evaporation. Multiplying the scaling factor with the ratio of model time step and basetimestep in the original approach resulted in (much) smaller capillary fluxes at sub-daily model time steps compared to daily model time steps, and is not used in the new approach. Parameters cap_hmax and cap_n can be set through the TOML file, parameter capscale of the previous approach is not used anymore.","category":"page"},{"location":"changelog/#Fixed-3","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Conversion of GroundwaterFlow boundaries [m^3 d^-1] as part of model concept sbm_gwf to m^3 s^-1 for sub-daily model time steps. For the conversion the basetimestep (86400 s) should be used (and not the model time step).","category":"page"},{"location":"changelog/#v0.4.1-2021-11-04","page":"Changelog","title":"v0.4.1 - 2021-11-04","text":"","category":"section"},{"location":"changelog/#Changed-3","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The alpha parameter of the kinematic wave has a fixed value now and is not updated because of changes in water height (this could result in large water balance errors). See also Surface routing.\nCyclic input for other structs than vertical are also now supported (for example cyclic  inflow to the river).\nMoved update_forcing! and update_cyclic! functions to the run function. It is now easier to implement a custom run function with custom loading of input data (forcing and cyclic parameters).","category":"page"},{"location":"changelog/#Added-3","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Check if reservoirs and lakes have downstream nodes. Without downstream nodes is not supported and in that case an error message is thrown that is easier to understand than the previous one: \"ArgumentError: Collection is empty, must contain exactly 1 element.\"\nFor the input.path_forcing TOML setting we use Glob.jl to expand strings like \"data/forcing-year-*.nc\" to a set of netCDF files that are split in time.\nExternal water inflow (supply/abstractions) added to the kinematic wave inflow in m3/s. It is added/removed to sf.qlat[v] before computing the new q[v] with the kinematic wave equation.\nFixed values for forcing parameters are supported, see also Fixed forcing values.","category":"page"},{"location":"changelog/#Fixed-4","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"River inflow for reservoirs and lakes in the kinematic wave. This inflow was based on sf.q[v] at the previous time step, and this has been fixed to the current time step.","category":"page"},{"location":"changelog/#v0.4.0-2021-09-02","page":"Changelog","title":"v0.4.0 - 2021-09-02","text":"","category":"section"},{"location":"changelog/#Changed-4","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Changed length units for lateral subsurface flow component from millimeter to meter. This means that state netCDF files from previous versions can only be reused if ssf is divided by 10^9.\nAdd snow and glacier processes to wflow_sbm figure of the documentation.","category":"page"},{"location":"changelog/#Added-4","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Multi-threading of vertical SBM concept and lateral kinematic wave components (overland, river and subsurface flow) of wflow_sbm model SBM + Kinematic wave.\nImproved error message for CSV Reducer.\nThe TOML keys kv₀, θᵣ and θₛ have been replaced with the ASCII versions kv_0, theta_r and theta_s, to avoid encoding issues with certain text editors. The old keys still work as well.","category":"page"},{"location":"changelog/#Fixed-5","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Calculation of volumetric water content of vertical SBM (soil layers and root zone).\nUpdate of satwaterdepth in SBM (evaporation was only substracted from a local variable, and not from sbm.satwaterdepth).\nFixed the index lowerlake_ind of NaturalLake. Linked lakes were not simulated correctly (flows between upstream and downsteam lake).\nInterpolation function interpolate_linear(x, xp, fp) for CSV tables lakes. When x was larger or smaller than xp, maximum(xp) or minimum(xp) was returned instead of maximum(fp) or minimum(fp).\nFixed model timestep of reservoirs (SimpleReservoir) and lakes (NaturalLake) in relation to precipitation and evapotranspiration fluxes. This was set to the fixed Wflow basetimestep of 86400 s, and should be set to the actual model time step from the TOML configuration file.\nAdd flux from Drainage (GroundwaterFlow) in the sbm_gwf_model to the overland flow component instead of the river component of the kinematic wave.\nFixed option constanthead = false (TOML file), constant_head field of GroundwaterFlow was not defined in this case. Fixed this by initialising empty fields (Vector) for struct ConstantHead.\nFixed return max(0, boundary.flux[index]) to return max(0, flux) the flux should be returned when cell is dry, no negative value allowed.\nFixed path to initialize lake to: dirname(static_path) \nFixed outflow = 0, when lake level is below lake threshold. Before a negative value could enter the log function and model would fail. \nFixed the lake storage initialization. For continuation runs (reinit = false), this caused the lake to be reset to the initial conditions instead of the saved state.","category":"page"},{"location":"changelog/#v0.3.1-2021-05-19","page":"Changelog","title":"v0.3.1 - 2021-05-19","text":"","category":"section"},{"location":"changelog/#Fixed-6","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Ignore extra dimensions in input NetCDFs if they are size 1","category":"page"},{"location":"changelog/#v0.3.0-2021-05-10","page":"Changelog","title":"v0.3.0 - 2021-05-10","text":"","category":"section"},{"location":"changelog/#Changed-5","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"New deposition process for coarse sediment in the reservoirs with a new parameter  restrapefficiency in the sediment model.\nNew variables added to the LandSediment and RiverSediment structs in order to save  more output from the sediment model.\nAdded variables volume and inwater to SurfaceFlow struct, this is convenient for the coupling with the water quality model Delwaq.\nRiver water level (h) and discharge (q) forced directly into the RiverSediment struct (instead of using the OverlandFlowSediment struct first). \nRequire Julia 1.6 or later.","category":"page"},{"location":"changelog/#Added-5","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Modify model parameters and forcing through the TOML file (see Modify parameters).\nRun wflow_sbm (SBM + kinematic wave) in two parts (until recharge and after subsurface flow) from BMI, including the option to switch off the lateral subsurface component of wflow_sbm.\nSupport more netCDF dimension and axis order variants.","category":"page"},{"location":"changelog/#Fixed-7","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Corrected a bug in sediment deposition in the river (case when incoming sediment load is more than the river transport capacity).\nFixed update of snow and glacierstore fields of HBV and SBM concepts by the glacier_hbv module. ","category":"page"},{"location":"changelog/#v0.2.0-2021-03-26","page":"Changelog","title":"v0.2.0 - 2021-03-26","text":"","category":"section"},{"location":"changelog/#Changed-6","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Removed dependency of the f model parameter of wflow_sbm on the parameters theta_s, theta_r and M. This approach is used in Topog_SBM, but not applicable for wflow_sbm. The f parameter needs to be provided as part of the NetCDF model parameter file.\nGrid properties as cell length and elevation now stored as part of the model.land.network component and not as part of the vertical model components, as it is not used by these components. altitude (elevation) should now be provided as part of the [input] section of the TOML configuration file, and not as part of the [input.vertical] section.\nRemoved parameter theta_e from SBM struct (not used in update). Parameters theta_s and theta_r included separately (instead of theta_e) in LateralSSF struct, now directly linked to SBM parameters.\nImprove error messages (NetCDF and cyclic flow graph).","category":"page"},{"location":"changelog/#Added-6","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Export of NetCDF scalar timeseries (separate NetCDF file from gridded timeseries). This also allows for importing these timeseries by Delft-FEWS (General Adapter).","category":"page"},{"location":"changelog/#Fixed-8","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model parameter Manning's n now used during the update of the struct SurfaceFlow, to change the related alpha parameter of the kinematic wave for channel flow.","category":"page"},{"location":"lateral/gwf/#lateral_gwf","page":"Groundwater flow","title":"Groundwater flow","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Single layer groundwater flow is defined in the struct GroundwaterFlow, which contains the following fields:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"aquifer\nconnectivity\nconstanthead\nboundaries","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Base.@kwdef struct GroundwaterFlow\n    aquifer::A where A <: Aquifer\n    connectivity::Connectivity\n    constanthead::ConstantHead\n    boundaries::Vector{B} where B <: AquiferBoundaryCondition\nend","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The fields of struct GroundwaterFlow are described in more detail below.","category":"page"},{"location":"lateral/gwf/#Aquifer-types","page":"Groundwater flow","title":"Aquifer types","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Groundwater flow contains the Abstract type Aquifer, that can be either a confined (ConfinedAquifer) or unconfined (UnconfinedAquifer) aquifer. Confined aquifers are overlain by a poorly permeable confining layer (e.g. clay). No air can get in to fill the pore space so that the aquifer always remains fully saturated. For a confined aquifer, water will always flow along the complete height H [m] over the aquifer and transmissivity kH [m^2 d^-1] is a constant (k [m d^-1] is the horizontal hydraulic conductivity). Specific storage is the amount of water an aquifer releases per unit change in hydraulic head, per unit volume of aquifer, as the aquifer and the groundwater itself is compressed. Its value is much smaller than specific yield, between 1e-5 (stiff) and 0.01 (weak). The upper boundary of an unconfined aquifer is the water table (the phreatic surface). Specific yield (or drainable porosity) represents the volumetric fraction the aquifer will yield when all water drains and the pore volume is filled by air instead. Specific yield will vary roughly between 0.05 (clay) and 0.45 (peat) (Johnson, 1967).","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The parameters of structs ConfinedAquifer and UnconfinedAquifer are presented in Tables of the Confined aquifer and Unconfined aquifer sections of Model parameters. Parameters that can be set directly from the static input data (netCDF) are marked in these Tables.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Groundwater flow is solved forward in time and central in space. The vertically averaged governing equation for an inhomogeneous and isotropic aquifer in one dimension can be written as:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    S fracphidelta t =  fracdeltadelta x (kH fracphidelta x) + Q","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where S [m m^-1] is storativity (or specific yield), phi [m] is hydraulic head, t is time, k [m t^-1] is horizontal hydraulic conductivity, H [m] is the (saturated) aquifer height: groundwater level - aquifer bottom elevation and Q [m t^-1] represents fluxes from boundary conditions (e.g. recharge or abstraction), see also Aquifer boundary conditions.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The simplest finite difference formulation is forward in time, central in space, and can be written as:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    S_i  frac(phi_i^t+1 - phi_i^t)Delta t = -C_i-1  (phi_i-1 - phi_i) - C_i  (phi_i+1 - phi_i) + Q_ᵢ","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where _i is the cell index, ^t is time, Delta t is the step size, C_i-1 is the the intercell conductance between cell i-1 and i and C_i is the intercell conductance between cell i and i+1. The connection data between cells is stored as part of the Connectivity struct, see also Connectivity for more information.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Conductance C is defined as:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    C = frackH wl","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where w [m] is the width of the cell to cell connection, and l [m] is the length of the cell to cell connection. k and H may both vary in space; intercell conductance is therefore an average using the properties of two cells.  For the calculation of the intercell conductance C the harmonic mean is used (see also Goode and Appel, 1992), here between cell index i and cell index i+1, in the x direction:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    C_i = w  frac(k_iH_icdot k_i+1H_i+1)(k_iH_i cdot l_i+1 + k_i+1H_i+1 cdot l_i)","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where H [m] is the aquifer top - aquifer bottom, and k, l_i is the length in cell i (05 Delta x_i),  l_i+1 is the length in cell i+1 (05 Delta x_i+1) and w as previously defined. For an unconfined aquifer the intercell conductance is scaled by using the \"upstream saturated fraction\" as the MODFLOW documentation calls it. In this approach, the saturated thickness of a cell-to-cell is approximated using the cell with the highest head. This results in a consistent overestimation of the saturated thickness, but it avoids complexities related with cell drying and rewetting, such as having to define a \"wetting threshold\" or a \"wetting factor\". See also the documentation for MODFLOW-NWT (Niswonger et al., 2011) or MODFLOW6 (Langevin et al., 2017) for more background information. For more background on drying and rewetting, see for example McDonald et al. (1991).","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For the finite difference formulation, there is only one unknown, phi_i^t+1. Reshuffling terms:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"phi_i^t+1 = phi_i^t + (C_i-1  (phi_i - phi_i-1) + C_i  (phi_i+1 - phi_i) + Q_i) fracΔtS_i","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"This can be generalized to two dimensions, for both regular and irregular cell connectivity. Finally, a stable time step size can be computed given the forward-in-time, central in space scheme, based on the following criterion from Chu and Willis (1984):","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"fracDelta t k H(Delta x  Delta y S)  le frac14","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Delta t [d] is the stable time step size, Delta x [m] is the cell length in the x direction and Delta y [m] is the cell length in the y direction, k is the horizontal hydraulic conductivity [m^2 d^-1] and H [m] is the saturated thickness of the aquifer. For each cell frac(Delta x  Delta y S)k H is calculated, the minimum of these values is determined, and multiplied by frac14, to get the stable time step size.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For more details about the finite difference formulation and the stable time step size criterion we refer to the paper of Chu and Willis (1984).","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Boundary conditions can be classified into three categories:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"specified head (Dirichlet)\nspecified flux (Neumann)\nhead-dependent flux (Robin)","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Neumann and Robin conditions are implemented by adding to or subtracting from a net (lumped) cell flux. Dirichlet conditions are special cased, since they cannot (easily) be implemented via the flux, but the head is set directly instead.","category":"page"},{"location":"lateral/gwf/#Connectivity","page":"Groundwater flow","title":"Connectivity","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The connectivity between cells is defined as follows.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Wflow.Connectivity","category":"page"},{"location":"lateral/gwf/#Wflow.Connectivity","page":"Groundwater flow","title":"Wflow.Connectivity","text":"Connectivity{T}\n\nStores connection data between cells. Connections are stored in a compressed sparse column (CSC) adjacency matrix: only non-zero values are stored. Primarily, this consist of two vectors:\n\nthe row value vector holds the cell indices of neighbors\nthe column pointers marks the start and end index of the row value vector\n\nThis matrix is square: n = m = ncell. nconnection is equal to nnz (the number of non-zero values).\n\nncell: the number of (active) cells in the simulation\nnconnection: the number of connections between cells\nlength1: for every connection, the length in the first cell, size nconnection\nlength2: for every connection, the length in the second cell, size nconnection\nwidth: width for every connection, (approx.) perpendicular to length1 and length2, size nconnection\ncolptr: CSC column pointer (size ncell + 1)\nrowval: CSC row value (size nconnection)\n\n\n\n\n\n","category":"type"},{"location":"lateral/gwf/#Constant-head","page":"Groundwater flow","title":"Constant head","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Dirichlet boundary conditions can be specified through the field constanthead (type ConstantHead)  of the GroundwaterFlow struct.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"@get_units struct ConstantHead{T}\n    head::Vector{T} | \"m\"\n    index::Vector{Int} | \"-\"\nend","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For the model SBM + Groundwater flow this boundary condition is optional, and if used should be specified in the TOML file as follows (see also sbm_gwf_config.toml):","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"[model]\nconstanthead = true","category":"page"},{"location":"lateral/gwf/#Aquifer-boundary-conditions","page":"Groundwater flow","title":"Aquifer boundary conditions","text":"","category":"section"},{"location":"lateral/gwf/#River","page":"Groundwater flow","title":"River","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The flux between river and aquifer is calculated using Darcy's law following the approach in MODFLOW:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    Q_riv =  BigglbraceC_i textmin(h_riv - B_riv h_riv - phi) h_riv  phi atop C_e (h_riv - phi)  h_riv leq phi","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Q_riv is the exchange flux from river to aquifer [L^3 T^-1], C_i [L^2 T^-1] is the river bed infiltration conductance, C_e [L^2 T^-1] is the river bed exfiltration conductance, B_riv the bottom of the river bed [L], h_riv is the river stage [L] and phi is the hydraulic head in the river cell [L].","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow river boundary condition section of the Model parameters provides the parameters of the struct River. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The exchange flux (river to aquifer) Q_riv is an output variable (field flux of the River struct), and is used to update the total flux in a river cell. For the model SBM + Groundwater flow, the water level h [m] of the river kinematic wave in combination with the river bottom is used to update the stage field of the River struct each time step.","category":"page"},{"location":"lateral/gwf/#Drainage","page":"Groundwater flow","title":"Drainage","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The flux from drains to the aquifer is calculated as follows:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_drain = C_drain textmin(0 h_drain - phi)","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Q_drain is the exchange flux from drains to aquifer [L^3 T^-1], C_drain [L^2 T^-1] is the drain conductance, h_drain is the drain elevation [L] and phi is the hydraulic head in the cell with drainage [L].","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow drainage boundary condition section of the Model parameters provides the parameters of the struct Drainage. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The exchange flux (drains to aquifer) Q_drain is an output variable (field flux of struct Drainage), and is used to update the total flux in a cell with drains. For the model SBM + Groundwater flow this boundary condition is optional, and if used should be specified in the TOML file as follows (see also sbm_gwf_config.toml):","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"[model]\ndrains = true","category":"page"},{"location":"lateral/gwf/#Recharge","page":"Groundwater flow","title":"Recharge","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The recharge flux Q_r to the aquifer is calculated as follows:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_r = R  A","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"with R the recharge rate [L T^-1] and A the area [L^2 ] of the aquifer cell.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow recharge boundary condition section of the Model parameters section provides the parameters of the struct Recharge. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The recharge flux Q_r is an output variable (field flux of struct Recharge), and is used to update the total flux in a cell where recharge occurs. For the model SBM + Groundwater flow, the recharge rate from the vertical SBM concept recharge [mm] is used to update the rate field of the Recharge struct each time step. The rate field is multiplied by the area field of the aquifer.   ","category":"page"},{"location":"lateral/gwf/#Head-boundary","page":"Groundwater flow","title":"Head boundary","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"This boundary is a fixed head with time (not affected by the model stresses over time)) outside of the model domain, and is generally used to avoid an unnecessary extension of the model domain to the location of the fixed boundary (for example a large lake). The flux from the boundary Q_hb [L^3 T^-1] is calculated as follows:","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_hb = C_hb (phi_hb - phi)","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"with C_hb the conductance of the head boundary [L^2 T^-1], phi_hb the head [L] of the head boundary and  phi the head of the aquifer cell.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow head boundary condition section of the Model parameters provides the parameters of the struct HeadBoundary.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The head boundary flux Q_hb is an output variable (field flux of struct HeadBoundary), and is used to update the total flux in a cell where this type of boundary occurs. The parameter Head phi_hb can be specified as a fixed or time dependent value.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nThis boundary is not (yet) part of the model SBM + Groundwater flow.","category":"page"},{"location":"lateral/gwf/#Well-boundary","page":"Groundwater flow","title":"Well boundary","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"A volumetric well rate [L^3 T^-1] can be specified as a boundary condition.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the well boundary condition section of the Model parameters provides the parameters of the struct Well.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The volumetric well rate Q_well can be can be specified as a fixed or time dependent value. If a cell is dry, the actual well flux flux is set to zero (see also the last note on this page).","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nThis boundary is not (yet) part of the model SBM + Groundwater flow.","category":"page"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nFor an unconfined aquifer the boundary fluxes are checked, in case of a dry aquifer cell a negative flux is not allowed.","category":"page"},{"location":"lateral/gwf/#References","page":"Groundwater flow","title":"References","text":"","category":"section"},{"location":"lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Chu, W. S., & Willis, R. (1984). An explicit finite difference model for unconfined aquifers. Groundwater, 22(6), 728-734.\nGoode, D. J., & Appel, C. A. (1992). Finite-Difference Interblock Transmissivity for Unconﬁned Aquifers and for Aquifers having Smoothly Varying Transmissivity Water-resources investigations report, 92, 4124. \nJohnson, A. I. (1967), Specific yield: compilation of specific yields for various materials, Water Supply Paper 1662-D, Washington, D.C.: U.S. Government Printing Office, p. 74, doi:10.3133/wsp1662D.\nLangevin, C.D., Hughes, J.D., Banta, E.R., Niswonger, R.G., Panday, Sorab, and Provost, A.M., 2017, Documentation for the MODFLOW 6 Groundwater Flow Model: U.S. Geological Survey Techniques and Methods, book 6, chap. A55, 197 p., https://doi.org/10.3133/tm6A55.\nMcDonald, M.G., Harbaugh, A.W., Orr, B.R., and Ackerman, D.J., 1991, A method of converting no-flow cells to variable-head cells for the U.S. Geological Survey modular finite-difference groundwater flow model: U.S. Geological Survey Open-File Report 91-536, 99 p.\nNiswonger, R.G., Panday, Sorab, and Ibaraki, Motomu, 2011, MODFLOW-NWT, A Newton formulation for MODFLOW-2005: U.S. Geological Survey Techniques and Methods 6-A37, 44 p.","category":"page"},{"location":"lateral/local-inertial_params/#local-inertial_river_params","page":"Local inertial","title":"River flow","text":"","category":"section"},{"location":"lateral/local-inertial_params/","page":"Local inertial","title":"Local inertial","text":"The Table below shows the parameters (fields) of struct ShallowWaterRiver, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river], to map the internal model parameter to the external netCDF variable. The parameter river bed elevation zb is based on the bankfull elevation and depth input data:","category":"page"},{"location":"lateral/local-inertial_params/","page":"Local inertial","title":"Local inertial","text":"[input.lateral.river]\nbankfull_elevation = \"RiverZ\"\nbankfull_depth = \"RiverDepth\"","category":"page"},{"location":"lateral/local-inertial_params/","page":"Local inertial","title":"Local inertial","text":"parameter description unit default\nmannings_n Manning's roughness at edge/link s m^-frac13 0.036\nwidth river width m -\nzb river bed elevation m -\nlength river length m -\nn number of cells - -\nne number of edges/links - -\ng acceleration due to gravity m s^-2 -\nα stability coefficient (Bates et al., 2010) - -\nh_thresh depth threshold for calculating flow m -\nΔt model time step s -\nq river discharge (subgrid channel) m^3 s^-1 -\nq_av average river discharge (subgrid channel) m^3 s^-1 -\nzb_max maximum channel bed elevation m -\nh water depth m -\nη_max maximum water elevation m -\nhf water depth at edge/link m -\nh_av average water depth m -\nlength_at_link river length at edge/link m -\nwidth_at_link river width at edge/link m -\na flow area at edge/link m^2 -\nr wetted perimeter at edge/link m -\nvolume river volume m^3 -\nerror error volume m^3 -\ninwater lateral inflow m^3 s^-1 -\ninflow external inflow (abstraction/supply/demand) m^3 s^-1 0.0\nbankfull_volume bankfull volume m^3 -\nbankfull_depth bankfull depth m -\nfroude_limit if true a check is performed if froude number > 1.0 (algorithm is modified) - -\nreservoir_index map cell to 0 (no reservoir) or i (pick reservoir i in reservoir field) - -\nlake_index map cell to 0 (no lake) or i (pick lake i in lake field) - -\nreservoir an array of reservoir models SimpleReservoir - -\nlake an array of lake models NaturalLake - -","category":"page"},{"location":"lateral/sediment/#Sediment-Flux","page":"Sediment Flux","title":"Sediment Flux","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Both the inland and river sediment model take into account sediment flux or transport of sediment in water, either in overland flow or in the stream flow. These two transport are distinguished in two different structures.","category":"page"},{"location":"lateral/sediment/#Inland-Sediment-Model","page":"Sediment Flux","title":"Inland Sediment Model","text":"","category":"section"},{"location":"lateral/sediment/#Sediment-Flux-in-overland-flow","page":"Sediment Flux","title":"Sediment Flux in overland flow","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Once the amount of soil detached by both rainfall and overland flow has been estimated, it has then to be routed and delivered to the river network. Inland routing in sediment models is usually done by comparing the amount of detached sediment with the transport capacity of the flow, which is the maximum amount of sediment than the flow can carry downslope. There are several existing formulas available in the literature. For a wide range of slope and for overland flow, the Govers equation (1990) seems the most appropriate choice (Hessel et al, 2007). However, as the wflow_sediment model was developed to be linked to water quality issues, the Yalin transport equation was chosen as it can handle particle differentiation (Govers equation can still be used if wflow_sediment is used to only model inland processes with no particle differentiation). For land cells, wflow_sediment assumes that erosion can mobilize 5 classes of sediment:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Clay (mean diameter of 2 mum)\nSilt (mean diameter of 10 mum)\nSand (mean diameter of 200 mum)\nSmall aggregates (mean diameter of 30 mum)\nLarge aggregates (mean diameter of 500 mum).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   PSA = SAN (1-CLA)^24 \n   PSI = 013SIL\n   PCL = 020CLA \n   SAG = 20CLA    CLA  025 \n   SAG = 028(CLA-025)+05    025 leq CLA leq 05 \n   SAG = 057    CLA  05 \n   LAG = 1 - PSA - PSI - PCL - SAG","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where CLA, SIL and SAN are the primary clay, silt, sand fractions of the topsoil and PCL, PSI, PSA, SAG and LAG are the clay, silt, sand, small and large aggregates fractions of the detached sediment respectively. The transport capacity of the flow using Yalin’s equation with particle differentiation, developed by Foster (1982), is:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   TC_i = (P_e)_i  (S_g)_i  rho_w   g  d_i  V_*","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where TC_i is the transport capacity of the flow for the particle class i, (P_e)_i is the effective number of particles of class i, (S_g)_i is the specific gravity for the particle class i (kg m^-3), rho_w is the mass density of the fluid (kg m^-3), g is the acceleration due to gravity (m s^-2), d_i is the diameter of the particle of class i (m) and V_*=(g R S)^05 is the shear velocity of the flow (m s^-1) with S the slope gradient and R the hydraulic radius of the flow (m). The detached sediment are then routed downslope until the river network using the accucapacityflux, accupacitystate functions depending on the transport capacity from Yalin.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"The choice of transport capacity method for the overland flow is set up in the model section of the TOML:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"[model]\nlandtransportmethod = \"yalinpart\" # Overland flow transport capacity method: [\"yalinpart\", \"govers\", \"yalin\"]","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Note that the \"govers\" and \"yalin\" equations can only assess total transport capacity of the flow and can therefore not be used in combination with the river part of the sediment model.","category":"page"},{"location":"lateral/sediment/#River-Sediment-Model","page":"Sediment Flux","title":"River Sediment Model","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Sediment dynamics in the river can be described by the three same processes than on the land: erosion, deposition and transport. The diﬀerence is that channel ﬂow is much higher, deeper and permanent compared to overland ﬂow. In channels, erosion is the direct removal of sediments from the river bed or bank (lateral erosion). Sediments are transported in the river either by rolling, sliding and silting (bed load transport) or via turbulent flow in the higher water column (suspended load transport). The type of transport is determined by the river bed shear stress. As sediment particles have a higher density than water, they can also be deposited on the river bed according to their settling velocity compared to ﬂow velocity. In addition to regular deposition in the river, lakes, reservoirs and ﬂoodplains represents additional major sediment settling pools.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Complete models of sediment dynamics based on hydrology and not hydraulic or hydrodynamic are much rarer than for soil loss and inland dynamics. The simpler models such as the SWAT default sediment river model uses again the transport capacity of the ﬂow to determine if there is erosion or deposition (Neitsch et al., 2011).  A more physics-based approach (Partheniades, 1965) to determine river erosion is used by Liu et al. (2018) and in the new SWAT’s approach developed by Narasimhan et al. (2017). For wﬂow_sediment, the new physics-based model of SWAT was chosen for transport and erosion as it enables the use of parameter estimation for erosion of bed and bank of the channel and separates the suspended from the bed loads. ","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Overview of the different processes for a river cell in wflow_sediment.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"(Image: sediment_instream)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Running the river model is an option of the wflow_sediment model and is enabled using the TOML file. By default it is false:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"[model]\nrunrivermodel = true","category":"page"},{"location":"lateral/sediment/#Sediment-inputs-in-a-river-cell","page":"Sediment Flux","title":"Sediment inputs in a river cell","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"The first part of the river model assesses how much detached sediment are in the river cell at the beginning of the timestep t. Sources of detached sediment are sediments coming from land erosion, estimated with the soil loss part of wflow_sediment model, the sediment coming from upstream river cells and the detached sediment that were left in the cell at the end of the previous timestep (t-1):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   (sed_in)_t = (sed_land)_t + upstreamleft(sed_out)_t-1right + (sed_riv)_t-1","category":"page"},{"location":"lateral/sediment/#River-transport-and-erosion","page":"Sediment Flux","title":"River transport and erosion","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Once the amount of sediment inputs at the beginning of the timestep is known, the model then estimates transport, and river erosion if there is a deficit of sediments. Transport in the river system is estimated via a transport capacity formula. There are several transport capacity formulas available in wflow_sediment, some requiring calibration and some not. Choosing a transport capacity equation depends on the river characteristics (some equation are more suited for narrow or wider rivers), and on the reliability of the required river parameters (such as slope, width or mean particle diameter of the river channel). Several river transport capacity are available and the choice is set up in the model section of the TOML:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"[model]\nrivtransportmethod = \"bagnold\" # River flow transport capacity method: [\"bagnold\", \"engelund\", \"yang\", \"kodatie\", \"molinas\"]","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Simplified Bagnold","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Originally more valid for intermediate to large rivers, this simplified version of the Bagnold equation relates sediment transport to flow velocity with two simple calibration parameters (Neitsch et al, 2011):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"C_max = c_sp  left( dfracprf Qh  W right) ^sp_exp","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where C_max is the sediment concentration (ton m^-3 or kg/L), Q is the surface runoff in the river cell (m^3s^-1), h is the river water level (m), W is the river width (m) and c_sp, prf and sp_exp are calibration parameters. The prf coefficient is usually used to deduce the peak velocity of the flow, but for simplification in wflow_sediment, the equation was simplified to only get two parameters to calibrate: sp_exp and c_Bagnold = c_sp  prf^sp_exp. The coefficient sp_exp usually varies between 1 and 2 while prf and c_sp have a wider range of variation. The table below summarizes ranges and values of the three Bagnold coefficients used by other studies:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Table: Range of the simplified Bagnold coefficients (and calibrated value)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Study River prf range c_sp range sp_exp range\nVigiak 2015 Danube 0.5-2 (/) 0.0001-0.01 (0.003-0.006)\nVigiak 2017 Danube / 0.0001-0.01 (0.0015)\nAbbaspour 2007 Thur (CH) 0.2-0.25 (/) 0.001-0.002 (/)\nOeurng 2011 Save (FR) 0-2 (0.58) 0.0001-0.01 (0.01)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Engelund and Hansen This transport capacity is not present in SWAT but used in many models such as Delft3D-WAQ, Engelund and Hansen calculates the total sediment load as (Engelund and Hansen, 1967):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   C_w = 005 left( dfracrho_srho_s - rho right) left( dfracu Ssqrtleft( dfracrho_srho_s - rho right) g  D_50 right) theta^12","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where C_w is the sediment concentration by weight, rho and rho_s are the fluid and sediment density (here equal to 1000 and 2650 g m^-3), u is the water mean velocity (m s^-1), S is the river slope, g is the acceleration due to gravity, D_50 is the river mean diameter (m) and theta is the Shields parameter.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Kodatie Kodatie (1999) developed the power relationships from Posada (1995) using field data and linear optimization so that they would be applicable for a wider range of riverbed sediment size. The resulting equation, for a rectangular channel, is (Neitsch et al, 2011):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   C_max = left( dfraca u^b h^c S^dV_in right)  W","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where V_in in the volume of water entering the river cell   during the timestep (m^3) and a, b, c and d are coefficients depending on the riverbed sediment size. Values of these coefficients are summarized in the table below.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Table: Range of the simplified Bagnold coefficients (and calibrated value)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"River sediment diameter a b c d\nD_50 leq 0.05mm 281.4 2.622 0.182 0\n0.05  D_50 leq 0.25mm 2  829.6 3.646 0.406 0.412\n0.25  D_50 leq 2mm 2  123.4 3.300 0.468 0.613\nD_50  2mm 431  884.8 1.000 1.000 2.000","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Yang Yang (1996) developed a set of two equations giving transport of sediments for sand-bed or gravel-bed rivers. The sand equation (D_50  2mm) is:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   logleft(C_ppmright) = 5435 - 0286logfracomega_s50D_50nu-0457logfracu_*omega_s50 \n   +left(1799-0409logfracomega_s50D_50nu-0314logfracu_*omega_s50right)logleft(fracuSomega_s50-fracu_crSomega_s50right)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"And the gravel equation (2 leq D_50  10 mm) is:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   logleft(C_ppmright) = 6681 - 0633logfracomega_s50D_50nu-4816logfracu_*omega_s50 \n   +left(2784-0305logfracomega_s50D_50nu-0282logfracu_*omega_s50right)logleft(fracuSomega_s50-fracu_crSomega_s50right)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where C_ppm is sediment concentration in parts per million by weight, omega_s50 is the settling velocity of a particle with the median riverbed diameter estimated with Stokes (m s^-1), nu is the kinematic viscosity of the fluid (m^2s^-1), u_* is the shear velocity (sqrtgR_HS in m s^-1 with R_H the hydraulic radius of the river) and u_cr is the critical velocity (m/s, equation can be found in Hessel, 2007).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Molinas and Wu The Molinas and Wu (2001) transport equation was developed for large sand-bed rivers based on the universal stream power psi. The corresponding equation is (Neitsch et al, 2011):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   C_w = dfrac1430 (086+sqrtpsi) psi^150016+psi 10^-6","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where psi is the universal stream power given by:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   psi = dfracpsi^3left(dfracrho_srho-1right) g h omega_s50  left log_10left(dfrachD_50right)right^2","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Once the maximum concentration C_max is established with one of the above transport formula, the model then determines if there is erosion of the river bed and bank. In order to do that, the difference sed_ex between the maximum amount of sediment estimated with transport (sed_max = C_max V_in) and the sediment inputs to the river cell (sed_in calculated above) is calculated. If too much sediment is coming in and sed_ex is negative, then there is no river bed and bank erosion. And if the river has not reach its maximum transport capacity, then erosion of the river happens.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"First, the sediments stored in the cell from deposition in previous timesteps sed_stor are eroded from clay to gravel. If this amount is not enough to cover sed_ex, then erosion of the local river bed and bank material starts.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Instead of just setting river erosion amount to just cover the remaining difference sed_exeff between sed_ex and sed_stor, actual erosion potential is adjusted using river characteristics and is separated between the bed and bank of the river using the physics-based approach of Knight (1984).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"The bed and bank of the river are supposed to only be able to erode a maximum amount of their material E_Rbed for the bed and E_Rbank for the river bank. For a rectangular channel, assuming it is meandering and thus only one bank is prone to erosion, they are calculated from the equations (Neitsch et al, 2011):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   E_Rbed = k_dbed left( tau_ebed - tau_crbed right) 10^-6  L  W  rho_b bed  Delta t \n   E_Rbank = k_dbank left( tau_ebank - tau_crbank right) 10^-6 L h rho_b bank  Delta t","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where E_R is the potential bed/bank erosion rates (tons), k_d is the erodibility of the bed/bank material (cm^3 N^-1 s^-1), tau_e is the effective shear stress from the flow on the bed/bank (N m^-2), tau_cr is the critical shear stress for erosion to happen (N m^-2), L, W and h are the channel length, width and water height (m), rho_b is the bulk density of the bed/bank of the river (g cm^-3) and Delta t is the model timestep (s).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"In wflow_sediment, the erodibility of the bed/bank are approximated using the formula from Hanson and Simon (2001):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   k_d=02 tau_cr^-05","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Normally erodibilities are evaluated using jet test in the field and there are several reviews and some adjustments possible to this equation (Simon et al, 2011). However, to avoid too heavy calibration and for the scale considered, this equation is supposed to be efficient enough. The critical shear stress tau_cr is evaluated differently for the bed and bank. For the bed, the most common formula from Shields initiation of movement is used. For the bank, a more recent approach from Julian and Torres (2006) is used :","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   tau_crbank = (01+01779 SC+00028 SC^2-234 10^-5  SC^3) C_ch","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where SC is the percent clay and silt content of the river bank and C_ch is a coefficient taking into account the positive impact of vegetation on erosion reduction. This coefficient is then dependent on the land use and classical values are shown in the table below. These values where then adapted for use with the GlobCover land use map. Percent of clay and silt (along with sand and gravel) for the channel is estimated from the river median particle diameter assuming the same values as SWAT shown in the table below. Median particle diameter is here estimated depending on the Strahler river order. The higher the order, the smaller the diameter is. As the median diameter is only used in wflow_sediment for the estimation of the river bed/bank sediment composition, this supposition should be enough. Actual refined data or calibration may however be needed if the median diameter is also required for the transport formula. In a similar way, the bulk densities of river bed and bank are also just assumed to be of respectively 1.5 and 1.4 g cm^-3.","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Table: Classical values of the channel cover vegetation coefficient (Julian and Torres, 2006)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Bank vegetation C_ch\nNone 1.00\nGrassy 1.97\nSparse trees 5.40\nDense trees 19.20","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Table : Composition of the river bed/bank depending on the median diameter d_50 [mum] (Neitsch et al, 2011) ","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Sediment Fraction leq 5 5 to 50 50 to 2000 2000\nSand 0.15 0.15 0.65 0.15\nSilt 0.15 0.65 0.15 0.15\nClay 0.65 0.15 0.15 0.05\nGravel 0.05 0.05 0.05 0.65","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Then, the repartition of the flow shear stress is refined into the effective shear stress and the bed and bank of the river using the equations developed by Knight (1984) for a rectangular channel:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   tau_ebed = rho g R_H S  left(1 - dfracSF_bank100right) left(1+dfrac2hWright) \n   tau_ebank = rho g R_H S  left( SF_bankright)  left(1+dfracW2hright)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where rho g is the fluid specific weight (9800 N m^-3 for water), R_H is the hydraulic radius of the channel (m), h and W are the water level and river width (m). SF_bank is the proportion of shear stress acting on the bank (%) and is estimated from (Knight, 1984):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   SF_bank = exp left( -3230 log_10left(dfracWh+3right)+6146 right)","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Finally the relative erosion potential of the bank and bed of the river is calculated by:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   RTE_bed = dfracE_RbedE_Rbed+E_Rbank \n   RTE_bank = 1 - RTE_bed","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"And the final actual eroded amount for the bed and bank is the maximum between RTE sed_exeff and the erosion potential E_R. Total eroded amount of sediment sed_erod is then the sum of the eroded sediment coming from the storage of previously deposited sediment and the river bed/bank erosion.","category":"page"},{"location":"lateral/sediment/#River-deposition","page":"Sediment Flux","title":"River deposition","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"As sediments have a higher density than water, moving sediments in water can be deposited in the river bed. The deposition process depends on the mass of the sediment, but also on flow characteristics such as velocity. In wflow_sediment, as in SWAT, deposition is modelled with Einstein’s equation (Neitsch et al, 2011):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   P_dep=left(1-dfrac1e^xright)100","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where P_dep is the percentage of sediments that is deposited on the river bed and x is a parameter calculated with:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   x = dfrac1055 L  omega_su h","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where L and h are channel length and water height (m), omega_s is the particle settling velocity calculated with Stokes formula (m s^-1) and u is the mean flow velocity (m s^-1). The calculated percentage is then subtracted from the amount of sediment input and eroded river sediment for each particle size class (sed_dep = P_dep100 (sed_in + sed_erod)). Resulting deposited sediment are then stored in the river bed and can be re-mobilized in future time steps by erosion.","category":"page"},{"location":"lateral/sediment/#Mass-balance-and-sediment-concentration","page":"Sediment Flux","title":"Mass balance and sediment concentration","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Finally after estimating inputs, deposition and erosion with the transport capacity of the flow, the amount of sediment actually leaving the river cell to go downstream is estimated using:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   sed_out = (sed_in + sed_erod - sed_dep) dfracV_outV","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where sed_out is the amount of sediment leaving the river cell (tons), sed_in is the amount of sediment coming into the river cell (storage from previous timestep, land erosion and sediment flux from upstream river cells in tons), sed_erod is the amount of sediment coming from river erosion (tons), sed_dep is the amount of deposited sediments (tons), V_out is the volume of water leaving the river cell (surface runoff Q times timestep Delta t in m^3) and V is the total volume of water in the river cell (V_out plus storage h W L in m^3).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"A mass balance is then used to calculate the amount of sediment remaining in the cell at the end of the timestep (sed_riv)_t:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   (sed_riv)_t = (sed_riv)_t-1 + (sed_land)_t + upstreamleft(sed_out)_t-1right + (sed_erod)_t - (sed_dep)_t - (sed_out)_t","category":"page"},{"location":"lateral/sediment/#Lake-and-reservoir-modelling","page":"Sediment Flux","title":"Lake and reservoir modelling","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Apart from land and river, the hydrologic wflow_sbm model also handles lakes and reservoirs modelling. In wflow_sbm, lakes and large reservoirs are modelled using a 1D bucket model at the cell corresponding to the outlet. For the other cells belonging to the lake/reservoir which are not the outlet, processes such as precipitation and evaporation are filtered out and shifted to the outlet cell. wflow_sediment handles the lakes and reservoirs in the same way. If a cell belongs to a lake/reservoir and is not the outlet then the model assumes that no erosion/deposition of sediments is happening and the sediments are only all transported to the lake/reservoir outlet. Once the sediments reach the outlet, then sediments are deposited in the lake/reservoir according to Camp’s model (1945) (Verstraeten et al, 2000):","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"   TE = dfracomega_su_crres = dfracA_resQ_outres omega_s","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"where TE is the trapping efficiency of the lake/reservoir (or the fraction of particles trapped), omega_s is the particle velocity from Stokes (m s^-1), u_crres is the reservoir’s critical settling velocity (m/s) which is equal to the reservoir’s outflow Q_outres (m^3 s^-1) divided by the reservoir’s surface area A_res (m^2).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"For reservoirs, coarse sediment particles from the bed load are also assumed to be trapped by the  dam structure. This adding trapping is taken into account with a reservoir trapping efficiency coefficient  for large particles (between 0 and 1). Depending on the type of the dam, all bed load particles are trapped  (restrapefficiency =1.0, for example for a gravity dam) or only partly (for example for run-of-the-river dams).","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Lake and reservoir modelling is enabled in the model section of the TOML and require the extra following input arguments:","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"[model]\ndoreservoir = true\ndolake = false\n\n[input.vertical]\n# Reservoir\nresareas = \"wflow_reservoirareas\"\n# Lake\nlakeareas = \"wflow_lakeareas\"\n\n[input.lateral.river]\n# Reservoir\nresarea = \"ResSimpleArea\"\nrestrapefficiency = \"ResTrapEff\"\nresareas = \"wflow_reservoirareas\"\nreslocs = \"wflow_reservoirlocs\"\n# Lake\nlakearea = \"LakeArea\"\nlakeareas = \"wflow_lakeareas\"\nlakelocs = \"wflow_lakelocs\"","category":"page"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"Note that in the inland part, lake and reservoir coverage are used to filter erosion and transport in overland flow.","category":"page"},{"location":"lateral/sediment/#References","page":"Sediment Flux","title":"References","text":"","category":"section"},{"location":"lateral/sediment/","page":"Sediment Flux","title":"Sediment Flux","text":"K.C. Abbaspour, J. Yang, I. Maximov, R. Siber, K. Bogner, J. Mieleitner, J. Zobrist, and R.Srinivasan. Modelling hydrology and water quality in the pre-alpine/alpine Thur watershed using SWAT. Journal of Hydrology, 333(2-4):413-430, 2007. 10.1016/j.jhydrol.2006.09.014\nP. Borrelli, M. M\u007farker, P. Panagos, and B. Sch\u007futt. Modeling soil erosion and river sediment yield for an intermountain drainage basin of the Central Apennines, Italy. Catena, 114:45-58, 2014. 10.1016/j.catena.2013.10.007\nF. Engelund and E. Hansen. A monograph on sediment transport in alluvial streams. Technical University of Denmark 0stervoldgade 10, Copenhagen K., 1967.\nG. Govers. Empirical relationships for the transport capacity of overland flow. IAHS Publication, (January 1990):45-63 ST, 1990.\nG.J Hanson and A Simon. Erodibility of cohesive streambeds in the loess area of the midwestern USA. Hydrological Processes, 15(May 1999):23-38, 2001.\nR Hessel and V Jetten. Suitability of transport equations in modelling soil erosion for a small Loess Plateau catchment. Engineering Geology, 91(1):56-71, 2007. 10.1016/j.enggeo.2006.12.013\nJ.P Julian, and R. Torres. Hydraulic erosion of cohesive riverbanks. Geomorphology,  76:193-206, 2006. 10.1016/j.geomorph.2005.11.003\nD.W. Knight, J.D. Demetriou, and M.E. Hamed. Boundary Shear in Smooth Rectangular Channels. J. Hydraul. Eng., 110(4):405-422, 1984. 10.1061/(ASCE)0733-9429(1987)113:1(120)\nS.L Neitsch, J.G Arnold, J.R Kiniry, and J.R Williams. SWAT Theoretical Documentation Version 2009. Texas Water Resources Institute, pages 1-647, 2011. 10.1016/j.scitotenv.2015.11.063\nC. Oeurng, S. Sauvage, and J.M. Sanchez-Perez. Assessment of hydrology, sediment and particulate organic carbon yield in a large agricultural catchment using the SWAT model. Journal of Hydrology, 401:145-153, 2011. 10.1016/j.hydrol.2011.02.017\nA. Simon, N. Pollen-Bankhead, and R.E Thomas. Development and application of a deterministic bank stability and toe erosion model for stream restoration. Geophysical Monograph Series, 194:453-474, 2011. 10.1029/2010GM001006\nG. Verstraeten and J. Poesen. Estimating trap efficiency of small reservoirs and ponds: methods and implications for the assessment of sediment yield. Progress in Physical Geography, 24(2):219-251, 2000. 10.1177/030913330002400204\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, and J. Poesen. Adapting SWAT hillslope erosion model to predict sediment concentrations and yields in large Basins. Science of the Total Environment, 538:855-875, 2015. 10.1016/j.scitotenv.2015.08.095\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, F. Obreja, J. Poesen, H. Habersack, J. Feher, and S. Groselj. Modelling sediment fluxes in the Danube River Basin with SWAT. Science of the Total Environment, 2017. 10.1016/j.scitotenv.2017.04.236","category":"page"},{"location":"structure/#Structures","page":"Structures","title":"Structures","text":"","category":"section"},{"location":"structure/#Model","page":"Structures","title":"Model","text":"","category":"section"},{"location":"structure/","page":"Structures","title":"Structures","text":"Below the composite type that represents all different aspects of a Wflow.Model, such as  the network, parameters, clock, model type, configuration and input and output.","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"struct Model{N,L,V,R,W,T}\n    config::Config  # all configuration options\n    network::N      # connectivity information, directed graph\n    lateral::L      # lateral model that holds lateral state, moves along network\n    vertical::V     # vertical model that holds vertical state, independent of each other\n    clock::Clock    # to keep track of simulation time\n    reader::R       # provides the model with dynamic input\n    writer::W       # writes model output\n    type::T         # model type\nend","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"The lateral field of the struct Model can contain different lateral concepts. For each Wflow model these different lateral concepts are mapped through the use of a NamedTuple. The vertical field of the struct Model always contains one vertical concept, for example the SBM or HBV vertical concept.","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"Below an example how lateral concepts are mapped for the SBM model through a NamedTuple:","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"(subsurface = ssf, land = olf, river = rf)","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"The subsurface part is mapped to the lateral subsurface flow kinematic wave concept, the land part is mapped the overland flow kinematic wave concept and the river part is mapped to the river flow kinematic wave concept. Knowledge of this specific mapping is required to understand and correctly set input, output and state variables in the TOML configuration file, see also Config and TOML. This mapping is described in more detail for each model in the section Models. Also the struct of each mapped concept is provided, so one can check the internal variables in the code. These structs are defined as a parametric composite type, with type parameters between curly braces after the struct name. See also the next paragraph Vertical and lateral models for a more detailed description.","category":"page"},{"location":"structure/#Vertical-and-lateral-models","page":"Structures","title":"Vertical and lateral models","text":"","category":"section"},{"location":"structure/","page":"Structures","title":"Structures","text":"The different model concepts used in Wflow are defined as parametric composite types. For example the vertical SBM concept is defined as follows: struct SBM{T,N,M}. T, N and M between curly braces after the struct name refer to type parameters, for more information about type parameters you can check out Type parameters. Since these parameters can be of any type, it is possible to declare an unlimited number of composite types. The type parameters are used to set the type of struct fields, below an example with a part of the SBM struct:","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"@get_units @with_kw struct SBM{T,N,M}\n    # Model time step [s]\n    Δt::T | \"s\"\n    # Maximum number of soil layers\n    maxlayers::Int | \"-\"\n    # number of cells\n    n::Int | \"-\"\n    # Number of soil layers\n    nlayers::Vector{Int} | \"-\"\n    # Number of unsaturated soil layers\n    n_unsatlayers::Vector{Int} | \"-\"\n    # Fraction of river [-]\n    riverfrac::Vector{T} | \"-\"\n    # Saturated water content (porosity) [mm mm⁻¹]\n    θₛ::Vector{T} | \"mm mm-1\"\n    # Residual water content [mm mm⁻¹]\n    θᵣ::Vector{T} | \"mm mm-1\"\n    # Vertical hydraulic conductivity [mm Δt⁻¹] at soil surface\n    kv₀::Vector{T} | \"mm Δt-1\"\n    # Muliplication factor [-] applied to kv_z (vertical flow)\n    kvfrac::Vector{SVector{N,T}} | \"-\"","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"The type parameter T is used in Wflow as a subtype of AbstractFloat, allowing to store fields with a certain floating point precision (e.g. Float64 or Float32) in a flexible way. N refers to the maximum number of soil layers of the SBM soil column, and M refers to the maximum number of soil layers + 1. See also part of the following instance of SBM:","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"sbm = SBM{Float,maxlayers,maxlayers + 1}(\n    Δt = tosecond(Δt),\n    maxlayers = maxlayers,\n    n = n,","category":"page"},{"location":"structure/","page":"Structures","title":"Structures","text":"For the other model concepts, we refer to the code to check these type parameters.","category":"page"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = Wflow","category":"page"},{"location":"#Wflow","page":"Home","title":"Wflow","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Wflow is a Julia package that provides a hydrological modeling framework, as well as several different vertical and lateral concepts that can be used to run hydrological simulations. It is a continuation of the work available here.","category":"page"},{"location":"","page":"Home","title":"Home","text":"You can use Wflow in the following three ways.","category":"page"},{"location":"","page":"Home","title":"Home","text":"From Julia as a library. The Quick start describes how to install it, prepare an example model, and run a simulation.\nWith the wflow_cli Command Line Interface. This way there is no need to install Julia, you can download a binary and run.\nThrough the Basic Model Interface, which is a standardized interface to run the model that also makes it easy to couple other BMI enabled models to it.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Wflow can also be linked to the flood forecasting system Delft-FEWS. This is described in Run from Delft-FEWS","category":"page"},{"location":"","page":"Home","title":"Home","text":"See the side bar on the left to navigate to other sections of the documentation.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The source code for Wflow is available under the MIT license at github.com/Deltares/Wflow.jl.","category":"page"},{"location":"lateral/kinwave/#Kinematic-wave","page":"Kinematic wave","title":"Kinematic wave","text":"","category":"section"},{"location":"lateral/kinwave/#Surface-routing","page":"Kinematic wave","title":"Surface routing","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The main flow routing scheme available in Wflow.jl is the kinematic wave approach for channel and overland flow, assuming that the topography controls water flow mostly. The kinematic wave equations are (Chow, 1988):","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"  dfracdQdx + dfracdAdt = q \n   A = alpha Q^beta","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"These equations can then be combined as a function of streamflow only:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    dfracdQdx + alpha beta Q^beta - 1 dfracdQdt = q","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where Q is the surface runoff in the kinematic wave [m^3/s], x is the length of the runoff pathway [m], A is the cross-section area of the runoff pathway [m^2], t is the integration timestep [s] and alpha and beta are coefficients.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"These equations are solved with a nonlinear scheme using Newton’s method and can also be iterated depending on the  model space and time resolution. By default, the iterations are performed until a stable solution is reached (epsilon  10^-12). For larger models, the number of iterations can also be fixed for to a specific sub-timestep (in seconds) for both overland and channel flows to improve simulation time. To enable (fixed or not) iterations of the kinematic wave the following lines can be inserted in the TOML file of the model:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\n# Enable iterations of the kinematic wave\nkin_wave_iteration = true\n# Fixed sub-timestep for iterations of channel flow (river cells)\nkw_river_tstep = 900\n# Fixed sub-timestep for iterations of overland flow (land cells)\nkw_land_tstep = 3600","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The alpha parameter of the kinematic wave is fixed. To estimate the wetted perimeter for the calculation of the alpha parameter a bankfull height map (default value is 1.0 m) for the river can be provided as follows: ","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input.lateral.river]\nh_bankfull = \"river_bankfullheight\"","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The wetted perimeter of the river is based on half bankfull height. For the land part the wetted perimeter is based on the flow width.","category":"page"},{"location":"lateral/kinwave/#Inflow","page":"Kinematic wave","title":"Inflow","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"External water (supply/abstraction) inflow [m^3 s^-1]  can be added to the kinematic wave for surface water routing, as a cyclic parameter or as part of forcing (see also Input section).","category":"page"},{"location":"lateral/kinwave/#Subsurface-flow-routing","page":"Kinematic wave","title":"Subsurface flow routing","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"In the SBM model the kinematic wave approach is used to route subsurface flow laterally. The saturated store S can be drained laterally by saturated downslope subsurface flow per unit width of slope w [m] according to:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    q=fracK_0mathittan(beta)f(e^(-fz_i)-e^(-fz_t))","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where beta is element slope angle [deg.], q is subsurface flow [m^2/t], K_0 is the saturated hydraulic conductivity at the soil surface [m/t], z_i is the water table depth [m], z_t is total soil depth [m], and f is a scaling parameter [m^-1], that controls the decrease of vertical saturated conductivity with  depth.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Combining with the following continuity equation:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    (theta_s-theta_r)fracpartial hpartial t = -wfracpartial qpartial x + wr","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where h is the water table height [m], x is the distance downslope [m], and r is the netto input rate [m/t] to the saturated store. Substituting for h (fracpartial qpartial h), gives:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"  w fracpartial qpartial t = -cwfracpartial qpartial x + cwr","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where celerity c = fracK_0mathittan(beta)(theta_s-theta_r) e^(-fz_i)","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave equation for lateral subsurface flow is solved iteratively using Newton's method.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"note: Note\nFor the lateral subsurface flow kinematic wave the model timestep is not adjusted. For certain model timestep and model grid size combinations this may result in loss of accuracy.","category":"page"},{"location":"lateral/kinwave/#Multi-Threading","page":"Kinematic wave","title":"Multi-Threading","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave calculations for surface - and subsurface flow routing can be executed in parallel using multiple threads. In the model section of the TOML file, a minimum stream order can be provided (default is 4) to define subbasins. Subbasins are created at all confluences where each branch has a minimal stream order. Based on the subbasins a directed acyclic graph is created that controls the order of execution and which subbasins can run in parallel. ","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\nmin_streamorder = 3   # minimum stream order to delineate subbasins, default is 4","category":"page"},{"location":"lateral/kinwave/#Subcatchment-flow","page":"Kinematic wave","title":"Subcatchment flow","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Normally the the kinematic wave is continuous throughout the model. By using the pits entry in the model and input sections of the TOML file all flow is at the subcatchment only (upstream of the pit locations, defined by the netCDF variable wflow_pits in the example below) and no flow is transferred from one subcatchment to another. This can be convenient when connecting the result of the model to a water allocation model such as Ribasim.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input]\n# these are not directly part of the model\npits = \"wflow_pits\"\n\n[model]\npits = true","category":"page"},{"location":"lateral/kinwave/#Limitations","page":"Kinematic wave","title":"Limitations","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave approach for channel, overland and lateral subsurface flow, assumes that the topography controls water flow mostly. This assumption holds for steep terrain, but in less steep terrain the hydraulic gradient is likely not equal to the surface slope (subsurface flow), or pressure differences and inertial momentum cannot be neglected (channel and overland flow). In addition, while the kinemative wave equations are solved with a nonlinear scheme using Newton's method (Chow, 1988), other model equations are solved through a simple explicit scheme. In summary the following limitations apply:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Channel flow, and to a lesser degree overland flow, may be unrealistic in terrain that is not steep, and where pressure forces and inertial momentum are important.\nThe lateral movement of subsurface flow may be very wrong in terrain that is not steep.","category":"page"},{"location":"lateral/kinwave/#Reservoirs-and-Lakes","page":"Kinematic wave","title":"Reservoirs and Lakes","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Simplified reservoirs and lakes models can be included as part of the river kinematic wave network.","category":"page"},{"location":"lateral/kinwave/#Reservoirs","page":"Kinematic wave","title":"Reservoirs","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Simple reservoirs can be included within the kinematic wave river routing by supplying the following reservoir parameters:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"locs - Outlet of the reservoirs in which each reservoir has a unique id\narea - Surface area of the reservoirs [m^2]\nareas - Reservoir coverage\ntargetfullfrac - Target fraction full (of max storage) for the reservoir: number between 0 and 1\ntargetminfrac - Target minimum full fraction (of max storage). Number between 0 and 1\nmaxvolume - Maximum reservoir storage (above which water is spilled) [m^3]\ndemand - Minimum (environmental) flow requirement downstream of the reservoir  [m^3 s^-1]\nmaxrelease - Maximum Q that can be released if below spillway [m^3 s^-1]","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"By default the reservoirs are not included in the model. To include them put the following lines in the TOML file of the model:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\nreservoirs = true","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Finally there is a mapping required between external and internal parameter names in the TOML file, with below an example:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input]\n\n[input.lateral.river.reservoir]\narea = \"ResSimpleArea\"\nareas = \"wflow_reservoirareas\"\ndemand = \"ResDemand\"\nlocs = \"wflow_reservoirlocs\"\nmaxrelease = \"ResMaxRelease\"\nmaxvolume = \"ResMaxVolume\"\ntargetfullfrac = \"ResTargetFullFrac\"\ntargetminfrac = \"ResTargetMinFrac\"","category":"page"},{"location":"lateral/kinwave/#Lakes","page":"Kinematic wave","title":"Lakes","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Natural (uncontrolled) lakes are modelled using a mass balance approach:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    dfracS(t + Delta t)Delta t = dfracS(t)Delta t + Q_in + dfrac(P-E) ADelta t - Q_out","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where S is lake storage [m^3], Delta t is the model timestep [s], Q_in is the sum of inflows (river, overland and lateral subsurface flow) [m^3 s^-1], Q_out is the lake outflow at the outlet [m^3 s^-1], P is precipitation [m], E is lake evaporation [m] and A is the lake surface area [m^2].","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"(Image: lake_schematisation)","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Lake schematisation.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Most of the variables in this equation are already known or coming from previous timestep, apart from S(t+ Delta t) and Q_out which can both be linked to the water level H in the lake using a storage curve S = f(H) and a rating curve Q = f(H). In wflow, several options are available to select storage and rating curves, and in most cases, the mass balance is then solved by linearization and iteration or using the Modified Puls Approach from Maniak (Burek et al., 2013). Storage curves in wflow can either:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Come from the interpolation of field data linking volume and lake height,\nBe computed from the simple relationship S = A H.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Rating curves in wlow can either:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Come from the interpolation of field data linking lake outflow and water height,\nBe computed from a rating curve of the form Q_out = alpha (H-H_0)^beta, where H_0 is the minimum water level under which the outflow is zero. Usual values for beta are 3/2 for a rectangular weir or 2 for a parabolic weir (Bos, 1989).","category":"page"},{"location":"lateral/kinwave/#Modified-Puls-Approach","page":"Kinematic wave","title":"Modified Puls Approach","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The Modified Puls Approach is a resolution method of the lake balance that uses an explicit relationship between storage and outflow. Storage is assumed to be equal to A H and the rating curve for a parabolic weir (beta = 2):","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    S = A H = A  (h + H_0) = dfracAsqrtalpha sqrtQ + A H_0","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Inserting this equation in the mass balance gives:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    dfracADelta t sqrtalpha sqrtQ + Q = dfracS(t)Delta t + Q_in +\n    dfrac(P-E) ADelta t - dfracA H_0Delta t = SI - dfracA H_0Delta t","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The solution for Q is then:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    Q =  left( -LF + sqrtLF^2 + 2  left( SI - dfracA*H_0Delta t right)\n     right) ^2 textfor  SI  dfracA H_0Delta t  text and where \n    LF = dfracADelta t sqrtalpha \n    Q = 0 text for  SI leq dfracA*H_0Delta t","category":"page"},{"location":"lateral/kinwave/#Lake-parameters","page":"Kinematic wave","title":"Lake parameters","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Natural lakes can be included within the kinematic wave river routing in wflow, by supplying the following parameters:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"area - Surface area of the lakes [m^2]\nareas - Coverage of the lakes\nlocs - Outlet of the lakes in which each lake has a unique id\nlinkedlakelocs - Outlet of linked (downstream) lakes (unique id)\nwaterlevel - Lake water level [m], used to reinitiate lake model\nthreshold - Water level threshold H_0 under which outflow is zero [m]\nstorfunc - Type of lake storage curve ; 1 for S = AH (default) and 2 for S = f(H) from lake data and interpolation\noutflowfunc - Type of lake rating curve ; 1 for Q = f(H) from lake data and interpolation, 2 for general Q = b(H - H_0)^e and 3 in the case of Puls Approach Q = b(H - H_0)^2 (default)\nb -  Rating curve coefficient\ne - Rating curve exponent","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"By default, the lakes are not included in the model. To include them, put the following line in the TOML file of the model:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\nlakes = true","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"There is also a mapping required between external and internal parameter names in the TOML file, with below an example:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input]\n\n[input.lateral.river.lake]\narea = \"lake_area\"\nareas = \"wflow_lakeareas\"\nb = \"lake_b\"\ne = \"lake_e\"\nlocs = \"wflow_lakelocs\"\noutflowfunc = \"lake_outflowfunc\"\nstorfunc  = \"lake_storfunc\"\nthreshold  = \"lake_threshold\"\nwaterlevel = \"lake_waterlevel\"","category":"page"},{"location":"lateral/kinwave/#Additional-settings","page":"Kinematic wave","title":"Additional settings","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Storage and rating curves from field measurement can be supplied to wflow via CSV files supplied in the same folder of the TOML file. Naming of the files uses the ID of the lakes where data are available and is of the form lake_sh_1.csv and lake_hq_1.csv for respectively the storage and rating curves of lake with ID 1.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The storage curve is stored in a CSV file with lake level [m] in the first column H and corresponding lake storage [m ^3] in the second column S:","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"H,  S\n392.21, 0\n393.21, 430202000\n393.71, 649959000\n394.21, 869719000","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The rating curve uses level and discharge data depending on the Julian day of the year (JDOY). The first line contains H for the first column. The other lines contain the water level and the corresponding discharges for the different JDOY (1-365), see also the example below, that shows part of a CSV file (first 4 Julian days).","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"H\n394,    43,     43,     43,     43\n394.01, 44.838, 44.838, 44.838, 44.838\n394.02, 46.671, 46.671, 46.671, 46.671\n394.03, 48.509, 48.509, 48.509, 48.509\n394.04, 50.347, 50.347, 50.347, 50.347\n394.05, 52.179, 52.179, 52.179, 52.179","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Linked lakes: In some cases, lakes can be linked and return flow can be allowed from the downstream to the upstream lake. The linked lakes are defined in the linkedlakelocs parameter that represent the downstream lake location ID, at the grid cell of the upstream lake location.","category":"page"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"note: Note\nIn every file, level units are meters [m] above lake bottom and not meters above sea level [m asl]. Especially with storage/rating curves coming from data, please be careful and convert units if needed.","category":"page"},{"location":"lateral/kinwave/#External-inflows","page":"Kinematic wave","title":"External inflows","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"External inflows, for example water supply or abstractions, can be added to the kinematic wave via the inflow variable. For this, the user can supply a 2D map of the inflow which can be static or dynamic (changing every timestep or cyclic is possible). These inflow are added or abstracted from the upstream inflow qin before running the kinematic wave to solve the impact on resulting q. In case of a negative inflow (abstractions), a minimum of zero is applied to the upstream flow qin.","category":"page"},{"location":"lateral/kinwave/#References","page":"Kinematic wave","title":"References","text":"","category":"section"},{"location":"lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Bos M.G., 1989. Discharge measurement structures. Third revised edition, International Institute for Land Reclamation and Improvement ILRI, Wageningen, The Netherlands.\nBurek P., Van der Knijf J.M., Ad de Roo, 2013. LISFLOOD – Distributed Water Balance and flood Simulation Model – Revised User Manual. DOI: http://dx.doi.org/10.2788/24719.\nChow, V., Maidment, D. and Mays, L., 1988, Applied Hydrology. McGraw-Hill Book Company, New York.","category":"page"},{"location":"lateral/kinwave_params/#Surface-flow","page":"Kinematic wave","title":"Surface flow","text":"","category":"section"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"The Table below shows the parameters (fields) of struct SurfaceFlow, including a description of these parameters, the unit, and default value if applicable. SurfaceFlow is used for river and overland flow. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river] and [input.lateral.land], for river and overland flow respectively, to map the internal model parameter to the external netCDF variable. For river flow three additionally parameters can be set, dl (river length), width (river width) and bankfull water height h_bankfull as follows, through the TOML file:","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"[input.lateral.river]\nlength = \"wflow_riverlength\"\nwidth = \"wflow_riverwidth\"\nh_bankfull = \"river_bankfullheight\"","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"[1]: default value for Manning's roughness n, river = 0.036; land = 0.072","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"[2]: only applicable for river domain","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"parameter description unit default\nβ constant in Manning's equation - -\ndl length m -\nn Manning's roughness s m^-frac13 [1]\nsl slope m m^-1 -\nwidth width m -\nq discharge m^3 s^-1 -\nqin inflow from upstream cells m^3 s^-1 -\nq_av average discharge m^3 s^-1 -\nqlat lateral inflow per unit length m^2 s^-1 -\ninwater lateral inflow m^3 s^-1 -\ninflow external inflow (abstraction/supply/demand) m^3 s^-1 0.0\nvolume kinematic wave volume m^3 -\nh water level m -\nh_av average water level m -\nh_bankfull bankfull water level m 1.0\nΔt model time step s -\nits number of fixed iterations - -\nalpha_pow used in the power part of alpha - -\nalpha_term term used in computation of alpha - -\nα constant in momentum equation A = alpha Q^beta s^frac35 m^frac15 -\ncel celerity of kinematic wave m s^-1 -\nto_river part of overland flow that flows to the river m s^3 -\nrivercells location of river cells (0 or 1) - -\nwb_pit location (0 or 1) of a waterbody (wb, reservoir or lake) - -\nreservoir_index map cell to 0 (no reservoir) or i (pick reservoir i in reservoir field) - -\nlake_index map cell to 0 (no lake) or i (pick lake i in lake field) - -\nreservoir [2] an array of reservoir models SimpleReservoir - -\nlake [2] an array of lake models NaturalLake - -\nkinwave_it boolean for kinematic wave iterations - false","category":"page"},{"location":"lateral/kinwave_params/#reservoir_params","page":"Kinematic wave","title":"Reservoirs","text":"","category":"section"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"The Table below shows the parameters (fields) of struct SimpleReservoir, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river.reservoir], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"Two parameters reservoir coverage areas and the outlet of reservoirs (unique id) locs that are not part of the SimpleReservoir struct are also required, and can be set as follows through the TOML file: ","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"[input.lateral.river.reservoir]\nareas = \"wflow_reservoirareas\"\nlocs = \"wflow_reservoirlocs\"","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"parameter description unit default\narea area m^2 -\ndemandrelease ( demand) minimum (environmental) flow released from reservoir m^3 s^-1 -\nmaxrelease maximum amount that can be released if below spillway m^3 s^-1 -\nmaxvolume maximum storage (above which water is spilled) m^3 -\ntargetfullfrac target fraction full (of max storage) - -\ntargetminfrac target minimum full fraction (of max storage) - -\nΔt model time step s -\nvolume volume m^3 -\ninflow total inflow into reservoir m^3 -\noutflow outflow into reservoir m^3 s^-1 -\ntotaloutflow total outflow into reservoir m^3 -\npercfull fraction full (of max storage) - -\nprecipitation outflow into reservoir mm Δt⁻¹ -\nevaporation outflow into reservoir mm Δt⁻¹ -","category":"page"},{"location":"lateral/kinwave_params/#lake_params","page":"Kinematic wave","title":"Lakes","text":"","category":"section"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"The Table below shows the parameters (fields) of struct NaturalLake, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river.lake], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"Two parameters lake coverage areas and the outlet of lakes (unique id) locs that are not part of the NaturalLake struct are also required, and can be set as follows through the TOML file:","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"[input.lateral.river.lake]\nareas = \"wflow_lakeareas\"\nlocs = \"wflow_lakelocs\"","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"parameter description unit default\narea area m^2 -\nb Rating curve coefficient - -\ne Rating curve exponent - -\noutflowfunc type of lake rating curve - -\nstorfunc type of lake storage curve - -\nthreshold water level threshold H_0 below that level outflow is zero m -\nwaterlevel waterlevel H of lake m -\nlowerlake_ind (linkedlakelocs) Index of lower lake (linked lakes) - 0\nsh data for storage curve - -\nhq data rating curve - -\nΔt model time step s -\ninflow total inflow to the lake m^3 -\nstorage storage lake m^3 -\noutflow outflow lake m^3 s^-1 -\ntotaloutflow total outflow lake m^3 -\nprecipitation average precipitation for lake area mm Δt⁻¹ -\nevaporation average precipitation for lake area mm Δt⁻¹ -","category":"page"},{"location":"lateral/kinwave_params/#Lateral-subsurface-flow","page":"Kinematic wave","title":"Lateral subsurface flow","text":"","category":"section"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"The Table below shows the parameters (fields) of struct LateralSSF, including a description of these parameters, the unit, and default value if applicable. ","category":"page"},{"location":"lateral/kinwave_params/","page":"Kinematic wave","title":"Kinematic wave","text":"parameter description unit default\nkh₀ horizontal hydraulic conductivity at soil surface m Δt^-1 -\nf a scaling parameter (controls exponential decline of kh₀) m^-1 -\nsoilthickness soil thickness m -\nθₛ saturated water content (porosity) - -\nθᵣ residual water content - -\nt time step Δt s -\nΔt model time step s -\nβₗ slope - -\ndl drain length m -\ndw drain width m -\nzi pseudo-water table depth (top of the saturated zone) m -\nexfiltwater exfiltration (groundwater above surface level, saturated excess conditions) m -\nrecharge net recharge to saturated store m -\nssf subsurface flow m^3 Δt-1 -\nssfin inflow from upstream cells m^3 Δt-1 -\nssfmax maximum subsurface flow m^2 Δt-1 -\nto_river part of subsurface flow that flows to the river m^3 Δt-1 -\nwb_pit boolean location (0 or 1) of a waterbody (wb, reservoir or lake) - -","category":"page"}]
}
