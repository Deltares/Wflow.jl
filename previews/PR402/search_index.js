var documenterSearchIndex = {"docs":
[{"location":"model_docs/lateral/waterbodies/#reservoir_lake","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Simplified reservoirs and lakes models can be included as part of the river network.","category":"page"},{"location":"model_docs/lateral/waterbodies/#Reservoirs","page":"Reservoirs and Lakes","title":"Reservoirs","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Simple reservoirs can be included within the river routing by supplying the following reservoir parameters:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"locs - Outlet of the reservoirs in which each reservoir has a unique id\narea - Surface area of the reservoirs [m^2]\nareas - Reservoir coverage\ntargetfullfrac - Target fraction full (of max storage) for the reservoir: number between 0 and 1\ntargetminfrac - Target minimum full fraction (of max storage). Number between 0 and 1\nmaxvolume - Maximum reservoir storage (above which water is spilled) [m^3]\ndemand - Minimum (environmental) flow requirement downstream of the reservoir  [m^3 s^-1]\nmaxrelease - Maximum Q that can be released if below spillway [m^3 s^-1]","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"By default the reservoirs are not included in the model. To include them put the following lines in the TOML file of the model:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"[model]\nreservoirs = true","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Finally there is a mapping required between external and internal parameter names in the TOML file, with below an example:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"[input]\n\n[input.lateral.river.reservoir]\narea = \"ResSimpleArea\"\nareas = \"wflow_reservoirareas\"\ndemand = \"ResDemand\"\nlocs = \"wflow_reservoirlocs\"\nmaxrelease = \"ResMaxRelease\"\nmaxvolume = \"ResMaxVolume\"\ntargetfullfrac = \"ResTargetFullFrac\"\ntargetminfrac = \"ResTargetMinFrac\"","category":"page"},{"location":"model_docs/lateral/waterbodies/#Lakes-(unregulated-and-regulated)","page":"Reservoirs and Lakes","title":"Lakes (unregulated and regulated)","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Lakes are modelled using a mass balance approach:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"    dfracS(t + Delta t)Delta t = dfracS(t)Delta t + Q_in + dfrac(P-E) ADelta t - Q_out","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"where S is lake storage [m^3], Delta t is the model timestep [s], Q_in is the sum of inflows (river, overland and lateral subsurface flow) [m^3 s^-1], Q_out is the lake outflow at the outlet [m^3 s^-1], P is precipitation [m], E is lake evaporation [m] and A is the lake surface area [m^2].","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"(Image: lake_schematisation)","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Lake schematization.","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Most of the variables in this equation are already known or coming from previous timestep, apart from S(t+ Delta t) and Q_out which can both be linked to the water level H in the lake using a storage curve S = f(H) and a rating curve Q = f(H). In wflow, several options are available to select storage and rating curves, and in most cases, the mass balance is then solved by linearization and iteration or using the Modified Puls Approach from Maniak (Burek et al., 2013). Storage curves in wflow can either:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Come from the interpolation of field data linking volume and lake height,\nBe computed from the simple relationship S = A H.","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Rating curves in wflow can either:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Come from the interpolation of field data linking lake outflow and water height, also appropriate for regulated lakes/ dams,\nBe computed from a rating curve of the form Q_out = alpha (H-H_0)^beta, where H_0 is the minimum water level under which the outflow is zero. Usual values for beta are 3/2 for a rectangular weir or 2 for a parabolic weir (Bos, 1989).","category":"page"},{"location":"model_docs/lateral/waterbodies/#Modified-Puls-Approach","page":"Reservoirs and Lakes","title":"Modified Puls Approach","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"The Modified Puls Approach is a resolution method of the lake balance that uses an explicit relationship between storage and outflow. Storage is assumed to be equal to A H and the rating curve for a parabolic weir (beta = 2):","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"    S = A H = A  (h + H_0) = dfracAsqrtalpha sqrtQ + A H_0","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Inserting this equation in the mass balance gives:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"    dfracADelta t sqrtalpha sqrtQ + Q = dfracS(t)Delta t + Q_in +\n    dfrac(P-E) ADelta t - dfracA H_0Delta t = SI - dfracA H_0Delta t","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"The solution for Q is then:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"    Q =  left( dfrac-LF + sqrtLF^2 + 4  left( SI - dfracA*H_0Delta t right)\n    2 right) ^2 textfor  SI  dfracA H_0Delta t  text and where\n    LF = dfracADelta t sqrtalpha \n    Q = 0 text for  SI leq dfracA*H_0Delta t","category":"page"},{"location":"model_docs/lateral/waterbodies/#Lake-parameters","page":"Reservoirs and Lakes","title":"Lake parameters","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Lakes can be included within the kinematic wave river routing in wflow, by supplying the following parameters:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"area - Surface area of the lakes [m^2]\nareas - Coverage of the lakes\nlocs - Outlet of the lakes in which each lake has a unique id\nlinkedlakelocs - Outlet of linked (downstream) lakes (unique id)\nwaterlevel - Lake water level [m], used to reinitiate lake model\nthreshold - Water level threshold H_0 under which outflow is zero [m]\nstorfunc - Type of lake storage curve ; 1 for S = AH (default) and 2 for S = f(H) from lake data and interpolation\noutflowfunc - Type of lake rating curve ; 1 for Q = f(H) from lake data and interpolation, 2 for general Q = b(H - H_0)^e and 3 in the case of Puls Approach Q = b(H - H_0)^2 (default)\nb -  Rating curve coefficient\ne - Rating curve exponent","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"By default, the lakes are not included in the model. To include them, put the following line in the TOML file of the model:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"[model]\nlakes = true","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"There is also a mapping required between external and internal parameter names in the TOML file, with below an example:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"[input]\n\n[input.lateral.river.lake]\narea = \"lake_area\"\nareas = \"wflow_lakeareas\"\nb = \"lake_b\"\ne = \"lake_e\"\nlocs = \"wflow_lakelocs\"\noutflowfunc = \"lake_outflowfunc\"\nstorfunc  = \"lake_storfunc\"\nthreshold  = \"lake_threshold\"\nwaterlevel = \"lake_waterlevel\"","category":"page"},{"location":"model_docs/lateral/waterbodies/#Additional-settings","page":"Reservoirs and Lakes","title":"Additional settings","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Storage and rating curves from field measurement can be supplied to wflow via CSV files supplied in the same folder of the TOML file. Naming of the files uses the ID of the lakes where data are available and is of the form lake_sh_1.csv and lake_hq_1.csv for respectively the storage and rating curves of lake with ID 1.","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"The storage curve is stored in a CSV file with lake level [m] in the first column H and corresponding lake storage [m ^3] in the second column S:","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"H,  S\n392.21, 0\n393.21, 430202000\n393.71, 649959000\n394.21, 869719000","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"The rating curve uses level and discharge data depending on the Julian day of the year (JDOY), and can be also used for regulated lakes/ dams. The first line contains H for the first column. The other lines contain the water level and the corresponding discharges for the different JDOY (1-365), see also the example below, that shows part of a CSV file (first 4 Julian days). The volume above the maximum water level of the rating curve is assumed to flow instantaneously out of the lake (overflow).","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"H\n394,    43,     43,     43,     43\n394.01, 44.838, 44.838, 44.838, 44.838\n394.02, 46.671, 46.671, 46.671, 46.671\n394.03, 48.509, 48.509, 48.509, 48.509\n394.04, 50.347, 50.347, 50.347, 50.347\n394.05, 52.179, 52.179, 52.179, 52.179","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Linked lakes: In some cases, lakes can be linked and return flow can be allowed from the downstream to the upstream lake. The linked lakes are defined in the linkedlakelocs parameter that represent the downstream lake location ID, at the grid cell of the upstream lake location.","category":"page"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"note: Note\nIn every file, level units are meters [m] above lake bottom and not meters above sea level [m asl]. Especially with storage/rating curves coming from data, please be careful and convert units if needed.","category":"page"},{"location":"model_docs/lateral/waterbodies/#References","page":"Reservoirs and Lakes","title":"References","text":"","category":"section"},{"location":"model_docs/lateral/waterbodies/","page":"Reservoirs and Lakes","title":"Reservoirs and Lakes","text":"Bos M.G., 1989. Discharge measurement structures. Third revised edition, International Institute for Land Reclamation and Improvement ILRI, Wageningen, The Netherlands.\nBurek P., Van der Knijf J.M., Ad de Roo, 2013. LISFLOOD – Distributed Water Balance and flood Simulation Model – Revised User Manual. DOI: http://dx.doi.org/10.2788/24719.","category":"page"},{"location":"model_docs/vertical/flextopo/#vert_flextopo","page":"FLEXTopo","title":"FLEXTopo","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/#Introduction","page":"FLEXTopo","title":"Introduction","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"This section describes the different vertical processes available as part of the vertical FLEXTopo concept. This concept is part of the wflow_flextopo model. The FLEXTopo model is a process-based model, which consists of different parallel classes connected through their groundwater storage. These classes are usually delineated from topographical data to represent the variability in hydrological processes across user-defined Hydrological Response Units (HRU). The main assumption underlying the concept, which was first introduced by Savenije (2010), is that different parts of the landscape fulfill different tasks in runoff generation and, hence, can be represented by different model structures. Commonly used classes include hillslopes, plateau and wetlands. Hillslopes are steep areas in a catchment and are generally forested. The dominant runoff process in hillslopes is assumed to be characterized by subsurface flow. Plateaus are defined as relatively flat and are relatively high above the stream, with deep groundwater levels. Depending on the specific conditions, the dominant runoff processes are groundwater recharge, quick subsurface flow and hortonian overland flow, which is especially important in agricultural areas. Saturation overland flow and capillary rise are the dominant processes on the riparian wetland class, where groundwater levels are shallow and assumed to rise quickly during an event. The strength of the concept is that the definition of classes and associated model structures is modular and flexible and not constrained by a predefined fixed model structure. The flexible approach allows to develop process-based models for different topographic, climatic, geologic and land use conditions, making use of the available data and expert knowledge. The FLEXTopo modeling approach has been applied in a lumped and distributed way in various applications across the globe (Gao et al., 2014; Euser et al., 2015; Hanus et al., 2021; Hrachowitz et al. 2021; Hulsman et al. 2021; Bouaziz et al., 2022).","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The wflow_flextopo model is set-up in a modular way, implying that the user is free to determine the number of classes and which processes and/or parameters to include or exclude for each class. For each cell in the model domain, the percentage of each class in the cell is provided by the user in the staticmaps. The most complete model structure implemented in wflow_flextopo is shown in the figure below. However, it is also possible to bypass each bucket or to deactivate processes through parameter values (see FLEXTopo configuration). It is also possible for users to contribute to the code by adding different conceptualizations for the different storages. When defining several classes, the model structures for each class are implemented in parallel, except for the common glacier, snow and groundwater processes, which are not class specific. An example of a three classes model is also shown in the Figure below.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"(Image: flextopo_julia_1class.png) Schematic representation of the FLEXTopo model for a single class model including all storages and fluxes. Main parameters are denoted in red.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"(Image: flextopo_julia_3class.png) Example of a three class model with different model structure configurations per class","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The descriptions below of each of the FLEXTopo model components are given for the most complete model structure with the symbols as shown in the schematic representation of the one class model in the Figure above. By bypassing storages and/or setting parameters to specific values, the model structure can be adapted to a user-defined model structure.","category":"page"},{"location":"model_docs/vertical/flextopo/#Snow","page":"FLEXTopo","title":"Snow","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The snow model is described in Snow and glaciers.","category":"page"},{"location":"model_docs/vertical/flextopo/#Glaciers","page":"FLEXTopo","title":"Glaciers","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Glacier processes are described in Snow and glaciers. Glacier modelling is enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"[model]\nglacier = true","category":"page"},{"location":"model_docs/vertical/flextopo/#Correction-factors-for-forcing-data","page":"FLEXTopo","title":"Correction factors for forcing data","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The e_mathrmcorr and p_mathrmcorr model parameters can be used to adjust the potential evaporation and precipitation, respectively.","category":"page"},{"location":"model_docs/vertical/flextopo/#Interception","page":"FLEXTopo","title":"Interception","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"After the snow module, rainfall P_mathrmR [mm t^-1] and snowmelt P_mathrmM [mm t^-1] enter the interception storage S_mathrmI [mm]. The maximum interception storage is defined by the I_mathrmmax [mm] parameter for each class. Interception evaporation E_mathrmI [mm t^-1] occurs at potential rate E_mathrmP [mm t^-1] as long as there is enough water in the interception storage. Effective precipitation P_mathrmE [mm t^-1] flows out of the interception store when the storage capacity is exceeded.  Interception evaporation is subtracted from potential evaporation to ensure total evaporation does not exceed potential evaporation.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The following equations apply:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmImathrmdt = (P_mathrmR + P_mathrmM) - E_mathrmI - P_mathrmE","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    P_mathrmE = mathrmmax(0 (S_mathrmI - I_mathrmmax)mathrmdt)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    E_mathrmI = mathrmmin(E_mathrmP S_mathrmImathrmdt)","category":"page"},{"location":"model_docs/vertical/flextopo/#Hortonion-ponding-and-runoff","page":"FLEXTopo","title":"Hortonion ponding and runoff","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Hortonian overland flow processes are represented by a combination of two storages: a horton ponding storage S_mathrmHp [mm] and a runoff generating storage S_mathrmHf [mm]. This conceptualization was introduced by de Boer-Euser (2017) and included in the plateau class to represent hortonian overland flow (infiltration excess overland flow) in agricultural fields. When the storage capacity of the ponding storage is exceeded, runoff Q_mathrmH [mm t^-1] is generated that enters the horton runoff storage. The horton runoff generating storage is included to slightly smooth the precipitation signal. However, the response time of the runoff generation storage K_mathrmHf [t^-1] is very short to generate fast runoff Q_mathrmHf [mm t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Effective precipitation P_mathrmE [mm t^-1] from the interception module enters the horton ponding storage, which has a maximum storage capacity S_mathrmHmax [mm]. When the inflow exceeds the storage capacity, direct runoff is generated Q_mathrmHdirect [mm t^-1] and net infiltration in the horton ponding storage is denoted as Q_mathrmHinnet [mm t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Evaporation from the horton ponding storage E_mathrmH [mm t^-1]  is based on a simple formulation to express water stress. The equation describes how actual evaporation is linearly reduced when the relative horton ponding storage overlineS_mathrmHp [-] is below a certain threshold L_mathrmP [-] parameter.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"A beta function with parameter beta [-] is used to split the net infiltrating water to storage and to runoff Q_mathrmH [mm t^-1], to which is added the direct runoff Q_mathrmHdirect [mm t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The shape of the beta function for various values of beta [-] is shown below:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    using Printf\n    using CairoMakie","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[1, 1], xlabel = \"S/Smax [-]\", ylabel = \"Fraction of runoff [-]\")      # hide\n        x = 0:0.01:1                                                                        # hide\n        betas = [0.3, 1.0, 3.0]                                                             # hide\n        for beta in betas                                                                   # hide\n            lines!(ax, x, (1 .- (1 .- x).^beta), label = @sprintf(\"beta = %.1f\", beta))     # hide\n        end                                                                                 # hide\n        Legend(fig[1, 2], ax, \"beta\")                                                       # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Additionally, water infiltrates from the horton ponding storage to the root zone storage (Q_mathrmHR [mm t^-1]), based on a formulation using a maximum infiltration capacity F_mathrmmax [mm t^-1] and a decay coefficient F_mathrmdec [-].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The maximum storage capacity of the horton ponding storage is reduced when soils are likely to be frozen S_mathrmHmaxfrost [mm], i.e. during periods when the temperature is below zero for several consecutive days.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The following equations apply for the Horton ponding storage S_mathrmHp [mm]:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmHpmathrmdt = P_mathrmE - E_mathrmH  - Q_mathrmH - Q_mathrmHR","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The constitutive equations are:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmHdirect=mathrmmax((S_mathrmHp+P_mathrmES_mathrmHmax)00)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmHinnet = P_mathrmE  Q_mathrmHdirect","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    overlineS_mathrmHp = S_mathrmHpS_mathrmHmax","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    E_mathrmH = mathrmmin ( (E_mathrmP - E_mathrmI) cdot mathrmmin(overlineS_mathrmHpL_mathrmP1) S_mathrmHpmathrmdt  )","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmH = Q_mathrmHinnet cdot (1-(1-overlineS_mathrmHp)^beta)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmHR = F_mathrmmax cdot mathrmexp(-F_mathrmdec cdot overlineS_mathrmHp)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The reduction of the storage capacity of the horton ponding storage during frozen soil conditions is calculated following the equations provided by de Boer-Euser (2017):","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    S_mathrmHmaxfrost = F_mathrmT cdot S_mathrmHmax","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"with:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"F_mathrmT =\n    begincases\n      S_mathrmHmin  textif F_mathrmaccfr  F_mathrmaccfr0\n      fracF_mathrmaccF_mathrmaccfr1 - F_mathrmaccfr0 - fracF_mathrmaccfr0F_mathrmaccfr1 - F_mathrmaccfr0   textif  F_mathrmaccfr0 le F_mathrmaccfr le F_mathrmaccfr1\n      1  textif F_mathrmaccfr  F_mathrmaccfr1\n    endcases","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"where S_mathrmHmin [-], F_mathrmaccfr0 [degree t], F_mathrmaccfr1 [degree t] and K_mathrmmf [-] are all model parameters to describe: a coefficient to reduce S_mathrmHmax to a minimum storage capacity, the minimum and maximum modelled accumulated frost and a melt coefficient for the frozen topsoil, respectively.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The following equations apply for the Horton fast runoff storage S_mathrmHf [mm]:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmHfmathrmdt = Q_mathrmH - Q_mathrmHf","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmHf = K_mathrmHf^-1 cdot S_mathrmHf","category":"page"},{"location":"model_docs/vertical/flextopo/#Root-zone-soil-moisture","page":"FLEXTopo","title":"Root zone soil moisture","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The incoming water from the interception and hortonian routines Q_mathrmHR [mm t^-1] enters the root zone storage S_mathrmR [mm]. The root zone storage has a maximum capacity S_mathrmRmax [mm], which represents the volume of water in the unsaturated root zone, which is available to the roots of vegetation for transpiration. Abundant water which exceeds the capacity of the root zone storage cannot infiltrate and becomes directly available for runoff Q_mathrmRdirect [mm t^-1]. The net infiltration in the root zone storage is denoted as Q_mathrmRinnet [mm t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"A simple formulation to express water stress is used to calculate evaporation E_mathrmR [mm t^-1] from the root zone storage. The equation describes how actual evaporation is linearly reduced when the relative root zone storage overlineS_mathrmR [-] is below a certain threshold L_mathrmP [-] parameter.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Next, a beta function with parameter beta [-] describes the partitioning of incoming water to the root zone storage and to runoff Q_mathrmR [mm t^-1]. The water that leaves the root zone storage is partitioned into the fast storage and through preferential recharge to the slow storage, based on a splitter parameter d_mathrms [-].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Water may also leave the root zone storage through percolation to the slow groundwater Q_mathrmperc [mm t^-1] or enter the root zone storage from the slow groundwater through capillary rise Q_mathrmcap [mm t^-1], based on a maximum percolation parameter Q_mathrmpercmax [mm t^-1] and a maximum capillary rise flux parameter Q_mathrmcapmax [mm t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The water balance equation for the root zone storage is:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmRmathrmdt = Q_mathrmHR - E_mathrmR  - Q_mathrmR - Q_mathrmperc + Q_mathrmcap","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The constitutive equations are:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmRdirect=mathrmmax((S_mathrmR+Q_mathrmHRS_mathrmRmax)00)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmRinnet = Q_mathrmHR  Q_mathrmRdirect","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    overlineS_mathrmR = S_mathrmRS_mathrmRmax","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    E_mathrmR = mathrmmin ( (E_mathrmP - E_mathrmI - E_mathrmH) cdot mathrmmin(overlineS_mathrmRL_mathrmP1) S_mathrmRmathrmdt  )","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmR = Q_mathrmRinnet cdot (1-(1-overlineS_mathrmR)^beta)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmperc = Q_mathrmpercmax cdot overlineS_mathrmR","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmcap = Q_mathrmcapmax cdot (1 - overlineS_mathrmR)","category":"page"},{"location":"model_docs/vertical/flextopo/#Fast-storage-and-runoff","page":"FLEXTopo","title":"Fast storage and runoff","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The outflow from the root zone storage Q_mathrmR [mm t^-1] is split with the splitter parameter d_mathrms [-] into inflow in the fast storage Q_mathrmRF [mm t^-1] and inflow in the slow storage Q_mathrmRS [mm t^-1] to represent preferential recharge. The fast runoff storage S_mathrmF [mm] generates fast runoff Q_mathrmF [mm t^-1] through a simple non-linear equation with a recession constant K_mathrmF [t^-1] and an exponent alpha [-].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The following equations apply:","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmFmathrmdt = Q_mathrmRF - Q_mathrmF","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmRF = Q_mathrmR cdot (1-d_mathrms)","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmF = K_mathrmF^-1 cdot S_mathrmF^alpha","category":"page"},{"location":"model_docs/vertical/flextopo/#Common-slow-groundwater-storage-and-runoff","page":"FLEXTopo","title":"Common slow groundwater storage and runoff","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"The slow groundwater storage S_mathrmS [mm] is a shared storage for all the different classes. It is filled through preferential recharge from the outflow of the root zone storage Q_mathrmRS [mm t^-1] and through percolation Q_mathrmperc [mm t^-1]. It empties through capillary rise Q_mathrmcap [mm t^-1] and through a linear outflow Q_mathrmS [mm t^-1] with recession timescale coefficient K_mathrmS [t^-1].","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Total streamflow Q_mathrmTOT [mm t^-1] is the weighted sum of the horton fast runoff and the fast runoff from the different classes based on the fraction of each class in a cell F_mathrmhrufrac [-] and the slow runoff, which is then routed downstream along the river network through the kinematic wave.","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    mathrmdS_mathrmSmathrmdt = Q_mathrmRS + Q_mathrmperc - Q_mathrmS - Q_mathrmcap","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmRS = Q_mathrmR cdot d_mathrms","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"    Q_mathrmS = K_mathrmS^-1 cdot S_mathrmS","category":"page"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"Q_mathrmTOT =  Q_mathrmS + sum_class=1^n (Q_mathrmFclass + Q_mathrmHfclass) cdot F_mathrmhrufracclass","category":"page"},{"location":"model_docs/vertical/flextopo/#References","page":"FLEXTopo","title":"References","text":"","category":"section"},{"location":"model_docs/vertical/flextopo/","page":"FLEXTopo","title":"FLEXTopo","text":"de Boer-Euser, T. (2017). Added value of distribution in rainfall-runoff models for the Meuse basin  PhD thesis, Delft University of Technology. https://doi.org/10.4233/uuid:89a78ae9-7ffb-4260-b25d-698854210fa8\nBouaziz, L. J. E., Aalbers, E. E., Weerts, A. H., Hegnauer, M., Buiteveld, H., Lammersen, R., Stam, J., Sprokkereef, E., Savenije, H. H. G., and Hrachowitz, M. (2022)   Ecosystem adaptation to climate change: the sensitivity of hydrological predictions to time-dynamic model parameters,   Hydrol. Earth Syst. Sci., 26, 1295–1318, https://doi.org/10.5194/hess-26-1295-2022\nEuser, T., Hrachowitz, M., Winsemius, H. C., & Savenije, H. H. G. (2015).   The effect of forcing and landscape distribution on performance and consistency of model structures.   Hydrological Processes, 29(17), 3727–3743. https://doi.org/10.1002/hyp.10445\nGao, H., Hrachowitz, M., Fenicia, F., Gharari, S., & Savenije, H. H. G. (2014).   Testing the realism of a topography-driven model (FLEX-Topo) in the nested catchments of the Upper Heihe, China.   Hydrology and Earth System Sciences, 18(5), 1895–1915. https://doi.org/10.5194/hess-18-1895-2014\nHanus, S., Hrachowitz, M., Zekollari, H., Schoups, G., Vizcaino, M., and Kaitna, R. (2021)   Future changes in annual, seasonal and monthly runoff signatures in contrasting Alpine catchments in Austria,   Hydrol. Earth Syst. Sci., 25, 3429–3453, https://doi.org/10.5194/hess-25-3429-2021\nHrachowitz, M., Stockinger, M., Coenders-Gerrits, M., van der Ent, R., Bogena, H., Lücke, A., and Stumpp, C. (2021)   Reduction of vegetation-accessible water storage capacity after deforestation affects catchment travel time distributions   and increases young water fractions in a headwater catchment, Hydrol. Earth Syst. Sci., 25, 4887–4915, https://doi.org/10.5194/hess-25-4887-2021\nHulsman, P., Savenije, H. H. G., & Hrachowitz, M. (2021). Learning from satellite observations:   Increased understanding of catchment processes through stepwise model improvement.   Hydrology and Earth System Sciences, 25(2), 957–982. https://doi.org/10.5194/hess-25-957-2021\nSavenije, H. H. G. (2010). HESS opinions “topography driven conceptual modelling (FLEX-Topo).”   Hydrology and Earth System Sciences, 14(12), 2681–2692. https://doi.org/10.5194/hess-14-2681-2010","category":"page"},{"location":"user_guide/intro/#About-the-user-guide","page":"About the user guide","title":"About the user guide","text":"","category":"section"},{"location":"user_guide/intro/","page":"About the user guide","title":"About the user guide","text":"The purpose of this user guide is to describe the steps to install the wflow julia software and to set up a simple model. The user guide also contains a step-wise process how to configure your model using the TOML file (model settings) and the netCDF gridded datasets.","category":"page"},{"location":"user_guide/intro/","page":"About the user guide","title":"About the user guide","text":"Sample data and model set up is also included for the Moselle River Basin (a major tributary of the Rhine River), which can be used to explore the model software. The model is set up for the wflow_sbm, wflow_hbv and wflow_sediment model concepts.","category":"page"},{"location":"user_guide/intro/","page":"About the user guide","title":"About the user guide","text":"Finally, information is provided on setting up your own model, including building a model from scratch or alternatively using Deltares HydroMT model building tools which are open source.","category":"page"},{"location":"model_docs/lateral/kinwave/#kin_wave","page":"Kinematic wave","title":"Kinematic wave","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/#Surface-routing","page":"Kinematic wave","title":"Surface routing","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The main flow routing scheme available in Wflow.jl is the kinematic wave approach for channel and overland flow, assuming that the topography controls water flow mostly. The kinematic wave equations are (Chow, 1988):","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"  dfracdQdx + dfracdAdt = q \n   A = alpha Q^beta","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"These equations can then be combined as a function of streamflow only:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    dfracdQdx + alpha beta Q^beta - 1 dfracdQdt = q","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where Q is the surface runoff in the kinematic wave [m^3/s], x is the length of the runoff pathway [m], A is the cross-section area of the runoff pathway [m^2], t is the integration timestep [s] and alpha and beta are coefficients.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"These equations are solved with a nonlinear scheme using Newton's method and can also be iterated depending on the  model space and time resolution. By default, the iterations are performed until a stable solution is reached (epsilon  10^-12). For larger models, the number of iterations can also be fixed for to a specific sub-timestep (in seconds) for both overland and channel flows to improve simulation time. To enable (fixed or not) iterations of the kinematic wave the following lines can be inserted in the TOML file of the model:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\n# Enable iterations of the kinematic wave\nkin_wave_iteration = true\n# Fixed sub-timestep for iterations of channel flow (river cells)\nkw_river_tstep = 900\n# Fixed sub-timestep for iterations of overland flow (land cells)\nkw_land_tstep = 3600","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The alpha parameter of the kinematic wave is fixed. To estimate the wetted perimeter for the calculation of the alpha parameter a bankfull river depth map (default value is 1.0 m) for the river can be provided as follows:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input.lateral.river]\nbankfull_depth = \"wflow_riverdepth\"","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The wetted perimeter of the river is based on half bankfull river depth. For the land part the wetted perimeter is based on the flow width.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Simplified reservoir and lake models can be included as part of the river kinematic wave network.","category":"page"},{"location":"model_docs/lateral/kinwave/#Inflow","page":"Kinematic wave","title":"Inflow","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"External water (supply/abstraction) inflow [m^3 s^-1]  can be added to the kinematic wave for surface water routing, as a cyclic parameter or as part of forcing (see also Input section).","category":"page"},{"location":"model_docs/lateral/kinwave/#Abstractions","page":"Kinematic wave","title":"Abstractions","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Abstractions from the river through the variable abstraction [m^3 s-1] are possible when water demand and allocation is computed. The variable abstraction is set from the water demand and allocation module each time step. The abstraction is divided by the length of the runoff pathway and subtracted from the lateral inflow of the kinematic wave routing scheme for river flow.","category":"page"},{"location":"model_docs/lateral/kinwave/#Subsurface-flow-routing","page":"Kinematic wave","title":"Subsurface flow routing","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"In the SBM model the kinematic wave approach is used to route subsurface flow laterally. Different vertical hydraulic conductivity depth profiles are possible as part of the vertical SBM concept, and these profiles (after unit conversion) are also used to compute lateral subsurface flow. The following profiles (see SBM for a detailed description) are available:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"exponential (default)\nexponential_constant\nlayered\nlayered_exponential ","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"For the profiles exponential and exponential_constant, the saturated store S is drained laterally by saturated downslope subsurface flow for a slope with width w [m] according to:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    Q = begincases\n    fracK_0tan(beta)fleft(e^(-fz_i)-e^(-fz_mathrmexp)right) w + \n    K_0e^(-fz_mathrmexp)(z_t-z_mathrmexp)tan(beta) w  textif z_i  z_mathrmexp\n    \n    K_0e^(-fz_mathrmexp)(z_t - z_i)tan(beta) w  textif z_i ge z_mathrmexp\n    endcases","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where beta is element slope angle, Q is subsurface flow [m^3 d^-1], K_0 is the saturated hydraulic conductivity at the soil surface [m d^-1], z_i is the water table depth [m], z_t is the total soil depth [m], f is a scaling parameter [m^-1] that controls the decrease of K_0 with depth and z_mathrmexp [m] is the depth from soil surface for which the exponential decline of K_0 is valid. For the exponential profile, z_mathrmexp is equal to z_t.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Combining with the following continuity equation:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    (theta_s-theta_r)wfracpartial hpartial t = -fracpartial Qpartial x + wr","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where h is the water table height [m], x is the distance downslope [m], and r is the net input rate [m d^-1] to the saturated store. Substituting for h (fracpartial Qpartial h), gives:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"  fracpartial Qpartial t = -cfracpartial Qpartial x + cwr","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"where celerity c is calculated as follows:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    c = begincases\n    fracK_0e^(-fz_i)tan(beta)(theta_s-theta_r) \n    + fracK_0e^(-fz_mathrmexp)tan(beta)(theta_s-theta_r)   textif z_i  z_mathrmexp\n    \n    fracK_0e^(-fz_mathrmexp)tan(beta)(theta_s-theta_r)  textif z_i ge z_mathrmexp\n    endcases","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"For the layered and layered_exponential profiles the equivalent horizontal hydraulic conductivity K_h [m d^-1] is calculated for water table height h = z_t-z_i [m], and lateral subsurface flow is calculated as follows:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"  Q = K_h h tan(beta) w","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"and celerity c is given by:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"    c = fracK_h tan(beta)(theta_s-theta_r)","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave equation for lateral subsurface flow is solved iteratively using Newton's method.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"note: Note\nFor the lateral subsurface flow kinematic wave the model timestep is not adjusted. For certain model timestep and model grid size combinations this may result in loss of accuracy.","category":"page"},{"location":"model_docs/lateral/kinwave/#Multi-Threading","page":"Kinematic wave","title":"Multi-Threading","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave calculations for surface - and subsurface flow routing can be executed in parallel using multiple threads. In the model section of the TOML file, a minimum stream order can be provided to define subbasins for the river (default is 6) and land domain (default is 5). Subbasins are created at all confluences where each branch has a minimal stream order. Based on the subbasins a directed acyclic graph is created that controls the order of execution and which subbasins can run in parallel.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[model]\nmin_streamorder_river = 5 # minimum stream order to delineate subbasins for river domain, default is 6\nmin_streamorder_land = 4  # minimum stream order to delineate subbasins for land domain, default is 5","category":"page"},{"location":"model_docs/lateral/kinwave/#Subcatchment-flow","page":"Kinematic wave","title":"Subcatchment flow","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Normally the the kinematic wave is continuous throughout the model. By using the pits entry in the model and input sections of the TOML file all flow is at the subcatchment only (upstream of the pit locations, defined by the netCDF variable wflow_pits in the example below) and no flow is transferred from one subcatchment to another. This can be convenient when connecting the result of the model to a water allocation model such as Ribasim.","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"[input]\n# these are not directly part of the model\npits = \"wflow_pits\"\n\n[model]\npits = true","category":"page"},{"location":"model_docs/lateral/kinwave/#Limitations","page":"Kinematic wave","title":"Limitations","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"The kinematic wave approach for channel, overland and lateral subsurface flow, assumes that the topography controls water flow mostly. This assumption holds for steep terrain, but in less steep terrain the hydraulic gradient is likely not equal to the surface slope (subsurface flow), or pressure differences and inertial momentum cannot be neglected (channel and overland flow). In addition, while the kinematic wave equations are solved with a nonlinear scheme using Newton's method (Chow, 1988), other model equations are solved through a simple explicit scheme. In summary the following limitations apply:","category":"page"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Channel flow, and to a lesser degree overland flow, may be unrealistic in terrain that is not steep, and where pressure forces and inertial momentum are important.\nThe lateral movement of subsurface flow may be very wrong in terrain that is not steep.","category":"page"},{"location":"model_docs/lateral/kinwave/#External-inflows","page":"Kinematic wave","title":"External inflows","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"External inflows, for example water supply or abstractions, can be added to the kinematic wave via the inflow variable. For this, the user can supply a 2D map of the inflow, as a cyclic parameter or as part of forcing (see also Input section). These inflows are added or abstracted from the upstream inflow qin before running the kinematic wave to solve the impact on resulting q. In case of a negative inflow (abstractions), a minimum of zero is applied to the upstream flow qin.","category":"page"},{"location":"model_docs/lateral/kinwave/#References","page":"Kinematic wave","title":"References","text":"","category":"section"},{"location":"model_docs/lateral/kinwave/","page":"Kinematic wave","title":"Kinematic wave","text":"Chow, V., Maidment, D. and Mays, L., 1988, Applied Hydrology. McGraw-Hill Book Company, New York.","category":"page"},{"location":"model_docs/structures/#Julia-structures","page":"Julia structures","title":"Julia structures","text":"","category":"section"},{"location":"model_docs/structures/#Model","page":"Julia structures","title":"Model","text":"","category":"section"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"Below the composite type that represents all different aspects of a Wflow.Model, such as  the network, parameters, clock, model type, configuration and input and output.","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"struct Model{N,L,V,R,W,T}\n    config::Config  # all configuration options\n    network::N      # connectivity information, directed graph\n    lateral::L      # lateral model that holds lateral state, moves along network\n    vertical::V     # vertical model that holds vertical state, independent of each other\n    clock::Clock    # to keep track of simulation time\n    reader::R       # provides the model with dynamic input\n    writer::W       # writes model output\n    type::T         # model type\nend","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"The lateral field of the struct Model can contain different lateral concepts. For each wflow model these different lateral concepts are mapped through the use of a NamedTuple. The vertical field of the struct Model always contains one vertical concept, for example the SBM or HBV vertical concept.","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"Below an example how lateral concepts are mapped for the SBM model through a NamedTuple:","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"(subsurface = ssf, land = olf, river = rf)","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"The subsurface part is mapped to the lateral subsurface flow kinematic wave concept, the land part is mapped the overland flow kinematic wave concept and the river part is mapped to the river flow kinematic wave concept. Knowledge of this specific mapping is required to understand and correctly set input, output and state variables in the TOML configuration file, see also Config and TOML. This mapping is described in more detail for each model in the section Models. Also the struct of each mapped concept is provided, so one can check the internal variables in the code. These structs are defined as a parametric composite type, with type parameters between curly braces after the struct name. See also the next paragraph Vertical and lateral models for a more detailed description.","category":"page"},{"location":"model_docs/structures/#Vertical-and-lateral-models","page":"Julia structures","title":"Vertical and lateral models","text":"","category":"section"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"The different model concepts used in wflow are defined as parametric composite types. For example the vertical SBM concept is defined as follows: struct SBM{T,N,M}. T, N and M between curly braces after the struct name refer to type parameters, for more information about type parameters you can check out Type parameters. Since these parameters can be of any type, it is possible to declare an unlimited number of composite types. The type parameters are used to set the type of struct fields, below an example with a part of the SBM struct:","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"@get_units @with_kw struct SBM{T,N,M}\n    # Model time step [s]\n    dt::T | \"s\"\n    # Maximum number of soil layers\n    maxlayers::Int | \"-\"\n    # number of cells\n    n::Int | \"-\"\n    # Number of soil layers\n    nlayers::Vector{Int} | \"-\"\n    # Number of unsaturated soil layers\n    n_unsatlayers::Vector{Int} | \"-\"\n    # Fraction of river [-]\n    riverfrac::Vector{T} | \"-\"\n    # Saturated water content (porosity) [mm mm⁻¹]\n    theta_s::Vector{T} | \"mm mm-1\"\n    # Residual water content [mm mm⁻¹]\n    theta_r::Vector{T} | \"mm mm-1\"\n    # Vertical hydraulic conductivity [mm Δt⁻¹] at soil surface\n    kv_0::Vector{T} | \"mm dt-1\"\n    # Muliplication factor [-] applied to kv_z (vertical flow)\n    kvfrac::Vector{SVector{N,T}} | \"-\"","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"The type parameter T is used in wflow as a subtype of AbstractFloat, allowing to store fields with a certain floating point precision (e.g. Float64 or Float32) in a flexible way. N refers to the maximum number of soil layers of the SBM soil column, and M refers to the maximum number of soil layers + 1. See also part of the following instance of SBM:","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"sbm = SBM{Float,maxlayers,maxlayers + 1}(\n    dt = tosecond(dt),\n    maxlayers = maxlayers,\n    n = n,","category":"page"},{"location":"model_docs/structures/","page":"Julia structures","title":"Julia structures","text":"For the other model concepts, we refer to the code to check these type parameters.","category":"page"},{"location":"model_docs/vertical/hbv/#vert_hbv","page":"HBV","title":"HBV","text":"","category":"section"},{"location":"model_docs/vertical/hbv/#Introduction","page":"HBV","title":"Introduction","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"This section describes the different vertical processes available as part of the vertical HBV concept. This concept is part of the wflow_hbv model.","category":"page"},{"location":"model_docs/vertical/hbv/#Snow","page":"HBV","title":"Snow","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The snow model is described in Snow and glaciers.","category":"page"},{"location":"model_docs/vertical/hbv/#Glaciers","page":"HBV","title":"Glaciers","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Glacier processes are described in Snow and glaciers. Glacier modelling is enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"[model]\nglacier = true","category":"page"},{"location":"model_docs/vertical/hbv/#Potential-Evaporation","page":"HBV","title":"Potential Evaporation","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The cevpf model parameter is used to adjust the potential evaporation based on land use. In the original HBV version cevpfo is used, a factor for forest land use only.","category":"page"},{"location":"model_docs/vertical/hbv/#Interception","page":"HBV","title":"Interception","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"For interception storage a single icf parameter is used according to the land use. In this implementation interception evaporation is subtracted to ensure total evaporation does not exceed potential evaporation. From this storage evaporation equal to the potential evaporation rate will occur as long as water is available, even if it is stored as snow. All water enters this store first, there is no concept of free throughfall (e.g. through gaps in the canopy). In the model a running water budget is kept of the interception store:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The available storage (icf- actual storage) is filled with the water coming from the snow routine (Q_in)\nAny surplus water now becomes the new Q_in\nInterception evaporation is determined as the minimum of the current interception storage and the potential evaporation","category":"page"},{"location":"model_docs/vertical/hbv/#The-soil-routine","page":"HBV","title":"The soil routine","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The incoming water from the snow and interception routines, Q_in, is available for infiltration in the soil routine. The soil layer has a limited capacity, fc, to hold soil water, which means if fc is exceeded the abundant water cannot infiltrate and, consequently, becomes directly available for runoff.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    Q_dr=max((SM+Q_infc)00)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where Q_dr is the abundant soil water (also referred to as direct runoff) and SM is the soil moisture content. Consequently, the net amount of water that infiltrates into the soil, I_net, equals:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"I_net = Q_in  Q_dr","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Part of the infiltrating water, I_net, will runoff through the soil layer (seepage). This runoff volume, SP, is related to the soil moisture content, SM, through the following power relation:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"SP = left(fracSMfcright)^beta I_net","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where beta is an empirically based parameter. Application of this equation implies that the amount of seepage water increases with increasing soil moisture content. The fraction of the infiltrating water which does not runoff, I_netSP, is added to the available amount of soil moisture, SM. The beta parameter affects the amount of supply to the soil moisture reservoir that is transferred to the quick response reservoir. Values of beta vary generally between 1 and 3. Larger values of beta reduce runoff and indicate a higher absorption capacity of the soil.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"(Image: hbv-soilmoist.png)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Schematic view of the soil moisture routine","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"A percentage of the soil moisture will evaporate. This percentage is related to the potential evaporation and the available amount of soil moisture:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    E_a = fracSMT_m E_p    SMT_m \n    E_a = E_p    SM geq T_m","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where E_a is the actual evaporation, E_p is the potential evaporation and T_m (leq fc) is a user defined threshold, above which the actual evaporation equals the potential evaporation. T_m is defined as LP * fc in which LP is a soil dependent evaporation factor (LPleq 1).","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"In the original model (Bergström, 1992), a correction to E_a is applied in case of interception. If E_a from the soil moisture storage plus E_i exceeds ET_pE_i (E_i = interception evaporation) then the exceeding part is multiplied by a factor (1-e_red), where the parameter e_red varies between 0 and 1. This correction is not present in the wflow_hbv model.","category":"page"},{"location":"model_docs/vertical/hbv/#The-runoff-response-routine","page":"HBV","title":"The runoff response routine","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The volume of water which becomes available for runoff, S_dr+SP, is transferred to the runoff response routine. In this routine the runoff delay is simulated through the use of a number of linear reservoirs.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Two linear reservoirs are defined to simulate the different runoff processes: the upper zone (generating quick runoff and interflow) and the lower zone (generating slow runoff). The available runoff water from the soil routine (i.e. direct runoff, S_dr, and seepage, SP) in principle ends up in the lower zone, unless the percolation threshold, PERC, is exceeded, in which case the redundant water ends up in the upper zone:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Delta V_LZ=min(PERC(S_dr+SP)) \nDelta V_UZ=max(00(S_dr+SPPERC))","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where V_UZ is the content of the upper zone, V_LZ is the content of the lower zone.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Capillary flow from the upper zone to the soil moisture reservoir is modeled according to:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Q_cf=cflux  (fcSM)fc","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where cflux is the maximum capillary flux [mm day^-1].","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The upper zone generates quick runoff (Q_q) using:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Q_q=K  UZ^(1+alpha)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where K is the upper zone recession coefficient, and alpha determines the amount of non-linearity. Within HBV-96, the value of K is determined from three other parameters: alpha, KHQ, and HQ [mm day^-1]. The value of HQ represents an outflow rate of the upper zone for which the recession rate is equal to KHQ. If we define UZ_HQ to be the content of the upper zone at outflow rate HQ we can write the following equation:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    HQ=K cdot UZ^(1+alpha) = KHQ cdot UZ_HQ","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"If we eliminate UZ_HQ we obtain:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    HQ = K left(fracHQKHQright)^(1+alpha)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Rewriting for K results in:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    K = KQH^(1alpha) HQ^alpha","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The lower zone is a linear reservoir, which means the rate of slow runoff, Q_LZ, which leaves this zone during one time step equals:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Q_LZ = K_LZ  V_LZ","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"where K_LZ is the reservoir constant.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The upper zone is also a linear reservoir, but it is slightly more complicated than the lower zone because it is divided into two zones: a lower part in which interflow is generated and an upper part in which quick flow is generated.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"(Image: hbv-upper)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Schematic view of the upper zone","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"If the total water content of the upper zone, V_UZ is lower than a threshold UZ1, the upper zone only generates interflow. On the other hand, if V_UZ exceeds UZ1, part of the upper zone water will runoff as quick flow:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    Q_i = K_i min(UZ1V_uz)\n    Q_q = K_q max((V_UZUZ1)00)","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Where Q_i is the amount of generated interflow in one time step, Q_q is the amount of generated quick flow in one time step and K_i and K_q are reservoir constants for interflow and quick flow respectively.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The total runoff rate, Q, is equal to the sum of the three different runoff components:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    Q = Q_LZ+Q_i+Q_q","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"The runoff behavior in the runoff response routine is controlled by two threshold values P_m and UZ1 in combination with three reservoir parameters, K_LZ, K_i and K_q.","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"In order to represent the differences in delay times between the three runoff components, the reservoir constants have to meet the following requirement:","category":"page"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"    K_LZK_iK_q","category":"page"},{"location":"model_docs/vertical/hbv/#References","page":"HBV","title":"References","text":"","category":"section"},{"location":"model_docs/vertical/hbv/","page":"HBV","title":"HBV","text":"Bergström, S., 1992, The HBV model–its structure and applications, SMHI Reports RH 4, Norrköping.","category":"page"},{"location":"intro/use_cases/#Case-studies","page":"Case studies","title":"Case studies","text":"","category":"section"},{"location":"intro/use_cases/#case_rws","page":"Case studies","title":"Wflow models for the Meuse and Rhine","text":"","category":"section"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"Reliable hydrological models for the Rhine and the Meuse river basin are necessary for short-term forecasting of river flows and long-term predictions for strategic water management planning. In collaboration with Rijkswaterstaat, Deltares is setting up a new line of models for the Rhine and the Meuse basins. The models will be used for forecasting and to estimate the impact of climate change on water resources and extreme streamflow. In the model development, we seek to improve hydrological predictions by including relevant processes in the model schematization. The modularity of the wflow framework is ideal for this as we can easily evaluate the combination of different vertical and lateral model components. For example, the local inertial routing for river and overland flow enables us to consider retention of water in the floodplains, which will likely improve extreme streamflow predictions.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"(Image: fig_case_rws)","category":"page"},{"location":"intro/use_cases/#case_flifs","page":"Case studies","title":"Operational flood forecasting in Australia","text":"","category":"section"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"In Australia, there was a need for high-resolution, fast and accurate rainfall-runoff models to provide boundary conditions for a fast and detailed flood inundation model (SFINCS). The domain of the flood model covers the complete North and East Coast of Australia. Although many gauging stations are available to provide real-time information, many rivers are not covered. For these locations, wflow_sbm models are used to provide this real-time information. Additionally, these models are used to provide projections for potential future scenarios. Using the HydroMT library, all wflow_sbm models were automatically built. The high level of flexibility in spatial and temporal resolution, and the physics-based nature of the concept makes wflow_sbm a very suitable model for ungauged basins. Furthermore, the model is sufficiently detailed and computationally efficient for a coupling with the fast flood inundation model SFINCS.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"(Image: fig_case_flifs)","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"The results of this Proof of Concept are very promising. Technically, we were able to very quickly setup the wflow_sbm models, couple them to the flood inundation models (SFINCS) and run the models operationally under the Delft-FEWS platform. Model validation was carried out for two basins by comparing the results of wflow_sbm against the observations and the results of calibrated URBS models. This validation showed that the uncalibrated wflow_sbm model results were already quite satisfying, especially given the complex nature of these basins, including several small and big reservoirs. We could also demonstrate the potential for further calibration by changing the KsatHorFrac parameter.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"Reference: De Kleermaeker, S., Leijnse, T., Morales, Y., Druery, C., Maguire, S.,","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"Developing a real-time data and modelling framework for operational flood inundation forecasting in Australia. In Hydrology & Water Resources Symposium 2022 (HWRS 2022): The Past, the Present, the Future. Engineers Australia. https://search.informit.org/doi/10.3316/informit.916755150845355","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"(Image: fig_case_flifs)","category":"page"},{"location":"intro/use_cases/#case_mfa","page":"Case studies","title":"Simulating plastic transport in Thailand","text":"","category":"section"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"For the Polution Control Board of the Government of Thailand and the World Bank, we supported the material flow analysis of plastics in Thailand using wflow. Plastic polution is a growing global problem. Plastic waste enters the rivers and is transported to the ocean where it remains and threatens the health of the ocean, seas and coasts. The initial movement of plastic waste is in many cases triggered by runoff from (heavy) rainfall and transported by the flow of water towards small streams and rivers. Therefore there is strong relation to rainfall-runoff processes, which can be modeled using high-resolution rainfall-runoff models.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"In this study we applied the wflow_sbm model in combination with a fate-and-transport and water quality model (DelWaq) to simulate the movement of plastics through 5 large river basins and on 3 island and coastal zones (Krabi, Phuket and Ko Samui, see screenshot of the model below) in Thailand. Together with our partners Panya Consultants and HII, we were able to show hotspots of plastic polution, how much plastic waste would end up in the Gulf of Thailand and what would be priority areas for reducing plastic waste reaching the sea.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"(Image: fig_case_mfa)","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"The wflow_sbm models for the 5 large basins were calibrated. The presence of large dams and reservoirs complicated the calibration, but with the input for the operation of the dams, the model performance for these basins could be largely improved. The figure below shows the calibrated model results for the Chao Phraya, just upstream of Bangkok. The input from the hydrological wflow_sbm model was used as input for the fate and transport model to assess how much plastic would be transported to the ocean.","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"(Image: fig_case_mfa)","category":"page"},{"location":"intro/use_cases/","page":"Case studies","title":"Case studies","text":"Link to World Bank report: https://www.worldbank.org/en/country/thailand/publication/plastic-waste-material-flow-analysis-for-thailand","category":"page"},{"location":"model_docs/vertical/sbm/#vert_sbm","page":"SBM","title":"SBM","text":"","category":"section"},{"location":"model_docs/vertical/sbm/#Introduction","page":"SBM","title":"Introduction","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The SBM vertical concept has its roots in the Topog_SBM model but has had considerable changes over time. The main differences are:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The unsaturated zone can be split-up in different layers\nThe addition of evapotranspiration losses\nThe addition of a capillary rise","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The sections below describe the working of the SBM vertical concept in more detail.","category":"page"},{"location":"model_docs/vertical/sbm/#Precipitation","page":"SBM","title":"Precipitation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The division between solid and liquid precipitation (snowfall and rainfall, respectively) is performed based on the air temperature. If the temperature is below a threshold temperature (tt), precipitation will fall as snow. An interval parameter (tti) defines the range over which precipitation is partly falling as snow, and partly as rain. Snowfall is added to the snowpack, where it is subject to melting and refreezing (see the section on snow and glaciers). The amount of rainfall is subject to interception, and ultimately becomes available for evaporation and/or soil processes.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: snowfall)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Division between snow and precipitation based on the threshold temperature","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-snowfall_fig-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/#interception","page":"SBM","title":"Rainfall interception","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Two different interception models are available: the analytical Gash model, and the modified Rutter model. The simulation timestep defines which interception model is used, where daily (or larger) timesteps use the Gash model, and timesteps smaller than daily use the modified Rutter model.","category":"page"},{"location":"model_docs/vertical/sbm/#The-analytical-(Gash)-model-(Gash,-1979)","page":"SBM","title":"The analytical (Gash) model (Gash, 1979)","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The analytical model of rainfall interception is based on Rutter's numerical model. Simplifications  allow the model to be applied on a daily basis, although a storm-based approach will yield better results in situations with more than one storm per day. The amount of water needed to completely saturate the canopy is defined as:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"P=frac-overlineRSoverlineE_wlnleft1-fracoverlineE_woverlineR(1-p-p_t)^-1right","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where overlineR is the average precipitation intensity on a saturated canopy and overlineE_w the average evaporation from the wet canopy and with the vegetation parameters S, p and p_t as defined previously. The model uses a series of expressions to calculate the interception loss during different phases of a storm. An analytical integration of the total evaporation and rainfall under saturated canopy conditions is performed for each storm to determine average values of overlineE_w and overlineR. The total evaporation from the canopy (the total interception loss) is calculated as the sum of the components listed in the table below. Interception losses from the stems are calculated for days with Pgeq S_tp_t. p_t and S_t are small and neglected.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Table: Formulation of the components of interception loss according to Gash:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Components Interception loss\nFor m small storms (P_gP_g) (1-p-p_t)sum_j=1^mP_gj\nWetting up the canopy in n large storms (P_ggeqP_g) n(1-p-p_t)P_g-nS\nEvaporation from saturated canopy during rainfall overlineEoverlineRsum_j=1^n(P_gj-P_g)\nEvaporation after rainfall ceases for n large storms nS\nEvaporation from trunks in q storms that fill the trunk storage qS_t\nEvaporation from  trunks in m+n-q storms that do not fill the trunk storage p_tsum_j=1^m+n-qP_gj","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"In applying the analytical model, saturated conditions are assumed to occur when the hourly rainfall exceeds a certain threshold. Often a threshold of 0.5 mm/hr is used. overlineR is calculated for all hours when the rainfall exceeds the threshold to give an estimate of the mean rainfall rate onto a saturated canopy.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Gash (1979) has shown that in a regression of interception loss on rainfall (on a storm basis) the regression coefficient should equal to overlineE_woverlineR. Assuming that neither overlineE_w nor overlineR vary considerably in time, overlineE_w can be estimated in this way from overlineR in the absence of above-canopy climatic observations. Values derived in this way generally tend to be (much) higher than those calculated with the penman-monteith equation.","category":"page"},{"location":"model_docs/vertical/sbm/#The-modified-rutter-model","page":"SBM","title":"The modified rutter model","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"For sub daily timesteps the interception is calculated using a simplification of the Rutter model. The simplified model is solved explicitly and does not take drainage from the canopy into account. The amount of stemflow is taken as a fraction (0.1 * canopygapfraction) of the precipitation. Throughfall equals to the amount of water that cannot be stored by the canopy, plus the rainfall that is not captured by the canopy. Water can evaporate from the canopy storage, taken as the minimum between potential evaporation and the current storage. The \"left-over\" potential evaporation (if any) is returned as output.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Wflow.rainfall_interception_modrut","category":"page"},{"location":"model_docs/vertical/sbm/#Interception-parameters-from-LAI","page":"SBM","title":"Interception parameters from LAI","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The SBM concept can determine the interception parameters from leaf area index (LAI) climatology. In order to switch this on you must define this cyclic parameter in the TOML file, the parameter is read from path_static, as follows:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[input]\npath_forcing = \"data/forcing-moselle.nc\"\npath_static = \"data/staticmaps-moselle.nc\"\n\ncyclic = [\"vertical.leaf_area_index\"]","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Furthermore these additional parameters are required:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Specific leaf storage  (sl [mm])\nStorage woody part of vegetation (swood [mm])\nExtinction coefficient (kext [-])","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Here it is assumed that cmax [mm] (leaves) (canopy storage capacity for the leaves only) relates linearly with LAI (c.f. Van Dijk and Bruijnzeel 2001). This is done via the sl. sl can be determined through a lookup table with land cover based on literature (Pitman 1989, Lui 1998). Next the cmax (leaves) is determined using:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"\n    cmax(leaves)  = sl  LAI","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"To get to total storage (cmax) the woody part of the vegetation also needs to be added. As for sl, the storage of the woody part swood can also be related to land cover (lookup table).","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The canopy gap fraction is determined using the extinction coefficient kext (van Dijk and Bruijnzeel 2001):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    canopygapfraction = exp(-kext  LAI)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The extinction coefficient kext can be related to land cover.","category":"page"},{"location":"model_docs/vertical/sbm/#evap","page":"SBM","title":"Evaporation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The wflow_sbm model assumes the input to be potential reference evapotranspiration. A crop coefficient (kc, set to 1 by default) is used to convert the potential evapotranspiration rate of a reference crop fully covering the soil to the potential evapotranspiration rate of vegetation (natural and agricultural) fully covering the soil. The crop coefficient kc of wflow_sbm is used for a surface completely covered by vegetation, and does not include the effect of growing stages of vegetation and soil cover. These effects are handled separately through the use of the canopy gap fraction. ","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"It is assumed that the potential evaporation rate of intercepted water by vegetation is equal to the potential evapotranspiration rate of vegetation (fully covering the soil) multiplied by the canopy fraction. The potential evapotranspiration rate left over after interception is available for transpiration. For potential open water evaporation (river and water bodies) the potential reference evapotranspiration rate is used (multipled by the river fraction riverfrac, and open water fraction waterfrac). Also for potential soil evaporation the potential reference evapotranspiration rate is used, multiplied by the canopy gap fraction corrected by the sum of total water fraction (riverfrac and waterfrac) and the fraction covered by a glacier (glacierfrac).","category":"page"},{"location":"model_docs/vertical/sbm/#Bare-soil-evaporation","page":"SBM","title":"Bare soil evaporation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"If there is only one soil layer present in the wflow_sbm model, the bare soil evaporation is scaled according to the wetness of the soil layer. The fraction of bare soil is assumed to be equal to the fraction not covered by the canopy (canopygapfraction) corrected by the total water fraction. When the soil is fully saturated, evaporation is set to equal the potential reference evaporation. When the soil is not fully saturated, actual evaporation decreases linearly with decreasing soil moisture values, as indicated by the figure below.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: soil_evap)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Evaporation reduction as function of available soil moisture","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-sbm_soil_figs-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"When more soil layers are present, soil evaporation is only provided from the upper soil layer, and soil evaporation is split in evaporation from the unsaturated store and evaporation from the saturated store. Water is first evaporated from the unsaturated store. The remaining potential soil evaporation can be used for evaporation from the saturated store, but only when the water table is present in the upper soil layer. Both the evaporation from the unsaturated store and the evaporation from the saturated store are limited by the minimum of the remaining potential soil evaporation and the available water in the unsaturated/saturated zone of the upper soil layer. Also for multiple soil layers, the evaporation (both unsaturated and saturated) decreases linearly with decreasing water availability.","category":"page"},{"location":"model_docs/vertical/sbm/#Transpiration","page":"SBM","title":"Transpiration","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The maximum possible root water extraction rate for each soil layer is determined by partitioning the potential transpiration rate T_p based on the fraction of the total root length (rootfraction [-]) in each soil layer. A root water uptake reduction model is used to calculate a reduction coefficient as a function of soil water pressure, that may reduce the maximum possible root water extraction rate. The root water uptake reduction model is based on the concept proposed by Feddes et al. (1978). This concept defines a reduction coefficient alpha [-] as a function of soil water pressure (h [cm]). Four different levels of h are defined: h1, h2, h3 and h4. h1 represents anoxic moisture conditions, h2 represents field capacity, h3 represents the point of critical soil moisture content (onset of drought stress), and h4 represents the wilting point. The value of h3 is a function of the potential transpiration rate, between 1 and 5 mm d^-1. If T_p le 1 text mm d^-1, h3 is set equal to h3_low (input model parameter). If T_p ge 5 text mm d^-1, h3 is set equal to h3_high (input model parameter). For T_p values between 1 and 5 mm d^-1, the value of h3 is linearly related to T_p (between h3_low and h3_high). Besides model parameters h3_high and h3_low, the critical pressure heads h1, h2 and h4 can be defined as input to the model.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The current soil water pressure is determined following the concept defined by Brooks and Corey (1964):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    frac(theta-theta_r)(theta_s-theta_r) =  Bigglbraceleft(frach_bhright)^lambda h  h_b atop 1  h leq h_b","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where h is the pressure head [cm], h_b is the air entry pressure head [cm], and theta, theta_s, theta_r and lambda as previously defined.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Whenever the current soil water pressure drops below h4, the root water uptake is set to zero. The root water uptake is at ideal conditions whenever the soil water pressure is above h3, with a linear transition between h3 and h4. The assumption that very wet conditions do not affect root water uptake too much is probably generally applicable to natural vegetation. For crops this assumption is not valid and in this case root water uptake above h1 should be set to zero (oxygen deficit) and between h1 and h2 root water uptake is limited. This is possible by setting the input model parameter alpha_h1 at 0 (default is 1).","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: soil_rootwateruptake)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Root water uptake reduction coefficient as a function of soil water pressure","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-sbm_soil_figs-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The maximum allowed root water extraction from each soil layer in the unsaturated zone is determined based on the fraction of each soil layer in the unsaturated zone that is above the rooting depth (availcap) and the unsaturated storage usld, see conceptual figure below. This is implemented using the following code (i refers to the index of the vector that contains all active cells within the spatial model domain and k refers to the soil layer (from top to bottom) in the unsaturated zone):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    # availcap is fraction of soil layer containing roots\n    # if `ust` is `true`, the whole unsaturated store is available for transpiration\n    if ust\n        availcap = usld[k] * 0.99\n    else\n        availcap =\n            min(1.0, max(0.0, (sbm.rootingdepth[i] - sbm.sumlayers[i][k]) / usl[k]))\n    end\n    maxextr = usld[k] * availcap","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: soil_unsatevap)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Conceptual overview of how maxextr depends on rooting depth and water table depth","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-sbm_soil_figs-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"note: Note\nWhen whole_ust_available is set to true in the TOML file, almost the complete unsaturated storage (99%) is available for transpiration, independent of the rootingdepth.[model]\nwhole_ust_available = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The computation of transpiration from the saturated store depends on the water table depth, rooting depth, the reduction coefficient alpha, the fraction of wet roots and the rootfraction below the water table. The fraction of wet roots is determined using a sigmoid fuction (see figure below). The parameter rootdistpar defines the sharpness of the transition between fully wet and fully dry roots. If the water table depth is equal to or lower than the rooting depth, the remaining potential transpiration is used based on the potential transpiration and actual transpiration in the unsaturated zone. The remaining potential transpiration is multiplied by the wet roots fraction and the reduction coefficient (and limited by the available water in saturated zone) to get the transpiration from the saturated part of the soil. If the water table depth intersects the rooting depth, the potential transpiration is multiplied by the remaining rootfraction (below the water table), wet roots fraction and the reduction coefficient (and limited by the available water in saturated zone) to get the transpiration from the saturated part of the soil. This is implemented using the following code (i refers to the index of the vector that contains all active cells within the spatial model domain):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"        # transpiration from saturated store\n        wetroots = scurve(sbm.zi[i], sbm.rootingdepth[i], Float(1.0), sbm.rootdistpar[i])\n        alpha = rwu_reduction_feddes(\n            Float(0.0),\n            sbm.h1[i],\n            sbm.h2[i],\n            sbm.h3[i],\n            sbm.h4[i],\n            sbm.alpha_h1[i],\n        )\n        # include remaining root fraction if rooting depth is below water table zi\n        if sbm.zi[i] >= sbm.rootingdepth[i]\n            f_roots = wetroots\n            restevap = sbm.pottrans[i] - actevapustore\n        else\n            f_roots = wetroots * (1.0 - rootfraction_unsat)\n            restevap = sbm.pottrans[i]\n        end\n        actevapsat = min(restevap * f_roots * alpha, satwaterdepth)\n        satwaterdepth = satwaterdepth - actevapsat","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: soil_wetroots)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Amount of wet roots and the effect of the rootdistpar parameter","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-sbm_soil_figs-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/#snow","page":"SBM","title":"Snow and glaciers","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The snow and glacier model is described in Snow and glaciers. Both options can be enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nsnow = true\nglacier = true","category":"page"},{"location":"model_docs/vertical/sbm/#soil","page":"SBM","title":"Soil processes","text":"","category":"section"},{"location":"model_docs/vertical/sbm/#The-SBM-soil-water-accounting-scheme","page":"SBM","title":"The SBM soil water accounting scheme","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"A detailed description of the Topog_SBM model has been given by Vertessy (1999). Briefly: the soil is considered as a bucket with a certain depth (z_t [mm]), divided into a saturated store (S [mm]) and an unsaturated store (U [mm]). The top of the S store forms a pseudo-water table at depth z_i [mm] such that the value of S at any time is given by:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    S=(z_t-z_i)(theta_s-theta_r)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where theta_s [-] and theta_r [-] are the saturated and residual soil water contents, respectively.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The unsaturated store U is subdivided into storage (U_s [mm]) and deficit (U_d [mm]):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    U_d=(theta_s-theta_r)z_i-U\n    U_s=U-U_d","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The saturation deficit (S_d [mm]) for the soil profile as a whole is defined as:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    S_d=(theta_s-theta_r)z_t-S","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"All infiltrating water that enters the U store first. The unsaturated layer can be split-up in different layers, by providing the thickness [mm] of the layers in the TOML file. The following example specifies three layers (from top to bottom) of 100, 300 and 800 mm:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nthicknesslayers = [100, 300, 800]","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The code checks for each grid cell the specified layers against the soilthickness [mm], and adds or removes (partly) layer(s) based on the soilthickness.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Assuming a unit head gradient, the transfer of water (st [mm t^-1]) from a U [mm] store layer is controlled by the saturated hydraulic conductivity K_sat [mm t^-1] at depth z [mm] (bottom layer) or z_i [mm], the effective saturation degree of the layer, and a Brooks-Corey power coefficient (parameter c) based on the pore size distribution index lambda (Brooks and Corey, 1964):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    st=K_mathitsatleft(fractheta-theta_rtheta_s-theta_rright)^c\n    c=frac2+3lambdalambda","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"When the unsaturated layer is not split-up into different layers, it is possible to use the original Topog_SBM vertical transfer formulation, by specifying in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\ntransfermethod = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The transfer of water from the U [mm] store to the S [mm] store (st [mm t^-1]) is in that case controlled by the saturated hydraulic conductivity K_sat [mm t^-1] at depth z_i [mm] and the ratio between U [mm] and S_d [mm]:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    st=K_mathitsatfracU_sS_d","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Four different saturated hydraulic conductivity depth profiles (ksat_profile) are available and a ksat_profile can be specified in the TOML file as follows:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[input.vertical]\nksat_profile = \"exponential_constant\" # optional, one of (\"exponential\", \"exponential_constant\", \"layered\", \"layered_exponential\"), default is \"exponential\"","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Soil measurements are often available for about the upper 1.5-2 m of the soil column to estimate the saturated hydraulic conductivity, while these measurements are often lacking for soil depths beyond 1.5-2 m. These different profiles allow to extent the saturated hydraulic conductivity profile based on measurements (either an exponential fit or hydraulic conductivity value per soil layer) with an exponential or constant profile. By default, with ksat_profile \"exponential\", the saturated hydraulic conductivity (K_sat [mm t^-1]) declines with soil depth (z [mm]) in the model according to:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    K_sat=K_0e^(-fz)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where K_0 [mm t^-1] is the saturated hydraulic conductivity at the soil surface and f is a scaling parameter [mm^-1].","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The plot below shows the relation between soil depth z and saturated hydraulic conductivity K_sat for different values of f.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    using Printf\n    using CairoMakie","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    let                                                                                     # hide\n        fig = Figure(resolution = (800, 400))                                               # hide\n        ax = Axis(fig[1, 1], xlabel = \"Kₛₐₜ [mm/day]\", ylabel = \"-z [mm]\")                  # hide\n\n        z = 0:5.0:1000                                                                      # hide\n        ksat = 100.0                                                                        # hide\n        f = 0.6 ./ collect(50:150.0:800)                                                    # hide\n\n        for fi in f                                                                         # hide\n            lines!(ax, ksat .* exp.(-fi .* z), -z, label = @sprintf(\"f = %.2e\", fi))        # hide\n        end                                                                                 # hide\n\n        Legend(fig[1, 2], ax, \"f\")                                                          # hide\n        fig                                                                                 # hide\n    end                                                                                     # hide","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"With ksat_profile \"exponential_constant\", K_sat declines exponentially with soil depth z until z_mathrmexp [mm] below the soil surface, and stays constant at and beyond soil depth z_mathrmexp:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    K_sat = begincases\n    K_0e^(-fz)  textif z  z_mathrmexp\n    K_0e^(-fz_mathrmexp)  textif z ge z_mathrmexp\n    endcases","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"It is also possible to provide a K_sat value per soil layer by specifying ksat_profile \"layered\", these K_sat values are used directly to compute the vertical transfer of water between soil layers and to the saturated store S. Finally, with the ksat_profile \"layered_exponential\" a K_sat value per soil layer is used until depth z_mathrmlayered below the soil surface, and beyond z_mathrmlayered an exponential decline of K_sat (of the soil layer with bottom z_mathrmlayered) controlled by f occurs. The different available ksat_profle options are schematized in the figure below where the blue line represents the K_sat value.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: ksat_profiles)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Overview of available ksat_profile options, for a soil column with five layers","category":"page"},{"location":"model_docs/vertical/sbm/#Infiltration","page":"SBM","title":"Infiltration","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The water available for infiltration is taken as the rainfall including meltwater. Infiltration is determined separately for the compacted and non-compacted areas, as these have different infiltration capacities. Naturally, only the water that can be stored in the soil can infiltrate. If not all water can infiltrate, this is added as excess water to the runoff routing scheme.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The infiltrating water is split in two parts, the part that falls on compacted areas and the part that falls on non-compacted areas. The maximum amount of water that can infiltrate in these areas is calculated by taking the minimum of the maximum infiltration rate (infiltcapsoil [mm t^-1] for non-compacted areas and infiltcappath [mm t^-1] for compacted areas) and the amount of water available for infiltration avail_forinfilt [mm t^-1]. The water that can actually infiltrate infiltsoilpath [mm t^-1] is calculated by taking the minimum of the total maximum infiltration rate (compacted and non-compacted areas) and the remaining storage capacity.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Infiltration excess occurs when the infiltration capacity is smaller then the throughfall and stemflow rate. This amount of water (infiltexcess [mm t^-1]) becomes overland flow (infiltration excess overland flow). Saturation excess occurs when the (upper) soil becomes saturated and water cannot infiltrate anymore. This amount of water excesswater [mm t^-1] becomes overland flow (saturation excess overland flow).","category":"page"},{"location":"model_docs/vertical/sbm/#Infiltration-in-frozen-soils","page":"SBM","title":"Infiltration in frozen soils","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"If snow processes are modelled, the infiltration capacity is reduced when the soil is frozen (or near freezing point). A infiltration correction factor is defined as a S-curve with the shape as defined below. A parameter (cf_soil) defines the base factor of infiltration when the soil is frozen. The soil temperature is calculated based on the soil temperature on the previous timestep, and the temperature difference between air and soil temperature weighted with a factor (w_soil, which defaults to 0.1125).","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The near surface soil temperature is modelled using a simple equation (Wigmosta et al., 2009):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"T_s^t = T_s^t-1 + w  (T_a - T_s^t-1)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where T_s^t [degreeC] is the near-surface soil temperature at time t, T_a [degreeC] is air temperature and w [-] is a weighting coefficient determined through calibration (default is 0.1125 for daily timesteps).","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"A reduction factor (cf_soil [-], default is 0.038) is applied to the maximum infiltration rate (infiltcapsoil and infiltcappath), when the following model settings are specified in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model]\nsoilinfreduction = true\nsnow = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"If soilinfreduction is set to false, water is allowed to infiltrate the soil, even if the soil is frozen.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"A S-curve (see plot below) is used to make a smooth transition (a c-factor (c) of 8.0 is used):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    b = frac10(10 - cf_soil)\n    soilinfredu = frac10b + exp(-c (T_s - a)) + cf_soil\n    a = 00\n    c = 80","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: soil_frozeninfilt)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Infiltration correction factor as a function of soil temperature","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-sbm_soil_figs-py # hide","category":"page"},{"location":"model_docs/vertical/sbm/#Capillary-rise","page":"SBM","title":"Capillary rise","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The actual capillary rise actcapflux [mm t^-1] is determined using the following approach: first the saturated hydraulic conductivity ksat [mm t^-1] is determined at the water table z_i; next a potential capillary rise maxcapflux [mm t^-1] is determined from the minimum of ksat, actual transpiration actevapustore [mm t^-1] taken from the U store, available water in the S store (satwaterdepth [mm]) and the deficit of the U store (ustorecapacity [mm]), as shown by the following code block:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    maxcapflux = max(0.0, min(ksat, actevapustore, ustorecapacity, satwaterdepth))","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Then the potential rise maxcapflux is scaled using the water table depth zi, a maximum water depth cap_hmax [mm] beyond which capillary rise ceases and a coefficient cap_n [-], as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    if sbm.zi[i] > rootingdepth\n        capflux =\n            maxcapflux * pow(\n                1.0 - min(sbm.zi[i], sbm.cap_hmax[i]) / (sbm.cap_hmax[i]),\n                sbm.cap_n[i],\n            )\n    else\n        capflux = 0.0\n    end","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"If the roots reach the water table (rootingdepth ge sbm.zi), capflux is set to zero.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Finally, the capillary rise capflux is limited by the unsaturated store deficit (one or multiple layers), calculated as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain, and k refers to the layer position):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    usl[k] * (sbm.theta_s[i] - sbm.theta_r[i]) - usld[k]","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where usl [mm] is the unsaturated layer thickness, usld is the ustorelayerdepth [mm] (amount of water in the unsaturated layer), and theta_s and theta_r as previously defined.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The calculation of the actual capillary rise actcapflux is as follows in the code block below (i refers to the index of the vector that contains all active cells within the spatial model domain, and k refers to the layer position):","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    actcapflux = 0.0\n    netcapflux = capflux\n    for k = n_usl:-1:1\n        toadd =\n            min(netcapflux, max(usl[k] * (sbm.theta_s[i] - sbm.theta_r[i]) - usld[k], 0.0))\n        usld = setindex(usld, usld[k] + toadd, k)\n        netcapflux = netcapflux - toadd\n        actcapflux = actcapflux + toadd\n    end","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"In case of multiple unsaturated layers (n_usl  1), the calculation of the actual capillary rise starts at the lowest unsaturated layer while keeping track of the remaining capillary rise netcapflux [mm t^-1].","category":"page"},{"location":"model_docs/vertical/sbm/#Leakage","page":"SBM","title":"Leakage","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"If the maxleakage (mm/day) input model parameter is set > 0, water is lost from the saturated zone and runs out of the model.","category":"page"},{"location":"model_docs/vertical/sbm/#Open-water","page":"SBM","title":"Open water","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Part of the water available for infiltration is diverted to the open water, based on the fractions of river and lakes of each grid cell. The amount of evaporation from open water is assumed to be equal to potential evaporation (if sufficient water is available).","category":"page"},{"location":"model_docs/vertical/sbm/#Non-irrigation","page":"SBM","title":"Non-irrigation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Non-irrigation water demand and allocation computations are supported for the sectors domestic, industry and livestock. These computations can be enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model.water_demand]\ndomestic = true\nindustry = true\nlivestock = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"For these non-irrigation sectors the gross demand (d_mathrmgross [mm t^-1]) and net demand (d_mathrmnet [mm t^-1]) are provided to the model (input through cyclic or forcing data). Gross demand represents the total demand and hence the total abstraction from surface water or groundwater when sufficient water is available. Net demand represents water consumption. The portion of total abstracted water that is not consumed is returned as surface water. The return flow fraction (f_mathrmreturn [-]) is calculated as follows:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    f_mathrmreturn = 10 - fracd_mathrmnetd_mathrmgross","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"and used to calculate the return flow rate (water abstracted from surface water or groundwater but not consumed). For grid cells containing a river the return flow is directly returned to the river routing component, otherwise the return flow is returned to the overland flow routing component.","category":"page"},{"location":"model_docs/vertical/sbm/#Non-paddy-irrigation","page":"SBM","title":"Non-paddy irrigation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Non-paddy (other crops than flooded rice) water demand and allocation computations are supported. These computations can be enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model.water_demand]\nnonpaddy = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Irrigation is applied during the growing season (when input parameter irrigation_trigger [-] is true (or on)) and when water depletion exceeds the readily available water:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    (U_mathrmfield - U_mathrma) ge (U_mathrmfield - U_mathrmh3)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"where U_mathrmfield [mm] is the unsaturated store in the root zone at field capacity (defined at a soil water pressure head of -100 cm), U_mathrma [mm] is the actual unsaturated store in the root zone and U_mathrmh3 [mm] is the unsaturated store in the root zone at the critical soil water pressure head h3, below this pressure head reduction of root water uptake starts due to drought stress. The net irrigation demand [mm t^-1] is the irrigation rate that brings the root zone back to field capacity, limited by the soil infiltration capacity [mm t^-1], assuming that farmers do not apply an irrigation rate higher than the soil infiltration capacity. To account for limited irrigation efficiency the net irrigation demand is divided by the irrigation efficiency for non-paddy crops (irrigation_efficiency [-], default is 1.0), resulting in gross irrigation demand [mm t^-1]. Finally, the gross irrigation demand is limited by the maximum irrigation rate (maximum_irrigation_rate [mm t^-1], default is 25 mm d^-1). If the maximum irrigation rate is applied, irrigation continues at subsequent time steps until field capacity is reached. Irrigation is added to the SBM variable avail_forinfilt [mm t^-1], the amount of water available for infiltration.","category":"page"},{"location":"model_docs/vertical/sbm/#Paddy-irrigation","page":"SBM","title":"Paddy irrigation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Paddy (flooded rice) water demand and allocation computations are supported. These computations can be enabled by specifying the following in the TOML file:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"[model.water_demand]\npaddy = true","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Irrigation is applied during the growing season (when input parameter irrigation_trigger [-] is true (or on)) and when the paddy water depth h [mm] reaches below the minimum water depth h_min [mm] (see also the figure below). The net irrigation demand [mm t^-1] is the irrigation rate required to reach the optimal paddy water depth h_opt [mm], an approach similar to Xie and Cui (2011). To account for limited irrigation efficiency the net irrigation demand is divided by the irrigation efficiency for paddy fields (irrigation_efficiency [-], default is 1.0), resulting in gross irrigation demand [mm t^-1]. Finally, the gross irrigation demand is limited by the maximum irrigation rate (maximum_irrigation_rate [mm t^-1], default is 25 mm d^-1). If the maximum irrigation rate is applied, irrigation continues at subsequent time steps until the optimal paddy water depth h_opt is reached. Irrigation is added to the SBM variable avail_forinfilt [mm t^-1], the amount of water available for infiltration. When the paddy water depth h exceeds h_max [mm] runoff occurs, and this amount is added to the runoff routing scheme for overland flow. The figure below shows a typical vertical soil profile of a puddled rice soil with a muddy layer of about 15 cm (in this case represented by two soil layers of 5 cm and 10 cm thickness), a plow soil layer of 5 cm with relative low permeability (vertical hydraulic conductivity k_v of about 5 mm d^-1), and a non-puddled soil below the plow soil layer. The low vertical hydraulic conductivity of the plow soil layer can be realized by making use of the parameter kvfrac [-], a multiplication factor applied to the vertical hydraulic conductivity at soil depth z [mm].","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"(Image: paddy_profile)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Schematic diagram of a paddy field with water balance components and soil profile","category":"page"},{"location":"model_docs/vertical/sbm/#Water-withdrawal-and-allocation","page":"SBM","title":"Water withdrawal and allocation","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"For the water withdrawal the total gross demand is computed (sum over the irrigation and non-irrigation water demand sectors), in case sufficient water is available the water withdrawal is equal to the total gross demand. In case of insufficient water availability, the water withdrawal is scaled down to the available water, and allocation is then proportional to the gross demand per sector (industry, domestic, livestock and irrigation). Water can be abstracted from the following sources:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"surface water from rivers (max 80% of total available water) \nreservoirs and lakes (max 98% of total available water)\ngroundwater (max 75% of total available water)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The model parameter frac_sw_used (fraction surface water used, default is 1.0) determines how much water is supplied by available surface water and groundwater.","category":"page"},{"location":"model_docs/vertical/sbm/#Local","page":"SBM","title":"Local","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"First, surface water abstraction (excluding reservoir and lake locations) is computed to satisfy local (same grid cell) water demand. The available surface water volume is limited by a fixed scaling factor of 0.8 to prevent rivers from completely drying out. It is assumed that the water demand cannot be satisfied completely from local surface water and groundwater. The next step is to satisfy the remaining water demand for allocation areas [-], described in the next sub-section.","category":"page"},{"location":"model_docs/vertical/sbm/#Allocation-areas","page":"SBM","title":"Allocation areas","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"For allocation areas the water demand V_mathrmsw demand [m^3] and availability V_mathrmsw availabilty [m^3] are summed (including reservoir and lake locations limited by a fixed scaling factor of 0.98), and the total surface water abstraction is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    V_mathrmsw abstraction = mathrmmin(V_mathrmsw demand V_mathrmsw availabilty)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The fraction of available surface water that can be abstracted f_mathrmsw abstraction [-] at the allocation area level is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    f_mathrmsw abstraction = fracV_mathrmsw abstractionV_mathrmsw available","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"This fraction is applied to the remaining available surface water of each river cell (including lake and reservoir locations) to compute surface water abstraction at each river cell and to update the local surface water abstraction.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The fraction of water demand that can be satisfied by available surface water f_mathrmsw allocation [-] at the allocation area level is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    f_mathrmsw allocation = fracV_mathrmsw abstractionV_mathrmsw demand","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"This fraction is applied to the remaining surface water demand of each land cell to compute the allocated surface water to each land cell.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Then groundwater abstraction is computed to satisfy the remaining local water demand, where groundwater abstraction is limited by a fixed scaling factor of 0.75 applied to the groundwater volume. Finally, for allocation areas the water demand V_mathrmgw demand [m^3] and availability V_mathrmgw availabilty [m^3] are summed, and the total groundwater abstraction is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    V_mathrmgw abstraction = mathrmmin(V_mathrmgw demand V_mathrmgw availabilty)","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The fraction of available groundwater that can be abstracted at allocation area level f_mathrmgw abstraction [-] at the allocation area level is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    f_mathrmgw abstraction = fracV_mathrmgw abstractionV_mathrmgw available","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"This fraction is applied to the remaining available groundwater of each land cell to compute groundwater abstraction and to update the local groundwater abstraction.","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"The fraction of water demand that can be satisfied by available groundwater f_mathrmgw allocation [-] at the allocation area level is then:","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"    f_mathrmgw allocation = fracV_mathrmgw abstractionV_mathrmgw demand","category":"page"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"This fraction is applied to the remaining groundwater demand of each land cell to compute the allocated groundwater to each land cell.","category":"page"},{"location":"model_docs/vertical/sbm/#Abstractions","page":"SBM","title":"Abstractions","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Groundwater abstraction is implemented by subtracting this amount from the recharge variable of the lateral subsurface flow component (kinematic wave) or the recharge rate of the groundwater flow module. Surface water abstraction [m^3 s^-1] is divided by the flow length dl [m] and subtracted from the lateral inflow of kinematic wave routing scheme for river flow. For the local inertial routing scheme (river and optional floodplain routing), the surface water abstraction [m^3 s^-1] is subtracted as part of the continuity equation of the local inertial model. For reservoir and lake locations surface water is abstracted (act_surfacewater_abst_vol [m^3 t^-1]) from the reservoir volume [m^3] and lake storage [m^3] respectively, with a subsequent update of the lake waterlevel [m].","category":"page"},{"location":"model_docs/vertical/sbm/#References","page":"SBM","title":"References","text":"","category":"section"},{"location":"model_docs/vertical/sbm/","page":"SBM","title":"SBM","text":"Brooks, R. H., and Corey, A. T., 1964, Hydraulic properties of porous media, Hydrology Papers 3, Colorado State University, Fort Collins, 27 p.\nFeddes, R.A., Kowalik, P.J. and Zaradny, H., 1978, Simulation of field water use and crop yield, Pudoc, Wageningen, Simulation Monographs.\nGash, J. H. C., 1979, An analytical model of rainfall interception by forests, Q. J. Roy. Meteor. Soc., 105, 43–55, doi:1026 10.1002/qj.497105443041027.\nLiu, S., 1998, Estimation of rainfall storage capacity in the canopies of cypress wetlands and slash pine uplands in North-Central Florida, J. Hydr., 207, 32–41, doi: 10.1016/S0022-1694(98)00115-2.\nPitman, J., 1989, Rainfall interception by bracken in open habitats—relations between leaf area, canopy storage and drainage rate, J. Hydr. 105, 317–334, doi: 10.1016/0022-1694(89)90111-X.\nVan Dijk, A. I. J. M., and Bruijnzeel, L. A., 2001, Modelling rainfall interception by vegetation of variable density using an adapted analytical model, Part 2, Model validation for a tropical upland mixed cropping system, J. Hydr., 247, 239–262.\nVertessy, R., and Elsenbeer, H., 1999, Distributed modeling of storm ﬂow generation in an amazonian rain forest catchment: effects of model parameterization, Water Resour. Res., 35, 2173–2187. doi: 10.1029/1999WR9000511257.\nWigmosta, M. S., Lane, L. J., Tagestad, J. D., and Coleman A. M., 2009, Hydrologic and erosion models to assess land use and management practices affecting soil erosion, J. Hydrol. Eng., 14, 27-41.\nXie, X. and Cui, Y., 2011, Development and test of SWAT for modeling hydrological processes in irrigation districts with paddy rice, J. Hydrol., 396, pp. 61-71.","category":"page"},{"location":"intro/publications/#Publications","page":"Publications","title":"Publications","text":"","category":"section"},{"location":"intro/publications/#Citing-wflow","page":"Publications","title":"Citing wflow","text":"","category":"section"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"For publications, please cite the following paper introducing Wflow.jl and describing the wflow_sbm concept, together with some case studies:","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van Verseveld, W. J., Weerts, A. H., Visser, M., Buitink, J., Imhoff, R. O., Boisgontier, H., Bouaziz, L., Eilander, D., Hegnauer, M., ten Velden, C., and Russell, B., 2024. Wflow_sbm v0.7.3, a spatially distributed hydrological model: from global data to local applications. Geosci. Model Dev., 17, 3199–3234. https://doi.org/10.5194/gmd-17-3199-2024.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"To cite a specific software version please use the DOI provided in the Zenodo badge (Image: DOI), that points to the latest release. The DOIs of previous versions are also available at Zenodo. If you use a snapshot of the development (without a DOI) please cite as follows:","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van Verseveld, Willem, Visser, Martijn, Buitink, Joost, Bouaziz, Laurène, Boisgontier, Hélène, Bootsma, Huite, Weerts, Albrecht, Baptista, Carlos Fernando, Pronk, Maarten, Eilander, Dirk, Hartgring, Sebastian, Dalmijn, Brendan, Hofer, Julian, Hegnauer, Mark, & Mendoza, Raul, (YEAR). Deltares/Wflow.jl: unstable-master. https://github.com/Deltares/Wflow.jl, obtained: DATE_OF_DOWNLOAD.","category":"page"},{"location":"intro/publications/#Publications-using-wflow","page":"Publications","title":"Publications using wflow","text":"","category":"section"},{"location":"intro/publications/#Peer-reviewed-journal-papers","page":"Publications","title":"Peer reviewed journal papers","text":"","category":"section"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Aerts, J. P. M., Hut, R. W., van de Giesen, N. C., Drost, N., van Verseveld, W. J., Weerts, A. H., and Hazenberg, P., 2022. Large-sample assessment of varying spatial resolution on the streamflow estimates of the wflow_sbm hydrological model. Hydrol. Earth Syst. Sci., 26, 4407–4430. https://doi.org/10.5194/hess-26-4407-2022.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"de Boer-Euser, T., Bouaziz, L., De Niel, J., Brauer, C., Dewals, B., Drogue, G., Fenicia, F., Grelier, B., Nossent, J., Pereira, F., Savenije, H., Thirel, G., Willems, P., 2017. Looking beyond general metrics for model comparison – lessons from an international model intercomparison study. Hydrol. Earth Syst. Sci. 21, 423–440. https://doi:10.5194/hess-21-423-2017.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Bouaziz, L.J.E., Fenicia, F., Thirel, G., de Boer-Euser, T., Buitink, J., Brauer, C.C., De Niel, J., Dewals, B.J., Drogue, G., Grelier, B., Melsen, L. A., Moustakas, S., Nossent, J., Pereira, F., Sprokkereef, E., Stam, J., Weerts, A.H., Willems, P., Savenije, H.H.G., Hrachowitz, M., 2021. Behind the scenes of streamflow model performance. Hydrol. Earth Syst. Sci., 25, 1069–1095. https://doi.org/10.5194/hess-25-1069-2021.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Bouaziz, L. J. E., Aalbers, E. E., Weerts, A. H., Hegnauer, M., Buiteveld, H., Lammersen, R., Stam, J., Sprokkereef, E., Savenije, H. H. G., and Hrachowitz, M., 2022. Ecosystem adaptation to climate change: the sensitivity of hydrological predictions to time-dynamic model parameters, Hydrol. Earth Syst. Sci., 26, 1295–1318. https://doi.org/10.5194/hess-26-1295-2022.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Casson, D. R., Werner, M., Weerts, A., and Solomatine, D., 2018. Global re-analysis datasets to improve hydrological assessment and snow water equivalent estimation in a sub-Arctic watershed. Hydrol. Earth Syst. Sci., 22, 4685–4697. https://doi.org/10.5194/hess-22-4685-2018.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Emerton, R.E., Stephens, E.M., Pappenberger, F., Pagano, T.C., Weerts, A.H., Wood, A.W., Salamon, P., Brown, J.D., Hjerdt, N., Donnelly, C., Baugh, C.A., Cloke, H.L., 2016. Continental and global scale flood forecasting systems. WIREs Water 3, 391–418. https://doi.org/10.1002/wat2.1137.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Gebremicael, T.G., Mohamed, Y.A., Van der Zaag, P., 2019. Attributing the hydrological impact of different land use types and their long-term dynamics through combining parsimonious hydrological modelling, alteration analysis and PLSR analysis. Science of The Total Environment, 660, 1155-1167, https://doi.org/10.1016/jscitotenv.2019.01.085.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Giardino, A., Schrijvershof, R., Nederhoff, C.M., de Vroeg, H., Brière, C., Tonnon, P.-K., Caires, S., Walstra, D.J., Sosa, J., van Verseveld, W., Schellekens, J., Sloff, C.J., 2018. A quantitative assessment of human interventions and climate change on the West African sediment budget, Ocean & Coastal Management, 156, 249-265. https://doi.org/10.1016/j.ocecoaman.2017.11.008.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Hally, A., Caumont, O., Garrote, L., Richard, E., Weerts, A., Delogu, F., Fiori, E., Rebora, N., Parodi, A., Mihalović, A., Ivković, M., Dekić, L., van Verseveld, W., Nuissier, O., Ducrocq, V., D’Agostino, D., Galizia, A., Danovaro, E., Clematis, A., 2015. Hydrometeorological multi-model ensemble simulations of the 4 November 2011 flash flood event in Genoa, Italy, in the framework of the DRIHM project. Nat. Hazards Earth Syst. Sci. 15, 537–555. https://doi:10.5194/nhess-15-537-2015.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Hassaballah, K., Mohamed, Y., Uhlenbrook, S., and Biro, K., 2017. Analysis of streamflow response to land use and land cover changes using satellite data and hydrological modelling: case study of Dinder and Rahad tributaries of the Blue Nile (Ethiopia–Sudan), Hydrol. Earth Syst. Sci., 21, 5217–5242. https://doi.org/10.5194/hess-21-5217-2017.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Imhoff, R.O, van Verseveld, W.J., van Osnabrugge, B., Weerts, A.H., 2020. Scaling Point-Scale (Pedo)transfer Functions to Seamless Large-Domain Parameter Estimates for High-Resolution Distributed Hydrologic Modeling: An Example for the Rhine River. Water Resources Research,56,e2019WR026807. https://doi.org/10.1029/2019WR026807.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Imhoff, R.O., van Verseveld, W., van Osnabrugge, B., Weerts, A.H., 2020. Ruimtelijk schaalbare hydrologische modelparameters uit open-source omgevingsdata: een voorbeeld voor de Rijn. Stromingen: vakblad voor hydrologen, 26(3), 19-36 https://edepot.wur.nl/540682.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Jeuken, A., Bouaziz, L., Corzo, G., Alfonso, L., 2016. Analyzing Needs for Climate Change Adaptation in the Magdalena River Basin in Colombia, in: Filho, W.L., Musa, H., Cavan, G., O’Hare, P., Seixas, J. (Eds.), Climate Change Adaptation, Resilience and Hazards, Climate Change Management. Springer International Publishing, pp. 329–344 https://doi.org/10.1007/978-3-319-39880-8.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"López López, P., Wanders, N., Schellekens, J., Renzullo, L.J., Sutanudjaja, E.H., Bierkens, M.F.P., 2016. Improved large-scale hydrological modelling through the assimilation of streamflow and downscaled satellite soil moisture observations. Hydrol. Earth Syst. Sci., 20, 3059–3076. https://doi.org/10.5194/hess-20-3059-2016.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., Weerts, A.H., Uijlenhoet, R., 2017. genRE: A method to extend gridded precipitation climatology data sets in near real-time for hydrological forecasting purposes. Water Resources Research, 53. https://doi.org/10.1002/2017WR021201.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., Uijlenhoet, R., Weerts, A., 2019. Contribution of potential evaporation forecasts to 10-day streamflow forecast skill for the Rhine River, Hydrol. Earth Syst. Sci., 23, 1453–1467, https://doi.org/10.5194/hess-23-1453-2019.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rakovec, O., Weerts, A.H., Sumihar, J., Uijlenhoet, R., 2015. Operational aspects of asynchronous filtering for flood forecasting. Hydrol. Earth Syst. Sci., 19, 2911–2924, https://doi.org/10.5194/hess-19-2911-2015.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Ratri, D.N., A.H. Weerts, R. Muharsyah, K. Whan, A. Klein Tank, E. Aldrian, M. H. Hariadi, Calibration of ECMWF SEAS5 based streamflow forecast in Seasonal hydrological forecasting for Citarum river basin, West Java, Indonesia, Journal of Hydrology: Regional Studies,45,101305, https://doi.org/10.1016/j.ejrh.2022.101305.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rusli, S.R., A.H. Weerts, A. Taufiq, V. Bense, 2021. Estimating water balance components and their uncertainty bounds in highly groundwater-dependent and data-scarce area: An example for the Upper Citarum basin, J. Hydrol. Regional Studies, https://doi.org/10.1016/j.ejrh.2021.100911.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rusli, S.R., V.F. Bense, A. Taufiq, A.H. Weerts,2023. Quantifying basin-scale changes in groundwater storage using GRACE and one-way coupled hydrological and groundwater flow model in the data-scarce Bandung groundwater Basin, Indonesia, Groundwater for Sustainable Development,22, 100953, https://doi.org/10.1016/j.gsd.2023.100953.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rusli, S.R., A.H. Weerts, S.M.T. Mustafa, D.E. Irawan, A. Taufiq, V.F. Bense, 2023. Quantifying aquifer interaction using numerical groundwater flow model evaluated by environmental water tracer data: Application to the data-scarce area of the Bandung groundwater basin, West Java, Indonesia, Journal of Hydrology: Regional Studies, 50, https://doi.org/10.1016/j.ejrh.2023.101585.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Schaller, N., Sillmann, J., Müller, M., Haarsma, R., Hazeleger, W., Hegdahl, T.J., Kelder, T., van den Oord, G., Weerts, A., Whan, K., 2020. The role of spatial and temporal model resolution in a flood event storyline approach in western Norway. Weather and Climate Extremes, doi: https://doi.org/10.1016/j.wace.2020.100259.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Sperna Weiland, F.C.,  R.D. Visser, P. Greve, B. Bisselink, L. Brunner and A.H. Weerts, 2021. Estimating Regionalized Hydrological Impacts of Climate Change Over Europe by Performance-Based Weighting of CORDEX Projections, Frontiers of Water, https://doi.org/10.3389/frwa.2021.713537.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Tangdamrongsub, N., Steele-Dunne, S.C., Gunter, B.C., Ditmar, P.G., Weerts, A.H., 2015. Data assimilation of GRACE terrestrial water storage estimates into a regional hydrological model of the Rhine River basin. Hydrol. Earth Syst. Sci. 19, 2079–2100. https://doi:10.5194/hess-19-2079-2015.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van der Laan, E., P. Hazenberg, A.H. Weerts, 2024. Simulation of long-term storage dynamics of headwater reservoirs across the globe using public cloud computing infrastructure. Science of The Total Environment, 172678, https://doi.org/10.1016/j.scitotenv.2024.172678.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van der Vat, M., Boderie, P., Bons, K.A., Hegnauer, M., Hendriksen, G., van Oorschot, M., Ottow, B., Roelofsen, F., Sankhua, R.N., Sinha, S.K., Warren, A., Young, W., 2019. Participatory Modelling of Surface and Groundwater to Support Strategic Planning in the Ganga Basin in India. Water, 11, 2443. https://doi.org/10.3390/w11122443.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Wannasin, C., Brauer, C. C., Uijlenhoet, R., van Verseveld, W. J., Weerts, A. H., 2021. Daily flow simulation in Thailand Part I: Testing a distributed hydrological model with seamless parameter maps based on global data. Journal of Hydrology: Regional Studies, 34, 1-19. https://doi.org/10.1016/j.ejrh.2021.100794.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Wannasin, C., Brauer, C. C., Uijlenhoet, R., van Verseveld, W. J., Weerts, A. H., 2021. Daily flow simulation in Thailand Part II: Unraveling effects of reservoir operation. Journal of Hydrology: RegionalStudies, 34, 1-17. https://doi.org/10.1016/j.ejrh.2021.100792.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Wang, X., Zhang, J., Babovic, V., 2016. Improving real-time forecasting of water quality indicators with combination of process-based models and data assimilation technique. Ecological Indicators 66, 428–439. https://doi:10.1016/j.ecolind.2016.02.016.","category":"page"},{"location":"intro/publications/#PhD,-MSc,-BSc-Theses-and-Internship-reports","page":"Publications","title":"PhD, MSc, BSc Theses & Internship reports","text":"","category":"section"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Abdelnour, A., 2022. Bias Correction of Climate Simulations to Assess Climate Change Impacts on Low Flows in the Rhine River, MSc thesis, Delft Universitry of technology, https://repository.tudelft.nl/islandora/object/uuid:50489399-cbd2-467f-9b82-98e5f3e371e9.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Ali, M.A., 2023. Machine learning for predicting spatially variable lateral hydraulic conductivity: a step towards efficient hydrological model calibration and global applicability, Intersnhip report, Deltares.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Arnal, L., 2014. An intercomparison of flood forecasting models for the Meuse River basin, MSc Thesis, Vrije Universiteit, Amsterdam, https://hal.inrae.fr/hal-02600749.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Alkemade, G., 2019. Routing and calibration of distributed hydrological models, MSc Thesis, Vrije Universiteit, Amsterdam, Faculty of Science, Hydrology.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Azadeh Karami Fard, 2015. Modeling runoff of an Ethiopian catchment with WFLOW, MSc. Thesis, Vrije Universiteit, Amsterdam.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Benschop, J., 2023. The application of hybrid lateral routing in hydrological simulations of the Rhine catchment, MSc Thesis, Hydrology and Environmental Hydraulics Group, Wageningen University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Beusen, B., 2021. The effect of rooting depth on discharge and evapotranspiration in (semi-)arid areas, MSc Thesis, Hydrology and Quantitative Water Management Group, Wageningen University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Beusen, B., 2021. Plastic transport and the effect of climate change in the Rhine, Internship report, Deltares.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Bouaziz, L. J. E., 2021. Internal processes in hydrological models: A glance at the Meuse basin from space. Delft University of Technology, Delft, the Netherlands, Doctoral dissertation, https://doi.org/10.4233/uuid:09d84cc1-27e2-4327-a8c7-207a75952061.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Hartgring, S., 2023. On Forecasting the Rur River: Using hindcasts and forecasts of the 2021 flood event to improve understanding of flood forecasting in the Rur catchment. Delft University of Technology, Delft, the Netherlands, MSc thesis, http://resolver.tudelft.nl/uuid:2909d997-a983-490a-a588-87119998543a.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Jaime, D.E.V, 2021. Ensemble hydrological forecasts to derive extreme return periods: Case Study of the Overijsselse Vecht River using the wflow_sbm model, MSc thesis, Unesco IHE, Delft.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"López López, P., 2018. Application of Global Hydrological Datasets for River Basin Modelling Utrecht University, Utrecht, the Netherlands, pp. 1-214, Doctoral dissertation, http://dspace.library.uu.nl/handle/1874/364148.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Maat, W.H., 2015. Simulating discharges and forecasting floods using a conceptual rainfall-runoff model for the Bolivian Mamoré basin, MSc Thesis, University of Twente, Enschede. https://essay.utwente.nl/67046/.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"van Osnabrugge, B., 2020. Interpolate, simulate, assimilate: operational aspects of improving hydrological forecasts in the Rhine basin. Wageningen University, Doctoral dissertation, https://doi.org/10.18174/513157.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rohrmueller, I., 2019. BENCHMARKING THE NEW WFLOW DISTRIBUTED HYDROLOGICAL MODEL, MSc Thesis, School of Engineering - Newcastle University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Rusli, S.R., 2024. Deepening the quantitative understanding of groundwater systems in  data-scarce areas: application in the Bandung Groundwater Basin, Indonesia. Wageningen  University, Doctoral dissertation, https://doi.org/10.18174/640983.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Tretjakova, D., 2015. Investigating the effect of using fully-distributed model and data assimilation on the performance of hydrological forecasting in the Karasu catchment, Turkey, MSc thesis, Wageningen University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Verbrugge, M., 2019. Reservoir Operation Optimization, a case study in the Chao Phraya Basin, BSc thesis, Hydrology and Quantitative Water Management Group, Wageningen University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Verbrugge, M., 2023. Bias-correcting meteorological forcing to improve seasonal discharge forecasting of the Rhine, Internship report, Deltares.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Viguures, P., 2020. Modelling of flash floods in current and future climate with high resolution convection permitting regional climate models in the European Alps, MSc Thesis, Wageningen University.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Visser, B., 2020. Impact of climate change on local water resources of European catchments, Intersnhip report, Deltares.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"Wannasin, C., 2023. Modelling and forecasting daily streamflow with reservoir operation in the upper Chao Phraya River basin, Thailand.   Wageningen University, Doctoral dissertation, https://doi.org/10.18174/584572.","category":"page"},{"location":"intro/publications/#Reports","page":"Publications","title":"Reports","text":"","category":"section"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"World Bank. 2021. Plastic Waste Discharges from Rivers and Coastlines in Indonesia. Marine Plastics Series;. World Bank, Washington, DC. © World Bank, https://openknowledge.worldbank.org/handle/10986/35607, License: CC BY 3.0 IGO.","category":"page"},{"location":"intro/publications/","page":"Publications","title":"Publications","text":"World Meteorological Organization (WMO), 2023. State of Global Water Resources report 2022, WMO-No. 1333, https://library.wmo.int/idurl/4/68473.","category":"page"},{"location":"model_docs/shared_concepts/#Shared-processes","page":"Shared processes","title":"Shared processes","text":"","category":"section"},{"location":"model_docs/shared_concepts/#snow_and_glac","page":"Shared processes","title":"Snow and glaciers","text":"","category":"section"},{"location":"model_docs/shared_concepts/#Snow-modelling","page":"Shared processes","title":"Snow modelling","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"If the air temperature, T_a, is below a user-defined threshold tt (degreeC) precipitation occurs as snowfall, whereas it occurs as rainfall if Ta  tt. A another parameter tti defines how precipitation can occur partly as rain or snowfall (see the figure below). If precipitation occurs as snowfall, it is added to the dry snow component within the snow pack. Otherwise it ends up in the free water reservoir, which represents the liquid water content of the snow pack. Between the two components of the snow pack, interactions take place, either through snow melt (if temperatures are above a threshold tt) or through snow refreezing (if temperatures are below threshold tt.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The respective rates of snow melt and refreezing are:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Q_m = cfmax(T_att) T_a  tt \nQ_r=cfmax  cfr(ttT_a) Ta  tt","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"where Q_m is the rate of snow melt, Q_r is the rate of snow refreezing, and cfmax and cfr are user defined model parameters (the melting factor [mm/(degreeC day)] and the refreezing factor respectively).","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The fraction of liquid water in the snow pack is at most equal to a user defined fraction, whc, of the water equivalent of the dry snow content. If the liquid water concentration exceeds whc, either through snow melt or incoming rainfall, the surplus water (rainfall) becomes available for infiltration into the soil:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"    snowwater = snowwater - refreezing  # free water content in snow\n    maxsnowwater = snow * whc  # max water in the snow\n    snowwater = snowwater + snowmelt + rainfall  # add all water and potentially supersaturate the snowpack\n    rainfall = max(snowwater - maxsnowwater, 0.0)  # rain + surplus snowwater","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"\n (Image: snowmelt)","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Snowmelt and refreezing rates as a function of temperature (for set melting and refreezing factors)","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"# Figure created using python: # hide\n# https://gist.github.com/JoostBuitink/21dd32e71fd1360117fcd1c532c4fd9d#file-snowmelt_fig-py # hide","category":"page"},{"location":"model_docs/shared_concepts/#Glacier-modelling","page":"Shared processes","title":"Glacier modelling","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Glacier processes can be modelled if the snow model is enabled. For the vertical HBV concept snow modelling is not optional. Glacier modelling is very close to snow modelling and considers two main processes: glacier build-up from snow turning into firn/ice (using the HBV-light model) and glacier melt (using a temperature degree-day model).","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The definition of glacier boundaries and initial volume is defined in three parameters. glacierfrac is a parameter that gives the fraction of each grid cell covered by a glacier as a number between zero and one. glacierstore is a state parameter that gives the amount of water (in mm w.e.) within the glaciers at each gridcell. Because the glacier store (glacierstore) cannot be initialized by running the model for a couple of years, a default initial state should be supplied by adding this parameter to the input static file. The required glacier data can be prepared from available glacier datasets.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"First, a fixed fraction of the snowpack on top of the glacier is converted into ice for each timestep and added to the glacierstore using the HBV-light model (Seibert et al., 2018). This fraction g_sifrac typically ranges from 0.001 to 0.006.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Then, when the snowpack on top of the glacier is almost all melted (snow cover < 10 mm), glacier melt is enabled and estimated with a degree-day model. If the air temperature, T_a, is below a certain threshold g_tt (degreeC) precipitation occurs as snowfall, whereas it occurs as rainfall if T_a  g_tt.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"With this the rate of glacier melt in mm is estimated as:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Q_m = g_cfmax(T_a  g_tt)   T_a  g_tt","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"where Q_m is the rate of glacier melt and g_cfmax is the melting factor in mm/(degreeC day). Parameter g_tt can be taken as equal to the snow tt parameter. Values of the melting factor g_cfmax normally varies from one glacier to another and some values are reported in the literature. g_cfmax can also be estimated by multiplying snow cfmax by a factor between 1 and 2, to take into account the higher albedo of ice compared to snow.","category":"page"},{"location":"model_docs/shared_concepts/#Rainfall-interception","page":"Shared processes","title":"Rainfall interception","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Both the Gash and Rutter models are available to estimate rainfall interception by the vegetation. The selection of an interception model depends on the simulation timestep.","category":"page"},{"location":"model_docs/shared_concepts/#The-analytical-(Gash)-model","page":"Shared processes","title":"The analytical (Gash) model","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The analytical model of rainfall interception is based on Rutter's numerical model. The simplifications that introduced allow the model to be applied on a daily basis, although a storm-based approach will yield better results in situations with more than one storm per day. The amount of water needed to completely saturate the canopy is defined as:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"P=frac-overlineRSoverlineE_wlnleft1-fracoverlineE_woverlineR(1-p-p_t)^-1right","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"where overlineR is the average precipitation intensity on a saturated canopy and overlineE_w the average evaporation from the wet canopy and with the vegetation parameters S, p and p_t as defined previously. The model uses a series of expressions to calculate the interception loss during different phases of a storm. An analytical integration of the total evaporation and rainfall under saturated canopy conditions is then done for each storm to determine average values of overlineE_w and overlineR. The total evaporation from the canopy (the total interception loss) is calculated as the sum of the components listed in the table below. Interception losses from the stems are calculated for days with Pgeq S_tp_t. p_t and S_t are small and neglected.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Table: Formulation of the components of interception loss according to Gash:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Components Interception loss\nFor m small storms (P_gP_g) (1-p-p_t)sum_j=1^mP_gj\nWetting up the canopy in n large storms (P_ggeqP_g) n(1-p-p_t)P_g-nS\nEvaporation from saturated canopy during rainfall overlineEoverlineRsum_j=1^n(P_gj-P_g)\nEvaporation after rainfall ceases for n large storms nS\nEvaporation from trunks in q storms that fill the trunk storage qS_t\nEvaporation from  trunks in m+n-q storms that do not fill the trunk storage p_tsum_j=1^m+n-qP_gj","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"In applying the analytical model, saturated conditions are assumed to occur when the hourly rainfall exceeds a certain threshold. Often a threshold of 0.5 mm/hr is used. overlineR is calculated for all hours when the rainfall exceeds the threshold to give an estimate of the mean rainfall rate onto a saturated canopy.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Gash (1979) has shown that in a regression of interception loss on rainfall (on a storm basis) the regression coefficient should equal to overlineE_woverlineR. Assuming that neither overlineE_w nor overlineR vary considerably in time, overlineE_w can be estimated in this way from overlineR in the absence of above-canopy climatic observations. Values derived in this way generally tend to be (much) higher than those calculated with the penman-monteith equation.","category":"page"},{"location":"model_docs/shared_concepts/#The-modified-rutter-model","page":"Shared processes","title":"The modified rutter model","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"For sub daily timesteps the interception is calculated using a simplification of the Rutter model. The simplified model is solved explicitly and does not take drainage from the canopy into account.","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Wflow.rainfall_interception_modrut","category":"page"},{"location":"model_docs/shared_concepts/#Wflow.rainfall_interception_modrut","page":"Shared processes","title":"Wflow.rainfall_interception_modrut","text":"rainfall_interception_modrut(precipitation, potential_evaporation, canopystorage, canopygapfraction, cmax)\n\nInterception according to a modified Rutter model. The model is solved explicitly and there is no drainage below cmax.\n\n\n\n\n\n","category":"function"},{"location":"model_docs/shared_concepts/#Interception-parameters-from-LAI","page":"Shared processes","title":"Interception parameters from LAI","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The SBM concept can determine the interception parameters from leaf area index (LAI) climatology. In order to switch this on you must define this cyclic parameter in the TOML file, the parameter is read from path_static, as follows:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"[input]\npath_forcing = \"data/forcing-moselle.nc\"\npath_static = \"data/staticmaps-moselle.nc\"\n\ncyclic = [\"vertical.leaf_area_index\"]","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Furthermore these additional parameters are required:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Specific leaf storage  (sl [mm])\nStorage woody part of vegetation (swood [mm])\nExtinction coefficient (kext [-])","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Here it is assumed that cmax [mm] (leaves) (canopy storage capacity for the leaves only) relates linearly with LAI (c.f. Van Dijk and Bruijnzeel 2001). This done via the sl. sl can be determined through a lookup table with land cover based on literature (Pitman 1989, Lui 1998). Next the cmax (leaves) is determined using:","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"\n    cmax(leaves)  = sl  LAI","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"To get to total storage (cmax) the woody part of the vegetation also needs to be added. As for sl, the storage of the woody part swood can also be related to land cover (lookup table).","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The canopy gap fraction is determined using the extinction coefficient kext (van Dijk and Bruijnzeel 2001):","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"    canopygapfraction = exp(-kext  LAI)","category":"page"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"The extinction coefficient kext can be related to land cover.","category":"page"},{"location":"model_docs/shared_concepts/#References","page":"Shared processes","title":"References","text":"","category":"section"},{"location":"model_docs/shared_concepts/","page":"Shared processes","title":"Shared processes","text":"Seibert, J., Vis, M. J. P., Kohn, I., Weiler, M., and Stahl, K., 2018, Technical note: Representing glacier geometry changes in a semi-distributed hydrological model, Hydrol. Earth Syst. Sci., 22, 2211–2224, https://doi.org/10.5194/hess-22-2211-2018.","category":"page"},{"location":"user_guide/install/#How-to-install","page":"How to install","title":"How to install","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"First download and install the current stable release of Julia. Please see platform specific instructions for further installation instructions and if you have trouble installing Julia.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"If you are new to Julia, it may be a good idea to check out the Getting Started section of the Julia Manual. Links to other learning resources can be found at julialang.org/learning.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Wflow can be used in two different ways, depending on the required use of the code:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"If you want to stay up-to-date with the latest version, explore and modify the model code, and write your own Julia scripts around the wflow package, we recommend installing wflow as a Julia package.\nIf you don't need extra features, but just want to run simulations, a complied executable version is available. This consists of a single executable, wflow_cli, allowing you to run the model via the command line.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Below we describe how to install both versions of wflow.","category":"page"},{"location":"user_guide/install/#Installing-as-Julia-package","page":"How to install","title":"Installing as Julia package","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Wflow is a Julia package, that can be installed through several different ways. Below we show how to install wflow from Julia's package repository, and how to install the latest version from GitHub.","category":"page"},{"location":"user_guide/install/#Install-from-Julia's-package-repository","page":"How to install","title":"Install from Julia's package repository","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"To access Julia's package manager, press ] in the Julia REPL.  To get back to the Julia REPL, press backspace or ^C.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"tip: Tip\nIf you have not used Julia in a while, it can be a good idea to run up to update your packages.pkg> up","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Access Julia's package manager and install wflow using:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"pkg> add Wflow","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"This can take a while, especially the first time, since compatible dependencies are also automatically looked up and installed from the Pkg General registry.","category":"page"},{"location":"user_guide/install/#Install-from-GitHub","page":"How to install","title":"Install from GitHub","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"It is also possible to install wflow from the master branch as follows:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"pkg> add Wflow#master","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"This command will track the master branch, and will update to the latest commit on that branch when you run update, or simply up, in the Pkg REPL. The use of add will install wflow in you home directory under .julia/packages/Wflow. Note that packages installed under packages by add are supposed to never be altered in that location, for Pkg and it's automatic dependency handling to work well.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"If you want to make any changes to any of the files in the repository, you need to do a development install. This can be done using:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"pkg> dev Wflow","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"This will clone the git repository, put it under your home directory in .julia/dev/Wflow, and add the wflow package to your project environment. Note that to receive updates, you have to pull in the latest changes yourself using git pull.","category":"page"},{"location":"user_guide/install/#Check-installation-of-wflow","page":"How to install","title":"Check installation of wflow","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Finally, go back to the Julia REPL and try to load wflow:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"julia> using Wflow","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"The first time this will take longer as any package that is new or changed needs to be pre-compiled first, to allow faster loading on subsequent uses. No error messages should appear, indicating that you have now successfully installed wflow.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Before ending this section, we want to recommend a few tools that can make using and developing Julia code easier.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"tip: Tip\nThere is a section on editors and IDEs for Julia on https://julialang.org/, scroll down to see it. We use and recommend Microsoft's free and open source Visual Studio Code. When combined with the Julia extension it provides a powerful and interactive development experience.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"tip: Tip\nWhen planning to make changes to the code of wflow, we recommend installing the Revise.jl package. This package allows you to modify code and use the changes without restarting Julia. Install it with add Revise from the Pkg REPL. Then create a file called .julia/config/startup.jl, and put using Revise there. This will load Revise every time you start a Julia session.","category":"page"},{"location":"user_guide/install/#Installing-the-compiled-executable","page":"How to install","title":"Installing the compiled executable","text":"","category":"section"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Binaries of wflow_cli can be downloaded from our website download.deltares.nl, and are currently available for Windows. Download and install the .msi file. After installing you can see two folders in the installation directory. It is only the bin/wflow_cli that is used. The artifacts folder contains binary dependencies such as netCDF.","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"artifacts\\\nbin\\wflow_cli","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Check whether the installation was performed successfully by running wflow_cli with no arguments in the command line. This will give the following message:","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"Usage: wflow_cli 'path/to/config.toml'","category":"page"},{"location":"user_guide/install/","page":"How to install","title":"How to install","text":"note: Note\nThe old version of wflow, based on Python and PCRaster libraries is also available to download from our website download.deltares.nl. We recommend installing the Julia version, as this documentation is written to support this version.","category":"page"},{"location":"model_docs/params_lateral/#params_lat","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"","category":"section"},{"location":"model_docs/params_lateral/#Kinematic-wave","page":"Parameters lateral concepts","title":"Kinematic wave","text":"","category":"section"},{"location":"model_docs/params_lateral/#Surface-flow","page":"Parameters lateral concepts","title":"Surface flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct SurfaceFlowRiver used for river flow, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river] to map the internal model parameter to the external netCDF variable. The input parameter slope (listed under [input.lateral.river]) is not equal to the internal model parameter sl, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nbeta constant in Manning's equation - -\nsl (slope) slope m m^-1 -\nn Manning's roughness s m^-frac13 0.036\ndl length m -\nq discharge m^3 s^-1 -\nqin inflow from upstream cells m^3 s^-1 -\nq_av average discharge m^3 s^-1 -\nqlat lateral inflow per unit length m^2 s^-1 -\ninwater lateral inflow m^3 s^-1 -\ninflow external inflow (abstraction/supply/demand) m^3 s^-1 0.0\ninflow_wb inflow waterbody (lake or reservoir model) from land part m^3 s^-1 0.0\nabstraction abstraction (computed as part of water demand and allocation) m^3 s^-1 0.0\nvolume kinematic wave volume m^3 -\nh water level m -\nh_av average water level m -\nbankfull_depth bankfull river depth m 1.0\ndt model time step s -\nits number of fixed iterations - -\nwidth width m -\nalpha_pow used in the power part of alpha - -\nalpha_term term used in computation of alpha - -\nalpha constant in momentum equation A = alpha Q^beta s^frac35 m^frac15 -\ncel celerity of kinematic wave m s^-1 -\nreservoir_index map cell to 0 (no reservoir) or i (pick reservoir i in reservoir field) - -\nlake_index map cell to 0 (no lake) or i (pick lake i in lake field) - -\nreservoir an array of reservoir models SimpleReservoir - -\nlake an array of lake models Lake - -\nallocation water allocation of type AllocationRiver - -\nkinwave_it boolean for kinematic wave iterations - false","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct SurfaceFlowLand used for overland flow, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.land] to map the internal model parameter to the external netCDF variable. The input parameter slope (listed under [input.lateral.land]) is not equal to the internal model parameter sl, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nbeta constant in Manning's equation - -\nsl (slope) slope m m^-1 -\nn Manning's roughness s m^-frac13 0.072\ndl length m -\nq discharge m^3 s^-1 -\nqin inflow from upstream cells m^3 s^-1 -\nq_av average discharge m^3 s^-1 -\nqlat lateral inflow per unit length m^2 s^-1 -\ninwater lateral inflow m^3 s^-1 -\nvolume kinematic wave volume m^3 -\nh water level m -\nh_av average water level m -\ndt model time step s -\nits number of fixed iterations - -\nwidth width m -\nalpha_pow used in the power part of alpha - -\nalpha_term term used in computation of alpha - -\nalpha constant in momentum equation A = alpha Q^beta s^frac35 m^frac15 -\ncel celerity of kinematic wave m s^-1 -\nto_river part of overland flow that flows to the river m^3 s^-1 -\nkinwave_it boolean for kinematic wave iterations - false","category":"page"},{"location":"model_docs/params_lateral/#reservoir_params","page":"Parameters lateral concepts","title":"Reservoirs","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct SimpleReservoir, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river.reservoir], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"Two parameters reservoir coverage areas and the outlet of reservoirs (unique id) locs that are not part of the SimpleReservoir struct are also required, and can be set as follows through the TOML file:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.river.reservoir]\nareas = \"wflow_reservoirareas\"\nlocs = \"wflow_reservoirlocs\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\narea area m^2 -\ndemand minimum (environmental) flow requirement downstream of the reservoir m^3 s^-1 -\nmaxrelease maximum amount that can be released if below spillway m^3 s^-1 -\nmaxvolume maximum storage (above which water is spilled) m^3 -\ntargetfullfrac target fraction full (of max storage) - -\ntargetminfrac target minimum full fraction (of max storage) - -\ndemandrelease minimum (environmental) flow released from reservoir m^3 s^-1 -\ndt model time step s -\nvolume volume m^3 -\ninflow total inflow into reservoir m^3 -\noutflow outflow into reservoir m^3 s^-1 -\ntotaloutflow total outflow into reservoir m^3 -\npercfull fraction full (of max storage) - -\nprecipitation average precipitation for reservoir area mm Δt⁻¹ -\nevaporation average potential evaporation for reservoir area mm Δt⁻¹ -\nactevap average actual evaporation for lake area mm Δt⁻¹ -","category":"page"},{"location":"model_docs/params_lateral/#lake_params","page":"Parameters lateral concepts","title":"Lakes","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct Lake, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river.lake], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"Two parameters lake coverage areas and the outlet of lakes (unique id) locs that are not part of the Lake struct are also required, and can be set as follows through the TOML file:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.river.lake]\nareas = \"wflow_lakeareas\"\nlocs = \"wflow_lakelocs\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The input parameter linkedlakelocs (listed under [input.lateral.river.lake]) is not equal to the internal model parameter lowerlake_ind, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\narea area m^2 -\nb Rating curve coefficient - -\ne Rating curve exponent - -\noutflowfunc type of lake rating curve - -\nstorfunc type of lake storage curve - -\nthreshold water level threshold H_0 below that level outflow is zero m -\nwaterlevel waterlevel H of lake m -\nlowerlake_ind (linkedlakelocs) Index of lower lake (linked lakes) - 0\nsh data for storage curve - -\nhq data rating curve - -\ndt model time step s -\ninflow total inflow to the lake m^3 -\nstorage storage lake m^3 -\nmaxstorage maximum storage lake with rating curve type 1 m^3 -\noutflow outflow lake m^3 s^-1 -\ntotaloutflow total outflow lake m^3 -\nprecipitation average precipitation for lake area mm Δt⁻¹ -\nevaporation average potential evaporation for lake area mm Δt⁻¹ -\nactevap average actual evaporation for lake area mm Δt⁻¹ -","category":"page"},{"location":"model_docs/params_lateral/#params_ssf","page":"Parameters lateral concepts","title":"Lateral subsurface flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct LateralSSF, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF). The soil related parameters f, soilthickness, z_exp, theta_s and theta_r are derived from the vertical SBM concept (including unit conversion for f, z_exp and soilthickness), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. The internal slope model parameter slope is set through the TOML file as follows:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.land]\nslope = \"Slope\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The parameter kh_0 is computed by multiplying the vertical hydraulic conductivity at the soil surface kv_0 (including unit conversion) of the vertical SBM concept with the internal parameter khfrac [-] (default value of 1.0). The internal model parameter khfrac is set through the TOML file as follows:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.subsurface]\nksathorfrac = \"KsatHorFrac\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The khfrac parameter compensates for anisotropy, small scale kv_0 measurements (soil core) that do not represent larger scale hydraulic conductivity, and smaller flow length scales (hillslope) in reality, not represented by the model resolution.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"For the vertical SBM concept different vertical hydraulic conductivity depth profiles are possible, and these also determine which LateralSSF parameters are used including the input requirements for the computation of lateral subsurface flow. For the exponential profile the model parameters kh_0 and f are used. For the exponential_constant profile kh_0 and f are used, and z_exp is required as part of [input.vertical]. For the layered profile, SBM model parameter kv is used, and for the layered_exponential profile kv is used and z_exp is required as part of [input.vertical].","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nkh_0 horizontal hydraulic conductivity at soil surface m d^-1 3.0\nf a scaling parameter (controls exponential decline of kh_0) m^-1 1.0\nkh horizontal hydraulic conductivity m d^-1 -\nkhfrac (ksathorfrac) a muliplication factor applied to vertical hydraulic conductivity kv - 100.0\nsoilthickness soil thickness m 2.0\ntheta_s saturated water content (porosity) - 0.6\ntheta_r residual water content - 0.01\ndt model time step d -\nslope slope m m^-1 -\ndl drain length m -\ndw drain width m -\nzi pseudo-water table depth (top of the saturated zone) m -\nz_exp depth from soil surface for which exponential decline of kh_0 is valid m -\nexfiltwater exfiltration (groundwater above surface level, saturated excess conditions) m Δt⁻¹ -\nrecharge net recharge to saturated store m^2 Δt⁻¹ -\nssf subsurface flow m^3 d-1 -\nssfin inflow from upstream cells m^3 d-1 -\nssfmax maximum subsurface flow m^2 d-1 -\nto_river part of subsurface flow that flows to the river m^3 d-1 -\nvolume subsurface water volume m^3 -","category":"page"},{"location":"model_docs/params_lateral/#Local-inertial","page":"Parameters lateral concepts","title":"Local inertial","text":"","category":"section"},{"location":"model_docs/params_lateral/#local-inertial_river_params","page":"Parameters lateral concepts","title":"River flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct ShallowWaterRiver, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river], to map the internal model parameter to the external netCDF variable. The parameter river bed elevation zb is based on the bankfull elevation and depth input data:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.river]\nbankfull_elevation = \"RiverZ\"\nbankfull_depth = \"RiverDepth\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"When floodplain routing (parameter floodplain) is included as part of local inertial river flow, parameter q_av represents the total average discharge of the river channel and floodplain routing, and parameter q_channel_av represents average river channel discharge. Otherwise parameters q_av and q_channel_av represent both average river channel discharge (are equal).","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The input parameter n (listed under [input.lateral.river]) is not equal to the internal model parameter mannings_n, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nmannings_n (n) Manning's roughness s m^-frac13 0.036\nwidth river width m -\nzb river bed elevation m -\nlength river length m -\nn number of cells - -\nne number of edges/links - -\nactive_n active nodes - -\nactive_e active edges - -\ng acceleration due to gravity m s^-2 -\nalpha stability coefficient (Bates et al., 2010) - 0.7\nh_thresh depth threshold for calculating flow m 0.001\ndt model time step s -\nq river discharge (subgrid channel) m^3 s^-1 -\nq_av average river channel (+ floodplain) discharge m^3 s^-1 -\nq_channel_av average river channel discharge m^3 s^-1 -\nzb_max maximum channel bed elevation m -\nmannings_n_sq Manning's roughness squared at edge/link (s m^-frac13)^2 -\nh water depth m -\nzs_max maximum water elevation m -\nzs_src water elevation of source node of edge m -\nzs_dst water elevation of downstream node of edge m -\nhf water depth at edge/link m -\nh_av average water depth m -\ndl river length m -\ndl_at_link river length at edge/link m -\nwidth river width m -\nwidth_at_link river width at edge/link m -\na flow area at edge/link m^2 -\nr hydraulic radius at edge/link m -\nvolume river volume m^3 -\nerror error volume m^3 -\ninwater lateral inflow m^3 s^-1 -\ninflow external inflow (abstraction/supply/demand) m^3 s^-1 0.0\nabstraction abstraction (computed as part of water demand and allocation) m^3 s^-1 0.0\ninflow_wb inflow waterbody (lake or reservoir model) from land part m^3 s^-1 0.0\nbankfull_volume bankfull volume m^3 -\nbankfull_depth bankfull depth m -\nfroude_limit if true a check is performed if froude number > 1.0 (algorithm is modified) - -\nreservoir_index river cell index with a reservoir - -\nlake_index river cell index with a lake - -\nwaterbody water body cells (reservoir or lake) - -\nreservoir an array of reservoir models SimpleReservoir - -\nlake an array of lake models Lake - -\nallocation optional water allocation of type AllocationRiver - -\nfloodplain optional 1D floodplain routing FloodPlain - -","category":"page"},{"location":"model_docs/params_lateral/#local-inertial_floodplain_params","page":"Parameters lateral concepts","title":"1D floodplain","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct FloodPlain (part of struct ShallowWaterRiver), including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river.floodplain], to map the internal model parameter to the external netCDF variable. The input parameter n (listed under [input.lateral.river.floodplain]) is not equal to the internal model parameter mannings_n, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nprofile Floodplain profile FloodPlainProfile  \nmannings_n (n) Manning's roughness for the floodplain s m^-frac13 0.072\nmannings_n_sq Manning's roughness squared at edge/link (s m^-frac13)^2 -\nvolume flood volume m^3 -\nh flood depth m -\nh_av average flood depth m -\nerror  error volume m^3\na flow area at edge/link m^2 -\nr hydraulic radius at edge/link m -\nhf flood depth at edge/link m -\nzb_max maximum bankfull elevation at edge m -\nq0 discharge at previous time step m^3 s^-1 -\nq discharge m^3 s^-1 -\nq_av average discharge m^3 s^-1 -\nhf_index index with hf above depth threshold - -","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The floodplain profile FloodPlainProfile contains the following parameters:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\ndepth (flood_depth) flood depths m -\nvolume cumulative flood volume (per flood depth) m^3 -\nwidth cumulative floodplain width (per flood depth) m -\na cumulative floodplain flow area (per flood depth) m^2 -\np cumulative floodplain wetted perimeter (per flood depth) m -","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The floodplain volumes (per flood depth interval) can be set as follows through the TOML file:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.river.floodplain]\nvolume = \"floodplain_volume\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The input parameter flood_depth (dimension of floodplain volume) is not equal to the internal model parameter depth, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/#local-inertial_land_params","page":"Parameters lateral concepts","title":"Overland flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct ShallowWaterLand, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.land], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The mannings roughness (for the computation of mannings_n_sq) should be provided as follows in the TOML file:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.lateral.land]\nn = \"n_land\" # mannings roughness","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The input parameter elevation (listed under [input.lateral.land]) is not equal to the internal model parameter z, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nn number of cells - -\nxl cell length x direction m -\nyl cell length y direction m -\nxwidth effective flow width x direction (floodplain) m -\nywidth effective flow width y direction (floodplain) m -\ng acceleration due to gravity m s^-2 -\ntheta weighting factor (de Almeida et al., 2012) - 0.8\nalpha stability coefficient (Bates et al., 2010) - 0.7\nh_thresh depth threshold for calculating flow m 0.001\ndt model time step s -\nqy0 flow in y direction at previous time step m^3 s^-1 -\nqx0 flow in x direction at previous time step m^3 s^-1 -\nqx flow in x direction m^3 s^-1 -\nqy flow in y direction m^3 s^-1 -\nzx_max maximum cell elevation (x direction) m -\nzy_max maximum cell elevation (y direction) m -\nmannings_n_sq Manning's roughness squared s m^-frac13 based on 0.072\nvolume total volume of cell (including river volume for river cells) m^3 -\nerror error volume m^3 -\nrunoff runoff from hydrological model m^3 s^-1 -\nh water depth of cell m -\nz (elevation) elevation of cell m -\nfroude_limit if true a check is performed if froude number > 1.0 (algorithm is modified) - -\nrivercells river cells - -\nh_av average water depth m -","category":"page"},{"location":"model_docs/params_lateral/#Water-allocation-river","page":"Parameters lateral concepts","title":"Water allocation river","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct AllocationRiver, used when water demand and allocation is computed (optional), including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nact_surfacewater_abst actual surface water abstraction mm Δt⁻¹ -\nact_surfacewater_abst_vol actual surface water abstraction m^3 Δt⁻¹ -\navailable_surfacewater available surface water m^3 -\nnonirri_returnflow return flow from non-irrigation (industry, domestic and livestock) mm Δt⁻¹ -","category":"page"},{"location":"model_docs/params_lateral/#Groundwater-flow","page":"Parameters lateral concepts","title":"Groundwater flow","text":"","category":"section"},{"location":"model_docs/params_lateral/#Confined-aquifer","page":"Parameters lateral concepts","title":"Confined aquifer","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct ConfinedAquifer, including a description of these parameters, the unit, and default value if applicable. Struct ConfinedAquifer is not (yet) part of a wflow model.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nk horizontal conductivity m d^-1s -\nstorativity storativity m m^-1 -\nspecific_storage specific storage m^-1 -\ntop top groundwater layers m -\nbottom bottom groundwater layers m -\narea cell area m^2 -\nhead groundwater head m -\nconductance conductance m^2 d^-1 -","category":"page"},{"location":"model_docs/params_lateral/#Unconfined-aquifer","page":"Parameters lateral concepts","title":"Unconfined aquifer","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct UnconfinedAquifer, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. The top parameter is provided by the external parameter altitude as part of the static input data and set as follows through the TOML file:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input]\n# these are not directly part of the model\naltitude = \"wflow_dem\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The input parameter conductivity (listed under [input.lateral.subsurface]) is not equal to the internal model parameter kh_0, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nkh_0 (conductivity) horizontal conductivity m d^-1s -\nspecific_yield specific yield m m^-1 -\ntop (altitude) top groundwater layer m -\nbottom bottom groundwater layer m -\narea cell area m^2 -\nhead groundwater head m -\nconductance conductance m^2 d^-1 -\nf factor controlling the reduction of reference horizontal conductivity - 3.0","category":"page"},{"location":"model_docs/params_lateral/#Constant-Head","page":"Parameters lateral concepts","title":"Constant Head","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct ConstantHead, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.subsurface], to map the internal model parameter to the external netCDF variable. The input parameter constant_head (listed under [input.lateral.subsurface]) is not equal to the internal model parameter head, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nhead (constant_head) groundwater head m -\nindex constant head cell index - -","category":"page"},{"location":"model_docs/params_lateral/#Boundary-conditions","page":"Parameters lateral concepts","title":"Boundary conditions","text":"","category":"section"},{"location":"model_docs/params_lateral/#gwf_river_params","page":"Parameters lateral concepts","title":"River","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct River, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.subsurface], to map the internal model parameter to the external netCDF variable. The input parameter river_bottom (listed under [input.lateral.subsurface]) is not equal to the internal model parameter bottom, and is listed in the Table below between parentheses.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nstage river stage m -\ninfiltration_conductance river bed infiltration conductance m^2 day^-1 m^2 day^-1 -\nexfiltration_conductance river bed exfiltration conductance m^2 day^-1 -\nbottom (river_bottom) river bottom elevation m -\nindex river cell index - -\nflux exchange flux (river to aquifer) m^3 d^-1 -","category":"page"},{"location":"model_docs/params_lateral/#gwf_drainage_params","page":"Parameters lateral concepts","title":"Drainage","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct Drainage, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.subsurface], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.lateral.subsurface] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nelevation (drain_elevation) drain elevation m -\nconductance (drain_conductance) drain conductance m^2 day^-1 -\nindex (drain) drain cell index - -\nflux exchange flux (drains to aquifer) m^3 day^-1 -","category":"page"},{"location":"model_docs/params_lateral/#gwf_recharge_params","page":"Parameters lateral concepts","title":"Recharge","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct Recharge, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nrate recharge rate m^3 day^-1 -\nindex recharge cell index - -\nflux recharge flux m^3 day^-1 -","category":"page"},{"location":"model_docs/params_lateral/#gwf_headboundary_params","page":"Parameters lateral concepts","title":"Head boundary","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct HeadBoundary, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nhead head m -\nconductance conductance of the head boundary m^2 day^-1 -\nindex head boundary cell index - -\nflux conductance of the head boundary m^3 day^-1 -","category":"page"},{"location":"model_docs/params_lateral/#well_boundary_params","page":"Parameters lateral concepts","title":"Well boundary","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct Well, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"input parameter description unit default\nvolumetric_rate volumetric well rate m^3 d^-1 -\nindex well index - -\nflux actual well flux m^3 day^-1 -","category":"page"},{"location":"model_docs/params_lateral/#Sediment","page":"Parameters lateral concepts","title":"Sediment","text":"","category":"section"},{"location":"model_docs/params_lateral/#Overland-flow","page":"Parameters lateral concepts","title":"Overland flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct OverlandFlowSediment, including a description of these parameters, the unit, and default value if applicable.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\nn number of cells - -\nrivcell river cells - -\nsoilloss total eroded soil ton Δt^-1 -\nerosclay eroded soil for particle class clay ton Δt^-1 -\nerossilt eroded soil for particle class silt ton Δt^-1 -\nerossand eroded soil for particle class sand ton Δt^-1 -\nerossagg eroded soil for particle class small aggregates ton Δt^-1 -\neroslagg eroded soil for particle class large aggregates ton Δt^-1 -\nTCsed total transport capacity of overland flow ton Δt^-1 -\nTCclay transport capacity of overland flow for particle class clay ton Δt^-1 -\nTCsilt transport capacity of overland flow for particle class silt ton Δt^-1 -\nTCsand transport capacity of overland flow for particle class sand ton Δt^-1 -\nTCsagg transport capacity of overland flow for particle class small aggregates ton Δt^-1 -\nTClagg transport capacity of overland flow for particle class large aggregates ton Δt^-1 -\ninlandsed sediment reaching the river with overland flow ton Δt^-1 -\ninlandclay sediment with particle class clay reaching the river with overland flow ton Δt^-1 -\ninlandsilt sediment with particle class silt reaching the river with overland flow ton Δt^-1 -\ninlandsand sediment with particle class sand reaching the river with overland flow ton Δt^-1 -\ninlandsagg sediment with particle class small aggregates reaching the river with overland flow ton Δt^-1 -\ninlandlagg sediment with particle class large aggregates reaching the river with overland flow ton Δt^-1 -","category":"page"},{"location":"model_docs/params_lateral/#River-flow","page":"Parameters lateral concepts","title":"River flow","text":"","category":"section"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows external parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river]. These external parameters are not part of struct RiverSediment, but used to calculate parameters of struct RiverSediment.","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"external parameter description unit default\nreslocs reservoir location (outlet) - -\nresareas reservoir coverage - -\nresarea reservoir area - m^2\nrestrapeff reservoir trapping efficiency coefficient - -\nlakelocs lake location (outlet) - -\nlakeareas lake coverage - -\nlakearea lake area - m^2","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"The Table below shows the parameters (fields) of struct RiverSediment, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.lateral.river], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.lateral.river] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable RiverSlope:","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"[input.vertical]\nslope = \"RiverSlope\"","category":"page"},{"location":"model_docs/params_lateral/","page":"Parameters lateral concepts","title":"Parameters lateral concepts","text":"parameter description unit default\ndl (length) river length m -\nwidth river width m -\nsl (slope) river slope - -\nrhos (rhosed) density of sediment kg m^-31 2650.0\ndmclay median diameter particle size class clay mm 2.0\ndmsilt median diameter particle size class silt mm 10.0\ndmsand median diameter particle size class sand mm 200.0\ndmsagg median diameter particle size class small aggregates mm 30.0\ndmlagg median diameter particle size class large aggregates mm 500.0\ndmgrav median diameter particle size class gravel mm 2000.0\nfclayriv fraction of particle class clay - -\nfsiltriv fraction of particle class silt - -\nfsandriv fraction of particle class sand - -\nfsaggriv fraction of particle class small aggregates - -\nflaggriv fraction of particle class large aggregates - -\nfgravriv fraction of particle class gravel - -\nd50 (d50riv) river sediment median diameter mm -\nd50engelund river mean diameter mm -\ncbagnold Bagnold c coefficient - -\nebagnold Bagnold exponent - -\nn number of cells - -\ndt model time step s -\nak Kodatie coefficient a - -\nbk Kodatie coefficient b - -\nck Kodatie coefficient c - -\ndk Kodatie coefficient d - -\nkdbank bank erodibilty m^3 N^-1 s^-1 -\nkdbed bed erodibility m^3 N^-1 s^-1 -\nTCrbank critical bed bank shear stress m^3 N^-2 -\nTCrbed critical bed shear stress m^3 N^-2 -\nh_riv river water level m -\nq_riv river discharge m^3 s^-1 -\ninlandclay sediment input with particle class clay from land erosion t Δt^-1 -\ninlandsilt sediment input with particle class silt from land erosion t Δt^-1 -\ninlandsand sediment input with particle class sand from land erosion t Δt^-1 -\ninlandsagg sediment input with particle class small aggregates from land erosion t Δt^-1 -\ninlandlagg sediment input with particle class large aggregates from land erosion t Δt^-1 -\ninlandsed sediment input from land erosion t Δt^-1 -\nsedload sediment left in the cell t -\nclayload sediment with particle class clay left in the cell t -\nsiltload sediment with particle class silt left in the cell t -\nsandload sediment with particle class sand left in the cell t -\nsaggload sediment with particle class small aggregates left in the cell t -\nlaggload sediment with particle class large aggregates in the cell t -\ngravload sediment with particle class gravel left in the cell t -\nsedstore sediment stored on the river bed after deposition t Δt^-1 -\nclaystore sediment with particle class clay stored on the river bed after deposition t Δt^-1 -\nsiltstore sediment with particle class silt stored on the river bed after deposition t Δt^-1 -\nsandstore sediment with particle class sand stored on the river bed after deposition t Δt^-1 -\nsaggstore sediment with particle class small aggregates stored on the river bed after deposition t Δt^-1 -\nlaggstore sediment with particle class large aggregates stored on the river bed after deposition t Δt^-1 -\ngravstore sediment with particle class gravel stored on the river bed after deposition t Δt^-1 -\noutsed sediment flux t Δt^-1 -\noutclay sediment with particle class clay flux t Δt^-1 -\noutsilt sediment with particle class silt t Δt^-1 -\noutsand sediment with particle class sand t Δt^-1 -\noutsagg sediment with particle class small aggregates t Δt^-1 -\noutlagg sediment with particle class large aggregates t Δt^-1 -\noutgrav sediment with particle class gravel t Δt^-1 -\nSedconc total sediment concentration (SSconc + Bedconc) g m^-3 -\nSSconc suspended load concentration g m^-3 -\nBedconc bed load concentration g m^-3 -\nmaxsed river transport capacity t Δt^-1 -\nerodsed total eroded sediment t Δt^-1 -\nerodsedbank eroded bank sediment t Δt^-1 -\nerodsedbed eroded bed sediment t Δt^-1 -\ndepsed deposited sediment t Δt^-1 -\ninsed sediment input flux t Δt^-1 -\nwbcover waterbody coverage - -\nwblocs waterbody locations - -\nwbarea waterbody area m^2 -\nwbtrap waterbody trapping efficiency coefficient - -","category":"page"},{"location":"model_docs/lateral/sediment_flux/#Sediment-flux","page":"Sediment flux","title":"Sediment flux","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Both the inland and river sediment model take into account sediment flux or transport of sediment in water, either in overland flow or in the stream flow. These two transport are distinguished in two different structures.","category":"page"},{"location":"model_docs/lateral/sediment_flux/#Inland-Sediment-Model","page":"Sediment flux","title":"Inland Sediment Model","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/#Sediment-Flux-in-overland-flow","page":"Sediment flux","title":"Sediment Flux in overland flow","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Once the amount of soil detached by both rainfall and overland flow has been estimated, it has then to be routed and delivered to the river network. Inland routing in sediment models is usually done by comparing the amount of detached sediment with the transport capacity of the flow, which is the maximum amount of sediment that the flow can carry downslope. There are several existing formulas available in the literature. For a wide range of slopes and for overland flow, the Govers equation (1990) seems the most appropriate choice (Hessel et al, 2007). However, as the wflow_sediment model was developed to be linked to water quality issues, the Yalin transport equation was chosen as it can handle particle differentiation (Govers equation can still be used if wflow_sediment is used to only model inland processes with no particle differentiation). For land cells, wflow_sediment assumes that erosion can mobilize 5 classes of sediment:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Clay (mean diameter of 2 mum)\nSilt (mean diameter of 10 mum)\nSand (mean diameter of 200 mum)\nSmall aggregates (mean diameter of 30 mum)\nLarge aggregates (mean diameter of 500 mum).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   PSA = SAN (1-CLA)^24 \n   PSI = 013SIL\n   PCL = 020CLA \n   SAG = 20CLA    CLA  025 \n   SAG = 028(CLA-025)+05    025 leq CLA leq 05 \n   SAG = 057    CLA  05 \n   LAG = 1 - PSA - PSI - PCL - SAG","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where CLA, SIL and SAN are the primary clay, silt, sand fractions of the topsoil and PCL, PSI, PSA, SAG and LAG are the clay, silt, sand, small and large aggregates fractions of the detached sediment respectively. The transport capacity of the flow using Yalin's equation with particle differentiation, developed by Foster (1982), is:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   TC_i = (P_e)_i  (S_g)_i  rho_w   g  d_i  V_*","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where TC_i is the transport capacity of the flow for the particle class i, (P_e)_i is the effective number of particles of class i, (S_g)_i is the specific gravity for the particle class i (kg m^-3), rho_w is the mass density of the fluid (kg m^-3), g is the acceleration due to gravity (m s^-2), d_i is the diameter of the particle of class i (m) and V_*=(g R S)^05 is the shear velocity of the flow (m s^-1) with S the slope gradient and R the hydraulic radius of the flow (m). The detached sediment are then routed downslope until the river network using the accucapacityflux, accupacitystate functions depending on the transport capacity from Yalin.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"The choice of transport capacity method for the overland flow is set up in the model section of the TOML:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"[model]\nlandtransportmethod = \"yalinpart\" # Overland flow transport capacity method: [\"yalinpart\", \"govers\", \"yalin\"]","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Note that the \"govers\" and \"yalin\" equations can only assess total transport capacity of the flow and can therefore not be used in combination with the river part of the sediment model.","category":"page"},{"location":"model_docs/lateral/sediment_flux/#River-Sediment-Model","page":"Sediment flux","title":"River Sediment Model","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Sediment dynamics in rivers can be described by the same three processes on land: erosion, deposition and transport. The difference is that channel ﬂow is much higher, deeper and permanent compared to overland ﬂow. In channels, erosion is the direct removal of sediments from the river bed or bank (lateral erosion). Sediments are transported in the river either by rolling, sliding and silting (bed load transport) or via turbulent flow in the higher water column (suspended load transport). The type of transport is determined by the river bed shear stress. As sediment particles have a higher density than water, they can also be deposited on the river bed according to their settling velocity compared to the ﬂow velocity. In addition to regular deposition in the river, lakes, reservoirs and floodplains represents additional major sediment settling pools.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Complete models of sediment dynamics based on hydrology and not on hydraulics or hydrodynamics are much rarer than for soil loss and inland dynamics. The simpler models such as the SWAT default sediment river model uses again the transport capacity of the ﬂow to determine if there is erosion or deposition (Neitsch et al., 2011).  A more physics-based approach (Partheniades, 1965) to determine river erosion is used by Liu et al. (2018) and in the new SWAT's approach developed by Narasimhan et al. (2017). For wﬂow_sediment, the new physics-based model of SWAT was chosen for transport and erosion as it enables the use of parameter estimation for erosion of bed and bank of the channel and separates the suspended from the bed loads.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Overview of the different processes for a river cell in wflow_sediment.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"(Image: sediment_instream)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Running the river model is an option of the wflow_sediment model and is enabled using the TOML file. By default it is false:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"[model]\nrunrivermodel = true","category":"page"},{"location":"model_docs/lateral/sediment_flux/#Sediment-inputs-in-a-river-cell","page":"Sediment flux","title":"Sediment inputs in a river cell","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"The first part of the river model assesses how much detached sediment are in the river cell at the beginning of the timestep t. Sources of detached sediment are sediments coming from land erosion, estimated with the soil loss part of wflow_sediment model, the sediment coming from upstream river cells and the detached sediment that were left in the cell at the end of the previous timestep (t-1):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   (sed_in)_t = (sed_land)_t + upstreamleft(sed_out)_t-1right + (sed_riv)_t-1","category":"page"},{"location":"model_docs/lateral/sediment_flux/#River-transport-and-erosion","page":"Sediment flux","title":"River transport and erosion","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Once the amount of sediment inputs at the beginning of the timestep is known, the model then estimates transport, and river erosion if there is a deficit of sediments. Transport in the river system is estimated via a transport capacity formula. There are several transport capacity formulas available in wflow_sediment, some requiring calibration and some not. Choosing a transport capacity equation depends on the river characteristics (some equation are more suited for narrow or wider rivers), and on the reliability of the required river parameters (such as slope, width or mean particle diameter of the river channel). Several river transport capacity are available and the choice is set up in the model section of the TOML:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"[model]\nrivtransportmethod = \"bagnold\" # River flow transport capacity method: [\"bagnold\", \"engelund\", \"yang\", \"kodatie\", \"molinas\"]","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Simplified Bagnold","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Originally more valid for intermediate to large rivers, this simplified version of the Bagnold equation relates sediment transport to flow velocity with two simple calibration parameters (Neitsch et al, 2011):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"C_max = c_sp  left( dfracprf Qh  W right) ^sp_exp","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where C_max is the sediment concentration (ton m^-3 or kg/L), Q is the surface runoff in the river cell (m^3s^-1), h is the river water level (m), W is the river width (m) and c_sp, prf and sp_exp are calibration parameters. The prf coefficient is usually used to deduce the peak velocity of the flow, but for simplification in wflow_sediment, the equation was simplified to only get two parameters to calibrate: sp_exp and c_Bagnold = c_sp  prf^sp_exp. The coefficient sp_exp usually varies between 1 and 2 while prf and c_sp have a wider range of variation. The table below summarizes ranges and values of the three Bagnold coefficients used by other studies:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Table: Range of the simplified Bagnold coefficients (and calibrated value)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Study River prf range c_sp range sp_exp range\nVigiak 2015 Danube 0.5-2 (/) 0.0001-0.01 (0.003-0.006) 1-2 (1.4)\nVigiak 2017 Danube / 0.0001-0.01 (0.0015) 1-2 (1.4)\nAbbaspour 2007 Thur (CH) 0.2-0.25 (/) 0.001-0.002 (/) 0.35-1.47 (/)\nOeurng 2011 Save (FR) 0-2 (0.58) 0.0001-0.01 (0.01) 1-2 (2)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Engelund and Hansen This transport capacity is not present in SWAT but used in many models such as Delft3D-WAQ, Engelund and Hansen calculates the total sediment load as (Engelund and Hansen, 1967):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   C_w = 005 left( dfracrho_srho_s - rho right) left( dfracu Ssqrtleft( dfracrho_srho_s - rho right) g  D_50 right) theta^12","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where C_w is the sediment concentration by weight, rho and rho_s are the fluid and sediment density (here equal to 1000 and 2650 g m^-3), u is the water mean velocity (m s^-1), S is the river slope, g is the acceleration due to gravity, D_50 is the river mean diameter (m) and theta is the Shields parameter.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Kodatie Kodatie (1999) developed the power relationships from Posada (1995) using field data and linear optimization so that they would be applicable for a wider range of riverbed sediment size. The resulting equation, for a rectangular channel, is (Neitsch et al, 2011):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   C_max = left( dfraca u^b h^c S^dV_in right)  W","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where V_in in the volume of water entering the river cell during the timestep (m^3) and a, b, c and d are coefficients depending on the riverbed sediment size. Values of these coefficients are summarized in the table below.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Table: Range of the simplified Bagnold coefficients (and calibrated value)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"River sediment diameter a b c d\nD_50 leq 0.05mm 281.4 2.622 0.182 0\n0.05  D_50 leq 0.25mm 2  829.6 3.646 0.406 0.412\n0.25  D_50 leq 2mm 2  123.4 3.300 0.468 0.613\nD_50  2mm 431  884.8 1.000 1.000 2.000","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Yang Yang (1996) developed a set of two equations giving transport of sediments for sand-bed or gravel-bed rivers. The sand equation (D_50  2mm) is:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   logleft(C_ppmright) = 5435 - 0286logfracomega_s50D_50nu-0457logfracu_*omega_s50 \n   +left(1799-0409logfracomega_s50D_50nu-0314logfracu_*omega_s50right)logleft(fracuSomega_s50-fracu_crSomega_s50right)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"And the gravel equation (2 leq D_50  10 mm) is:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   logleft(C_ppmright) = 6681 - 0633logfracomega_s50D_50nu-4816logfracu_*omega_s50 \n   +left(2784-0305logfracomega_s50D_50nu-0282logfracu_*omega_s50right)logleft(fracuSomega_s50-fracu_crSomega_s50right)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where C_ppm is sediment concentration in parts per million by weight, omega_s50 is the settling velocity of a particle with the median riverbed diameter estimated with Stokes (m s^-1), nu is the kinematic viscosity of the fluid (m^2s^-1), u_* is the shear velocity (sqrtgR_HS in m s^-1 with R_H the hydraulic radius of the river) and u_cr is the critical velocity (m/s, equation can be found in Hessel, 2007).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Molinas and Wu The Molinas and Wu (2001) transport equation was developed for large sand-bed rivers based on the universal stream power psi. The corresponding equation is (Neitsch et al, 2011):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   C_w = dfrac1430 (086+sqrtpsi) psi^150016+psi 10^-6","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where psi is the universal stream power given by:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   psi = dfracpsi^3left(dfracrho_srho-1right) g h omega_s50  left log_10left(dfrachD_50right)right^2","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Once the maximum concentration C_max is established with one of the above transport formula, the model then determines if there is erosion of the river bed and bank. In order to do that, the difference sed_ex between the maximum amount of sediment estimated with transport (sed_max = C_max V_in) and the sediment inputs to the river cell (sed_in calculated above) is calculated. If too much sediment is coming in and sed_ex is negative, then there is no river bed and bank erosion. And if the river has not reach its maximum transport capacity, then erosion of the river happens.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"First, the sediments stored in the cell from deposition in previous timesteps sed_stor are eroded from clay to gravel. If this amount is not enough to cover sed_ex, then erosion of the local river bed and bank material starts.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Instead of just setting river erosion amount to just cover the remaining difference sed_exeff between sed_ex and sed_stor, actual erosion potential is adjusted using river characteristics and is separated between the bed and bank of the river using the physics-based approach of Knight (1984).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"The bed and bank of the river are supposed to only be able to erode a maximum amount of their material E_Rbed for the bed and E_Rbank for the river bank. For a rectangular channel, assuming it is meandering and thus only one bank is prone to erosion, they are calculated from the equations (Neitsch et al, 2011):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   E_Rbed = k_dbed left( tau_ebed - tau_crbed right) 10^-6  L  W  rho_b bed  Delta t \n   E_Rbank = k_dbank left( tau_ebank - tau_crbank right) 10^-6 L h rho_b bank  Delta t","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where E_R is the potential bed/bank erosion rates (tons), k_d is the erodibility of the bed/bank material (cm^3 N^-1 s^-1), tau_e is the effective shear stress from the flow on the bed/bank (N m^-2), tau_cr is the critical shear stress for erosion to happen (N m^-2), L, W and h are the channel length, width and water height (m), rho_b is the bulk density of the bed/bank of the river (g cm^-3) and Delta t is the model timestep (s).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"In wflow_sediment, the erodibility of the bed/bank are approximated using the formula from Hanson and Simon (2001):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   k_d=02 tau_cr^-05","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Normally erodibilities are evaluated using jet test in the field and there are several reviews and some adjustments possible to this equation (Simon et al, 2011). However, to avoid too heavy calibration and for the scale considered, this equation is supposed to be efficient enough. The critical shear stress tau_cr is evaluated differently for the bed and bank. For the bed, the most common formula from Shields initiation of movement is used. For the bank, a more recent approach from Julian and Torres (2006) is used :","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   tau_crbank = (01+01779 SC+00028 SC^2-234 10^-5  SC^3) C_ch","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where SC is the percent clay and silt content of the river bank and C_ch is a coefficient taking into account the positive impact of vegetation on erosion reduction. This coefficient is then dependent on the land use and classical values are shown in the table below. These values where then adapted for use with the GlobCover land use map. Percent of clay and silt (along with sand and gravel) for the channel is estimated from the river median particle diameter assuming the same values as SWAT shown in the table below. Median particle diameter is here estimated depending on the Strahler river order. The higher the order, the smaller the diameter is. As the median diameter is only used in wflow_sediment for the estimation of the river bed/bank sediment composition, this supposition should be enough. Actual refined data or calibration may however be needed if the median diameter is also required for the transport formula. In a similar way, the bulk densities of river bed and bank are also just assumed to be of respectively 1.5 and 1.4 g cm^-3.","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Table: Classical values of the channel cover vegetation coefficient (Julian and Torres, 2006)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Bank vegetation C_ch\nNone 1.00\nGrassy 1.97\nSparse trees 5.40\nDense trees 19.20","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Table : Composition of the river bed/bank depending on the median diameter d_50 [mum] (Neitsch et al, 2011)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Sediment Fraction leq 5 5 to 50 50 to 2000 2000\nSand 0.15 0.15 0.65 0.15\nSilt 0.15 0.65 0.15 0.15\nClay 0.65 0.15 0.15 0.05\nGravel 0.05 0.05 0.05 0.65","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Then, the repartition of the flow shear stress is refined into the effective shear stress and the bed and bank of the river using the equations developed by Knight (1984) for a rectangular channel:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   tau_ebed = rho g R_H S  left(1 - dfracSF_bank100right) left(1+dfrac2hWright) \n   tau_ebank = rho g R_H S  left( SF_bankright)  left(1+dfracW2hright)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where rho g is the fluid specific weight (9800 N m^-3 for water), R_H is the hydraulic radius of the channel (m), h and W are the water level and river width (m). SF_bank is the proportion of shear stress acting on the bank (%) and is estimated from (Knight, 1984):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   SF_bank = exp left( -3230 log_10left(dfracWh+3right)+6146 right)","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Finally the relative erosion potential of the bank and bed of the river is calculated by:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   RTE_bed = dfracE_RbedE_Rbed+E_Rbank \n   RTE_bank = 1 - RTE_bed","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"And the final actual eroded amount for the bed and bank is the maximum between RTE sed_exeff and the erosion potential E_R. Total eroded amount of sediment sed_erod is then the sum of the eroded sediment coming from the storage of previously deposited sediment and the river bed/bank erosion.","category":"page"},{"location":"model_docs/lateral/sediment_flux/#River-deposition","page":"Sediment flux","title":"River deposition","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"As sediments have a higher density than water, moving sediments in water can be deposited in the river bed. The deposition process depends on the mass of the sediment, but also on flow characteristics such as velocity. In wflow_sediment, as in SWAT, deposition is modelled with Einstein's equation (Neitsch et al, 2011):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   P_dep=left(1-dfrac1e^xright)100","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where P_dep is the percentage of sediments that is deposited on the river bed and x is a parameter calculated with:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   x = dfrac1055 L  omega_su h","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where L and h are channel length and water height (m), omega_s is the particle settling velocity calculated with Stokes formula (m s^-1) and u is the mean flow velocity (m s^-1). The calculated percentage is then subtracted from the amount of sediment input and eroded river sediment for each particle size class (sed_dep = P_dep100 (sed_in + sed_erod)). Resulting deposited sediment are then stored in the river bed and can be re-mobilized in future time steps by erosion.","category":"page"},{"location":"model_docs/lateral/sediment_flux/#Mass-balance-and-sediment-concentration","page":"Sediment flux","title":"Mass balance and sediment concentration","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Finally after estimating inputs, deposition and erosion with the transport capacity of the flow, the amount of sediment actually leaving the river cell to go downstream is estimated using:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   sed_out = (sed_in + sed_erod - sed_dep) dfracV_outV","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where sed_out is the amount of sediment leaving the river cell (tons), sed_in is the amount of sediment coming into the river cell (storage from previous timestep, land erosion and sediment flux from upstream river cells in tons), sed_erod is the amount of sediment coming from river erosion (tons), sed_dep is the amount of deposited sediments (tons), V_out is the volume of water leaving the river cell (surface runoff Q times timestep Delta t in m^3) and V is the total volume of water in the river cell (V_out plus storage h W L in m^3).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"A mass balance is then used to calculate the amount of sediment remaining in the cell at the end of the timestep (sed_riv)_t:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   (sed_riv)_t = (sed_riv)_t-1 + (sed_land)_t + upstreamleft(sed_out)_t-1right + (sed_erod)_t - (sed_dep)_t - (sed_out)_t","category":"page"},{"location":"model_docs/lateral/sediment_flux/#Lake-and-reservoir-modelling","page":"Sediment flux","title":"Lake and reservoir modelling","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Apart from land and river, the hydrologic wflow_sbm model also handles lakes and reservoirs modelling. In wflow_sbm, lakes and large reservoirs are modelled using a 1D bucket model at the cell corresponding to the outlet. For the other cells belonging to the lake/reservoir which are not the outlet, processes such as precipitation and evaporation are filtered out and shifted to the outlet cell. wflow_sediment handles the lakes and reservoirs in the same way. If a cell belongs to a lake/reservoir and is not the outlet then the model assumes that no erosion/deposition of sediments is happening and the sediments are only all transported to the lake/reservoir outlet. Once the sediments reach the outlet, then sediments are deposited in the lake/reservoir according to Camp's model (1945) (Verstraeten et al, 2000):","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"   TE = dfracomega_su_crres = dfracA_resQ_outres omega_s","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"where TE is the trapping efficiency of the lake/reservoir (or the fraction of particles trapped), omega_s is the particle velocity from Stokes (m s^-1), u_crres is the reservoir's critical settling velocity (m/s) which is equal to the reservoir's outflow Q_outres (m^3 s^-1) divided by the reservoir's surface area A_res (m^2).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"For reservoirs, coarse sediment particles from the bed load are also assumed to be trapped by the dam structure. This adding trapping is taken into account with a reservoir trapping efficiency coefficient for large particles (between 0 and 1). Depending on the type of the dam, all bed load particles are trapped (restrapefficiency =1.0, for example for a gravity dam) or only partly (for example for run-of-the-river dams).","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Lake and reservoir modelling is enabled in the model section of the TOML and require the extra following input arguments:","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"[model]\ndoreservoir = true\ndolake = false\n\n[input.vertical]\n# Reservoir\nresareas = \"wflow_reservoirareas\"\n# Lake\nlakeareas = \"wflow_lakeareas\"\n\n[input.lateral.river]\n# Reservoir\nresarea = \"ResSimpleArea\"\nrestrapefficiency = \"ResTrapEff\"\nresareas = \"wflow_reservoirareas\"\nreslocs = \"wflow_reservoirlocs\"\n# Lake\nlakearea = \"LakeArea\"\nlakeareas = \"wflow_lakeareas\"\nlakelocs = \"wflow_lakelocs\"","category":"page"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"Note that in the inland part, lake and reservoir coverage are used to filter erosion and transport in overland flow.","category":"page"},{"location":"model_docs/lateral/sediment_flux/#References","page":"Sediment flux","title":"References","text":"","category":"section"},{"location":"model_docs/lateral/sediment_flux/","page":"Sediment flux","title":"Sediment flux","text":"K.C. Abbaspour, J. Yang, I. Maximov, R. Siber, K. Bogner, J. Mieleitner, J. Zobrist, and R.Srinivasan. Modelling hydrology and water quality in the pre-alpine/alpine Thur watershed using SWAT. Journal of Hydrology, 333(2-4):413-430, 2007. 10.1016/j.jhydrol.2006.09.014\nP. Borrelli, M. Märker, P. Panagos, and B. Schütt. Modeling soil erosion and river sediment yield for an intermountain drainage basin of the Central Apennines, Italy. Catena, 114:45-58, 2014. 10.1016/j.catena.2013.10.007\nF. Engelund and E. Hansen. A monograph on sediment transport in alluvial streams. Technical University of Denmark 0stervoldgade 10, Copenhagen K., 1967.\nG. Govers. Empirical relationships for the transport capacity of overland flow. IAHS Publication, (January 1990):45-63 ST, 1990.\nG.J Hanson and A Simon. Erodibility of cohesive streambeds in the loess area of the midwestern USA. Hydrological Processes, 15(May 1999):23-38, 2001.\nR Hessel and V Jetten. Suitability of transport equations in modelling soil erosion for a small Loess Plateau catchment. Engineering Geology, 91(1):56-71, 2007. 10.1016/j.enggeo.2006.12.013\nJ.P Julian, and R. Torres. Hydraulic erosion of cohesive riverbanks. Geomorphology,  76:193-206, 2006. 10.1016/j.geomorph.2005.11.003\nD.W. Knight, J.D. Demetriou, and M.E. Hamed. Boundary Shear in Smooth Rectangular Channels. J. Hydraul. Eng., 110(4):405-422, 1984. 10.1061/(ASCE)0733-9429(1987)113:1(120)\nS.L Neitsch, J.G Arnold, J.R Kiniry, and J.R Williams. SWAT Theoretical Documentation Version 2009. Texas Water Resources Institute, pages 1-647, 2011. 10.1016/j.scitotenv.2015.11.063\nC. Oeurng, S. Sauvage, and J.M. Sanchez-Perez. Assessment of hydrology, sediment and particulate organic carbon yield in a large agricultural catchment using the SWAT model. Journal of Hydrology, 401:145-153, 2011. 10.1016/j.hydrol.2011.02.017\nA. Simon, N. Pollen-Bankhead, and R.E Thomas. Development and application of a deterministic bank stability and toe erosion model for stream restoration. Geophysical Monograph Series, 194:453-474, 2011. 10.1029/2010GM001006\nG. Verstraeten and J. Poesen. Estimating trap efficiency of small reservoirs and ponds: methods and implications for the assessment of sediment yield. Progress in Physical Geography, 24(2):219-251, 2000. 10.1177/030913330002400204\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, and J. Poesen. Adapting SWAT hillslope erosion model to predict sediment concentrations and yields in large Basins. Science of the Total Environment, 538:855-875, 2015. 10.1016/j.scitotenv.2015.08.095\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, F. Obreja, J. Poesen, H. Habersack, J. Feher, and S. Groselj. Modelling sediment fluxes in the Danube River Basin with SWAT. Science of the Total Environment, 2017. 10.1016/j.scitotenv.2017.04.236","category":"page"},{"location":"user_guide/sample_data/#sample_data","page":"Example models","title":"Example models","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"For each wflow Model a test model is available that can help to understand the data requirements and the usage of each Model. The TOML configuration file per available model are listed in the Table below:","category":"page"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"model TOML configuration file\nwflow_sbm + kinematic wave sbm_config.toml\nwflow_sbm + groundwater flow sbm_gwf_config.toml\nwflow_hbv hbv_config.toml\nwflow_flextopo flextopo_config.toml\nwflow_sediment sediment_config.toml","category":"page"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"The associated Model files (input static, forcing and state files) can easily be downloaded and for this we share the following Julia code (per Model) that downloads the required files to your current working directory. For running these test model see also Usage and Command Line Interface.","category":"page"},{"location":"user_guide/sample_data/#wflow_sbm_data","page":"Example models","title":"wflow_sbm + kinematic wave","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"# urls to TOML and netCDF of the Moselle example model\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/sbm_config.toml\"\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.9/staticmaps-moselle.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.6/forcing-moselle.nc\"\ninstates = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.6/instates-moselle.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sbm_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-moselle.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-moselle.nc\"))\ndownload(instates, joinpath(datadir, \"instates-moselle.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"user_guide/sample_data/#wflow_sbm-groundwater-flow","page":"Example models","title":"wflow_sbm + groundwater flow","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"# urls to TOML and netCDF of the Moselle example model\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/sbm_gwf_config.toml\"\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.3/staticmaps-sbm-groundwater.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.1/forcing-sbm-groundwater.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sbm_gwf_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-sbm-groundwater.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-sbm-groundwater.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"user_guide/sample_data/#wflow_hbv","page":"Example models","title":"wflow_hbv","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"# urls to TOML and netCDF of the Moselle example model\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/hbv_config.toml\"\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.1/staticmaps-lahn.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/forcing-lahn.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"hbv_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-lahn.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-lahn.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"user_guide/sample_data/#wflow_flextopo_data","page":"Example models","title":"wflow_flextopo","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"# urls to TOML and netCDF of the Meuse example model\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/flextopo_config.toml\"\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.8/staticmaps_flex_meuse.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.8/forcing_meuse.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"flextopo_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps_flex_meuse.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing_meuse.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"user_guide/sample_data/#wflow_sediment","page":"Example models","title":"wflow_sediment","text":"","category":"section"},{"location":"user_guide/sample_data/","page":"Example models","title":"Example models","text":"# urls to TOML and netCDF of the Moselle example model\ntoml_url = \"https://raw.githubusercontent.com/Deltares/Wflow.jl/master/test/sediment_config.toml\"\nstaticmaps = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.3/staticmaps-moselle-sed.nc\"\nforcing = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.3/forcing-moselle-sed.nc\"\ninstates = \"https://github.com/visr/wflow-artifacts/releases/download/v0.2.0/instates-moselle-sed.nc\"\n\n# create a \"data\" directory in the current directory\ndatadir = joinpath(@__DIR__, \"data\")\nmkpath(datadir)\ntoml_path = joinpath(@__DIR__, \"sediment_config.toml\")\n\n# download resources to current and data dirs\ndownload(staticmaps, joinpath(datadir, \"staticmaps-moselle-sed.nc\"))\ndownload(forcing, joinpath(datadir, \"forcing-moselle-sed.nc\"))\ndownload(instates, joinpath(datadir, \"instates-moselle-sed.nc\"))\ndownload(toml_url, toml_path)","category":"page"},{"location":"model_docs/model_configurations/#Model-configurations","page":"Model configurations","title":"Model configurations","text":"","category":"section"},{"location":"model_docs/model_configurations/#wflow_sbm","page":"Model configurations","title":"wflow_sbm","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Wflow_sbm represents hydrological models derived from the CQflow model (Köhler et al., 2006) that have the SBM vertical concept in common, but can have different lateral concepts that control how water is routed for example over the land or river domain. The soil part of SBM is largely based on the Topog_SBM model but has had considerable changes over time. Topog_SBM is specifically designed to simulate fast runoff processes in small catchments while the wflow_sbm model can be applied more widely. The main differences are for the vertical concept SBM of wflow_sbm:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The unsaturated zone can be split-up in different layers\nThe addition of evapotranspiration losses\nThe addition of a capillary rise\nThe addition of water demand and allocation","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The water demand and allocation computations are supported by the wflow_sbm model configurations:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"SBM + Kinematic wave\nSBM + Groundwater flow\nSBM + Local inertial river\nSBM + Local inertial river (1D) and land (2D)","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The vertical SBM concept is explained in more detail in the following section SBM vertical concept.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Topog_SBM uses an element network based on contour lines and trajectories for water routing. Wflow_sbm models differ in how the lateral components river, land, and subsurface are solved. Below the different wflow_sbm model configurations are described.","category":"page"},{"location":"model_docs/model_configurations/#config_sbm","page":"Model configurations","title":"SBM + Kinematic wave","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"For the lateral components of this wflow_sbm model water is routed over a D8 network, and the kinematic wave approach is used for river, overland and lateral subsurface flow. This is described in more detail in the section Kinematic wave.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"An overview of the different processes and fluxes in the wflow_sbm model with the kinematic wave approach for river, overland and lateral subsurface flow:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"(Image: wflow_sbm model)","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Below the mapping for this wflow_sbm model (type sbm) to the vertical SBM concept (instance of struct SBM) and the different lateral concepts is presented. For an explanation about the type parameters between curly braces after the struct name see the section on the model parameters.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"vertical => struct SBM{T,N,M}\nlateral.subsurface => struct LateralSSF{T}\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model_docs/model_configurations/#config_sbm_gwf","page":"Model configurations","title":"SBM + Groundwater flow","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"For river and overland flow the kinematic wave approach over a D8 network is used for this wflow_sbm model. For the subsurface domain, an unconfined aquifer with groundwater flow in four directions (adjacent cells) is used. This is described in more detail in the section Groundwater flow.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[model]\ntype = \"sbm_gwf\"\n\n[input.lateral.subsurface]\nksathorfrac = \"KsatHorFrac\"\nconductivity = \"conductivity\"\nspecific_yield = \"specific_yield\"\nexfiltration_conductance = \"exfilt_cond\"\ninfiltration_conductance = \"infilt_cond\"\nriver_bottom = \"river_bottom\"\nconductivity_profile = \"exponential\"\ngwf_f.value = 3.0","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Below the mapping for this wflow_sbm model (type sbm_gwf) to the vertical SBM concept (instance of struct SBM) and the different lateral concepts. For an explanation about the type parameters between curly braces after the struct name see the section on model parameters.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"vertical => struct SBM{T,N,M}\nlateral.subsurface.flow => struct GroundwaterFlow{A, B}\nlateral.subsurface.recharge => struct Recharge{T} <: AquiferBoundaryCondition\nlateral.subsurface.river => struct River{T} <: AquiferBoundaryCondition\nlateral.subsurface.drain => struct Drainage{T} <: AquiferBoundaryCondition # optional\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model_docs/model_configurations/#config_sbm_gwf_lie_river","page":"Model configurations","title":"SBM + Local inertial river","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"By default the model types sbm and sbm_gwf use the kinematic wave approach for river flow. There is also the option to use the local inertial model for river flow with an optional 1D floodplain schematization (routing is done separately for the river channel and floodplain), by providing the following in the TOML file:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[model]\nriver_routing = \"local-inertial\"    # optional, default is \"kinematic-wave\"\nfloodplain_1d = true                # optional, default is false","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Only the mapping for the river component changes, as shown below. For an explanation about the type parameters between curly braces after the struct name see the section on the model parameters.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"lateral.river => struct ShallowWaterRiver{T,R,L}","category":"page"},{"location":"model_docs/model_configurations/#config_sbm_gwf_lie_river_land","page":"Model configurations","title":"SBM + Local inertial river (1D) and land (2D)","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"By default the model types sbm and sbm_gwf use the kinematic wave approach for river and overland flow. There is also the option to use the local inertial model for 1D river and 2D overland flow, by providing the following in the TOML file:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[model]\nriver_routing = \"local-inertial\"\nland_routing = \"local-inertial\"","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The mapping for the river and land component changes, as shown below. For an explanation about the type parameters between curly braces after the struct name see the section on the model parameters.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"lateral.river => struct ShallowWaterRiver{T,R,L}\nlateral.land => struct ShallowWaterLand{T}","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The local inertial approach is described in more detail in the section Local inertial model.","category":"page"},{"location":"model_docs/model_configurations/#config_hbv","page":"Model configurations","title":"wflow_hbv","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The Hydrologiska Byrans Vattenbalansavdelning (HBV) model was introduced back in 1972 by the Swedish Meteological and Hydrological Institute (SMHI).  The HBV model is mainly used for runoff simulation and hydrological forecasting. The model is particularly useful for catchments where snow fall and snow melt are dominant factors, but application of the model is by no means restricted to these type of catchments.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The model is based on the HBV-96 model. However, the hydrological routing represented in HBV by a triangular function controlled by the MAXBAS parameter has been removed. Instead, the kinematic wave function is used to route the water downstream. All runoff that is generated in a cell in one of the HBV reservoirs is added to the kinematic wave reservoir at the end of a timestep. There is no connection between the different HBV cells within the model.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"A catchment is divided into a number of grid cells. For each of the cells individually, daily runoff is computed through application of the HBV-96 of the HBV model. The use of the grid cells offers the possibility to turn the HBV modelling concept, which is originally lumped, into a distributed model.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"(Image: wflow_hbv model)","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The figure above shows a schematic view of hydrological response simulation with the HBV-modelling concept. The land-phase of the hydrological cycle is represented by three different components: a snow routine, a soil routine and a runoff response routine. Each component is discussed in more detail below.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The vertical HBV concept is described in section HBV vertical concept. The routing for river and overland flow is described in the section Kinematic wave.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Below the mapping for wflow_hbv (type hbv) to the vertical HBV concept (instance of struct HBV) and the different lateral concepts. For an explanation about the type parameters between curly braces after the struct name see the section on model parameters.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"vertical => struct HBV{T}\nlateral.subsurface => struct LateralSSF{T}\nlateral.land => struct SurfaceFlow{T,R,L}\nlateral.river => struct SurfaceFlow{T,R,L}\nlateral.river.lake => struct NaturalLake{T} # optional\nlateral.river.reservoir => struct SimpleReservoir{T} # optional","category":"page"},{"location":"model_docs/model_configurations/#config_flextopo","page":"Model configurations","title":"wflow_flextopo","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The FLEXTopo model is a process-based model, which consists of different parallel classes connected through their groundwater storage. These classes are usually delineated from topographical data to represent the variability in hydrological processes across user-defined Hydrological Response Units (HRU). The main assumption underlying the concept, which was first introduced by Savenije (2010), is that different parts of the landscape fulfill different tasks in runoff generation and, hence, can be represented by different model structures. The strength of the concept is that the definition of classes and associated model structures is modular and flexible and not fixed to a predefined model structure. The flexible approach allows to develop process-based models for different topographic, climatic, geologic and land use conditions, making use of the available data and expert knowledge.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The kinematic wave function is used to route the water downstream. In a similar way as for HBV, all runoff that is generated in a cell in one of the FLEXTopo storages is added to the kinematic wave reservoir at the end of a timestep. There is no connection between the different vertical FLEXTopo cells within the model. The FLEXTopo model is implemented in a fully distributed way in the wflow Julia framework.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"In wflow_flextopo, the user is free to determine the number of classes and which model components to include or exclude for each class, this is done in the TOML file. Currently, for each storage, it is possible to bypass the storage and pass on the fluxes to the next model component. Interested users can contribute to the code by adding other conceptualizations for each storage components.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[model]\ntype = \"flextopo\"\nclasses = [\"h\", \"p\", \"w\"]     #user can set the number and name of each class.\n\n# for each component which is class specific, the user can select which conceptualization\n# to apply for each class as defined above in classes = [\"h\", \"p\", \"w\"]\nselect_snow = [\"common_snow_hbv\"]\n# available options are [\"common_snow_hbv\", \"common_snow_no_storage\"]\nselect_interception = [\"interception_overflow\", \"interception_overflow\", \"interception_overflow\"]\n# available options are [\"interception_overflow\", \"interception_no_storage\"]\nselect_hortonponding = [\"hortonponding_no_storage\", \"hortonponding_no_storage\", \"hortonponding_no_storage\"]\n# available options are [\"hortonponding\", \"hortonponding_no_storage\"]\nselect_hortonrunoff = [\"hortonrunoff_no_storage\", \"hortonrunoff_no_storage\", \"hortonrunoff_no_storage\"]\n# available options are [\"hortonrunoff\", \"hortonrunoff_no_storage\"]\nselect_rootzone = [\"rootzone_storage\", \"rootzone_storage\", \"rootzone_storage\"]\n# available options are [\"rootzone_storage\", \"rootzone_no_storage\"]\nselect_fast = [\"fast_storage\", \"fast_storage\", \"fast_storage\"]\n# available options are [\"fast_storage\", \"fast_no_storage\"]\nselect_slow = [\"common_slow_storage\"]\n# available options are [\"common_slow_storage\", \"slow_no_storage\"]","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"A schematic representation of the most complete model structure including all storage components, as currently implemented in the code, is shown in the Figure below. When setting up the model with multiple classes, model structures can be adapted by bypassing storages or turning parameter values on or off (e.g.: percolation or capillary rise, non-linear versus linear outflow of the fast runoff etc.), an example of a three class model is shown in FLEXTopo vertical concept.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"(Image: flextopo_julia_1class.png) Schematic representation of the FLEXTopo model for a single class model including all storages and fluxes. Main parameters are denoted in red.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"In the staticmaps, the user needs to provide maps of the fraction of each class within each cell, as shown below with hrufrac. For each model parameter which is class specific, an extra dimension classes is required in the staticmaps netcdf. For an example model, see FLEXTopo example model.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[input.vertical]\nhrufrac = \"hrufrac_lu\"","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Parameter multiplication of model parameters which are defined for several classes is possible through the TOML file:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[input.vertical.kf]\nnetcdf.variable.name = \"kf\"\nscale = [1.0, 3.0, 4.0]\noffset = [0.0, 0.0, 0.0]\nclass = [\"h\", \"p\", \"w\"]","category":"page"},{"location":"model_docs/model_configurations/#config_sediment","page":"Model configurations","title":"wflow_sediment","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The processes and fate of many particles and pollutants impacting water quality at the catchment level are intricately linked to the processes governing sediment dynamics. Both nutrients such as phosphorus, carbon or other pollutants such as metals are influenced by sediment properties in processes such as mobilization, flocculation or deposition. To better assert and model water quality in inland systems, a better comprehension and modelling of sediment sources and fate in the river is needed at a spatial and time scale relevant to such issues.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"The wflow_sediment model was developed to answer such issues. It is a distributed physics-based model, based on the distributed hydrologic wflow_sbm model. It is able to simulate both land and in-stream processes, and relies on available global datasets, parameter estimation and small calibration effort.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"In order to model the exports of terrestrial sediment to the coast through the Land Ocean Aquatic Continuum or LOAC (inland waters network such as streams, lakes...), two different modelling parts were considered. The first part, called the inland sediment model, is the modelling and estimation of soil loss and sediment yield to the river system by land erosion, separated into vertical Soil Erosion processes and lateral Sediment Flux in overland flow. The second part, called the River Sediment Model is the transport and processes of the sediment in the river system. The two parts together constitute the wflow_sediment model.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Overview of the concepts of the wflow_sediment model: (Image: wflow_sediment)","category":"page"},{"location":"model_docs/model_configurations/#Configuration","page":"Model configurations","title":"Configuration","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"As sediment generation and transport processes are linked to the hydrology and water flows, the inputs to the wflow_sediment model come directly from a hydrological model. The required dynamic inputs to run wflow_sediment are:","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Precipitation (can also come from the hydrological forcing data),\nLand runoff (overland flow) from the kinematic wave,\nRiver runoff from the kinematic wave,\nLand water level in the kinematic wave,\nRiver water level in the kinematic wave,\nRainfall interception by the vegetation.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"These inputs can be obtained from other wflow models such as wflow_sbm, wflow_hbv or from other sources.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Model outputs can be saved for both the inland and the instream part of the model. Some examples are listed below.","category":"page"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"[output.vertical]\n# Soil splash erosion [ton]\nsedspl = \"sedspl\"\n# Soil erosion by overland flow [ton]\nsedov = \"sedov\"\n# Total soil loss [ton]\nsoilloss = \"soilloss\"\n# Total transport capacity of overland flow [ton]\nTCsed = \"TCsed\"\n# Transport capacity per particle class (clay) [ton]\nTCclay = \"TCclay\"\n\n[output.lateral.land]\n# Total (or per particle class) sediment flux in overland flow [ton]\nolsed = \"olsed\"\nolclay = \"olclay\"\n# Total (or per particle class) sediment yield to the river [ton]\ninlandsed = \"inlandsed\"\ninlandclay = \"inlandclay\"\n\n[output.lateral.river]\n# Total sediment concentration in the river (suspended + bed load) [kg/m3]\nSedconc = \"Sedconc\"\n# Suspended load [kg/m3]\nSSconc = \"SSconc\"\n# Bed load [kg/m3]\nBedconc = \"Bedconc\"","category":"page"},{"location":"model_docs/model_configurations/#References","page":"Model configurations","title":"References","text":"","category":"section"},{"location":"model_docs/model_configurations/","page":"Model configurations","title":"Model configurations","text":"Köhler, L., Mulligan, M., Schellekens, J., Schmid, S., Tobón, C., 2006, Hydrological impacts of converting tropical montane cloud forest to pasture, with initial reference to northern Costa Rica. Final Technical Report DFID‐FRP Project No. R799.\nSavenije, H. H. G. (2010). HESS opinions “topography driven conceptual modelling (FLEX-Topo).” Hydrology and Earth System Sciences, 14(12), 2681–2692. https://doi.org/10.5194/hess-14-2681-2010","category":"page"},{"location":"changelog/#Changelog","page":"Changelog","title":"Changelog","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"All notable changes to this project will be documented in this file.","category":"page"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.","category":"page"},{"location":"changelog/#[unreleased]","page":"Changelog","title":"[unreleased]","text":"","category":"section"},{"location":"changelog/#Fixed","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Added missing BMI function get_grid_size, it is used for unstructured grids, for example to get the length of arrays returned by BMI functions get_grid_x and get_grid_y.\nAdded a check for the solution of the quadratic equation as part of the Modified Puls approach for lake outflow. Lower limit should be zero (very small negative values can occur).\nLimit lake evaporation (added variable actevap) and lake outflow to prevent negative lake storage. The variable actevap has also been added to the reservoir module.\nThe set_states function for model type sbm with local inertial routing for river and land component.\nInflow to reservoir and lake locations for local inertial routing: 1) with floodplain routing, the floodplain discharge was not added to the inflow of these locations, 2) the to_river variable from overland flow and lateral subsurface flow was not added to the inflow of these locations.\nClose netCDF NCDataset with state variables in extended BMI function save_state.\nFor the computation of Gash interception model parameter e_r multiply the precipitation input with the canopy fraction (this was only done for the potential evapotranspiration input).\nFunction BMI.update_until could throw an InexactError: Int64 caused by a not whole number, representing how many times (steps) an update of a wflow model is required. This is fixed by using divrem for the computation of the number of steps in this function. An error is thrown when the absolute remainder of divrem is larger than eps(), or when the number of steps is negative.\nFixed internal and external broken links in docs. \nThe internal time step of the local inertial model (stable_timestep function) can get zero when LoopVectorization is applied (@tturbo) to the for loop of these functions. This issue occured on a virtual machine, Windows 10 Enterprise, with Intel(R) Xeon(R) Gold 6144 CPU (2 processors). This has been fixed by replacing @tturbo with reduction of Polyester.jl.\nFixed required states of the model type sbm_gwf: added h_av for the river and land domain.\nFor the constanthead boundary of GroundwaterFlow the head should not be changed (was set to top elevation of the aquifer if head > top), and exfiltwater should be 0 for these boundary cells.","category":"page"},{"location":"changelog/#Changed","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Stop exposing scalar variables through BMI. The BMI.get_value_ptr function was not working correctly for scalar model variables (a view was applied). Only a few scalar model parameters are defined, and it is not expected that exposing these variables is required (e.g. for model coupling) while code changes for these variables (including struct fields) are required.\nThe local inertial routing (constant) river boundary condition depth at a ghost node (downstream river outlet) was set at 0.0 in the code and can now be provided through the model parameter netCDF file (riverdepth_bc). In addition, the boundary condition river length dl at a ghost node should be set through the model parameter netCDF file (riverlength_bc), providing this boundary condition through the [model] settings in the TOML file (model.riverlength_bc) has been deprecated.\nAs part of the vertical SBM concept: 1) add variable net_runoff (land runoff minus actual open water evaporation ae_openw_l) and 2) change the definition of variable runoff by removing the subtraction of ae_openw_l (total land runoff). The variable net_runoff is now input to the kinematic wave for overland flow (replaces the original runoff variable as input). The lower limit of the original runoff variable was set at zero, which may result in water balance errors. This lower limit was implemented in the Python version of wflow_sbm, to avoid a very slow kinematic wave solution for surface flow computation (no distinction between a kinematic wave for overland and river flow). When in the Python version of wflow_sbm the kinematic wave for surface flow was split into a river and land component, the lower limit was removed for river runoff (net_runoff_river), but not for land runoff.\nAlways use fractions for the computation of potential evapotranspiration (interception and transpiration) and potential evaporation (open water and soil). Replaced variable et_reftopot by crop coefficient kc (use of et_reftopot has been deprecated).\nFor improved code readability it is now discouraged to use non-ASCII characters for the names of variables, structs, functions and macros. Using the non-ASCII character for built-in operators is still allowed. This change in naming convention is now in effect and all invalid uses of non-ASCII characters have been replaced by ASCII equivalents.\nDocs: 1) improved description of different model configurations in model-setup.md, also in relation to hydromt_wflow in docs, 2) citing info related to wflow_sbm publication in Geosci. Model Dev. (from in review to published).\nRoot water uptake reduction (Feddes): 1) extend critical pressure head parameters with h3_low and h3_high, 2) all critical pressure head parameters can be set (values for h1, h2 and h3 were fixed) and 3) the root water uptake reduction coefficient alpha can be set at 0 (default is 1) at critical pressure head h1 (through the model parameter alpha_h1).\nFor the actual transpiration computation in SBM, the potential transpiration is partitioned over the soil layers with roots according to the model parameter rootfraction (fraction of the total root length in a soil layer). Previously, for each soil layer (from top to bottom) the actual transpiration was computed, and the remaining potential transpiration was used in the next soil layer.","category":"page"},{"location":"changelog/#Added","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Total water storage as an export variable for SBM concept. This is the total water stored per grid cell in millimeters. Excluded from this variable are the floodplain, lakes and reservoirs.\nChecks to see if all states are covered in the .toml file. If not all states are covered, an error is thrown. If there are more states specified than required, these states are ignored (with a warning in the logging), and the simulation will continue.\nSupport different vertical hydraulic conductivity profiles for the SBM concept. See also the following sections: The SBM soil water accounting scheme and Subsurface flow routing for a short description.\nLocal inertial routing to sbm_gwf model type.\nWater demand and allocation computations for model types sbm and sbm_gwf.","category":"page"},{"location":"changelog/#v0.7.3-2024-01-12","page":"Changelog","title":"v0.7.3 - 2024-01-12","text":"","category":"section"},{"location":"changelog/#Fixed-2","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Documentation: add leakage term to the wflow_sbm figure, document external input parameter ksathorfrac and fix description of adding external inflow to the kinematic wave.\nFixed BMI functions (e.g. BMI.get_value) that deviated from BMI specifications (BasicModelInterface.jl), including function arguments, return types and the BMI specification that arrays are always flattened (this was not the case for variables stored as 2-dimensional arrays or as vector of SVectors).\nBump compat for NCDatasets to 0.13, 0.14.\nThe solution for lake outflow as part of the Modified Puls Approach. The inflow and outflow variables are defined for period Δt, and not at t1 and t2 (instantaneous) as in the original mass balance equation of the Modified Puls Approach. Because of this, the terms of the quadratic equation (and solution) were fixed.\nUse kvfrac for the computation of vertical saturated hydraulic conductivity at the bottom of the soil layer, since kvfrac is also used for the computation of vertical unsaturated flow.","category":"page"},{"location":"changelog/#Changed-2","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"For cyclic parameters different cyclic time inputs are supported (only one common cyclic time (for example daily or monthly) was allowed).\nBMI: 1) added grid information (type and location) and whether a variable can be exchanged to metadata Structs, 2) extend model grid functions for wflow components that store variables on edges (local inertial model) with get_grid_edge_count and get_grid_edge_nodes.","category":"page"},{"location":"changelog/#Added-2","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Functions for loading and saving states and getting the starttime in Unix time format. This is convenient for coupling with OpenDA (and other external) software. The set states functionality from the initialization function has been moved to a separate set_states function for each Model type, to support loading states independent of initialization.","category":"page"},{"location":"changelog/#v0.7.2-2023-09-27","page":"Changelog","title":"v0.7.2 - 2023-09-27","text":"","category":"section"},{"location":"changelog/#Fixed-3","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Water balance of modified Rutter interception model. The sum of the stemflow partitioning coefficient pt and free throughfall coefficient p could get larger than 1, resulting in an overestimation of stemflow and throughfall amounts and negative net interception amounts. And the first drainage amount dd, controlled by a change over time in canopy storage capacity cmax, should not be subtracted from precipitation to compute net interception.\nThe netinterception (net interception) computed by the modified Rutter interception model was stored as interception in SBM, while this should be the interception (interception loss by evaporation) output of the modified Rutter interception model. The interception of SBM is used to compute the total actual evapotranspiration actevap.","category":"page"},{"location":"changelog/#v0.7.1-2023-06-30","page":"Changelog","title":"v0.7.1 - 2023-06-30","text":"","category":"section"},{"location":"changelog/#Fixed-4","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"State initialization of 1D floodplain volume. In the initialization function the wrong field name of type FloodPlainProfile was used (area instead of a).","category":"page"},{"location":"changelog/#v0.7.0-2023-06-12","page":"Changelog","title":"v0.7.0 - 2023-06-12","text":"","category":"section"},{"location":"changelog/#Fixed-5","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"BMI.get_time_units now gets called on the model rather than the type, like all other BMI functions, except BMI.initialize. Also it returns \"s\" instead of \"seconds since 1970-01-01T00:00:00\", in line with the BMI specification.\nAdded the interception component to total actual evapotranspiration actevap of SBM (was defined as the sum of soil evaporation, transpiration and open water evaporation).","category":"page"},{"location":"changelog/#Changed-3","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The time values returned in the BMI interface are no longer in seconds since 1970, but in seconds since the model start time. This is more in line with standard BMI practices.\nThe starttime was defined one model timestep Δt ahead of the actual model time (the initial conditions timestamp (state time)). As a consequence this was also the case for the current model time. To allow for an easier interpretation of wflow time handling, either through BMI or directly, the starttime is now equal to the state time, resulting in current model times without an offset.\nUsing more than 8 threads can result in too much overhead with Threads.@threads. After performance testing, this has been changed for kinematic wave routing and the vertical SBM concept to spawning tasks with Threads@spawn for number of threads <= 8, where each task iterates over a chunk of size basesize. For more than 8 threads the low overhead threading Polyester.@batch (including the minbatch argument) is used. For local inertial routing the use of Threads.@threads has been changed to threaded loop vectorization (river and 1D floodplain local inertial momentum equation) and Polyester.@batch.","category":"page"},{"location":"changelog/#Added-3","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"For (regulated) lakes with rating curve of type 1 (H-Q table), lake storage above the maximumstorage (based on maximum water level from the H-Q table) is spilled instantaneously (overflow) from the lake.\nAdded support to use sum as a reducer function for csv and scalar output options.","category":"page"},{"location":"changelog/#v0.6.3-2023-03-01","page":"Changelog","title":"v0.6.3 - 2023-03-01","text":"","category":"section"},{"location":"changelog/#Fixed-6","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Removed error when _FillValue is present in the time dimension of the forcing netCDF file. The simulation is allowed to continue with the attribute present, given that there are no missing values in the time dimension. This is checked by the code, and an error is thrown if this is the case.\nColumn index of daily lake rating curves. This was incorrectly based on dayofyear with a maximum of 365. The column index should be based on julian day (leap days are not counted).","category":"page"},{"location":"changelog/#Changed-4","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"NCDatasets version. Reading the time dimension of multifile netCDF file became very slow since NCDatasets v0.12.4, this issue has been solved in v0.12.11.\nStore the time dimension of the forcing netCDF file as part of the struct NCreader instead of calling dataset[\"time\"][:] each time step when loading forcing data.","category":"page"},{"location":"changelog/#Added-4","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Show total duration of simulation in the log file (info), and show the current time at execution of each timestep (debug).\nSupport for exponential decline in horizontal conductivity in the sbm_gwf concept. This can be enabled using the conductivity_profile setting (either \"uniform\" or \"exponential\"). If set to \"exponential\", it exponentially reduces the kh0 (or conductivity) based on the value of gwf_f to the actual horizontal conductivity (k).\nAn optional 1D floodplain schematization for the river flow inertial model, based on provided flood volumes as a function of flood depth per river cell. See also the following sections: SBM + Local inertial river and River and floodplain routing for a short description, and the following section for associated model parameters.","category":"page"},{"location":"changelog/#v0.6.2-2022-09-01","page":"Changelog","title":"v0.6.2 - 2022-09-01","text":"","category":"section"},{"location":"changelog/#Fixed-7","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Two issues related to reservoir and lake locations as part of local inertial model: 1) added as boundary points to the update of overland flow, 2) fixed check reservoir and lake location in update river flow.\nLimit flow (qx, qy and q) in local inertial model when water is not available (set to zero).\nIn the grid output netCDFs, don't set the _FillValue attribute, since the CF conventions don't allow it.\nGlacier parameter g_sifrac needs to be converted during initialization (time dependent).\nThe check that the sum of adaptive timesteps (Δt) of the local inertial model (1D and 2D) does not exceed the model timestep.","category":"page"},{"location":"changelog/#Changed-5","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Changed depth h for reservoir and lake locations as part of the river local inertial model from bankfull_depth to zero.","category":"page"},{"location":"changelog/#Added-5","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"External inflow to the SBM + Local inertial river (1D) and land (2D) model configuration.","category":"page"},{"location":"changelog/#v0.6.1-2022-04-26","page":"Changelog","title":"v0.6.1 - 2022-04-26","text":"","category":"section"},{"location":"changelog/#Fixed-8","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Fixed an error with the log file, when writing to a folder that does not (yet) exists. Now, the folder is created prior to writing the log file.\nFixed a MethodError for read_dims, thrown when reading netCDF data with NCDatasets.jl 0.12.3 or higher.","category":"page"},{"location":"changelog/#v0.6.0-2022-04-14","page":"Changelog","title":"v0.6.0 - 2022-04-14","text":"","category":"section"},{"location":"changelog/#Added-6","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The FLEXTopo model.\nSet a (different) uniform value for each index of input parameters with an extra dimension. A list of values (instead of one uniform value) that should be equal to the length of the extra dimension can be provided in the TOML file. See also Modify parameters.\nModify input parameters with an extra dimension at multiple indices with different scale and offset values, through the TOML file. See also Modify parameters.\nAdded support for netCDF compression for gridded model output, through the option compressionlevel in the [output] section in the TOML file. The setting defaults to 0 (no compression), but all levels between 0 and 9 can be used.","category":"page"},{"location":"changelog/#Changed-6","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Re-organized the documentation: moved explanation of different model concepts to a model documentation section, added a user guide to explain setting up the model, added new figures to the description of wflow_sbm.\nThe unit of lateral subsurface flow ssf of LateralSSF is now m^3 d^-1. The unit was m^3 t^-1, where t is the model timestep. Other flow variables are already stored independently from t, this allows for easier interpretation and to use states independently of t.\nChanged the reference level of water depth h and h_av of 2D overland flow (ShallowWaterLand) for cells containing a river from river bed elevation zb to cell elevation z.","category":"page"},{"location":"changelog/#Fixed-9","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Fixed calculation of average water depth h_av of 2D overland flow (ShallowWaterLand) with the local inertial approach. The summation of h was not correct, resulting in too low values for h_av. For river cells of 2D overland flow h_av was only updated as part of the river domain (ShallowWaterRiver), this value is now also updated as part of the land domain (ShallowWaterLand).\nFixed the following two flow width issues for 2D overland flow of the local inertial model: 1) The flow widths xwidth and ywidth were mapped incorrectly (reversed) to the flow calculation in x and y direction, respectively. 2) For river cells the effective flow width for overland flow was not determined correctly: the riverwidth vector supplied to the function set_effective_flowwidth! covered the complete model domain and should have covered the river domain, resulting in incorrect river widths and thus incorrect effective flow widths for river cells.","category":"page"},{"location":"changelog/#v0.5.2-2022-02-03","page":"Changelog","title":"v0.5.2 - 2022-02-03","text":"","category":"section"},{"location":"changelog/#Changed-7","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model types sbm_gwf and hbv use the same approach for the calculation of the drain width dw as model type sbm.\nRenamed h_bankfull parameter to bankfull_depth for consistency between kinematic-wave and local-inertial river routing. When using the old name under the [input.lateral.river] section of the TOML file, it will work but it is suggested to update the name.","category":"page"},{"location":"changelog/#Added-7","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Additional log messages and log file as output, see also Logging.\nOption to use the local inertial model for river flow as part of the sbm model type. See also SBM + Local inertial river.\nOption to use the local inertial model for 1D river flow combined with 2D overland flow as part of the sbm model type. See also SBM + Local inertial river (1D) and land (2D).","category":"page"},{"location":"changelog/#Fixed-10","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model type hbv: the surface width for overland flow was not corrected with the river width.\nFixed use of absolute path for path_forcing in TOML file, which gave an error in wflow v0.5.1.\nFixed a crash when glacier processes are simulated as part of the hbv concept (Δt was not defined).\nWhen the surface flow width for overland flow is zero, the water level h of the kinematic wave should not be calculated, otherwise this results in NaN values. When the model is initialized from state files, q and h are set to zero for indices with a zero surface flow width.\nFixed how number of iterations its for kinematic wave river flow are calculated during initialization when using a fixed sub-timestep (specified in the TOML file). For a model timestep smaller than the fixed sub-timestep an InexactError was thrown.\nFixed providing a cyclic parameter when the netCDF variable is read during model initialization with ncread, this gave an error about the size of the netCDF time dimension.\nFixed CSV and netCDF scalar output of variables with dimension layer (SVector).","category":"page"},{"location":"changelog/#v0.5.1-2021-11-24","page":"Changelog","title":"v0.5.1 - 2021-11-24","text":"","category":"section"},{"location":"changelog/#Fixed-11","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Fixed calculation of exfiltwater as part of the sbm_gwf model type. This was based directly on groundwater head above the surface level, without multiplying by the specific_yield, resulting in an overestimation of exfiltwater. This is required since the groundwater model estimates the head by dividing the volume by the specific yield or storativity of the aquifer. So, should the groundwater table rise above surface level, the head above surface level does not represent a water column one to one. (This also means the groundwater model (slightly) overestimates heads when the head rises above the surface level. However, this water is immediately removed, and the head will be set to surface level.)","category":"page"},{"location":"changelog/#Added-8","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Optional dir_input and dir_output keys in the TOML, which can be used to quickly change the path for all input or output files that are given as a relative path.","category":"page"},{"location":"changelog/#v0.5.0-2021-11-12","page":"Changelog","title":"v0.5.0 - 2021-11-12","text":"","category":"section"},{"location":"changelog/#Changed-8","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Scaling of potential capillary rise is replaced by a common approach found in literature, based on the water table depth zi, a maximum water depth cap_hmax beyond which capillary rise ceases, and a coefficient cap_n. See also Capillary rise. Multiplying the scaling factor with the ratio of model time step and basetimestep in the original approach resulted in (much) smaller capillary fluxes at sub-daily model time steps compared to daily model time steps, and is not used in the new approach. Parameters cap_hmax and cap_n can be set through the TOML file, parameter capscale of the previous approach is not used anymore.","category":"page"},{"location":"changelog/#Fixed-12","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Conversion of GroundwaterFlow boundaries [m^3 d^-1] as part of model concept sbm_gwf to m^3 s^-1 for sub-daily model time steps. For the conversion the basetimestep (86400 s) should be used (and not the model time step).","category":"page"},{"location":"changelog/#v0.4.1-2021-11-04","page":"Changelog","title":"v0.4.1 - 2021-11-04","text":"","category":"section"},{"location":"changelog/#Changed-9","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"The alpha parameter of the kinematic wave has a fixed value now and is not updated because of changes in water height (this could result in large water balance errors). See also Surface routing.\nCyclic input for other structs than vertical are also now supported (for example cyclic inflow to the river).\nMoved update_forcing! and update_cyclic! functions to the run function. It is now easier to implement a custom run function with custom loading of input data (forcing and cyclic parameters).","category":"page"},{"location":"changelog/#Added-9","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Check if reservoirs and lakes have downstream nodes. Without downstream nodes is not supported and in that case an error message is thrown that is easier to understand than the previous one: \"ArgumentError: Collection is empty, must contain exactly 1 element.\"\nFor the input.path_forcing TOML setting we use Glob.jl to expand strings like \"data/forcing-year-*.nc\" to a set of netCDF files that are split in time.\nExternal water inflow (supply/abstractions) added to the kinematic wave inflow in m3/s. It is added/removed to sf.qlat[v] before computing the new q[v] with the kinematic wave equation.\nFixed values for forcing parameters are supported, see also Fixed forcing values.","category":"page"},{"location":"changelog/#Added-10","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Option to use the local inertial model for river flow as part of the SBM + Kinematic wave. See also SBM + Local inertial river.","category":"page"},{"location":"changelog/#Fixed-13","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"River inflow for reservoirs and lakes in the kinematic wave. This inflow was based on sf.q[v] at the previous time step, and this has been fixed to the current time step.","category":"page"},{"location":"changelog/#v0.4.0-2021-09-02","page":"Changelog","title":"v0.4.0 - 2021-09-02","text":"","category":"section"},{"location":"changelog/#Changed-10","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Changed length units for lateral subsurface flow component from millimeter to meter. This means that state netCDF files from previous versions can only be reused if ssf is divided by 10^9.\nAdd snow and glacier processes to wflow_sbm figure of the documentation.","category":"page"},{"location":"changelog/#Added-11","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Multi-threading of vertical SBM concept and lateral kinematic wave components (overland, river and subsurface flow) of wflow_sbm model SBM + Kinematic wave.\nImproved error message for CSV Reducer.\nThe TOML keys kv₀, θᵣ and θₛ have been replaced with the ASCII versions kv_0, theta_r and theta_s, to avoid encoding issues with certain text editors. The old keys still work as well.","category":"page"},{"location":"changelog/#Fixed-14","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Calculation of volumetric water content of vertical SBM (soil layers and root zone).\nUpdate of satwaterdepth in SBM (evaporation was only subtracted from a local variable, and not from sbm.satwaterdepth).\nFixed the index lowerlake_ind of NaturalLake. Linked lakes were not simulated correctly (flows between upstream and downstream lake).\nInterpolation function interpolate_linear(x, xp, fp) for CSV tables lakes. When x was larger or smaller than xp, maximum(xp) or minimum(xp) was returned instead of maximum(fp) or minimum(fp).\nFixed model timestep of reservoirs (SimpleReservoir) and lakes (NaturalLake) in relation to precipitation and evapotranspiration fluxes. This was set to the fixed wflow basetimestep of 86400 s, and should be set to the actual model time step from the TOML configuration file.\nAdd flux from Drainage (GroundwaterFlow) in the sbm_gwf_model to the overland flow component instead of the river component of the kinematic wave.\nFixed option constanthead = false (TOML file), constant_head field of GroundwaterFlow was not defined in this case. Fixed this by initializing empty fields (Vector) for struct ConstantHead.\nFixed return max(0, boundary.flux[index]) to return max(0, flux) the flux should be returned when cell is dry, no negative value allowed.\nFixed path to initialize lake to: dirname(static_path)\nFixed outflow = 0, when lake level is below lake threshold. Before a negative value could enter the log function and model would fail.\nFixed the lake storage initialization. For continuation runs (reinit = false), this caused the lake to be reset to the initial conditions instead of the saved state.","category":"page"},{"location":"changelog/#v0.3.1-2021-05-19","page":"Changelog","title":"v0.3.1 - 2021-05-19","text":"","category":"section"},{"location":"changelog/#Fixed-15","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Ignore extra dimensions in input netCDFs if they are size 1","category":"page"},{"location":"changelog/#v0.3.0-2021-05-10","page":"Changelog","title":"v0.3.0 - 2021-05-10","text":"","category":"section"},{"location":"changelog/#Changed-11","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"New deposition process for coarse sediment in the reservoirs with a new parameter restrapefficiency in the sediment model.\nNew variables added to the LandSediment and RiverSediment structs in order to save more output from the sediment model.\nAdded variables volume and inwater to SurfaceFlow struct, this is convenient for the coupling with the water quality model Delwaq.\nRiver water level (h) and discharge (q) forced directly into the RiverSediment struct (instead of using the OverlandFlowSediment struct first).\nRequire Julia 1.6 or later.","category":"page"},{"location":"changelog/#Added-12","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Modify model parameters and forcing through the TOML file (see Modify parameters).\nRun wflow_sbm (SBM + kinematic wave) in two parts (until recharge and after subsurface flow) from BMI, including the option to switch off the lateral subsurface component of wflow_sbm.\nSupport more netCDF dimension and axis order variants.","category":"page"},{"location":"changelog/#Fixed-16","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Corrected a bug in sediment deposition in the river (case when incoming sediment load is more than the river transport capacity).\nFixed update of snow and glacierstore fields of HBV and SBM concepts by the glacier_hbv module.","category":"page"},{"location":"changelog/#v0.2.0-2021-03-26","page":"Changelog","title":"v0.2.0 - 2021-03-26","text":"","category":"section"},{"location":"changelog/#Changed-12","page":"Changelog","title":"Changed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Removed dependency of the f model parameter of wflow_sbm on the parameters theta_s, theta_r and M. This approach is used in Topog_SBM, but not applicable for wflow_sbm. The f parameter needs to be provided as part of the netCDF model parameter file.\nGrid properties as cell length and elevation now stored as part of the model.land.network component and not as part of the vertical model components, as it is not used by these components. altitude (elevation) should now be provided as part of the [input] section of the TOML configuration file, and not as part of the [input.vertical] section.\nRemoved parameter theta_e from SBM struct (not used in update). Parameters theta_s and theta_r included separately (instead of theta_e) in LateralSSF struct, now directly linked to SBM parameters.\nImprove error messages (netCDF and cyclic flow graph).","category":"page"},{"location":"changelog/#Added-13","page":"Changelog","title":"Added","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Export of netCDF scalar timeseries (separate netCDF file from gridded timeseries). This also allows for importing these timeseries by Delft-FEWS (General Adapter).","category":"page"},{"location":"changelog/#Fixed-17","page":"Changelog","title":"Fixed","text":"","category":"section"},{"location":"changelog/","page":"Changelog","title":"Changelog","text":"Model parameter Manning's n now used during the update of the struct SurfaceFlow, to change the related alpha parameter of the kinematic wave for channel flow.","category":"page"},{"location":"model_docs/params_vertical/#params_vert","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"","category":"section"},{"location":"model_docs/params_vertical/#params_sbm","page":"Parameters vertical concepts","title":"SBM","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct SBM, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.vertical] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable Sl:","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"[input.vertical]\nspecific_leaf = \"Sl\"","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"Different vertical hydraulic conductivity depth profiles: exponential (default), exponential_constant, layered and layered_exponential can be provided through the TOML file. Below an example for the exponential_constant profile:","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"[input.vertical]\nksat_profile = \"exponential_constant\"","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"For the exponential profile the input parameters kv_0 and f are used. For the exponential_constant profile kv_0 and f are used, and z_exp is required as input. For the layered profile, input parameter kv is used, and for the layered_exponential profile kv is used and z_layered is required as input.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ncfmax degree-day factor mm ᵒC^-1 Δt^-1 3.75653 mm ᵒC^-1 day^-1\ntt threshold temperature for snowfall ᵒC 0.0\ntti threshold temperature interval length ᵒC 1.0\nttm threshold temperature for snowmelt ᵒC 0.0\nwhc water holding capacity as fraction of current snow pack - 0.1\nw_soil soil temperature smooth factor - 0.1125\ncf_soil controls soil infiltration reduction factor when soil is frozen - 0.038\ng_tt threshold temperature for snowfall above glacier ᵒC 0.0\ng_cfmax Degree-day factor for glacier mm ᵒC^-1 Δt^-1 3.0 mm ᵒC^-1 day^-1\ng_sifrac fraction of the snowpack on top of the glacier converted into ice Δt^-1 0.001 day^-1\nglacierfrac fraction covered by a glacier - 0.0\nglacierstore water within the glacier mm 5500.0\ntheta_s saturated water content (porosity) - 0.6\ntheta_r residual water content - 0.01\nkv_0 Vertical hydraulic conductivity at soil surface mm Δt^-1 3000.0 mm day^-1\nkv Vertical hydraulic conductivity per soil layer mm Δt^-1 1000.0 mm day^-1\nf scaling parameter (controls exponential decline of kv_0) mm^-1 0.001\nz_exp Depth from soil surface for which exponential decline of kv_0 is valid mm -\nz_layered Depth from soil surface for which layered profile (of layered_exponential) is valid mm -\nhb air entry pressure of soil (Brooks-Corey) cm -10.0\nsoilthickness soil thickness mm 2000.0\ninfiltcappath infiltration capacity of the compacted areas mm Δt^-1 10.0 mm day^-1\ninfiltcapsoil soil infiltration capacity mm Δt^-1 100.0 mm day^-1\nmaxleakage maximum leakage from saturated zone mm Δt^-1 0.0  mm day^-1\nc Brooks-Corey power coefficient for each soil layer - 10.0\nkvfrac multiplication factor applied to kv_z (vertical flow) - 1.0\nwaterfrac fraction of open water (excluding rivers) - 0.0\npathfrac fraction of compacted area - 0.01\nrootingdepth rooting depth mm 750.0\nrootfraction fraction of the root length density in each soil layer - -\nh1 soil water pressure head h1 of the root water uptake reduction function (Feddes) cm 0.0 cm\nh2 soil water pressure head h2 of the root water uptake reduction function (Feddes) cm -100.0 cm\nh3_high soil water pressure head h3_high of the root water uptake reduction function (Feddes) cm -400.0 cm\nh3_low soil water pressure head h3_low of the root water uptake reduction function (Feddes) cm -1000.0 cm\nh4 soil water pressure head h4 of the root water uptake reduction function (Feddes) cm -15849.0 cm\nalpha_h1 root water uptake reduction at soil water pressure head h1 (0.0 or 1.0) - 1.0\nrootdistpar controls how roots are linked to water table - -500.0\ncap_hmax water depth beyond which capillary flux ceases mm 2000.0\ncap_n coefficient controlling capillary rise - 2.0\nkc crop coefficient Kc - 1.0\nsl (specific_leaf) specific leaf storage mm -\nswood (storage_wood) storage woody part of vegetation mm -\nkext extinction coefficient (to calculate canopy gap fraction) - -\ncmax maximum canopy storage mm 1.0\ne_r (eoverr) Gash interception model parameter - 0.1\ncanopygapfraction canopy gap fraction - 0.1\ndt model time step s -\nmaxlayers maximum number of soil layers - -\nn number of grid cells - -\nnlayers number of soil layers - -\nn_unsatlayers number of unsaturated soil layers - -\nnlayers_kv number of soil layers with vertical hydraulic conductivity value kv - -\nriverfrac fraction of river - -\nact_thickl thickness of soil layers mm -\nsumlayers cumulative sum of soil layers thickness, starting at soil surface mm -\nstemflow stemflow mm Δt^-1 -\nthroughfall throughfall mm Δt^-1 -\nustorelayerdepth amount of water in the unsaturated store, per layer mm -\nsatwaterdepth saturated store mm -\nzi pseudo-water table depth (top of the saturated zone) mm -\nsoilwatercapacity soilwater capacity mm -\ncanopystorage canopy storage mm -\nprecipitation precipitation mm Δt^-1 -\ntemperature temperature ᵒC -\npotential_evaporation potential reference evapotranspiration mm Δt^-1 -\npottrans interception subtracted from potential evapotranspiration mm Δt^-1 -\ntranspiration transpiration mm Δt^-1 -\nae_ustore actual evaporation from unsaturated store mm Δt^-1 -\ninterception interception loss by evaporation mm Δt^-1 -\nsoilevap total soil evaporation from unsaturated and saturated store mm Δt^-1 -\nsoilevapsat soil evaporation from saturated store mm Δt^-1 -\nactcapflux actual capillary rise mm Δt^-1 -\nactevapsat actual transpiration from saturated store mm Δt^-1 -\nactevap total actual evapotranspiration mm Δt^-1 -\nrunoff_river runoff from river based on riverfrac mm Δt^-1 -\nrunoff_land runoff from land based on waterfrac mm Δt^-1 -\nae_openw_l actual evaporation from open water (land) mm Δt^-1 -\nae_openw_r actual evaporation from river mm Δt^-1 -\nnet_runoff_river net runoff from river (runoff_river - ae_openw_r) mm Δt^-1 -\navail_forinfilt water available for infiltration mm Δt^-1 -\nactinfilt actual infiltration into the unsaturated zone mm Δt^-1 -\nactinfiltsoil actual infiltration into non-compacted fraction mm Δt^-1 -\nactinfiltpath actual infiltration into compacted fraction mm Δt^-1 -\ninfiltsoilpath infiltration into the unsaturated zone mm Δt^-1 -\ninfiltexcess infiltration excess water mm Δt^-1 -\nexcesswater water that cannot infiltrate due to saturated soil (saturation excess) mm Δt^-1 -\nexfiltsatwater water exfiltrating during saturation excess conditions mm Δt^-1 -\nexfiltustore water exfiltrating from unsaturated store because of change in water table mm Δt^-1 -\nexcesswatersoil excess water for non-compacted fraction mm Δt^-1 -\nexcesswaterpath excess water for compacted fraction mm Δt^-1 -\nrunoff total surface runoff from infiltration and saturation excess mm Δt^-1 -\nnet_runoff net surface runoff (runoff - ae_openw_l) mm Δt^-1 -\nvwc volumetric water content per soil layer (including theta_r and saturated zone) - -\nvwc_perc volumetric water content per soil layer (including theta_r and saturated zone) % -\nrootstore root water storage in unsaturated and saturated zone (excluding theta_r) mm -\nvwc_root volumetric water content in root zone (including theta_r and saturated zone) - -\nvwc_percroot volumetric water content in root zone (including theta_r and saturated zone) % -\nustoredepth total amount of available water in the unsaturated zone mm -\ntransfer downward flux from unsaturated to saturated zone mm Δt^-1 -\nrecharge net recharge to saturated zone mm Δt^-1 -\nactleakage actual leakage from saturated store mm Δt^-1 -\nsnow snow storage mm -\nsnowwater liquid water content in the snow pack mm -\nrainfallplusmelt snowmelt + precipitation as rainfall mm Δt^-1 -\ntsoil top soil temperature ᵒC -\nleaf_area_index leaf area index m^2 m-2 -\nwaterlevel_land water level land mm -\nwaterlevel_river water level river mm -\ntotal_storage total water storage (excluding floodplains, lakes and reservoirs) mm -\npaddy optional paddy (rice) fields of type Paddy (water demand and irrigation) - -\nnonpaddy optional non-paddy fields of type NonPaddy (water demand and irrigation) - -\ndomestic optional domestic water demand of type NonIrrigationDemand - -\nlivestock optional livestock water demand of type NonIrrigationDemand - -\nindustry optional industry water demand of type NonIrrigationDemand - -\nallocation optional water allocation of type AllocationLand - -","category":"page"},{"location":"model_docs/params_vertical/#params_hbv","page":"Parameters vertical concepts","title":"HBV","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct HBV, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ncfmax degree-day factor mm ᵒC^-1 Δt^-1 3.75653 mm ᵒC^-1 day^-1\ntt threshold temperature for snowfall ᵒC -1.41934\ntti threshold temperature interval length ᵒC 1.0\nttm threshold temperature for snowmelt ᵒC -1.41934\nwhc water holding capacity as fraction of current snow pack - 0.1\ng_tt threshold temperature for snowfall above glacier ᵒC 0.0\ng_cfmax Degree-day factor for glacier mm ᵒC^-1 Δt^-1 3.0 mm ᵒC^-1 day^-1\ng_sifrac fraction of the snowpack on top of the glacier converted into ice Δt^-1 0.001 day^-1\nglacierfrac fraction covered by a glacier - 0.0\nglacierstore water within the glacier mm 5500.0\nfc field capacity mm 260.0\nbetaseepage exponent in soil runoff generation equation - 1.8\nlp fraction of field capacity below which actual evaporation=potential evaporation - 0.53\nk4 recession constant baseflow Δt^-1 0.02307 day^-1\nkquickflow recession constant upper reservoir Δt^-1 0.09880 day^-1\nsuz Level over which k0 is used mm 100.0\nk0 recession constant upper reservoir Δt^-1 0.30 day^-1\nkhq recession rate at flow hq Δt^-1 0.09880 day^-1\nhq high flow rate hq for which recession rate of upper reservoir is known mm Δt^-1 3.27 mm day^-1\nalphanl measure of non-linearity of upper reservoir - 1.1\nperc percolation from upper to lower zone mm Δt^-1 0.4 mm day^-1\ncfr refreezing efficiency constant in refreezing of freewater in snow - 0.05\npcorr correction factor for precipitation - 1.0\nrfcf correction factor for rainfall - 1.0\nsfcf correction factor for snowfall - 1.0\ncflux maximum capillary rise from runoff response routine to soil moisture routine mm Δt^-1 2.0 mm day^-1\nicf maximum interception storage (in forested and non-forested areas) mm 2.0\ncevpf correction factor for potential evaporation - 1.0\nepf exponent of correction factor for evaporation on days with precipitation mm^-1 1.0\necorr evaporation correction - 1.0\nprecipitation precipitation mm Δt^-1 -\ntemperature temperature ᵒC -\npotential_evaporation potential evapotranspiration mm Δt^-1 -\npotsoilevap potential soil evaporation mm Δt^-1 -\nsoilevap soil evaporation mm Δt^-1 -\nintevap evaporation from interception storage mm Δt^-1 -\nactevap actual evapotranspiration (intevap + soilevap) mm Δt^-1 -\ninterceptionstorage actual interception storage mm -\nsnowwater available free water in snow mm -\nsnow snow pack mm -\nrainfallplusmelt snow melt + precipitation as rainfall mm Δt^-1 -\nsoilmoisture actual soil moisture mm -\ndirectrunoff direct runoff to upper zone mm Δt^-1 -\nhbv_seepage recharge to upper zone mm Δt^-1 -\nin_upperzone water inflow into upper zone mm Δt^-1 -\nupperzonestorage water content of the upper zone mm -\nquickflow specific runoff (quickflow part) mm Δt^-1 -\nreal_quickflow specific runoff (quickflow), if K upper zone is precalculated mm Δt^-1 -\npercolation actual percolation to the lower zone mm Δt^-1 -\ncapflux capillary rise mm Δt^-1 -\nlowerzonestorage water content of the lower zone mm -\nbaseflow specific runoff (baseflow part) per cell mm Δt^-1 -\nrunoff total specific runoff per cell mm Δt^-1 -","category":"page"},{"location":"model_docs/params_vertical/#params_flextopo","page":"Parameters vertical concepts","title":"FLEXtopo","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct FLEXTOPO, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ncfmax degree-day factor mm ᵒC^-1 Δt^-1 3.75653 mm ᵒC^-1 day^-1\ntt threshold temperature for snowfall ᵒC -1.41934\ntti threshold temperature interval length ᵒC 1.0\nttm threshold temperature for snowmelt ᵒC -1.41934\nwhc water holding capacity as fraction of current snow pack - 0.1\ncfr refreezing efficiency constant in refreezing of freewater in snow - 0.05\ng_tt threshold temperature for snowfall above glacier ᵒC 0.0\ng_cfmax Degree-day factor for glacier mm ᵒC^-1 Δt^-1 3.0 mm ᵒC^-1 day^-1\ng_sifrac fraction of the snowpack on top of the glacier converted into ice Δt^-1 0.001 day^-1\nglacierfrac fraction covered by a glacier - 0.0\nglacierstore water within the glacier mm 5500.0\necorr evaporation correction - 1.0\npcorr correction factor for precipitation - 1.0\nrfcf correction factor for rainfall - 1.0\nsfcf correction factor for snowfall - 1.0\nimax maximum interception storage (I_mathrmmax) mm 3.0\nshmax maximum horton ponding storage capacity (S_mathrmHmax) mm 30.0\nsrmax maximum root zone storage capacity (S_mathrmRmax) mm 260.0\nbeta exponent in soil runoff generation equation - 0.3\nlp fraction of root zone capacity below which actual evaporation=potential evaporation (L_mathrmP) - 0.3\nks recession constant slow groundwater storage (K_mathrmS) Δt^-1 0.006 day^-1\nkf recession constant fast storage (K_mathrmF) Δt^-1 0.1 day^-1\nkhf recession constant horton runoff storage (K_mathrmHf) Δt^-1 0.5 day^-1\nalfa measure of non-linearity of upper reservoir (alpha) - 1.0\nperc maximum percolation flux from root zone to slow storage (Q_mathrmpercmax) mm Δt^-1 0.30 mm day^-1\ncap maximum capillary rise from slow storage to root zone (Q_mathrmcapmax) mm Δt^-1 0.20 mm day^-1\nds splitter parameter determining fraction of root zone outflow to slow storage (d_mathrms) - 0.2\nshmin minimum storage capacity in horton ponding (relative to S_mathrmHmax) (S_mathrmHmin) [-] 0.2\nfacc0 maximum modelled accumulated frost resulting in shmin (F_mathrmaccfr0) [ᵒC Δt] -3.0\nfacc1 minimum modelled accumulated frost resulting in shmin (F_mathrmaccfr1) [ᵒC Δt] 0.0\nfdec exponent for the decline of infiltration capacity (F_mathrmdec) [-] 0.2\nfmax maximum infiltration capacity from horton ponding (F_mathrmmax) [mm Δt^-1] 2.0\nkmf melt coefficient of frozen topsoil (K_mathrmmf) [-] 1.0\nhrufrac fraction of class within cell (F_mathrmhrufrac) - 1/length(classes)\nprecipitation precipitation mm Δt^-1 -\ntemperature temperature ᵒC -\npotential_evaporation potential evapotranspiration mm Δt^-1 -\nprecipcorr corrected precipitation mm Δt^-1 -\nepotcorr corrected potential evaporation mm Δt^-1 -\nsnow snow water (S_mathrmW) mm -\nsnowwater available free water in snow mm -\ninterceptionstorage interception storage (S_mathrmI) mm -\ninterceptionstorage_m average interception storage over classes (S_mathrmI) mm -\nhortonpondingstorage horton ponding storage (S_mathrmHp) mm -\nhortonpondingstorage_m average horton ponding storage over classes (S_mathrmHp) mm -\nhortonrunoffstorage horton runoff storage (S_mathrmHf) mm -\nhortonrunoffstorage_m average horton runoff storage over classes (S_mathrmHf) mm -\nrootzonestorage root zone storage (S_mathrmR) mm -\nrootzonestorage_m average root zone storage over classes (S_mathrmR) mm -\nfaststorage fast storage (S_mathrmF) mm -\nfaststorage_m average fast storage over classes (S_mathrmF) mm -\nslowstorage slow storage (S_mathrmS) mm -\npotsoilevap potential soil evaporation (E_mathrmP) mm Δt^-1 -\nsoilevap soil evaporation mm Δt^-1 -\nintevap evaporation from interception storage (E_mathrmI) mm Δt^-1 -\nintevap_m average evaporation from interception storage over classes  (E_mathrmI) mm Δt^-1 -\nhortonevap evaporation from horton ponding storage (E_mathrmH) mm Δt^-1 -\nhortonevap_m average evaporation from horton ponding storage over classes  (E_mathrmH) mm Δt^-1 -\nrootevap evaporation from root zone storage (E_mathrmR) mm Δt^-1 -\nrootevap_m average evaporation from root zone storage over classes  (E_mathrmR) mm Δt^-1 -\nactevap actual evapotranspiration (intevap + hortonevap + rootevap) (E_mathrmA) mm Δt^-1 -\nactevap_m average actual evapotranspiration (intevap + hortonevap + rootevap) over classes (E_mathrmA) mm Δt^-1 -\nprecipeffective Effective precipitation (P_mathrmE) mm Δt^-1 -\nrainfallplusmelt snow melt + precipitation as rainfall (P_mathrmM + P_mathrmR) mm Δt^-1 -\nsnowmelt snowfall mm Δt^-1 -\nsnowfall snowfall mm Δt^-1 -\nfacc modeled accumulated frost ᵒC Δt -\nqhortonpond Flux from the hortonian ponding storage to the hortonian runoff storage (Q_mathrmH) mm Δt^-1 -\nqhortonrootzone Flux from the hortonian ponding storage to the root zone storage (Q_mathrmHR) mm Δt^-1 -\nqhortonrun Flux from the hortonian runoff storage (Q_mathrmHf) mm Δt^-1 -\nqrootzone Flux from the root zone storage (Q_mathrmR) mm Δt^-1 -\nqrootzonefast Pref. recharge to fast storage (Q_mathrmRF) mm Δt^-1 -\nqrootzoneslow_m Pref. recharge to slow storage sum classes (Q_mathrmRS) mm Δt^-1 -\nqcapillary Capillary flux from the slow to the root-zone storage (Q_mathrmcap) mm Δt^-1 -\nqcapillary_m Capillary flux from the slow to the root-zone storage sum classes (Q_mathrmcap) mm Δt^-1 -\nqpercolation Percolation flux from the root-zone to the slow storage (Q_mathrmperc) mm Δt^-1 -\nqpercolation_m Percolation flux from the root-zone to the slow storage sum classes (Q_mathrmperc) mm Δt^-1 -\nqfast runoff from fast storage (Q_mathrmF) mm Δt^-1 -\nqfast_tot sum of fast runoff (from fast and horton runoff storages) over classes mm Δt^-1 -\nqslow runoff from slow storage (Q_mathrmS) mm Δt^-1 -\nrunoff total specific runoff per cell (qslow + qfast_tot) (Q) mm Δt^-1 -\nwb_tot total water balance mm Δt^-1 -","category":"page"},{"location":"model_docs/params_vertical/#params_sediment","page":"Parameters vertical concepts","title":"Sediment","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows external parameters that can be set through static input data (netCDF), and can be listed in the TOML configuration file under [input.vertical]. These external parameters are not part of struct LandSediment, but used to calculate parameters of struct LandSediment.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"external parameter description unit default\npclay percentage clay % 0.1\npsilt percentage silt % 0.1\nresareas reservoir coverage - -\nlakeareas lake coverage - -","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct LandSediment, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical], to map the internal model parameter to the external netCDF variable. For some input parameters the parameter listed under [input.vertical] is not equal to the internal model parameter, these are listed in the Table below between parentheses after the internal model parameter. For example, internal model parameter sl is mapped as follows in the TOML file to the external netCDF variable Sl:","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"[input.vertical]\nspecific_leaf = \"Sl\"","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ncanopyheight canopy height m 3.0\nerosk coefficient for EUROSEM rainfall erosion - 0.6\nerosspl exponent for EUROSEM rainfall erosion - 2.0\nerosov coefficient for ANSWERS overland flow erosion - 0.9\npathfrac fraction of impervious area per grid cell - 0.01\nslope land slope - 0.01\nusleC USLE crop management factor - 0.01\nusleK USLE soil erodibility factor - 0.1\nsl (specific_leaf) specific leaf storage mm -\nswood (storage_wood) storage woody part of vegetation mm -\nkext extinction coefficient (to calculate canopy gap fraction) - -\ncmax maximum canopy storage mm 1.0\ncanopygapfraction canopy gap fraction - 0.1\ndmclay median diameter particle size class clay µm 2.0\ndmsilt median diameter particle size class silt µm 10.0\ndmsand median diameter particle size class sand µm 200.0\ndmsagg median diameter particle size class small aggregates µm 30.0\ndmlagg median diameter particle size class large aggregates µm 500.0\nrhos (rhosed) density of sediment kg m^-31 2650.0\nn number of cells - -\nyl length of cells in y direction m -\nxl length of cells in x direction m -\nriverfrac fraction of river - -\nwbcover waterbody coverage - -\nh_land depth of overland flow m -\ninterception canopy interception mm Δt^-1 -\nprecipitation precipitation mm Δt^-1 -\nq_land overland flow m^3 s^-1 -\nsedspl sediment eroded by rainfall ton Δt^-1 -\nsedov sediment eroded by overland flow ton Δt^-1 -\nsoilloss total eroded soil ton Δt^-1 -\nerosclay eroded soil for particle class clay ton Δt^-1 -\nerossilt eroded soil for particle class silt ton Δt^-1 -\nerossand eroded soil for particle class sand ton Δt^-1 -\nerossagg eroded soil for particle class small aggregates ton Δt^-1 -\neroslagg eroded soil for particle class large aggregates ton Δt^-1 -\nleaf_area_index leaf area index m^2 m^-2 -\ndl drain length m -\ndw flow width m -\ncGovers Govers transport capacity coefficient - -\nnGovers Govers transport capacity coefficient - -\nD50 median particle diameter of the topsoil mm -\nfclay fraction of particle class clay - -\nfsilt fraction of particle class silt - -\nfsand fraction of particle class sand - -\nfsagg fraction of particle class small aggregates - -\nflagg fraction of particle class large aggregates - -\nrivcell river cells - -\nTCsed total transport capacity of overland flow ton Δt^-1 -\nTCclay transport capacity of overland flow for particle class clay ton Δt^-1 -\nTCsilt transport capacity of overland flow for particle class silt ton Δt^-1 -\nTCsand transport capacity of overland flow for particle class sand ton Δt^-1 -\nTCsagg transport capacity of overland flow for particle class small aggregates ton Δt^-1 -\nTClagg transport capacity of overland flow for particle class large aggregates ton Δt^-1 -","category":"page"},{"location":"model_docs/params_vertical/#Water-demand-and-allocation","page":"Parameters vertical concepts","title":"Water demand and allocation","text":"","category":"section"},{"location":"model_docs/params_vertical/#Paddy","page":"Parameters vertical concepts","title":"Paddy","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct Paddy, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical.paddy], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ndemand_gross irrigation gross demand mm Δt^-1 -\nirrigation_efficiency irrigation efficiency - -\nmaximum_irrigation_rate maximum irrigation rate mm Δt^-1 25.0 mm day^-1\nirrigation_areas irrigation areas - -\nirrigation_trigger irrigation on or off (boolean) - -\nh_min minimum required water depth in the irrigated paddy fields mm 20.0\nh_opt optimal water depth in the irrigated paddy fields mm 50.0\nh_max water depth when paddy field starts spilling water (overflow) mm 80.0\nh actual water depth in paddy field mm -","category":"page"},{"location":"model_docs/params_vertical/#Non-paddy","page":"Parameters vertical concepts","title":"Non-paddy","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct NonPaddy, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical.nonpaddy], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ndemand_gross irrigation gross demand mm Δt^-1 -\nirrigation_efficiency irrigation efficiency - -\nmaximum_irrigation_rate maximum irrigation rate mm Δt^-1 25.0 mm day^-1\nirrigation_areas irrigation areas - -\nirrigation_trigger irrigation on or off (boolean) - -","category":"page"},{"location":"model_docs/params_vertical/#Non-irrigation-(industry,-domestic-and-livestock)","page":"Parameters vertical concepts","title":"Non-irrigation (industry, domestic and livestock)","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct NonIrrigationDemand, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF). These parameters can be listed for the sectors industry, domestic and livestock, in the TOML configuration file under [input.vertical.industry], [input.vertical.domestic] and [input.vertical.livestock], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\ndemand_gross gross industry water demand mm Δt^-1 0.0\ndemand_net net industry water demand mm Δt^-1 0.0\nreturnflow_fraction return flow fraction - -\nreturnflow return flow mm Δt^-1 -","category":"page"},{"location":"model_docs/params_vertical/#Water-allocation-land","page":"Parameters vertical concepts","title":"Water allocation land","text":"","category":"section"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"The Table below shows the parameters (fields) of struct AllocationLand, including a description of these parameters, the unit, and default value if applicable. The parameters in bold represent model parameters that can be set through static and forcing input data (netCDF), and can be listed in the TOML configuration file under [input.vertical.allocation], to map the internal model parameter to the external netCDF variable.","category":"page"},{"location":"model_docs/params_vertical/","page":"Parameters vertical concepts","title":"Parameters vertical concepts","text":"parameter description unit default\nirri_demand_gross irrigation gross demand mm Δt^-1 -\nnonirri_demand_gross non-irrigation gross demand mm Δt^-1 -\ntotal_gross_demand total gross demand mm Δt^-1 -\nfrac_sw_used fraction surface water used - 1.0\nareas allocation areas - 1\nsurfacewater_demand demand from surface water mm Δt^-1 -\nsurfacewater_alloc allocation from surface water mm Δt^-1 -\nact_groundwater_abst actual groundwater abstraction mm Δt^-1 -\nact_groundwater_abst_vol actual groundwater abstraction m^3 Δt^-1 -\navailable_groundwater available groundwater m^3 -\ngroundwater_demand groundwater_demand mm Δt^-1 -\ngroundwater_alloc allocation from groundwater mm Δt^-1 -\nirri_alloc allocated water for irrigation mm Δt^-1 -\nnonirri_alloc allocated water for non-irrigation mm Δt^-1 -\ntotal_alloc total allocated water mm Δt^-1 -\nnonirri_returnflow return flow from non-irrigation mm Δt^-1 -","category":"page"},{"location":"user_guide/step1_requirements/#Step-1:-Understanding-the-requirements","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"","category":"section"},{"location":"user_guide/step1_requirements/","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"In order to run wflow, several files are required. These consist of a settings file and input data. The input data is typically separated into static maps and forcing data, both are supplied in a netCDF file, except for lake storage and rating curves that are supplied via CSV files. A brief overview of the different files:","category":"page"},{"location":"user_guide/step1_requirements/","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"The settings.toml file contains information on the simulation period, links to the input files (and their names in the netCDF files), and links the correct names of the variables in the netCDF files to the variables and parameters of wflow.\nThe staticmaps.nc file contains spatial information on the elevation, locations of the gauges, land-use, drainage direction, etc. This file can also contain maps with parameter values.\nThe forcing.nc file contains the precipitation, temperature and potential evaporation time series (as a 3D array).","category":"page"},{"location":"user_guide/step1_requirements/","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"There are several model configurations supported by wflow. These model configurations require slightly different input requirements, yet the general structure is similar for each model. A wflow model configuration consists of a vertical concept like the SBM, HBV or FLEXTOPO in combination with lateral concepts that control how water is routed for example over the land or river domain. For the wflow_sbm model different model configurations are possible. The following model configurations are supported in wflow:","category":"page"},{"location":"user_guide/step1_requirements/","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"wflow_sbm:\nSBM + kinematic wave for subsurface and surface flow\nSBM + kinematic wave for subsurface and overland flow + local inertial river (+ optional floodplain)\nSBM + kinematic wave for subsurface flow + local inertial river (1D) and land (2D)\nSBM + groundwater flow + kinematic wave for surface flow\nwflow_hbv: HBV + kinematic wave for surface routing\nwflow_flextopo: FLEXTOPO + kinematic wave for surface routing\nwflow_sediment as post processing of wflow_sbm or wflow_hbv output","category":"page"},{"location":"user_guide/step1_requirements/","page":"Step 1: Understanding the requirements","title":"Step 1: Understanding the requirements","text":"In the following pages, some examples will be given on how to prepare a basic wflow_sbm model. Example data for other model configurations is provided in the section with sample data.","category":"page"},{"location":"user_guide/step2_settings_file/#config_toml","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"A settings file is essential for wflow, as it contains information on the model configuration, simulation period, input files, and parameters. The settings are provided in a TOML file. The settings file is structured in several sections, which are explained below. The filepaths that are provided in this file are relative to the location of the TOML file, or to dir_input and dir_output if they are given.","category":"page"},{"location":"user_guide/step2_settings_file/#General-time-info","page":"Step 2: Preparing the settings file","title":"General time info","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Time information is optional. When left out, for each timestamp in the forcing netCDF wflow will do computations, except for the first forcing timestamp that is considered equal to the initial conditions of the wflow model (state time). If you wish to calculate a subset of this time range, or a different timestep, you can specify a starttime, endtime and timestepsecs yourself. The starttime is defined as the model state time. In the TOML file settings below the starttime is 2000-01-01T00:00:00 (state time) and the first update (and output) of the wflow model is at 2000-01-02T00:00:00. The time_units optional information is used by the writer of the model, for model output in netCDF format. The calendar option allows you to calculate in one of the different CF conventions calendars provided by the CFTime.jl package, such as \"360_day\". This is useful if you want to calculate climate scenarios which are sometimes provided in these alternative calendars.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"calendar = \"standard\"                           # optional, this is default value\nstarttime = 2000-01-01T00:00:00                 # optional, default from forcing netCDF\nendtime = 2000-02-01T00:00:00                   # optional, default from forcing netCDF\ntime_units = \"days since 1900-01-01 00:00:00\"   # optional, this is default value\ntimestepsecs = 86400                            # optional, default from forcing netCDF\ndir_input = \"data/input\"                        # optional, default is the path of the TOML\ndir_output = \"data/output\"                      # optional, default is the path of the TOML","category":"page"},{"location":"user_guide/step2_settings_file/#logging_toml","page":"Step 2: Preparing the settings file","title":"Logging","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Wflow emits logging messages at various levels such as debug, info, and error. These get sent to both the terminal as well as a log file. Note that logging to a file is only part of the Wflow.run(tomlpath::AbstractString) method. If you want to debug an issue it can be helpful to set loglevel = \"debug\" in the TOML. To avoid flooding the screen, debug messages are only sent to the log file. The following settings will affect the logging:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"silent = false          # optional, default is \"false\"\nloglevel = \"debug\"      # optional, default is \"info\"\npath_log = \"log.txt\"    # optional, default is \"log.txt\"\nfews_run = false        # optional, default value is false","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"silent avoids logging to the terminal, and only writes the log file. loglevel controls which levels are filtered out, so the default setting \"info\" does not show any debug level messages. Note that for finer control, you can also pass an integer log level, see Julia's Logging documentation. path_log sets the desired output path for the log file. For information regarding fews_run, see Run from Delft-FEWS.","category":"page"},{"location":"user_guide/step2_settings_file/#Model-section","page":"Step 2: Preparing the settings file","title":"Model section","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Model specific settings can be included in the model section of the TOML file.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[model]\ntype = \"sbm\"                        # one of (\"sbm\", \"sbm_gwf, \"hbv\")\nmasswasting = false                 # include lateral snow transport in the model, default is false\nsnow = false                        # include snow modelling, default is false\nreinit = true                       # cold (reinit = true) or warm state (reinit = false), default is true\nreservoirs = false                  # include reservoir modelling, default is false\nkin_wave_iteration = false          # enable kinematic wave iterations in the model, default is false\nthicknesslayers = [100, 300, 800]   # specific SBM setting: for each soil layer a thickness [mm] is specified\nmin_streamorder_river = 5           # minimum stream order to delineate subbasins for river domain, default is 6 (for multi-threading computing purposes)\nmin_streamorder_land = 4            # minimum stream order to delineate subbasins for land domain, default is 5 (for multi-threading computing purposes)\n","category":"page"},{"location":"user_guide/step2_settings_file/#State-options","page":"Step 2: Preparing the settings file","title":"State options","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"The state section in the TOML file provides information about the location of input and output states of the model. This section is mostly relevant if the model needs to be started with a \"warm\" state (i.e. based on the results of a previous simulation). The example below shows how to save the output states of the current simulation, so it can be used to initialize another model in the future. Details on the settings required to start a model with a warm state can be found in the additional model options. If it is not required to store the outstates of the current simulation, the entire state section can be removed.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[state]\npath_input = \"instates-moselle.nc\"\npath_output = \"outstates-moselle.nc\"\n\n[state.vertical]\nsatwaterdepth = \"satwaterdepth\"\nsnow = \"snow\"\ntsoil = \"tsoil\"\nustorelayerdepth = \"ustorelayerdepth\"\nsnowwater = \"snowwater\"\ncanopystorage = \"canopystorage\"\n\n[state.lateral.river]\nq = \"q_river\"\nh = \"h_river\"\nh_av = \"h_av_river\"\n\n[state.lateral.river.reservoir]\nvolume = \"volume_reservoir\"\n\n[state.lateral.subsurface]\nssf = \"ssf\"\n\n[state.lateral.land]\nq = \"q_land\"\nh = \"h_land\"\nh_av = \"h_av_land\"","category":"page"},{"location":"user_guide/step2_settings_file/#Input-section","page":"Step 2: Preparing the settings file","title":"Input section","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"The input section of the TOML file contains information about the input forcing and model parameters files (netCDF format). Forcing is applied to the vertical component of the model, and needs to be mapped to the external netCDF variable name. forcing lists the internal model forcing parameters, and these are mapped to the external netCDF variables listed under the section [input.vertical]. It is possible to provide cyclic parameters to the model (minimum time step of 1 day). In the example below this is done for the internal vertical.leaf_area_index model parameter, that is linked to the external netCDF variable \"LAI\" variable. Cyclic time inputs of parameters can be different (for example daily and monthly). The time dimension name of these cylic input parameters in the model parameter netCDF file should start with \"time\". If a model parameter is not mapped, a default value will be used if available.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input]\n# use \"forcing-year-*.nc\" if forcing files are split in time\npath_forcing = \"forcing-moselle.nc\"    # Location of the forcing data\npath_static = \"staticmaps-moselle.nc\"  # Location of the static data\n\n# these are not directly part of the model\ngauges = \"wflow_gauges\"\nldd = \"wflow_ldd\"\nriver_location = \"wflow_river\"\nsubcatchment = \"wflow_subcatch\"\n\n# specify the internal IDs of the parameters which vary over time\n# the external name mapping needs to be below together with the other mappings\nforcing = [\n\"vertical.precipitation\",\n\"vertical.temperature\",\n\"vertical.potential_evaporation\",\n]\n\ncyclic = [\"vertical.leaf_area_index\"]\n\n[input.vertical]    # Map internal model variable/parameter names to names of the variables in the netCDF files\naltitude = \"wflow_dem\"\nc = \"c\"\ncf_soil = \"cf_soil\"\ncfmax = \"Cfmax\"\ne_r = \"EoverR\"\ninfiltcappath = \"InfiltCapPath\"\ninfiltcapsoil = \"InfiltCapSoil\"\nkext = \"Kext\"\n\"kv_0\" = \"KsatVer\"\nleaf_area_index = \"LAI\"             # Cyclic variable\nm = \"M\"\nmaxleakage = \"MaxLeakage\"\npathfrac = \"PathFrac\"\npotential_evaporation = \"PET\"       # Forcing variable\nprecipitation = \"P\"                 # Forcing variable\nrootdistpar = \"rootdistpar\"\nrootingdepth = \"RootingDepth\"\nsoilminthickness = \"SoilMinThickness\"\nsoilthickness = \"SoilThickness\"\nspecific_leaf = \"Sl\"\nstorage_wood = \"Swood\"\ntemperature = \"TEMP\"                # Forcing variable\ntt = \"TT\"\ntti = \"TTI\"\nttm = \"TTM\"\nw_soil = \"wflow_soil\"\nwater_holding_capacity = \"WHC\"\nwaterfrac = \"WaterFrac\"\n\"theta_r\" = \"thetaR\"\n\"theta_s\" = \"thetaS\"\n\n[input.lateral.river]\nlength = \"wflow_riverlength\"\nn = \"N_River\"\nslope = \"RiverSlope\"\nwidth = \"wflow_riverwidth\"\n\n[input.lateral.subsurface]\nksathorfrac = \"KsatHorFrac\"\n\n[input.lateral.land]\nn = \"N\"\nslope = \"Slope\"","category":"page"},{"location":"user_guide/step2_settings_file/#Output-netCDF-section","page":"Step 2: Preparing the settings file","title":"Output netCDF section","text":"","category":"section"},{"location":"user_guide/step2_settings_file/#Grid-data","page":"Step 2: Preparing the settings file","title":"Grid data","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"This optional section of the TOML file contains the output netCDF file for writing gridded model output, including a mapping between internal model parameter components and external netCDF variables.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"To limit the size of the resulting netCDF file, file compression can be enabled. This causes an increase in computational time, but can significantly reduce the file size of the netCDF file. This can be enabled by setting the compressionlevel variable to any value between 0 and 9. A setting of 0 indicates that compression is not enabled, and values between 1 and 9 indicate different levels of compression (1: least compression, smallest impact on run time, 9: highest compression level, biggest impact on run times). If file size becomes an issue, we recommend using a value of 1, as higher compression levels generally have only a limited effect on the file size.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[output]\npath = \"output_moselle.nc\"         # Location of the output file\ncompressionlevel = 1               # Amount of compression (default 0)\n\n[output.vertical]   # Mapping of names between internal model components and external netCDF variables\nsatwaterdepth = \"satwaterdepth\"\nsnow = \"snow\"\ntsoil = \"tsoil\"\nustorelayerdepth = \"ustorelayerdepth\"\nsnowwater = \"snowwater\"\ncanopystorage = \"canopystorage\"\n\n[output.lateral.river]\nq = \"q_river\"\nh = \"h_river\"\n\n[output.lateral.river.reservoir]\nvolume = \"volume_reservoir\"\n\n[output.lateral.subsurface]\nssf = \"ssf\"\n\n[output.lateral.land]\nq = \"q_land\"\nh = \"h_land\"","category":"page"},{"location":"user_guide/step2_settings_file/#Scalar-data","page":"Step 2: Preparing the settings file","title":"Scalar data","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Besides gridded data, it is also possible to write scalar data to a netCDF file. Below is an example that writes scalar data to the file \"output_scalar_moselle.nc\". For each netCDF variable a name (external variable name) and parameter (internal model parameter) is required. A reducer can be specified to apply to the model output, see for more information the following section Output CSV section. When a map is provided to extract data for certain locations (e.g. gauges) or areas (e.g. subcatchment), the netCDF location names are extracted from these maps. For a specific location (grid cell) a location is required. For layered model parameters and variables that have an extra dimension layer and are part of the vertical sbm concept it is possible to specify an internal layer index (see also example below). For model parameters and variables that have an extra dimension classes and are part of the vertical FLEXTopo concept it is possible to specify the class name. If multiple layers or classes are desired, this can be specified in separate [[netcdf.variable]] entries. Note that the specification of the extra dimension is not optional when wflow is integrated with Delft-FEWS, for netCDF scalar data an extra dimension is not allowed by the importNetcdfActivity of the Delft-FEWS General Adapter. In the section Output CSV section, similar functionality is available for CSV. For integration with Delft-FEWS, see also Run from Delft-FEWS, it is recommended to write scalar data to netCDF format since the General Adapter of Delft-FEWS can ingest this data format directly.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[netcdf]\npath = \"output_scalar_moselle.nc\"  # Location of the results\n\n[[netcdf.variable]] # Extract the values of lateral.river.q using the gauges map, and assigning it with the name 'Q' as variable to the netCDF\nname = \"Q\"\nmap = \"gauges\"\nparameter = \"lateral.river.q\"\n\n[[netcdf.variable]] # Using coordinates to extract the temperature\ncoordinate.x = 6.255\ncoordinate.y = 50.012\nname = \"vwc_layer2_bycoord\"\nlocation = \"vwc_bycoord\"\nparameter = \"vertical.vwc\"\nlayer = 2\n\n[[netcdf.variable]] # Using indices to extract the temperature\nlocation = \"temp_byindex\"\nname = \"temp_index\"\nindex.x = 100\nindex.y = 264\nparameter = \"vertical.temperature\"","category":"page"},{"location":"user_guide/step2_settings_file/#Output-CSV-section","page":"Step 2: Preparing the settings file","title":"Output CSV section","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Model output can also be written to CSV output. Below is an example that writes model output to the file \"output_moselle.csv\". For each CSV column a header and parameter (internal model parameter) is required. A reducer can be specified to apply to the model output, with the following available reducers:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"maximum\nminimum\nmean\nmedian\nsum\nfirst\nlast\nonly","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"with only as the default. To extract data for a specific location (grid cell), the index of the vector, the coordinates coordinate.x and coordinate.y, or the x and y indices of the 2D array (index.x and index.y) can be provided. Finally a map can be provided to extract data for certain locations (e.g. gauges) or areas (e.g. subcatchment). In this case a single entry can lead to multiple columns in the CSV file, which will be of the form header_id, e.g. Q_20, for a gauge with integer ID 20. For layered model parameters and variables that have an extra dimension layer and are part of the vertical sbm concept an internal layer index (see also example below) should be specified. For model parameters and variables that have an extra dimension classes and are part of the vertical FLEXTopo concept it is possible to specify the class name. If multiple layers or classes are desired, this can be specified in separate [[csv.column]] entries.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"The double brackets in [[csv.column]] is TOML syntax to indicate that it is part of a list. You may specify as many entries as you wish.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[csv]\npath = \"output_moselle.csv\"\n\n[[csv.column]]\nheader = \"Q\"\nparameter = \"lateral.river.q\"\nreducer = \"maximum\"\n\n[[csv.column]]\nheader = \"volume\"\nindex = 1\nparameter = \"lateral.river.reservoir.volume\"\n\n[[csv.column]]\ncoordinate.x = 6.255\ncoordinate.y = 50.012\nheader = \"temp_bycoord\"\nparameter = \"vertical.temperature\"\n\n[[csv.column]]\ncoordinate.x = 6.255\ncoordinate.y = 50.012\nheader = \"vwc_layer2_bycoord\"\nparameter = \"vertical.vwc\"\nlayer = 2\n\n[[csv.column]]\nheader = \"temp_byindex\"\nindex.x = 100\nindex.y = 264\nparameter = \"vertical.temperature\"\n\n[[csv.column]]\nheader = \"Q\"\nmap = \"gauges\"\nparameter = \"lateral.river.q\"\n\n[[csv.column]]\nheader = \"recharge\"\nmap = \"subcatchment\"\nparameter = \"vertical.recharge\"\nreducer = \"mean\"","category":"page"},{"location":"user_guide/step2_settings_file/#Modify-parameters","page":"Step 2: Preparing the settings file","title":"Modify parameters","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"It is possible to modify model parameters and forcing through the TOML file. Two options to modify input parameters are available:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Set an input parameter (static) to an uniform value.\nModify an input parameter (cyclic and static) or forcing variable through the use of a scale factor and offset.","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"To set for example the input parameter cfmax to an uniform value of 2.5:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input.vertical]\nwater_holding_capacity = \"WHC\"\nwaterfrac = \"WaterFrac\"\ncfmax.value = 2.5","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"For input parameters with an extra dimension (e.g. layer or classes) one uniform value can be provided or a list of values that should be equal to the length of the extra dimension. For example, for input parameter c, a list of values can be provided as follows:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input.vertical]\nwater_holding_capacity = \"WHC\"\nwaterfrac = \"WaterFrac\"\nc.value = [10.5, 11.25, 9.5, 7.0]","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"To change for example the forcing variable precipitation with a scale factor of 1.5 and an offset of 0.5:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input.vertical.precipitation]\nnetcdf.variable.name = \"P\"\nscale = 1.5\noffset = 0.5","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"For input parameters with an extra dimension it is also possible to modify multiple indices at once with different scale and offset values. In the example below the external netCDF variable c is modified at layer index 1 and 2, with a scale factor of 2.0 and 1.5 respectively, and an offset of 0.0 for both indices:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input.vertical.c]\nnetcdf.variable.name = \"c\"\nscale = [2.0, 1.5]\noffset = [0.0, 0.0]\nlayer = [1, 2]","category":"page"},{"location":"user_guide/step2_settings_file/#Fixed-forcing-values","page":"Step 2: Preparing the settings file","title":"Fixed forcing values","text":"","category":"section"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"It is possible to set fixed values for forcing parameters through the TOML file. To set for example temperature to a fixed value of 10 degreeC, the complete forcing list is required:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"forcing = [\n  \"vertical.precipitation\",\n  \"vertical.temperature\",\n  \"vertical.potential_evaporation\",\n]\n\n[input.vertical.temperature]\nvalue = 10","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"Note that the mapping to the external netCDF variable listed under the section [input.vertical] needs to be removed or commented out:","category":"page"},{"location":"user_guide/step2_settings_file/","page":"Step 2: Preparing the settings file","title":"Step 2: Preparing the settings file","text":"[input.vertical]\npotential_evaporation = \"PET\" # forcing\n# temperature = \"TEMP\" # forcing\nprecipitation = \"P\" # forcing","category":"page"},{"location":"user_guide/model-setup/#Building-a-model-from-scratch","page":"Building a model from scratch","title":"Building a model from scratch","text":"","category":"section"},{"location":"user_guide/model-setup/#Data-requirements","page":"Building a model from scratch","title":"Data requirements","text":"","category":"section"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The actual data requirements depend on the application of the Model and the Model type. Both forcing and static data should be provided in netCDF format, with the same grid definition for forcing and static data. The only exception is storage and rating curves for lakes, that should be provided in CSV format, see also Additional settings.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Forcing data:\nPrecipitation\nPotential evapotranspiration\nTemperature (optional, only needed for snow and glacier modelling)","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The requirements for static data (including model parameters) depend on the Model type. The following data is required for all Model types, but not directly part of a Model component:","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"flow direction data (D8)\nriver map (location of the river)\nsub-catchment map (model domain)","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"For the flow direction (D8) data, the PCRaster ldd convention is used, see also PCRaster ldd. An approach to generate ldd data is to make use of the Python package pyflwdir:","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"to upscale existing flow direction data as the 3 arcsec MERIT Hydro data (Yamazaki et al., 2019)\nor to derive flow directions from elevation data,","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"see also Eilander et al. (2021) for more information. Pyflwdir is also used by the hydroMT Python package described in the next paragraph. Another approach to generate ldd data is to make use of PCRaster functionality, see for example lddcreate.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Optionally, but also not directly part of a model component are gauge locations, that are used to extract gridded data from certain locations.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The different supported model configurations are described in the section Model configurations. Wflow_sbm models have the vertical concept SBM in common and input parameters for this component are described in the SBM section of Model parameters. For wflow_sbm models there are two ways to include subsurface flow:","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The kinematic wave approach (see section Subsurface flow routing) as part of the sbm model type. Parameters that are part of this component are described in the Lateral subsurface flow section of Model parameters. Input parameters for this component are derived from the SBM vertical concept and the land slope. One external parameter ksathorfrac is used to calculate the horizontal hydraulic conductivity at the soil surface kh_0.\nGroundwater flow (see section Groundwater flow component) as part of the sbm_gwf model type. For the unconfined aquifer the input parameters are described in the section Unconfined aquifer of Model parameters. The bottom (bottom) of the groundwater layer is derived from from the soilthickness [mm] parameter of SBM and the provided surface elevation altitude [m] as part of the static input. The area parameter is derived from the model grid. Parameters that are part of the boundary conditions of the unconfined aquifer are listed under Constant Head and Boundary conditions of the Model parameters section.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Most hydrological model configurations make use of the kinematic wave surface routing (river flow, overland flow or both) and input data required for the river and overland flow components is described in Surface flow.  There is also the option to use the local inertial model as part of the wflow_sbm models (model types sbm and sbm_gwf):","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"for river flow, see also the Local inertial river and floodplain model.\nfor 1D river flow and 2D overland flow combined, see also the Local inertial river (1D) and land (2D) model.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Input parameters for this approach are described in River flow (local inertial), including the optional 1D floodplain schematization, and Overland flow (local inertial) of the Model parameters section.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Reservoirs or lakes can be part of the kinematic wave or local inertial model for river flow and input parameters are described in Reservoirs and Lakes.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The wflow_hbv model configuration consists besides the river and overland flow components of the HBV vertical concept. Input parameters for this component are described in the HBV section of Model parameters. For the river and overland flow components the kinematic wave approach is used.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The wflow_flextopo model configuration consists besides the river and overland flow components of the FLEXTopo vertical concept. Input parameters for this component are described in the FLEXTopo section of Model parameters. For the river and overland flow components the kinematic wave approach is used.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The wflow_sediment model configuration consists of the vertical Soil Erosion concept and the input parameters for this concept are described in the Sediment section of the Model parameters. The parameters of the lateral Sediment Flux in overland flow concept are described in the Overland flow section of the Model parameters. Parameters of this component are not directly set by data from static input. The input parameters of the lateral concept River Sediment Model are listed in River flow of the Model parameters section.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"The Model parameters section lists all the parameters per Model component and these Tables can also be used to check which parameters can be part of the output, see also Output netCDF section and Output CSV section.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Example models can be found in the Example models section.","category":"page"},{"location":"user_guide/model-setup/#hydroMT","page":"Building a model from scratch","title":"hydroMT","text":"","category":"section"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"hydroMT is a Python package, developed by Deltares, to build and analyze hydro models. It provides a generic model api with attributes to access the model schematization, (dynamic) forcing data, results and states.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"For the following wflow_sbm model (modeltype sbm) configurations:","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"wflow_sbm + kinematic wave routing\nwflow_sbm + local inertial river and floodplain\nwflow_sbm + local inertial river (1D) and land (2D)","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"and the wflow_sediment model configuration, the wflow plugin hydroMT-wflow of hydroMT can be used to build and analyze these wflow models in an automated way.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"To learn more about the wflow plugin of this Python package, we refer to the hydroMT-wflow documentation.","category":"page"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"To inspect or modify (for example in QGIS) the netCDF static data of these wflow models it is convenient to export the maps to a raster format. This can be done as part of the hydroMT-wflow plugin, see also the following example. It is also possible to create again the netCDF static data file based on the modified raster map stack.","category":"page"},{"location":"user_guide/model-setup/#References","page":"Building a model from scratch","title":"References","text":"","category":"section"},{"location":"user_guide/model-setup/","page":"Building a model from scratch","title":"Building a model from scratch","text":"Yamazaki, D., Ikeshima, D., Sosa, J., Bates, P. D., Allen, G. H. and Pavelsky, T. M.: MERIT Hydro: A high‐resolution global hydrography map based on latest topography datasets, Water Resour. Res., 2019WR024873, doi:10.1029/2019WR024873, 2019.\nEilander, D., van Verseveld, W., Yamazaki, D., Weerts, A., Winsemius, H. C., and Ward, P. J.: A hydrography upscaling method for scale-invariant parametrization of distributed hydrological models, Hydrol. Earth Syst. Sci., 25, 5287–5313, https://doi.org/10.5194/hess-25-5287-2021, 2021.","category":"page"},{"location":"model_docs/intro/#About-the-model-documentation","page":"About the model documentation","title":"About the model documentation","text":"","category":"section"},{"location":"model_docs/intro/","page":"About the model documentation","title":"About the model documentation","text":"As opposed to the user guide, which describes the steps needed to build and apply a model in the software, this section explains the different model concepts that are available within the modelling framework of wflow. Descriptions are given regarding the model concepts with links to the original scientific papers which explain the concepts in more detail. The model parameters which influence the processes are also shown, using inline code blocks. An overview of all model parameters is also provided for easy reference, including their short names, long descriptions and their units (see parameters vertical concepts and parameters lateral concepts).","category":"page"},{"location":"model_docs/intro/#Division-between-vertical-and-lateral","page":"About the model documentation","title":"Division between vertical and lateral","text":"","category":"section"},{"location":"model_docs/intro/","page":"About the model documentation","title":"About the model documentation","text":"In the documentation we talk of vertical and lateral concepts. These are components in the model that describe the vertical movement of water in each model grid cell and the lateral movement of water across grid cells.","category":"page"},{"location":"user_guide/step3_input_data/#Step-3:-Preparing-the-input-data","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"","category":"section"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"As mentioned before, the input data can be classified into two types:","category":"page"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"Meteorological forcing: maps with timeseries for each model pixel, with values for precipitation, temperature, and potential evaporation. This data should be provided as a three-dimensional dataset, with the x, y and time dimensions.\nStatic maps.","category":"page"},{"location":"user_guide/step3_input_data/#Meteorological-data","page":"Step 3: Preparing the input data","title":"Meteorological data","text":"","category":"section"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"Meteorological data is provided as a single netCDF file, with several variables containing the forcing data for precipitation, temperature and potential evaporation. The code snippet below shows the contents of the example file (downloaded here), and displaying the content with NCDatasets in Julia. As can be seen, each forcing variable (precip, pet and temp) consists of a three-dimensional dataset (x, y, and time), and each timestep consists of a two-dimensional map with values at each gridcell. Only values within the basin are required.","category":"page"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"Group: /\n\nDimensions\n   time = 366\n   y = 313\n   x = 291\n\nVariables\n  time   (366)\n    Datatype:    Int64\n    Dimensions:  time\n    Attributes:\n     units                = days since 2000-01-02 00:00:00\n     calendar             = proleptic_gregorian\n\n  y   (313)\n    Datatype:    Float64\n    Dimensions:  y\n    Attributes:\n     _FillValue           = NaN\n\n  x   (291)\n    Datatype:    Float64\n    Dimensions:  x\n    Attributes:\n     _FillValue           = NaN\n\n  spatial_ref\n    Attributes:\n     crs_wkt              = GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]\n     x_dim                = x\n     y_dim                = y\n     dim0                 = time\n\n  precip   (291 × 313 × 366)\n    Datatype:    Float32\n    Dimensions:  x × y × time\n    Attributes:\n     _FillValue           = NaN\n     unit                 = mm\n     precip_fn            = era5\n     coordinates          = idx_out spatial_ref mask\n\n  idx_out   (291 × 313)\n    Datatype:    Int32\n    Dimensions:  x × y\n\n  mask   (291 × 313)\n    Datatype:    UInt8\n    Dimensions:  x × y\n\n  pet   (291 × 313 × 366)\n    Datatype:    Float32\n    Dimensions:  x × y × time\n    Attributes:\n     _FillValue           = NaN\n     unit                 = mm\n     pet_fn               = era5\n     pet_method           = debruin\n     coordinates          = idx_out spatial_ref mask\n\n  temp   (291 × 313 × 366)\n    Datatype:    Float32\n    Dimensions:  x × y × time\n    Attributes:\n     _FillValue           = NaN\n     unit                 = degree C.\n     temp_fn              = era5\n     temp_correction      = True\n     coordinates          = idx_out spatial_ref mask\n\nGlobal attributes\n  unit                 = mm\n  precip_fn            = era5","category":"page"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"note: Note\nWflow expects right labeling of the forcing time interval, e.g. daily precipitation at 01-02-2000 00:00:00 is the accumulated total precipitation between 01-01-2000 00:00:00 and 01-02-2000 00:00:00.","category":"page"},{"location":"user_guide/step3_input_data/#Static-data","page":"Step 3: Preparing the input data","title":"Static data","text":"","category":"section"},{"location":"user_guide/step3_input_data/#List-of-essential-static-data","page":"Step 3: Preparing the input data","title":"List of essential static data","text":"","category":"section"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"The list below contains a brief overview of several essential static maps required to run wflow. These NC variables names refer to the example data of the wflow_sbm + kinematic wave model (see here). Example data for the other model configurations can be found here.","category":"page"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"Description NC variable name unit\nFlow direction (1-9) wflow_ldd -\nMap indicating the river cells (0-1) wflow_river -\nThe length of the river wflow_riverlength m\nThe width of the river wflow_riverwidth m\nMask of the basin wflow_subcatch -\nLand slope Slope m m^-1\nRiver slope RiverSlope m m^-1","category":"page"},{"location":"user_guide/step3_input_data/","page":"Step 3: Preparing the input data","title":"Step 3: Preparing the input data","text":"As mentioned before, the model parameters can also be defined as spatial maps. They can be included in the same netCDF file, as long as their variable names are correctly mapped in the TOML settings file. See the section on example models on how to use this functionality.","category":"page"},{"location":"user_guide/step4_running/#run_wflow","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"","category":"section"},{"location":"user_guide/step4_running/#Using-Julia","page":"Step 4: Running a simulation","title":"Using Julia","text":"","category":"section"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Once you installed Julia and Wflow.jl, a simulation can be started from the command line as follows:","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"julia -e 'using Wflow; Wflow.run()' path/to/config.toml","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Furthermore, it is possible to write a Julia script to run a simulation. Example data to explore how this works can be found here.","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"using Wflow\nWflow.run(toml_path)","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Julia can also be used to modify settings after reading the settings file. In the example below, we show how to adjust the end date of the simulation.","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"using Dates\nconfig = Wflow.Config(toml_path)\nconfig.endtime = DateTime(\"2000-01-03T00:00:00\")\nWflow.run(config)","category":"page"},{"location":"user_guide/step4_running/#cli","page":"Step 4: Running a simulation","title":"Using the command line interface","text":"","category":"section"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"If you don't need the extra features of using wflow as a library, but just want to run simulations, the command line interface makes it easier to do so. It consists of a single executable, wflow_cli that accepts a single argument, the path to a TOML configuration file.","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Binaries of wflow_cli can be downloaded from our website download.deltares.nl, and are currently available for Windows.","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"After installing you can see three folders in the installation directory. It is only the bin/wflow_cli that is directly used. All three folders need to stay together however. The share folder contains TOML files with more information about the build.","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"bin\\wflow_cli\nlib\nshare","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Simply running wflow_cli with no arguments will give the following message:","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"Usage: wflow_cli 'path/to/config.toml'","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"When starting a run, you will see basic run information on the screen, as well as a progress bar, that gives an estimate of how much time is needed to finish the simulation:","category":"page"},{"location":"user_guide/step4_running/","page":"Step 4: Running a simulation","title":"Step 4: Running a simulation","text":"┌ Info: Run information\n│   model_type = \"sbm\"\n│   starttime = CFTime.DateTimeStandard(2000-01-01T00:00:00)\n│   dt = 86400 seconds\n│   endtime = CFTime.DateTimeStandard(2000-12-31T00:00:00)\n└   nthreads() = 4\n\nProgress: 100%|██████████████████████████████████████████████████| Time: 0:00:27","category":"page"},{"location":"model_docs/lateral/local-inertial/#local_inertial","page":"Local inertial","title":"Local inertial","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/#River-and-floodplain-routing","page":"Local inertial","title":"River and floodplain routing","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The local inertial approximation of shallow water flow neglects only the convective acceleration term in the Saint-Venant momentum conservation equation. The numerical solution of the local inertial approximation on a staggered grid is as follows (Bates et al., 2010):","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Q_t+Delta t = fracQ_t - g A_t Delta t S_t(1+gDelta t n^2 Q_t  (R_t^43 A_t))","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where Q_t+Delta t is the river flow [m^3/s] at time step t+Delta t, g is acceleration due to gravity [m/s^2], A_t is the cross sectional flow area at the previous time step, R_t is the hydraulic radius at the previous time step, Q_t is the river flow [m^3/s] at the previous time step, S_t is the water surface slope at the previous time step and n is the Manning's roughness coefficient [m^-13 s].","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The momentum equation is applied to each link between two river grid cells, while the continuity equation over Delta t is applied to each river cell:","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"h^t+Delta t = h^t + Delta t fracQ^t+Delta t_src - Q^t+Delta t_dstA","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where h^t+Delta t is the water depth [m] at time step t+Delta t, h^t is the water depth [m] at the previous time step, A is the river area [m^2] and Q_src and Q_dst represent river flow [m^3/s] at the upstream and downstream link of the river cell, respectively.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The model time step Delta t for the local inertial model is estimated based on the Courant-Friedrichs-Lewy condition (Bates et al., 2010):","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Delta t = min(alpha fracDelta x_isqrt(gh_i))","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where sqrt(gh_i) is the wave celerity for river cell i , Delta x_i is the river length [m] for river cell i and alpha is a coefficient (typically between 0.2 and 0.7) to enhance the stability of the simulation.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"In the TOML file the following properties related to the local inertial model can be provided for the sbm and sbm_gwf model types:","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"[model]\nriver_routing = \"local-inertial\"  # default is \"kinematic-wave\"\ninertial_flow_alpha = 0.5         # alpha coefficient for model stability (default = 0.7)\nfroude_limit = true               # default is true, limit flow to subcritical-critical according to Froude number\nh_thresh = 0.1                    # water depth [m] threshold for calculating flow between cells (default = 1e-03)\nfloodplain_1d = true              # include 1D floodplain schematization (default = false)","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Two optional constant boundary conditions riverlength_bc and riverdepth_bc can be provided at a river outlet node (or multiple river outlet nodes) through the model parameter netCDF file, as follows:","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"[input.lateral.river]\nriverlength_bc = \"riverlength_bc\"   # optional river length [m], default = 1e04\nriverdepth_bc = \"riverdepth_bc\"     # optional river depth [m], default = 0.0","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"These boundary conditions are copied to a ghost node (downstream of the river outlet node) in the code.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The optional 1D floodplain schematization is based on provided flood volumes as a function of flood depth (per flood depth interval) for each river cell. Wflow calculates from these flood volumes a rectangular floodplain profile for each flood depth interval. Routing is done separately for the river channel and floodplain.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The momentum equation is most stable for low slope environments, and to keep the simulation stable for (partly) steep environments the froude_limit option is set to true by default. This setting limits flow conditions to subcritical-critical conditions based on the Froude number (le 1), similar to Coulthard et al. (2013) in the CAESAR-LISFLOOD model and Adams et al. (2017) in the Landlab v1.0 OverlandFlow component. The froude number Fr on a link is calculated as follows:","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"  Fr = fracusqrt(gh_f)","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where sqrt(gh_f) is the wave celerity on a link and u is the water velocity on a link. If the water velocity from the local inertial model is causing the Froude number to be greater than 1.0, the water velocity (and flow) is reduced in order to maintain a Froude number of 1.0.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The downstream boundary condition basically simulates a zero water depth boundary condition at a set distance, as follows. For the downstream boundary condition (ghost point) the river width, river bed elevation and Manning's roughness coefficient are copied from the upstream river cell. The river length [m] of the boundary cell can be set through the TOML file with riverlength_bc, and has a default value of 10 km. The water depth at the boundary cell is fixed at 0.0 m.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Simplified reservoir and lake models can be included as part of the local inertial model for river flow (1D) and river and overland flow combined (see next section). Reservoir and lake models are included as a boundary point with zero water depth for both river and overland flow. For river flow the reservoir or lake model replaces the local inertial model at the reservoir or lake location, and Q is set by the outflow from the reservoir or lake. Overland flow at a reservoir or lake location is not allowed to or from the downstream river grid cell.","category":"page"},{"location":"model_docs/lateral/local-inertial/#Overland-flow-(2D)","page":"Local inertial","title":"Overland flow (2D)","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"For the simulation of 2D overland flow on a staggered grid the numerical scheme proposed by de Almeida et al. (2012) is adopted. The explicit solution for the estimation of water discharge between two cells in the x-direction is of the following form (following the notation of Almeida et al. (2012)):","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Q_i-12^n+1 = fracleft theta Q_i-12^n +frac(1-theta)2(Q_(i-32)^n + \n  Q_(i+12)^n)right- g h_f fracDelta tDelta x (eta^n_i - eta^n_i-1) Delta y1+gDelta t \n   n^2 Q_i-12^n(h_f^73 Delta y)","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"where subscripts i and n refer to space and time indices, respectively. Subscript i-12 is to the link between node i and i-1, subscript i+12 is the link between node i and node i+1, and subscript i-32 is the link between node i-1 and node i-2. Q is the water discharge [m^3 s^-1], eta is the water surface elevation [m], h_f [m] is the water depth between cells, n is the Manning's roughness coefficient [m^-13 s], g is acceleration due to gravity [m/s^2], Delta t [s] is the adaptive model time step, Delta x [m] is the distance between two cells and Delta y [m] is the flow width. Below the staggered grid and variables of the numerical solution in the x-direction, based on Almeida et al. (2012):","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"(Image: numerical_scheme_almeida)","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The overland flow local inertial approach is used in combination with the local inertial river routing. This is a similar to the modelling approach of Neal et al. (2012), where the hydraulic model LISFLOOD-FP was extended with a subgrid channel model. For the subgrid channel, Neal et al. (2012) make use of a D4 (four direction) scheme, while here a D8 (eight direction) scheme is used, in combination with the D4 scheme for 2D overland flow.","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"In the TOML file the following properties related to the local inertial model with 1D river routing and 2D overland flow can be provided for the sbm model type:","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"[model]\nland_routing = \"local-inertial\"  # default is kinematic-wave\nriver_routing = \"local-inertial\" # default is kinematic-wave\ninertial_flow_alpha = 0.5        # alpha coefficient for model stability (default = 0.7)\nfroude_limit = true              # default is true, limit flow to subcritical-critical according to Froude number\nh_thresh = 0.1                   # water depth [m] threshold for calculating flow between cells (default = 1e-03)","category":"page"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The properties inertial_flow_alpha, froude_limit and h_thresh apply to 1D river routing as well as 2D overland flow. The properties inertial_flow_alpha and froude_limit, and the adaptive model time step Delta t are explained in more detail in the River and floodplain routing section of the local inertial model.","category":"page"},{"location":"model_docs/lateral/local-inertial/#Inflow","page":"Local inertial","title":"Inflow","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"External water (supply/abstraction) inflow [m^3 s^-1]  can be added to the local inertial model for river flow (1D) and river and overland flow combined (1D-2D), as a cyclic parameter or as part of forcing (see also Input section).","category":"page"},{"location":"model_docs/lateral/local-inertial/#Abstractions","page":"Local inertial","title":"Abstractions","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Abstractions from the river through the variable abstraction [m^3 s-1] are possible when water demand and allocation is computed. The variable abstraction is set from the water demand and allocation module each time step. Abstractions are subtracted as part of the continuity equation of the local inertial model.","category":"page"},{"location":"model_docs/lateral/local-inertial/#Multi-Threading","page":"Local inertial","title":"Multi-Threading","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"The local inertial model for river flow (1D) and river and overland flow combined (1D-2D) can be executed in parallel using multiple threads.","category":"page"},{"location":"model_docs/lateral/local-inertial/#References","page":"Local inertial","title":"References","text":"","category":"section"},{"location":"model_docs/lateral/local-inertial/","page":"Local inertial","title":"Local inertial","text":"Adams, J. M., Gasparini, N. M., Hobley, D. E. J., Tucker, G. E., Hutton, E. W. H., Nudurupati, S. S., and Istanbulluoglu, E., 2017, The Landlab v1.0 OverlandFlow component: a Python tool for computing shallow-water flow across watersheds, Geosci. Model Dev., 10, 1645–1663, https://doi.org/10.5194/gmd-10-1645-2017.\nde Almeida, G. A. M., P. Bates, J. E. Freer, and M. Souvignet, 2012, Improving the stability of a simple formulation of the shallow water equations for 2-D flood modeling, Water Resour. Res., 48, W05528, https://doi.org/10.1029/2011WR011570.\nBates, P. D., M. S. Horritt, and T. J. Fewtrell, 2010, A simple inertial formulation of the shallow water equations for efficient two-dimensional flood inundation modelling, J. Hydrol., 387, 33–45, https://doi.org/10.1016/j.jhydrol.2010.03.027.\nCoulthard, T. J., Neal, J. C., Bates, P. D., Ramirez, J., de Almeida, G. A. M., and Hancock, G. R., 2013, Integrating the LISFLOOD-FP 2- D hydrodynamic model with the CAESAR model: implications for modelling landscape evolution, Earth Surf. Proc. Land., 38, 1897–1906, https://doi.org/10.1002/esp.3478.\nNeal, J., G. Schumann, and P. Bates (2012), A subgrid channel model for simulating river hydraulics and floodplaininundation over large and data sparse areas, Water Resour.Res., 48, W11506, https://doi.org/10.1029/2012WR012514.","category":"page"},{"location":"user_guide/additional_options/#Additional-wflow-options","page":"Additional wflow options","title":"Additional wflow options","text":"","category":"section"},{"location":"user_guide/additional_options/#reinit","page":"Additional wflow options","title":"Starting the model with \"warm\" states","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"The state section in the TOML file provides information on the input file if the model is initialized with a warm state (path_input) and to what file the states are written at the end of the model run (path_output). Please note that the model setting reinit needs to be set to false in order to initialize the model with states from the file located at path_input. A mapping between external state names and internal model states is required. This information is specified for each model component, the vertical model and lateral model components. In the example below the vertical component represents the SBM concept, and for the lateral components there is a river (including optional reservoir, lake and floodplain components), land and subsurface domain. The internal model states are listed on the left side, and the external state names are listed on the right side. Note that path_input is only required when reinit is set to false. path_output is optional, an output state file is only written when it is defined. If neither is set, the entire state section can be left out.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[model]\nreinit = false # cold (reinit = true) or warm state (reinit = false), default is true\n\n[state]\npath_input = \"data/instates-moselle.nc\"     # Location of the file with the input states\npath_output = \"data/outstates-moselle.nc\"   # Output location of the states after the model run\n\n[state.vertical]\nsatwaterdepth = \"satwaterdepth\"\nsnow = \"snow\"\ntsoil = \"tsoil\"\nustorelayerdepth = \"ustorelayerdepth\"\ncanopystorage = \"canopystorage\"\nsnowwater = \"snowwater\"\nglacierstore =\"glacierstore\"\n\n[state.lateral.river]\nq = \"q_river\"\nh = \"h_river\"\nh_av = \"h_av_river\"\n\n[state.lateral.river.floodplain] \nq = \"q_floodplain\"\nh = \"h_floodplain\"\n\n[state.lateral.river.reservoir]\nvolume = \"volume_reservoir\"\n\n[state.lateral.river.lake]\nwaterlevel = \"waterlevel_lake\"\n\n[state.lateral.subsurface]\nssf = \"ssf\"\n\n[state.lateral.land]\nq = \"q_land\"\nh = \"h_land\"\nh_av = \"h_av_land\"","category":"page"},{"location":"user_guide/additional_options/#Enabling-snow-and-glacier-processes","page":"Additional wflow options","title":"Enabling snow and glacier processes","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[model]\nsnow = true\nmasswasting = true\nglacier = true\n\n[input.vertical]\ntt = \"TT\"\ntti = \"TTI\"\nttm = \"TTM\"\nwater_holding_capacity = \"WHC\"\nglacierstore = \"wflow_glacierstore\"\nglacierfrac = \"wflow_glacierfrac\"\ng_cfmax = \"G_Cfmax\"\ng_tt = \"G_TT\"\ng_sifrac = \"G_SIfrac\"","category":"page"},{"location":"user_guide/additional_options/#Enabling-reservoirs","page":"Additional wflow options","title":"Enabling reservoirs","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[model]\nreservoirs = true\n\n[input.lateral.river.reservoir]\narea = \"ResSimpleArea\"\nareas = \"wflow_reservoirareas\"\ndemand = \"ResDemand\"\nlocs = \"wflow_reservoirlocs\"\nmaxrelease = \"ResMaxRelease\"\nmaxvolume = \"ResMaxVolume\"\ntargetfullfrac = \"ResTargetFullFrac\"\ntargetminfrac = \"ResTargetMinFrac\"\n\n[state.lateral.river.reservoir]\nvolume = \"volume_reservoir\"","category":"page"},{"location":"user_guide/additional_options/#Enabling-lakes","page":"Additional wflow options","title":"Enabling lakes","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[model]\nlakes = true\n\n[input.lateral.river.lake]\narea = \"lake_area\"\nareas = \"wflow_lakeareas\"\nb = \"lake_b\"\ne = \"lake_e\"\nlocs = \"wflow_lakelocs\"\noutflowfunc = \"lake_outflowfunc\"\nstorfunc  = \"lake_storfunc\"\nthreshold  = \"lake_threshold\"\nwaterlevel = \"lake_waterlevel\"\n\n[state.lateral.river.lake]\nwaterlevel = \"waterlevel_lake\"","category":"page"},{"location":"user_guide/additional_options/#Enabling-Floodplain-routing","page":"Additional wflow options","title":"Enabling Floodplain routing","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"As part of the local inertial model for river flow.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[model]\nfloodplain_1d = true\n\n[input.lateral.river.floodplain]\nvolume = \"floodplain_volume\"\nn = \"floodplain_n\"\n\n[state.lateral.river.floodplain] \nq = \"q_floodplain\"\nh = \"h_floodplain\"","category":"page"},{"location":"user_guide/additional_options/#Enabling-water-demand-and-allocation","page":"Additional wflow options","title":"Enabling water demand and allocation","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"The model types sbm and sbm_gwf support water demand and allocation computations, in combination with the kinematic wave and local inertial runoff routing scheme for river and overland flow.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"# example of water demand and allocation input parameters as cyclic data\n[input]\ncyclic = [\"vertical.domestic.demand_gross\", \"vertical.domestic.demand_net\", \n\"vertical.industry.demand_gross\", \"vertical.industry.demand_net\", \n\"vertical.livestock.demand_gross\", \"vertical.livestock.demand_net\", \n\"vertical.paddy.irrigation_trigger\", \"vertical.nonpaddy.irrigation_trigger\",]\n\n[model.water_demand]\ndomestic = true     # optional, default is \"false\"\nindustry = true     # optional, default is \"false\"\nlivestock = true    # optional, default is \"false\"\npaddy = true        # optional, default is \"false\"\nnonpaddy = true     # optional, default is \"false\"\n\n[input.vertical.allocation]\nareas = \"allocation_areas\"\nfrac_sw_used = \"SurfaceWaterFrac\"\n\n[input.vertical.domestic]\ndemand_gross = \"dom_gross\"\ndemand_net = \"dom_net\"\n\n[input.vertical.industry]\ndemand_gross = \"ind_gross\"\ndemand_net = \"ind_net\"\n\n[input.vertical.livestock]\ndemand_gross = \"lsk_gross\"\ndemand_net = \"lsk_net\"\n\n[input.vertical.paddy]\nirrigation_areas = \"paddy_irrigation_areas\"\nirrigation_trigger = \"irrigation_trigger\"\n\n[input.vertical.nonpaddy]\nirrigation_areas = \"nonpaddy_irrigation_areas\"\nirrigation_trigger = \"irrigation_trigger\"\n\n# required if paddy is set to \"true\"\n[state.vertical.paddy]\nh = \"h_paddy\"","category":"page"},{"location":"user_guide/additional_options/#multi_threading","page":"Additional wflow options","title":"Using multithreading","text":"","category":"section"},{"location":"user_guide/additional_options/#Using-wflow-in-Julia","page":"Additional wflow options","title":"Using wflow in Julia","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Wflow supports multi-threading execution of the wflow_sbm model that uses the kinematic wave approach for river, overland and lateral subsurface flow. Both the vertical SBM concept and the kinematic wave components of this model can run on multiple threads. The optional local inertial model for river flow and the optional local inertial model for river (1D) and land (2D), both part of wflow_sbm, can also run on multiple threads. The threading functionality for the kinematic wave may also be useful for models that make (partly) use of this routing approach as the wflow_hbv model and the wflow_sbm model SBM + Groundwater flow. The multi-threading functionality in wflow is considered experimental, see also the following issue, where an error was not thrown running code multi-threaded. Because of this we advise to start with running a wflow model single-threaded (for example during the testing phase of setting up an new wflow model).","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"For information on how to start Julia with multiple threads we refer to How to start Julia with multiple threads.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Additionally, when running Julia + wflow via the command line (note that this is different from the wflow_cli), it is possible to define the number of threads via the -t flag. An example where we start Julia with three threads:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"julia -t 3 -e 'using Wflow; Wflow.run()' path/to/config.toml","category":"page"},{"location":"user_guide/additional_options/#cli_multi_threading","page":"Additional wflow options","title":"Using the command line interface","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"As explained above, we need to start julia with multiple threads to make use of this speedup. For wflow_cli, the only way to do this is by setting the JULIA_NUM_THREADS environment variable, as explained in these julia docs.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"When a model run starts, among the run information the number of threads that are used is printed, so nthreads() = 4 means 4 threads are used, because JULIA_NUM_THREADS has been set to 4.","category":"page"},{"location":"user_guide/additional_options/#Using-the-Basic-Model-Interface","page":"Additional wflow options","title":"Using the Basic Model Interface","text":"","category":"section"},{"location":"user_guide/additional_options/#Introduction","page":"Additional wflow options","title":"Introduction","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"The Community Surface Dynamics Modeling System (CSMDS) has developed the Basic Model Interface (BMI). BMI consists of a set of standard control and query functions that can be added by a developer to the model code and makes a model both easier to learn and easier to couple with other software elements.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"For more information see also: http://csdms.colorado.edu/wiki/BMI_Description","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"CSDMS provides specifications for the languages C, C++, Fortran and Python. Wflow, written in the Julia programming language, makes use of the following Julia specification, based on BMI 2.0 version.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"For the BMI implementation of wflow all grids are defined as unstructured grids, including the special cases scalar and points. While the input (forcing and model parameters) is structured (uniform rectilinear), internally wflow works with one dimensional arrays based on the active grid cells of the 2D model domain.","category":"page"},{"location":"user_guide/additional_options/#Configuration","page":"Additional wflow options","title":"Configuration","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"The variables that wflow can exchange through BMI are based on the different model components and these components should be listed under the API section of the TOML configuration file of the model type. Below an example of this API section, that lists the vertical component and different lateral components:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"[API]\ncomponents = [\n  \"vertical\",\n  \"lateral.subsurface\",\n  \"lateral.land\",\n  \"lateral.river\",\n  \"lateral.river.reservoir\"\n]","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"See also:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Wflow.BMI.initialize\nWflow.BMI.get_input_var_names","category":"page"},{"location":"user_guide/additional_options/#BasicModelInterface.initialize","page":"Additional wflow options","title":"BasicModelInterface.initialize","text":"BMI.initialize(::Type{<:Wflow.Model}, config_file)\n\nInitialize the model. Reads the input settings and data as defined in the Config object generated from the configuration file config_file. Will return a Model that is ready to run.\n\n\n\n\n\n","category":"function"},{"location":"user_guide/additional_options/#BasicModelInterface.get_input_var_names","page":"Additional wflow options","title":"BasicModelInterface.get_input_var_names","text":"BMI.get_input_var_names(model::Model)\n\nReturns model input variables, based on the API section in the model configuration file. This API sections contains a list of Model components for which variables can be exchanged.\n\n\n\n\n\n","category":"function"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Variables with a third dimension, for example layer as part of the vertical SBM concept, are exposed as two-dimensional grids through the wflow BMI implementation. For these variables the index of this third dimension is required, by adding [k] to the variable name (k refers to the index of the third dimension). For example, the variable vertical.vwc[1] refers to the first soil layer of the vertical SBM concept.","category":"page"},{"location":"user_guide/additional_options/#Couple-to-a-groundwater-model","page":"Additional wflow options","title":"Couple to a groundwater model","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"For the coupling of wflow_sbm (SBM + kinematic wave) with a groundwater model (e.g. MODFLOW) it is possible to run:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"wflow_sbm in parts from the BMI, and\nto switch off the lateral subsurface flow component of wflow_sbm.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"The lateral subsurface component of wflow_sbm is not initialized by wflow when the [input.lateral.subsurface] part of the TOML file is not included. Then from the BMI it is possible to run first the recharge part of SBM:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"model = BMI.update(model, run=\"sbm_until_recharge\")","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"and to exchange recharge and for example river waterlevels to the groundwater model. After the groundwater model update, and the exchange of groundwater head and for example drain and river flux to wflow_sbm, the SBM part that mainly determines exfiltration of water from the unsaturated store, and the kinematic wave for river - and overland flow can be run as follows:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"model = BMI.update(model, run=\"sbm_after_subsurfaceflow\")","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"See also:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Wflow.BMI.update","category":"page"},{"location":"user_guide/additional_options/#BasicModelInterface.update","page":"Additional wflow options","title":"BasicModelInterface.update","text":"BMI.update(model::Model; run = nothing)\n\nUpdate the model for a single timestep.\n\nArguments\n\nrun = nothing: to update a model partially.\n\n\n\n\n\n","category":"function"},{"location":"user_guide/additional_options/#run_fews","page":"Additional wflow options","title":"Run from Delft-FEWS","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"Wflow integrates easily as part of an operational system by linking to the Delft-FEWS platform. Delft-FEWS integrates data and models, and is for example used in many active flood forecasting systems around the world.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"This can be done without a model adapter that provides the interface between Delft-FEWS and an external model (or module). This is possible because time information in the TOML configuration file is optional and Delft-FEWS can import and export netCDF files. When time information is left out from the TOML configuration file, the starttime, endtime and timestepsecs (timestep) of the run is extracted from the netCDF forcing file by wflow.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"To indicate that a wflow model runs from Delft-FEWS, the following setting needs to be specified in the main section of the TOML configuration file:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"fews_run = true  # optional, default value is false","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"This ensures that wflow offsets the time handling, to meet the expectations of Delft-FEWS.","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"It also uses a different format for the log file such that each log message takes up only one line. That meets the General Adapter logFile expectations, which then can get parsed with these Delft-FEWS log parsing settings:","category":"page"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"<logFile>\n    <file>log.txt</file>\n    <errorLinePattern >* [Error] *</errorLinePattern >\n    <warningLinePattern>* [Warn] *</warningLinePattern>\n    <infoLinePattern>* [Info] *</infoLinePattern>\n    <debugLinePattern >* [Debug] *</debugLinePattern >\n</logFile>","category":"page"},{"location":"user_guide/additional_options/#Run-wflow-as-a-ZMQ-Server","page":"Additional wflow options","title":"Run wflow as a ZMQ Server","text":"","category":"section"},{"location":"user_guide/additional_options/","page":"Additional wflow options","title":"Additional wflow options","text":"It is possible to run wflow as a ZMQ Server, for example for the coupling to the OpenDA software for data-assimilation. The code for the wflow ZMQ Server is not part of the Wflow.jl package, and is located here.","category":"page"},{"location":"model_docs/vertical/sediment/#vert_sediment","page":"Sediment","title":"Sediment","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Over the land, soil erosion, also called soil loss, is closely linked to the water cycle. The main processes governing sediment generation are splash erosion from rain droplets, and sheet and rill erosion from the shear stress caused by overland flow. The intensity of soil erosion by rain or ﬂow depends on the land and soil characteristics such as slope, land use or soil type. Once soil is eroded, the detached particles can be transported downslope by overland ﬂow. Along the transport pathways, soil particles can also be deposited due to a low flow velocity, a change of topography in depressions, footslopes or valley bottoms, and/or can be filtered and stopped by a change in vegetation such as ﬁeld boundaries.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"The inland part of the sediment gathers these different processes, separated in a vertical structure for the soil loss and lateral structure for the transport in overland flow.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Overview of the different processes for a land cell in wflow_sediment.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"(Image: sediment_inland)","category":"page"},{"location":"model_docs/vertical/sediment/#Soil-Erosion","page":"Sediment","title":"Soil Erosion","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"The first process to consider in sediment dynamics is the generation of sediments by land erosion. The main processes behind soil loss are rainfall erosion and overland flow erosion. In order to model such processes at a fine time and space scale, physics-based models such as ANSWERS and EUROSEM were chosen here.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"The choice of rainfall erosion method is set up in the model section of the TOML:","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"[model]\nrainerosmethod = \"answers\" # Rainfall erosion equation: [\"answers\", \"eurosem\"]","category":"page"},{"location":"model_docs/vertical/sediment/#Rainfall-erosion","page":"Sediment","title":"Rainfall erosion","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"In wflow_sediment, rainfall erosion can both be modelled using EUROSEM or ANSWERS equation. The main difference between the models is that EUROSEM uses a more physics-based approach based on the kinetic energy of the rain drops impacting the soil (Morgan et al, 1998), while ANSWERS is more empirical and uses parameters from the USLE model (Beasley et al, 1991).","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"In EUROSEM, rainfall erosion is modelled according to rainfall intensity and its kinetic energy when it reaches the soil according to equations developed by Brandt (1990). As the intensity of the rain kinetic energy depends on the length of the fall, rainfall intercepted by vegetation will then be reduced compared to direct throughfall. The kinetic energy of direct throughfall is estimated by (Morgan et al, 1998):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   KE_direct = 895 + 844log_10R_i","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where KE_direct is the kinetic energy of direct throughfall (J m^-2 mm^-1) and R_i is rainfall intensity (mm h^-1). If the rainfall is intercepted by vegetation and falls as leaf drainage, its kinetic energy is then reduced according to (Brandt, 1990):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   KE_leaf = 158H_p^05 - 587","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where KE_leaf is kinetic energy of leaf drainage (J m^-2 mm^-1) and H_p is the effective canopy height (half of plant height in m). Canopy height can be derived from the global map from Simard & al. (2011) or by user input depending on the land use.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Kinetic energies from both direct throughfall and leaf drainage are then multiplied by the respective depths of direct throughfall and leaf drainage (mm) and added to get the total rainfall kinetic energy KE. The soil detached by rainfall D_R (g m^-2) is then:","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   D_R = kKEe^-varphi h","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where k is an index of the detachability of the soil (g J^-1), KE is the total rainfall kinetic energy (J m^-2), h is the surface runoff depth on the soil (m) and varphi is an exponent varying between 0.9 and 3.1 used to reduce rainfall impact if the soil is already covered by water. As a simplification, Torri (1987) has shown that a value of 2.0 for varphi is representative enough for a wide range of soil conditions. The detachability of the soil k depends on the soil texture (proportion of clay, silt and sand content) and corresponding values are defined in EUROSEM user guide (Morgan et al, 1998). As a simplification, in wflow_sediment, the mean value of the detachability shown in the table below are used. Soil texture can for example be derived from the topsoil clay and silt content from SoilGrids (Hengl et al, 2017).","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Table: Mean detachability of soil depending on its texture (Morgan et al, 1998).","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Texture (USDA system) Mean detachability k (g/J)\nClay 2.0\nClay Loam 1.7\nSilt 1.2\nSilt Loam 1.5\nLoam 2.0\nSandy Loam 2.6\nLoamy Sand 3.0\nFine Sand 3.5\nSand 1.9","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Rainfall erosion is handled differently in ANSWERS. There, the impacts of vegetation and soil properties are handled through the USLE coefficients in the equation (Beasley et al, 1991):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   D_R = 0108  C_USLE  K_USLE  A_i  R_i^2","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where D_R is the soil detachment by rainfall (here in kg min^-1), C_USLE is the soil cover-management factor from the USLE equation, K_USLE is the soil erodibility factor from the USLE equation, A_i is the area of the cell (m^2) and R_i is the rainfall intensity (here in mm min^-1). There are several methods available to estimate the C and K factors from the USLE. They can come from user input maps, for example maps resulting from Panagos & al.'s recent studies for Europe (Panagos et al, 2015) (Ballabio et al, 2016). To get an estimate of the C factor globally, the other method is to estimate C values for the different land use type in from global land cover maps (e.g. GlobCover). An example is given for the global land cover map GlobCover, summed up in the table below, the values come from a literature study including Panagos et al.'s review (2015), Gericke & al. (2015), Mansoor & al. (2013), Chadli et al. (2016), de Vente et al. (2009), Borrelli et al. (2014), Yang et al. (2003) and Bosco et al. (2015).","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"The other methods to estimate the USLE K factor are to use either topsoil composition or topsoil geometric mean diameter. K estimation from topsoil composition is estimated with the equation developed in the EPIC model (Williams et al, 1983):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   K_USLE = left 02 + 03expleft-00256SANfrac(1-SIL)100right right\n   left(fracSILCLA+SILright)^03 \n   left(1-frac025OCOC+e^(372-295OC)right)left(1-frac075SNSN+e^(-551+229SN)right)","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where CLA, SIL, SAN are respectively the clay, silt and sand fractions of the topsoil (%), OC is the topsoil organic carbon content (%) and SN is 1-SAN100. These soil parameters can be derived for example from the SoilGrids dataset. The K factor can also be estimated from the soil mean geometric diameter using the formulation from the RUSLE guide by Renard & al. (1997):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   K_USLE = 00034 + 00405e^left(-dfrac12left(dfraclog_10(D_g)+165907101right)^2right)","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where D_g is the soil geometric mean diameter (mm) estimated from topsoil clay, silt, sand fraction.","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Table: Estimation of USLE C factor per Globcover land use type","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"GlobCover Value Globcover label C_USLE\n11 Post-flooding or irrigated croplands (or aquatic) 0.2\n14 Rainfed croplands 0.35\n20 Mosaic cropland (50-70%) vegetation (grassland/shrubland/forest) (20-50%) 0.27\n30 Mosaic vegetation (grassland/shrubland/forest) (50-70%) / cropland (20-50%) 0.25\n40 Closed to open (>15%) broadleaved evergreen or semi-deciduous forest (>5m) 0.0065\n50 Closed (>40%) broadleaved deciduous forest (>5m) 0.001\n60 Open (15-40%) broadleaved deciduous forest/woodland (>5m) 0.01\n70 Closed (>40%) needleleaved evergreen forest (>5m) 0.001\n90 Open (15-40%) needleleaved deciduous or evergreen forest (>5m) 0.01\n100 Closed to open (>15%) mixed broadleaved and needleleaved forest (>5m) 0.02\n110 Mosaic forest or shrubland (50-70%) / grassland (20-50%) 0.015\n120 Mosaic grassland (50-70%) / forest or shrubland (20-50%) 0.03\n130 Closed to open (>15%) (broadleaved or needleleaved, evergreen or deciduous) shrubland (<5m) 0.035\n140 Closed to open (>15%) herbaceous vegetation (grassland, savannas or lichens/mosses) 0.05\n150 Sparse (<15%) vegetation 0.35\n160 Closed to open (>15%) broadleaved forest regularly flooded (semi-permanently or temporarily) - Fresh or brackish water 0.001\n170 Closed (>40%) broadleaved forest or shrubland permanently flooded - Saline or brackish water 0.0005\n180 Closed to open (>15%) grassland or woody vegetation on regularly flooded or waterlogged soil - Fresh, brackish or saline water 0.04\n190 Artificial surfaces and associated areas (Urban areas >50%) 0.0\n200 Bare areas 0.0\n210 Water bodies 0.0\n220 Permanent snow and ice 0.0\n230 No data (burnt areas, clouds,…) 0.0","category":"page"},{"location":"model_docs/vertical/sediment/#Overland-flow-erosion","page":"Sediment","title":"Overland flow erosion","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Overland flow (or surface runoff) erosion is induced by the strength of the shear stress of the surface water on the soil. As in rainfall erosion, the effect of the flow shear stress can be reduced by the soil vegetation or by the soil properties. In wflow_sediment, soil detachment by overland flow is modelled as in ANSWERS with (Beasley et al, 1991):","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"   D_F = 090  C_USLE  K_USLE  A_i  S  q","category":"page"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"where D_F is soil detachment by flow (kg min^-1), C_USLE and K_USLE are the USLE cover and soil erodibility factors, A_i is the cell area (m^2), S is the slope gradient and q is the overland flow rate per unit width (m^2 min^-1). The USLE C and K factors can be estimated with the same methods as for rainfall erosion and here the slope gradient is obtained from the sinus rather than the tangent of the slope angle.","category":"page"},{"location":"model_docs/vertical/sediment/#Delivery-to-the-river-system","page":"Sediment","title":"Delivery to the river system","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"Once soil is detached, it can be transported by overland flow and reach the river system. This process is described in Sediment Flux in overland flow.","category":"page"},{"location":"model_docs/vertical/sediment/#References","page":"Sediment","title":"References","text":"","category":"section"},{"location":"model_docs/vertical/sediment/","page":"Sediment","title":"Sediment","text":"D.B Beasley and L.F Huggins. ANSWERS - Users Manual. Technical report, EPA, 1991.\nP. Borrelli, M. Märker, P. Panagos, and B. Schütt. Modeling soil erosion and river sediment yield for an intermountain drainage basin of the Central Apennines, Italy. Catena, 114:45-58, 2014. 10.1016/j.catena.2013.10.007\nC. Bosco, D. De Rigo, O. Dewitte, J. Poesen, and P. Panagos. Modelling soil erosion at European scale: Towards harmonization and reproducibility. Natural Hazards and Earth System Sciences, 15(2):225-245, 2015. 10.5194/nhess-15-225-2015\nC.J Brandt. Simulation of the size distribution and erosivity of raindrops and throughfall drops. Earth Surface Processes and Landforms, 15(8):687-698, dec 1990.\nK. Chadli. Estimation of soil loss using RUSLE model for Sebou watershed (Morocco). Modeling Earth Systems and Environment, 2(2):51, 2016. 10.1007/s40808-016-0105-y\nG R Foster. Modeling the erosion process. Hydrologic modeling of small watersheds, pages 295-380, 1982.\nA. Gericke. Soil loss estimation and empirical relationships for sediment delivery ratios of European river catchments. International Journal of River Basin Management, 2015. 10.1080/15715124.2014.1003302\nL.D.K. Mansoor, M.D. Matlock, E.C. Cummings, and L.L. Nalley. Quantifying and mapping multiple ecosystem services change in West Africa. Agriculture, Ecosystems and Environment, 165:6-18, 2013. 10.1016/j.agee.2012.12.001\nQ Morgan, J.N Smith, R.E Govers, G Poesen, J.W.A Auerswald, K Chisci, G Torri, D Styczen, and M E Folly. The European soil erosion model (EUROSEM): documentation and user guide. Technical report, 1998.\nS.L Neitsch, J.G Arnold, J.R Kiniry, and J.R Williams. SWAT Theoretical Documentation Version 2009. Texas Water Resources Institute, pages 1-647, 2011. 10.1016/j.scitotenv.2015.11.063\nP. Panagos, P. Borrelli, K. Meusburger, C. Alewell, E. Lugato, and L. Montanarella. Estimating the soil erosion cover-management factor at the European scale. Land Use Policy, 48:38-50, 2015. 10.1016/j.landusepol.2015.05.021\nK Renard, Gr Foster, Ga Weesies, Dk McCool, and Dc Yoder. Predicting soil erosion by water: a guide to conservation planning with the Revised Universal Soil Loss Equation (RUSLE). Washington, 1997.\nD. Torri, M. Sfalanga, and M. Del Sette. Splash detachment: Runoff depth and soil cohesion. Catena, 14(1-3):149-155, 1987. 10.1016/S0341-8162(87)80013-9\nJ. de Vente, J. Poesen, G. Govers, and C. Boix-Fayos. The implications of data selection for regional erosion and sediment yield modelling. Earth Surface Processes and Landforms, 34(15):1994-2007, 2009. 10.1002/esp.1884\nG. Verstraeten and J. Poesen. Estimating trap efficiency of small reservoirs and ponds: methods and implications for the assessment of sediment yield. Progress in Physical Geography, 24(2):219-251, 2000. 10.1177/030913330002400204\nO. Vigiak, A. Malago, F. Bouraoui, M. Vanmaercke, and J. Poesen. Adapting SWAT hillslope erosion model to predict sediment concentrations and yields in large Basins. Science of the Total Environment, 538:855-875, 2015. 10.1016/j.scitotenv.2015.08.095\nJ.R. Williams, K.G. Renard, and P.T. Dyke. EPIC A new method for assessing erosion's effect on soil productivity. Journal of Soil and Water Conservation, 38(5):381-383, 1983.\nD. Yang, S. Kanae, T. Oki, T. Koike, and K. Musiake. Global potential soil erosion with reference to land use and climate changes. Hydrological Processes, 17(14):2913-2928, 2003. 10.1002/hyp.1441","category":"page"},{"location":"","page":"About wflow","title":"About wflow","text":"CurrentModule = Wflow","category":"page"},{"location":"#About-wflow","page":"About wflow","title":"About wflow","text":"","category":"section"},{"location":"","page":"About wflow","title":"About wflow","text":"Wflow is Deltares' solution for modelling hydrological processes, allowing users to account for precipitation, interception, snow accumulation and melt, evapotranspiration, soil water, surface water, groundwater recharge, and water demand and allocation in a fully distributed environment. Successfully applied worldwide for analyzing flood hazards, drought, climate change impacts and land use changes, wflow is growing to be a leader in hydrology solutions. Wflow is conceived as a framework, within which multiple distributed model concepts are available, which maximizes the use of open earth observation data, making it the hydrological model of choice for data scarce environments. Based on gridded topography, soil, land use and climate data, wflow calculates all hydrological fluxes at any given grid cell in the model at a given time step.","category":"page"},{"location":"","page":"About wflow","title":"About wflow","text":"Wflow was born out of the creation of Deltares in 2008, when a strategic review identified the need for a distributed hydrological model to allow the simulation of flows at the catchment scale. With the intention being to encourage greater scientific collaboration. For this reason:","category":"page"},{"location":"","page":"About wflow","title":"About wflow","text":"Wflow is free and open source software.\nWflow is easily coupled with other models and software applications.\nContribution to the wflow code development is encouraged.","category":"page"},{"location":"","page":"About wflow","title":"About wflow","text":"From 2021 the wflow code is distributed under the MIT License. Wflow is also available as a compiled executable under the Deltares terms and conditions. The wflow computational engine is built in the Julia language, a high-performance computing language. Wflow does not include a graphical user interface and is designed for maximum user flexibility. Prior to 2021, wflow was developed in Python on top of the PCRaster Python extension. The Python version is still available, but not actively developed.","category":"page"},{"location":"user_guide/step5_output/#Step-5:-Analyzing-the-model-output","page":"Step 5: Analyzing the model output","title":"Step 5: Analyzing the model output","text":"","category":"section"},{"location":"user_guide/step5_output/","page":"Step 5: Analyzing the model output","title":"Step 5: Analyzing the model output","text":"After running the model example from the previous step 4, the model results can be found in data/output_moselle_simple.csv.","category":"page"},{"location":"user_guide/step5_output/","page":"Step 5: Analyzing the model output","title":"Step 5: Analyzing the model output","text":"If required, it is also possible to output netCDF files as output, by modifying the TOML file. An example is shown below:","category":"page"},{"location":"user_guide/step5_output/","page":"Step 5: Analyzing the model output","title":"Step 5: Analyzing the model output","text":"# Spatial output\n[output]\npath = \"data/output.nc\"\n\n[output.lateral.river]\nq_av = \"q_river\"\n\n[output.lateral.land]\nq = \"q_land\"\nh = \"h_land\"\n\n# Scalar output (mapped to the specified map)\n[netcdf]\npath = \"data/output_scalar.nc\"\n\n[[netcdf.variable]]\nname = \"Q\"\nmap = \"gauges\"\nparameter = \"lateral.river.q_av\"\n\n[[netcdf.variable]]\nname = \"prec\"\nmap = \"subcatchment\"\nparameter = \"vertical.precipitation\"\nreducer = \"mean\"","category":"page"},{"location":"user_guide/step5_output/","page":"Step 5: Analyzing the model output","title":"Step 5: Analyzing the model output","text":"Using your own preferred programming language, the model output files can be easily read and visualized.","category":"page"},{"location":"model_docs/lateral/gwf/#lateral_gwf","page":"Groundwater flow","title":"Groundwater flow","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Single layer groundwater flow requires the four following components, and each is described in more detail below:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"aquifer\nconnectivity\nconstanthead\nboundaries","category":"page"},{"location":"model_docs/lateral/gwf/#Aquifer-types","page":"Groundwater flow","title":"Aquifer types","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Groundwater flow can occur either in a confined or unconfined aquifer. Confined aquifers are overlain by a poorly permeable confining layer (e.g. clay). No air can get in to fill the pore space so that the aquifer always remains fully saturated. For a confined aquifer, water will always flow along the complete height H [m] over the aquifer and transmissivity kH [m^2 d^-1] is a constant (k [m d^-1] is the horizontal hydraulic conductivity). Specific storage is the amount of water an aquifer releases per unit change in hydraulic head, per unit volume of aquifer, as the aquifer and the groundwater itself is compressed. Its value is much smaller than specific yield, between 1e-5 (stiff) and 0.01 (weak).","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The upper boundary of an unconfined aquifer is the water table (the phreatic surface). Specific yield (or drainable porosity) represents the volumetric fraction the aquifer will yield when all water drains and the pore volume is filled by air instead. Specific yield will vary roughly between 0.05 (clay) and 0.45 (peat) (Johnson, 1967).","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Groundwater flow is solved forward in time and central in space. The vertically averaged governing equation for an inhomogeneous and isotropic aquifer in one dimension can be written as:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    S fracphidelta t =  fracdeltadelta x (kH fracphidelta x) + Q","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where S [m m^-1] is storativity (or specific yield), phi [m] is hydraulic head, t is time, k [m t^-1] is horizontal hydraulic conductivity, H [m] is the (saturated) aquifer height: groundwater level - aquifer bottom elevation and Q [m t^-1] represents fluxes from boundary conditions (e.g. recharge or abstraction), see also Aquifer boundary conditions.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The simplest finite difference formulation is forward in time, central in space, and can be written as:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    S_i  frac(phi_i^t+1 - phi_i^t)Delta t = -C_i-1  (phi_i-1 - phi_i) - C_i  (phi_i+1 - phi_i) + Q_ᵢ","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where _i is the cell index, ^t is time, Delta t is the step size, C_i-1 is the the intercell conductance between cell i-1 and i and C_i is the intercell conductance between cell i and i+1. The connection data between cells is stored as part of the Connectivity struct, see also Connectivity for more information.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Conductance C is defined as:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    C = frackH wl","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where w [m] is the width of the cell to cell connection, and l [m] is the length of the cell to cell connection. k and H may both vary in space; intercell conductance is therefore an average using the properties of two cells.  For the calculation of the intercell conductance C the harmonic mean is used (see also Goode and Appel, 1992), here between cell index i and cell index i+1, in the x direction:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    C_i = w  frac(k_iH_icdot k_i+1H_i+1)(k_iH_i cdot l_i+1 + k_i+1H_i+1 cdot l_i)","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where H [m] is the aquifer top - aquifer bottom, and k, l_i is the length in cell i (05 Delta x_i),  l_i+1 is the length in cell i+1 (05 Delta x_i+1) and w as previously defined. For an unconfined aquifer the intercell conductance is scaled by using the \"upstream saturated fraction\" as the MODFLOW documentation calls it. In this approach, the saturated thickness of a cell-to-cell is approximated using the cell with the highest head. This results in a consistent overestimation of the saturated thickness, but it avoids complexities related with cell drying and rewetting, such as having to define a \"wetting threshold\" or a \"wetting factor\". See also the documentation for MODFLOW-NWT (Niswonger et al., 2011) or MODFLOW6 (Langevin et al., 2017) for more background information. For more background on drying and rewetting, see for example McDonald et al. (1991).","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For the finite difference formulation, there is only one unknown, phi_i^t+1. Reshuffling terms:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"phi_i^t+1 = phi_i^t + (C_i-1  (phi_i - phi_i-1) + C_i  (phi_i+1 - phi_i) + Q_i) fracΔtS_i","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"This can be generalized to two dimensions, for both regular and irregular cell connectivity. Finally, a stable time step size can be computed given the forward-in-time, central in space scheme, based on the following criterion from Chu and Willis (1984):","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"fracDelta t k H(Delta x  Delta y S)  le frac14","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Delta t [d] is the stable time step size, Delta x [m] is the cell length in the x direction and Delta y [m] is the cell length in the y direction, k is the horizontal hydraulic conductivity [m^2 d^-1] and H [m] is the saturated thickness of the aquifer. For each cell frac(Delta x  Delta y S)k H is calculated, the minimum of these values is determined, and multiplied by frac14, to get the stable time step size.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For more details about the finite difference formulation and the stable time step size criterion we refer to the paper of Chu and Willis (1984).","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Boundary conditions can be classified into three categories:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"specified head (Dirichlet)\nspecified flux (Neumann)\nhead-dependent flux (Robin)","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Neumann and Robin conditions are implemented by adding to or subtracting from a net (lumped) cell flux. Dirichlet conditions are special cased, since they cannot (easily) be implemented via the flux, but the head is set directly instead.","category":"page"},{"location":"model_docs/lateral/gwf/#Connectivity","page":"Groundwater flow","title":"Connectivity","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The connectivity between cells is defined as follows.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Wflow.Connectivity","category":"page"},{"location":"model_docs/lateral/gwf/#Wflow.Connectivity","page":"Groundwater flow","title":"Wflow.Connectivity","text":"Connectivity{T}\n\nStores connection data between cells. Connections are stored in a compressed sparse column (CSC) adjacency matrix: only non-zero values are stored. Primarily, this consist of two vectors:\n\nthe row value vector holds the cell indices of neighbors\nthe column pointers marks the start and end index of the row value vector\n\nThis matrix is square: n = m = ncell. nconnection is equal to nnz (the number of non-zero values).\n\nncell: the number of (active) cells in the simulation\nnconnection: the number of connections between cells\nlength1: for every connection, the length in the first cell, size nconnection\nlength2: for every connection, the length in the second cell, size nconnection\nwidth: width for every connection, (approx.) perpendicular to length1 and length2, size nconnection\ncolptr: CSC column pointer (size ncell + 1)\nrowval: CSC row value (size nconnection)\n\n\n\n\n\n","category":"type"},{"location":"model_docs/lateral/gwf/#Constant-head","page":"Groundwater flow","title":"Constant head","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Dirichlet boundary conditions can be specified through the field constanthead (type ConstantHead)  of the GroundwaterFlow struct.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"@get_units struct ConstantHead{T}\n    head::Vector{T} | \"m\"\n    index::Vector{Int} | \"-\"\nend","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"For the model SBM + Groundwater flow this boundary condition is optional, and if used should be specified in the TOML file as follows (see also sbm_gwf_config.toml):","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"[model]\nconstanthead = true","category":"page"},{"location":"model_docs/lateral/gwf/#Aquifer-boundary-conditions","page":"Groundwater flow","title":"Aquifer boundary conditions","text":"","category":"section"},{"location":"model_docs/lateral/gwf/#River","page":"Groundwater flow","title":"River","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The flux between river and aquifer is calculated using Darcy's law following the approach in MODFLOW:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"    Q_riv =  BigglbraceC_i textmin(h_riv - B_riv h_riv - phi) h_riv  phi atop C_e (h_riv - phi)  h_riv leq phi","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Q_riv is the exchange flux from river to aquifer [L^3 T^-1], C_i [L^2 T^-1] is the river bed infiltration conductance, C_e [L^2 T^-1] is the river bed exfiltration conductance, B_riv the bottom of the river bed [L], h_riv is the river stage [L] and phi is the hydraulic head in the river cell [L].","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow river boundary condition section of the Model parameters provides the parameters of the struct River. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The exchange flux (river to aquifer) Q_riv is an output variable (field flux of the River struct), and is used to update the total flux in a river cell. For the model SBM + Groundwater flow, the water level h [m] of the river kinematic wave in combination with the river bottom is used to update the stage field of the River struct each time step.","category":"page"},{"location":"model_docs/lateral/gwf/#Drainage","page":"Groundwater flow","title":"Drainage","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The flux from drains to the aquifer is calculated as follows:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_drain = C_drain textmin(0 h_drain - phi)","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"where Q_drain is the exchange flux from drains to aquifer [L^3 T^-1], C_drain [L^2 T^-1] is the drain conductance, h_drain is the drain elevation [L] and phi is the hydraulic head in the cell with drainage [L].","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow drainage boundary condition section of the Model parameters provides the parameters of the struct Drainage. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The exchange flux (drains to aquifer) Q_drain is an output variable (field flux of struct Drainage), and is used to update the total flux in a cell with drains. For the model SBM + Groundwater flow this boundary condition is optional, and if used should be specified in the TOML file as follows (see also sbm_gwf_config.toml):","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"[model]\ndrains = true","category":"page"},{"location":"model_docs/lateral/gwf/#Recharge","page":"Groundwater flow","title":"Recharge","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The recharge flux Q_r to the aquifer is calculated as follows:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_r = R  A","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"with R the recharge rate [L T^-1] and A the area [L^2 ] of the aquifer cell.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow recharge boundary condition section of the Model parameters section provides the parameters of the struct Recharge. Parameters that can be set directly from the static input data (netCDF) are marked in this Table.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The recharge flux Q_r is an output variable (field flux of struct Recharge), and is used to update the total flux in a cell where recharge occurs. For the model SBM + Groundwater flow, the recharge rate from the vertical SBM concept recharge [mm] is used to update the rate field of the Recharge struct each time step. The rate field is multiplied by the area field of the aquifer.","category":"page"},{"location":"model_docs/lateral/gwf/#Head-boundary","page":"Groundwater flow","title":"Head boundary","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"This boundary is a fixed head with time (not affected by the model stresses over time)) outside of the model domain, and is generally used to avoid an unnecessary extension of the model domain to the location of the fixed boundary (for example a large lake). The flux from the boundary Q_hb [L^3 T^-1] is calculated as follows:","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Q_hb = C_hb (phi_hb - phi)","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"with C_hb the conductance of the head boundary [L^2 T^-1], phi_hb the head [L] of the head boundary and  phi the head of the aquifer cell.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the Groundwater flow head boundary condition section of the Model parameters provides the parameters of the struct HeadBoundary.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The head boundary flux Q_hb is an output variable (field flux of struct HeadBoundary), and is used to update the total flux in a cell where this type of boundary occurs. The parameter Head phi_hb can be specified as a fixed or time dependent value.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nThis boundary is not (yet) part of the model SBM + Groundwater flow.","category":"page"},{"location":"model_docs/lateral/gwf/#Well-boundary","page":"Groundwater flow","title":"Well boundary","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"A volumetric well rate [L^3 T^-1] can be specified as a boundary condition.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The Table in the well boundary condition section of the Model parameters provides the parameters of the struct Well.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"The volumetric well rate Q_well can be can be specified as a fixed or time dependent value. If a cell is dry, the actual well flux flux is set to zero (see also the last note on this page).","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nThis boundary is not (yet) part of the model SBM + Groundwater flow.","category":"page"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"note: Note\nFor an unconfined aquifer the boundary fluxes are checked, in case of a dry aquifer cell a negative flux is not allowed.","category":"page"},{"location":"model_docs/lateral/gwf/#References","page":"Groundwater flow","title":"References","text":"","category":"section"},{"location":"model_docs/lateral/gwf/","page":"Groundwater flow","title":"Groundwater flow","text":"Chu, W. S., & Willis, R. (1984). An explicit finite difference model for unconfined aquifers. Groundwater, 22(6), 728-734.\nGoode, D. J., & Appel, C. A. (1992). Finite-Difference Interblock Transmissivity for Unconﬁned Aquifers and for Aquifers having Smoothly Varying Transmissivity Water-resources investigations report, 92, 4124.\nJohnson, A. I. (1967), Specific yield: compilation of specific yields for various materials, Water Supply Paper 1662-D, Washington, D.C.: U.S. Government Printing Office, p. 74, doi:10.3133/wsp1662D.\nLangevin, C.D., Hughes, J.D., Banta, E.R., Niswonger, R.G., Panday, Sorab, and Provost, A.M., 2017, Documentation for the MODFLOW 6 Groundwater Flow Model: U.S. Geological Survey Techniques and Methods, book 6, chap. A55, 197 p., https://doi.org/10.3133/tm6A55.\nMcDonald, M.G., Harbaugh, A.W., Orr, B.R., and Ackerman, D.J., 1991, A method of converting no-flow cells to variable-head cells for the U.S. Geological Survey modular finite-difference groundwater flow model: U.S. Geological Survey Open-File Report 91-536, 99 p.\nNiswonger, R.G., Panday, Sorab, and Ibaraki, Motomu, 2011, MODFLOW-NWT, A Newton formulation for MODFLOW-2005: U.S. Geological Survey Techniques and Methods 6-A37, 44 p.","category":"page"}]
}
