<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Kinematic wave · Wflow.jl</title><link rel="canonical" href="https://deltares.github.io/Wflow.jl/lateral/kinwave/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Wflow.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Wflow.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quick-start/">Quick start</a></li><li><a class="tocitem" href="../../cli/">Command line interface</a></li><li><a class="tocitem" href="../../structure/">Model structure</a></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../../model/sbm/">wflow_sbm</a></li><li><a class="tocitem" href="../../model/hbv/">wflow_hbv</a></li><li><a class="tocitem" href="../../model/sediment/">wflow_sediment</a></li></ul></li><li><span class="tocitem">Vertical components</span><ul><li><a class="tocitem" href="../../vertical/sbm/">SBM</a></li><li><a class="tocitem" href="../../vertical/hbv/">HBV</a></li><li><a class="tocitem" href="../../vertical/process/">Vertical processes</a></li><li><a class="tocitem" href="../../vertical/sediment/">Soil Loss</a></li></ul></li><li><span class="tocitem">Lateral components</span><ul><li class="is-active"><a class="tocitem" href>Kinematic wave</a><ul class="internal"><li><a class="tocitem" href="#Surface-routing"><span>Surface routing</span></a></li><li><a class="tocitem" href="#Subsurface-flow-routing"><span>Subsurface flow routing</span></a></li><li><a class="tocitem" href="#Subcatchment-flow"><span>Subcatchment flow</span></a></li><li><a class="tocitem" href="#Limitations"><span>Limitations</span></a></li><li><a class="tocitem" href="#Reservoirs-and-Lakes"><span>Reservoirs and Lakes</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../gwf/">Groundwater flow</a></li><li><a class="tocitem" href="../sediment/">Sediment Flux</a></li></ul></li><li><a class="tocitem" href="../../bmi/">Basic Model Interface</a></li><li><a class="tocitem" href="../../fews/">Run from Delft-FEWS</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Lateral components</a></li><li class="is-active"><a href>Kinematic wave</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Kinematic wave</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Deltares/Wflow.jl/blob/master/docs/src/lateral/kinwave.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Kinematic-wave"><a class="docs-heading-anchor" href="#Kinematic-wave">Kinematic wave</a><a id="Kinematic-wave-1"></a><a class="docs-heading-anchor-permalink" href="#Kinematic-wave" title="Permalink"></a></h1><h2 id="Surface-routing"><a class="docs-heading-anchor" href="#Surface-routing">Surface routing</a><a id="Surface-routing-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-routing" title="Permalink"></a></h2><p>The main flow routing scheme available in Wflow.jl is the kinematic wave approach for channel and overland flow, assuming that the topography controls water flow mostly. The kinematic wave equations are (Chow, 1988):</p><p class="math-container">\[  \dfrac{dQ}{dx} + \dfrac{dA}{dt} = q \\~\\
   A = \alpha Q^{\beta}\]</p><p>These equations can then be combined as a function of streamflow only:</p><p class="math-container">\[    \dfrac{dQ}{dx} + \alpha \beta Q^{\beta - 1} \dfrac{dQ}{dt} = q\]</p><p>where <span>$Q$</span> is the surface runoff in the kinematic wave [m<span>$^3$</span>/s], <span>$x$</span> is the length of the runoff pathway [m], <span>$A$</span> is the cross-section area of the runoff pathway [m<span>$^{2}$</span>], <span>$t$</span> is the integration timestep [s] and <span>$\alpha$</span> and <span>$\beta$</span> are coefficients.</p><p>These equations are solved with a nonlinear scheme using Newton’s method and can also be iterated depending on the  model space and time resolution. By default, the iterations are performed until a stable solution is reached (<span>$\epsilon &lt; 10^{-12}$</span>). For larger models, the number of iterations can also be fixed for to a specific sub-timestep (in seconds) for both overland and channel flows to improve simulation time. To enable (fixed or not) iterations of the kinematic wave the following lines can be inserted in the TOML file of the model:</p><pre><code class="language-toml">[model]
# Enable iterations of the kinematic wave
kin_wave_iteration = true
# Fixed sub-timestep for iterations of channel flow (river cells)
kw_river_tstep = 900
# Fixed sub-timestep for iterations of overland flow (land cells)
kw_land_tstep = 3600</code></pre><h2 id="Subsurface-flow-routing"><a class="docs-heading-anchor" href="#Subsurface-flow-routing">Subsurface flow routing</a><a id="Subsurface-flow-routing-1"></a><a class="docs-heading-anchor-permalink" href="#Subsurface-flow-routing" title="Permalink"></a></h2><p>In the SBM model the kinematic wave approach is used to route subsurface flow laterally. The saturated store <span>$S$</span> can be drained laterally by saturated downslope subsurface flow per unit width of slope <span>$w$</span> [mm] according to:</p><p class="math-container">\[    q=\frac{K_{0}\mathit{tan(\beta)}}{f}(e^{(-fz_{i})}-e^{(-fz_{t})})\]</p><p>where <span>$\beta$</span> is element slope angle [deg.], <span>$q$</span> is subsurface flow [mm<span>$^{2}$</span>/t], <span>$K_{0}$</span> is the saturated hydraulic conductivity at the soil surface [mm/t], <span>$z_{i}$</span> is the water table depth [mm],<span>$z_{t}$</span> is total soil depth [mm], and <span>$f$</span> is a scaling parameter [mm<span>$^{-1}$</span>]:</p><p class="math-container">\[    f=\frac{\theta_{s}-\theta_{r}}{M},\,\]</p><p>where <span>$\theta_{s}$</span> is saturated water content [mm/mm] and <span>$\theta_{r}$</span> is residual water content [mm/mm] and <span>$M$</span> represents a model parameter [mm], that determines the decrease of vertical saturated conductivity with depth.</p><p>Combining with the following continuity equation:</p><p class="math-container">\[    (\theta_s-\theta_r)\frac{\partial h}{\partial t} = -w\frac{\partial q}{\partial x} + wr\]</p><p>where <span>$h$</span> is the water table height [mm], <span>$x$</span> is the distance downslope [mm], and <span>$r$</span> is the netto input rate [mm/t] to the saturated store. Substituting for <span>$h (\frac{\partial q}{\partial h})$</span>, gives:</p><p class="math-container">\[  w \frac{\partial q}{\partial t} = -cw\frac{\partial q}{\partial x} + cwr\]</p><p>where celerity <span>$c = \frac{K_{0}\mathit{tan(\beta)}}{(\theta_s-\theta_r)} e^{(-fz_{i})}$</span></p><p>The kinematic wave equation for lateral subsurface flow is solved iteratively using Newton&#39;s method.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For the lateral subsurface flow kinematic wave the model timestep is not adjusted. For certain model timestep and model grid size combinations this may result in loss of accuracy.</p></div></div><h2 id="Subcatchment-flow"><a class="docs-heading-anchor" href="#Subcatchment-flow">Subcatchment flow</a><a id="Subcatchment-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Subcatchment-flow" title="Permalink"></a></h2><p>Normally the the kinematic wave is continuous throughout the model. By using the the <code>pits</code> entry in the model and input sections of the TOML file all flow is at the subcatchment only (upstream of the pit locations, defined by the netCDF variable <code>wflow_pits</code> in the example below) and no flow is transferred from one subcatchment to another. This can be convenient when connecting the result of the model to a water allocation model such as Ribasim.</p><pre><code class="language-toml">[input]
# these are not directly part of the model
pits = &quot;wflow_pits&quot;

[model]
pits = true</code></pre><h2 id="Limitations"><a class="docs-heading-anchor" href="#Limitations">Limitations</a><a id="Limitations-1"></a><a class="docs-heading-anchor-permalink" href="#Limitations" title="Permalink"></a></h2><p>The kinematic wave approach for channel, overland and lateral subsurface flow, assumes that the topography controls water flow mostly. This assumption holds for steep terrain, but in less steep terrain the hydraulic gradient is likely not equal to the surface slope (subsurface flow), or pressure differences and inertial momentum cannot be neglected (channel and overland flow). In addition, while the kinemative wave equations are solved with a nonlinear scheme using Newton&#39;s method (Chow, 1988), other model equations are solved through a simple explicit scheme. In summary the following limitations apply:</p><ul><li><p>Channel flow, and to a lesser degree overland flow, may be unrealistic in terrain that is not steep, and where pressure forces and inertial momentum are important.</p></li><li><p>The lateral movement of subsurface flow may be very wrong in terrain that is not steep.</p></li></ul><h2 id="Reservoirs-and-Lakes"><a class="docs-heading-anchor" href="#Reservoirs-and-Lakes">Reservoirs and Lakes</a><a id="Reservoirs-and-Lakes-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoirs-and-Lakes" title="Permalink"></a></h2><p>Simplified reservoirs and lakes models can be included as part of the river kinematic wave network.</p><h3 id="Reservoirs"><a class="docs-heading-anchor" href="#Reservoirs">Reservoirs</a><a id="Reservoirs-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoirs" title="Permalink"></a></h3><p>Simple reservoirs can be included within the kinematic wave river routing by supplying the following reservoir parameters:</p><ul><li><code>locs</code> - Outlet of the reservoirs in which each reservoir has a unique id</li><li><code>area</code> - Surface area of the reservoirs [m<span>$^2$</span>]</li><li><code>areas</code> - Reservoir coverage</li><li><code>targetfullfrac</code> - Target fraction full (of max storage) for the reservoir: number between 0 and 1</li><li><code>targetminfrac</code> - Target minimum full fraction (of max storage). Number between 0 and 1</li><li><code>maxvolume</code> - Maximum reservoir storage (above which water is spilled) [m<span>$^3$</span>]</li><li><code>demand</code> - Minimum (environmental) flow requirement downstream of the reservoir  [m<span>$^3$</span> s<span>$^{-1}$</span>]</li><li><code>maxrelease</code> - Maximum Q that can be released if below spillway [m<span>$^3$</span> s<span>$^{-1}$</span>]</li></ul><p>By default the reservoirs are not included in the model. To include them put the following lines in the TOML file of the model:</p><pre><code class="language-toml">[model]
reservoirs = true</code></pre><p>Finally there is a mapping required between external and internal parameter names in the TOML file, with below an example:</p><pre><code class="language-toml">[input]

[input.lateral.river.reservoir]
area = &quot;ResSimpleArea&quot;
areas = &quot;wflow_reservoirareas&quot;
demand = &quot;ResDemand&quot;
locs = &quot;wflow_reservoirlocs&quot;
maxrelease = &quot;ResMaxRelease&quot;
maxvolume = &quot;ResMaxVolume&quot;
targetfullfrac = &quot;ResTargetFullFrac&quot;
targetminfrac = &quot;ResTargetMinFrac&quot;</code></pre><h3 id="Lakes"><a class="docs-heading-anchor" href="#Lakes">Lakes</a><a id="Lakes-1"></a><a class="docs-heading-anchor-permalink" href="#Lakes" title="Permalink"></a></h3><p>Natural (uncontrolled) lakes are modelled using a mass balance approach:</p><p class="math-container">\[    \dfrac{S(t + \Delta t)}{\Delta t} = \dfrac{S(t)}{\Delta t} + Q_{in} + \dfrac{(P-E) A}{\Delta t} - Q_{out}\]</p><p>where <span>$S$</span> is lake storage [m<span>$^3$</span>], <span>$\Delta t$</span> is the model timestep [s], <span>$Q_{in}$</span> is the sum of inflows (river, overland and lateral subsurface flow) [m<span>$^3$</span> s<span>$^{-1}$</span>], <span>$Q_{out}$</span> is the lake outflow at the outlet [m<span>$^3$</span> s<span>$^{-1}$</span>], <span>$P$</span> is precipitation [m], <span>$E$</span> is lake evaporation [m] and <span>$A$</span> is the lake surface area [m<span>$^2$</span>].</p><p><img src="../../images/lake.png" alt="lake_schematisation"/></p><p><em>Lake schematisation.</em></p><p>Most of the variables in this equation are already known or coming from previous timestep, apart from <span>$S(t+ \Delta t)$</span> and <span>$Q_{out}$</span> which can both be linked to the water level <span>$H$</span> in the lake using a storage curve <span>$S = f(H)$</span> and a rating curve <span>$Q = f(H)$</span>. In wflow, several options are available to select storage and rating curves, and in most cases, the mass balance is then solved by linearization and iteration or using the Modified Puls Approach from Maniak (Burek et al., 2013). Storage curves in wflow can either:</p><ul><li>Come from the interpolation of field data linking volume and lake height,</li><li>Be computed from the simple relationship <span>$S = A H$</span>.</li></ul><p>Rating curves in wlow can either:</p><ul><li>Come from the interpolation of field data linking lake outflow and water height,</li><li>Be computed from a rating curve of the form <span>$Q_{out} = \alpha {(H-H_{0})}^{\beta}$</span>, where <span>$H_{0}$</span> is the minimum water level under which the outflow is zero. Usual values for <span>$\beta$</span> are 3/2 for a rectangular weir or 2 for a parabolic weir (Bos, 1989).</li></ul><h3 id="Modified-Puls-Approach"><a class="docs-heading-anchor" href="#Modified-Puls-Approach">Modified Puls Approach</a><a id="Modified-Puls-Approach-1"></a><a class="docs-heading-anchor-permalink" href="#Modified-Puls-Approach" title="Permalink"></a></h3><p>The Modified Puls Approach is a resolution method of the lake balance that uses an explicit relationship between storage and outflow. Storage is assumed to be equal to <span>$A H$</span> and the rating curve for a parabolic weir (<span>$\beta = 2$</span>):</p><p class="math-container">\[    S = A H = A  (h + H_{0}) = \dfrac{A}{\sqrt{\alpha}} \sqrt{Q} + A H_{0}\]</p><p>Inserting this equation in the mass balance gives:</p><p class="math-container">\[    \dfrac{A}{\Delta t \sqrt{\alpha}} \sqrt{Q} + Q = \dfrac{S(t)}{\Delta t} + Q_{in} +
    \dfrac{(P-E) A}{\Delta t} - \dfrac{A H_{0}}{\Delta t} = SI - \dfrac{A H_{0}}{\Delta t}\]</p><p>The solution for Q is then:</p><p class="math-container">\[    Q = { \left( -LF + \sqrt{LF^{2} + 2  \left( SI - \dfrac{A*H_{0}}{\Delta t} \right)
    } \right) }^{2} \text{for } SI &gt; \dfrac{A H_{0}}{\Delta t}  \text{ and where}\\ 
    LF = \dfrac{A}{\Delta t \sqrt{\alpha}} \\~\\
    Q = 0 \text{ for } SI \leq \dfrac{A*H_{0}}{\Delta t}\]</p><h3 id="Lake-parameters"><a class="docs-heading-anchor" href="#Lake-parameters">Lake parameters</a><a id="Lake-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Lake-parameters" title="Permalink"></a></h3><p>Natural lakes can be included within the kinematic wave river routing in wflow, by supplying the following parameters:</p><ul><li><code>area</code> - Surface area of the lakes [m<span>$^2$</span>]</li><li><code>areas</code> - Coverage of the lakes</li><li><code>locs</code> - Outlet of the lakes in which each lake has a unique id</li><li><code>linkedlakelocs</code> - Outlet of linked (downstream) lakes (unique id)</li><li><code>waterlevel</code> - Lake water level [m], used to reinitiate lake model</li><li><code>threshold</code> - Water level threshold <span>$H_{0}$</span> under which outflow is zero [m]</li><li><code>storfunc</code> - Type of lake storage curve ; 1 for <span>$S = AH$</span> (default) and 2 for <span>$S = f(H)$</span> from lake data and interpolation</li><li><code>outflowfunc</code> - Type of lake rating curve ; 1 for <span>$Q = f(H)$</span> from lake data and interpolation, 2 for general <span>$Q = b(H - H_{0})^{e}$</span> and 3 in the case of Puls Approach <span>$Q = b(H - H_{0})^{2}$</span> (default)</li><li><code>b</code> -  Rating curve coefficient</li><li><code>e</code> - Rating curve exponent</li></ul><p>By default, the lakes are not included in the model. To include them, put the following line in the TOML file of the model:</p><pre><code class="language-toml">[model]
lakes = true</code></pre><p>There is also a mapping required between external and internal parameter names in the TOML file, with below an example:</p><pre><code class="language-toml">[input]

[input.lateral.river.lake]
area = &quot;lake_area&quot;
areas = &quot;wflow_lakeareas&quot;
b = &quot;lake_b&quot;
e = &quot;lake_e&quot;
locs = &quot;wflow_lakelocs&quot;
outflowfunc = &quot;lake_outflowfunc&quot;
storfunc  = &quot;lake_storfunc&quot;
threshold  = &quot;lake_threshold&quot;
waterlevel = &quot;lake_waterlevel&quot;</code></pre><h3 id="Additional-settings"><a class="docs-heading-anchor" href="#Additional-settings">Additional settings</a><a id="Additional-settings-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-settings" title="Permalink"></a></h3><p>Storage and rating curves from field measurement can be supplied to wflow via CSV files supplied in the same folder of the TOML file. Naming of the files uses the ID of the lakes where data are available and is of the form lake_sh_1.csv and lake_hq_1.csv for respectively the storage and rating curves of lake with ID 1.</p><p>The storage curve is stored in a CSV file with lake level [m] in the first column <code>H</code> and corresponding lake storage [m <span>$^{3}$</span>] in the second column <code>S</code>:</p><pre><code class="language-none">H,  S
392.21, 0
393.21, 430202000
393.71, 649959000
394.21, 869719000</code></pre><p>The rating curve uses level and discharge data depending on the Julian day of the year (JDOY). The first line contains <code>H</code> for the first column. The other lines contain the water level and the corresponding discharges for the different JDOY (1-365), see also the example below, that shows part of a CSV file (first 4 Julian days).</p><pre><code class="language-none">H
394,    43,     43,     43,     43
394.01, 44.838, 44.838, 44.838, 44.838
394.02, 46.671, 46.671, 46.671, 46.671
394.03, 48.509, 48.509, 48.509, 48.509
394.04, 50.347, 50.347, 50.347, 50.347
394.05, 52.179, 52.179, 52.179, 52.179</code></pre><p>Linked lakes: In some cases, lakes can be linked and return flow can be allowed from the downstream to the upstream lake. The linked lakes are defined in the <code>linkedlakelocs</code> parameter that represent the downstream lake location ID, at the grid cell of the upstream lake location.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In every file, level units are meters [m] above lake bottom and not meters above sea level [m asl]. Especially with storage/rating curves coming from data, please be careful and convert units if needed.</p></div></div><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Bos M.G., 1989. Discharge measurement structures. Third revised edition, International Institute for Land Reclamation and Improvement ILRI, Wageningen, The Netherlands.</li><li>Burek P., Van der Knijf J.M., Ad de Roo, 2013. LISFLOOD – Distributed Water Balance and flood Simulation Model – Revised User Manual. DOI: http://dx.doi.org/10.2788/24719.</li><li>Chow, V., Maidment, D. and Mays, L., 1988, Applied Hydrology. McGraw-Hill Book Company, New York.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../vertical/sediment/">« Soil Loss</a><a class="docs-footer-nextpage" href="../gwf/">Groundwater flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 20 January 2021 21:45">Wednesday 20 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
